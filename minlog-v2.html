<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MinLog - æç®€æµæ°´è´¦</title>
    <meta name="description" content="åŸºäº Karpathy æ–¹æ³•è®ºçš„ Append-Only ç¬”è®°å·¥å…·ï¼Œä½ çš„ç¬¬äºŒå¤§è„‘">
    <meta name="theme-color" content="#6366f1">

    <!-- PWA Support -->
    <link rel="manifest"
        href="data:application/json,%7B%22name%22%3A%22MinLog%22%2C%22short_name%22%3A%22MinLog%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23f8fafc%22%2C%22theme_color%22%3A%22%236366f1%22%7D">

    <!-- Tool Meta for Discovery -->
    <script type="application/json" id="tool_meta">
    {
        "tool_id": "minlog",
        "tool_name": "MinLog æç®€æµæ°´è´¦",
        "version": "2.0.0",
        "description": "åŸºäº Karpathy æ–¹æ³•è®ºçš„ Append-Only ç¬”è®°å·¥å…·ï¼Œæ”¯æŒ AI æ™ºèƒ½å›é¡¾ã€æ´å¯ŸæŒ–æ˜ã€ç¬¬äºŒå¤§è„‘å¯¹è¯",
        "author": "MinLog Team",
        "capabilities": {
            "ai": true,
            "local_draft": true,
            "offline": true,
            "export": ["txt", "json", "md"],
            "i18n": ["zh", "en"]
        },
        "tags": ["notes", "pkm", "ai", "productivity", "second-brain", "karpathy-method"],
        "ai_features": [
            "smart-review",
            "generate-report", 
            "discover-insights",
            "find-connections",
            "second-brain",
            "writing-assist",
            "auto-tag",
            "forgetting-curve",
            "feynman-test",
            "crystallization",
            "rumination"
        ]
    }
    </script>

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MinLog 2.0 - Design System & Styles
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Design Tokens
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            /* Colors - Primary */
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-300: #a5b4fc;
            --primary-400: #818cf8;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;

            /* Colors - Neutral */
            --neutral-50: #f8fafc;
            --neutral-100: #f1f5f9;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-400: #94a3b8;
            --neutral-500: #64748b;
            --neutral-600: #475569;
            --neutral-700: #334155;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;

            /* Colors - Semantic */
            --success-500: #22c55e;
            --success-600: #16a34a;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --error-500: #ef4444;
            --error-600: #dc2626;
            --info-500: #3b82f6;
            --info-600: #2563eb;

            /* Colors - Special */
            --rescue-color: #f59e0b;
            --ai-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);

            /* Typography */
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;

            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;

            --leading-tight: 1.25;
            --leading-normal: 1.5;
            --leading-relaxed: 1.75;

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;

            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);

            /* Z-Index */
            --z-dropdown: 100;
            --z-modal: 200;
            --z-toast: 300;
            --z-tooltip: 400;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Reset & Base
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--text-base);
            line-height: var(--leading-normal);
            color: var(--neutral-800);
            background: linear-gradient(135deg, var(--neutral-50) 0%, var(--primary-50) 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Layout
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .app-container {
            max-width: 768px;
            margin: 0 auto;
            padding: var(--space-4);
            padding-bottom: var(--space-12);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Header
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) 0;
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--neutral-200);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--ai-gradient);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            box-shadow: var(--shadow-md);
        }

        .logo-text {
            font-size: var(--text-xl);
            font-weight: 700;
            background: var(--ai-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            font-size: var(--text-sm);
            color: var(--neutral-500);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--neutral-100);
            border-radius: var(--radius-lg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
            color: var(--neutral-600);
            transition: all var(--transition-base);
        }

        .icon-btn:hover {
            background: var(--neutral-200);
            color: var(--neutral-800);
            transform: translateY(-1px);
        }

        .icon-btn:active {
            transform: translateY(0);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Input Area
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .input-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
            border: 1px solid var(--neutral-200);
        }

        .input-wrapper {
            display: flex;
            gap: var(--space-3);
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            min-height: 56px;
            max-height: 200px;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            font-size: var(--text-base);
            font-family: var(--font-sans);
            resize: none;
            transition: all var(--transition-base);
            line-height: var(--leading-relaxed);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .input-field::placeholder {
            color: var(--neutral-400);
        }

        .input-actions {
            display: flex;
            gap: var(--space-2);
        }

        .btn-primary {
            height: 44px;
            padding: 0 var(--space-5);
            background: var(--ai-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            white-space: nowrap;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            height: 44px;
            width: 44px;
            background: var(--neutral-100);
            color: var(--neutral-600);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secondary:hover {
            background: var(--neutral-200);
            color: var(--neutral-800);
        }

        .btn-secondary.recording {
            background: var(--error-500);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   AI Features Section
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .ai-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
            border: 1px solid var(--neutral-200);
        }

        .ai-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .ai-section-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-base);
            font-weight: 600;
            color: var(--neutral-700);
        }

        .ai-section-title::before {
            content: 'ğŸ¤–';
        }

        .ai-network-badge {
            font-size: var(--text-xs);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
            background: var(--success-500);
            color: white;
        }

        .ai-network-badge.offline {
            background: var(--neutral-400);
        }

        /* AI Feature Buttons */
        .ai-features-grid {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .ai-feature-btn {
            padding: var(--space-2) var(--space-3);
            background: var(--neutral-100);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            color: var(--neutral-700);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-1);
            white-space: nowrap;
        }

        .ai-feature-btn:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
            color: var(--primary-700);
        }

        .ai-feature-btn:active {
            transform: scale(0.98);
        }

        .ai-feature-btn.active {
            background: var(--primary-100);
            border-color: var(--primary-400);
            color: var(--primary-700);
        }

        .ai-feature-btn.more-btn {
            background: var(--neutral-50);
            border-style: dashed;
        }

        .ai-feature-btn.more-btn:hover {
            background: var(--neutral-100);
        }

        /* AI Features Dropdown */
        .ai-features-more {
            position: relative;
        }

        .ai-features-dropdown {
            position: absolute;
            top: calc(100% + var(--space-2));
            left: 0;
            background: white;
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            padding: var(--space-2);
            z-index: var(--z-dropdown);
            min-width: 200px;
            display: none;
        }

        .ai-features-dropdown.show {
            display: block;
            animation: fadeIn var(--transition-fast);
        }

        .ai-features-dropdown .ai-feature-btn {
            width: 100%;
            justify-content: flex-start;
            border: none;
            border-radius: var(--radius-md);
        }

        .ai-features-dropdown .ai-feature-btn:hover {
            background: var(--primary-50);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Report Period Selector */
        .report-period-selector {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            margin-left: var(--space-2);
        }

        .report-period-selector select {
            padding: var(--space-1) var(--space-2);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            background: white;
            cursor: pointer;
        }

        /* AI Chat Input */
        .ai-chat-wrapper {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .ai-chat-input {
            flex: 1;
            padding: var(--space-3);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-family: var(--font-sans);
            resize: none;
            min-height: 44px;
            max-height: 120px;
            transition: all var(--transition-base);
        }

        .ai-chat-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .ai-chat-send {
            width: 44px;
            height: 44px;
            background: var(--ai-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
            transition: all var(--transition-base);
        }

        .ai-chat-send:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .ai-chat-send:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* AI Output Area */
        .ai-output {
            background: var(--neutral-50);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: none;
        }

        .ai-output.show {
            display: block;
            animation: fadeIn var(--transition-base);
        }

        .ai-output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            background: var(--neutral-100);
            border-bottom: 1px solid var(--neutral-200);
        }

        .ai-output-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--neutral-600);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ai-output-actions {
            display: flex;
            gap: var(--space-2);
        }

        .ai-output-btn {
            padding: var(--space-1) var(--space-2);
            background: white;
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            color: var(--neutral-600);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .ai-output-btn:hover {
            background: var(--neutral-100);
            border-color: var(--neutral-400);
        }

        .ai-output-btn.success {
            background: var(--success-500);
            color: white;
            border-color: var(--success-500);
        }

        .ai-output-content {
            padding: var(--space-4);
            font-size: var(--text-sm);
            line-height: var(--leading-relaxed);
            color: var(--neutral-700);
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-output-content pre {
            background: var(--neutral-800);
            color: var(--neutral-100);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            overflow-x: auto;
            font-family: var(--font-mono);
            font-size: var(--text-xs);
        }

        .ai-output-content code {
            background: var(--neutral-200);
            padding: var(--space-1);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: var(--text-xs);
        }

        .ai-output-content h1,
        .ai-output-content h2,
        .ai-output-content h3 {
            margin-top: var(--space-4);
            margin-bottom: var(--space-2);
            color: var(--neutral-800);
        }

        .ai-output-content h1 {
            font-size: var(--text-xl);
        }

        .ai-output-content h2 {
            font-size: var(--text-lg);
        }

        .ai-output-content h3 {
            font-size: var(--text-base);
        }

        .ai-output-content p {
            margin-bottom: var(--space-3);
        }

        .ai-output-content ul,
        .ai-output-content ol {
            margin-left: var(--space-4);
            margin-bottom: var(--space-3);
        }

        .ai-output-content li {
            margin-bottom: var(--space-1);
        }

        .ai-output-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-8);
            color: var(--neutral-500);
        }

        .ai-output-loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--neutral-300);
            border-top-color: var(--primary-500);
            border-radius: 50%;
            margin-left: var(--space-2);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Search Section
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .search-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
            border: 1px solid var(--neutral-200);
        }

        .search-wrapper {
            display: flex;
            gap: var(--space-2);
        }

        .search-input {
            flex: 1;
            padding: var(--space-3);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            transition: all var(--transition-base);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .search-filters {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: var(--space-1) var(--space-3);
            background: var(--neutral-100);
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            color: var(--neutral-600);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--primary-100);
            border-color: var(--primary-300);
            color: var(--primary-700);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Random Resurface (AI Enhanced)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .resurface-section {
            background: linear-gradient(135deg, var(--warning-500) 0%, var(--rescue-color) 100%);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            color: white;
            box-shadow: var(--shadow-lg);
            display: none;
        }

        .resurface-section.show {
            display: block;
            animation: slideDown var(--transition-slow);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .resurface-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-3);
        }

        .resurface-title {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-weight: 600;
        }

        .resurface-badge {
            font-size: var(--text-xs);
            padding: var(--space-1) var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
        }

        .resurface-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: var(--radius-full);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
        }

        .resurface-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .resurface-content {
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
            margin-bottom: var(--space-3);
            font-size: var(--text-sm);
            line-height: var(--leading-relaxed);
        }

        .resurface-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: var(--text-xs);
            opacity: 0.9;
        }

        .resurface-reason {
            font-style: italic;
            opacity: 0.85;
            margin-top: var(--space-2);
            padding-top: var(--space-2);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: var(--text-xs);
        }

        .resurface-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
        }

        .resurface-btn {
            flex: 1;
            padding: var(--space-2);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .resurface-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .resurface-btn.primary {
            background: white;
            color: var(--warning-600);
            font-weight: 600;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Notes List
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .notes-section {
            margin-bottom: var(--space-6);
        }

        .notes-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .notes-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--neutral-700);
        }

        .notes-count {
            font-size: var(--text-sm);
            color: var(--neutral-500);
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        /* Note Card */
        .note-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--neutral-200);
            transition: all var(--transition-base);
            animation: fadeInUp var(--transition-slow);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .note-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--neutral-300);
        }

        .note-card.rescued {
            border-left: 3px solid var(--rescue-color);
        }

        .note-content {
            font-size: var(--text-sm);
            line-height: var(--leading-relaxed);
            color: var(--neutral-700);
            margin-bottom: var(--space-3);
            white-space: pre-wrap;
            word-break: break-word;
        }

        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-1);
            margin-bottom: var(--space-3);
        }

        .note-tag {
            padding: var(--space-1) var(--space-2);
            background: var(--primary-50);
            color: var(--primary-600);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
        }

        .note-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .note-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-xs);
            color: var(--neutral-400);
        }

        .note-rescue-count {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            color: var(--rescue-color);
            font-weight: 500;
        }

        .note-actions {
            display: flex;
            gap: var(--space-1);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .note-card:hover .note-actions {
            opacity: 1;
        }

        .note-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--neutral-100);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            color: var(--neutral-500);
            transition: all var(--transition-base);
        }

        .note-action-btn:hover {
            background: var(--neutral-200);
            color: var(--neutral-700);
        }

        .note-action-btn.rescue {
            color: var(--rescue-color);
        }

        .note-action-btn.rescue:hover {
            background: var(--warning-500);
            color: white;
        }

        .note-action-btn.delete:hover {
            background: var(--error-500);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-4);
            color: var(--neutral-400);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
        }

        .empty-state-text {
            font-size: var(--text-lg);
            margin-bottom: var(--space-2);
        }

        .empty-state-hint {
            font-size: var(--text-sm);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Modal
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: var(--z-modal);
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn var(--transition-fast);
        }

        .modal {
            background: white;
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn var(--transition-base);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--neutral-200);
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--neutral-800);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--neutral-100);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-500);
            transition: all var(--transition-base);
        }

        .modal-close:hover {
            background: var(--neutral-200);
            color: var(--neutral-700);
        }

        .modal-body {
            padding: var(--space-5);
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-5);
            border-top: 1px solid var(--neutral-200);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Settings Panel
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .settings-group {
            margin-bottom: var(--space-6);
        }

        .settings-group:last-child {
            margin-bottom: 0;
        }

        .settings-group-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--neutral-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-3);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--neutral-100);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-label {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .settings-label-text {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--neutral-700);
        }

        .settings-label-hint {
            font-size: var(--text-xs);
            color: var(--neutral-400);
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--neutral-300);
            border-radius: var(--radius-full);
            transition: all var(--transition-base);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: var(--radius-full);
            transition: all var(--transition-base);
            box-shadow: var(--shadow-sm);
        }

        .toggle input:checked+.toggle-slider {
            background: var(--primary-500);
        }

        .toggle input:checked+.toggle-slider::before {
            transform: translateX(22px);
        }

        /* Select Input */
        .settings-select {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            background: white;
            min-width: 140px;
            cursor: pointer;
        }

        .settings-select:focus {
            outline: none;
            border-color: var(--primary-500);
        }

        /* Text Input */
        .settings-input {
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--neutral-300);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            width: 100%;
            transition: all var(--transition-base);
        }

        .settings-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .settings-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            width: 100%;
            margin-top: var(--space-2);
        }

        /* Storage Health */
        .storage-health {
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--neutral-50);
            border-radius: var(--radius-lg);
        }

        .storage-health-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2);
        }

        .storage-health-title {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--neutral-600);
        }

        .storage-health-value {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--neutral-700);
        }

        .storage-health-bar {
            height: 8px;
            background: var(--neutral-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .storage-health-fill {
            height: 100%;
            background: var(--success-500);
            border-radius: var(--radius-full);
            transition: all var(--transition-slow);
        }

        .storage-health-fill.warning {
            background: var(--warning-500);
        }

        .storage-health-fill.critical {
            background: var(--error-500);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Export Modal
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .export-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .export-option {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--neutral-50);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .export-option:hover {
            border-color: var(--primary-300);
            background: var(--primary-50);
        }

        .export-option.selected {
            border-color: var(--primary-500);
            background: var(--primary-50);
        }

        .export-option-icon {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-2xl);
            box-shadow: var(--shadow-sm);
        }

        .export-option-info {
            flex: 1;
        }

        .export-option-title {
            font-weight: 600;
            color: var(--neutral-800);
            margin-bottom: var(--space-1);
        }

        .export-option-desc {
            font-size: var(--text-xs);
            color: var(--neutral-500);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Confirm Dialog
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .confirm-dialog {
            text-align: center;
            padding: var(--space-4);
        }

        .confirm-icon {
            font-size: 3rem;
            margin-bottom: var(--space-4);
        }

        .confirm-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--neutral-800);
            margin-bottom: var(--space-2);
        }

        .confirm-message {
            font-size: var(--text-sm);
            color: var(--neutral-500);
            margin-bottom: var(--space-6);
        }

        .confirm-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: center;
        }

        .btn-cancel {
            padding: var(--space-2) var(--space-5);
            background: var(--neutral-100);
            color: var(--neutral-700);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .btn-cancel:hover {
            background: var(--neutral-200);
        }

        .btn-danger {
            padding: var(--space-2) var(--space-5);
            background: var(--error-500);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .btn-danger:hover {
            background: var(--error-600);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Toast
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast {
            position: fixed;
            bottom: var(--space-6);
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--neutral-800);
            color: white;
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            box-shadow: var(--shadow-xl);
            z-index: var(--z-toast);
            opacity: 0;
            transition: all var(--transition-base);
            max-width: calc(100vw - var(--space-8));
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: var(--success-600);
        }

        .toast.error {
            background: var(--error-600);
        }

        .toast.warning {
            background: var(--warning-600);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Welcome Overlay
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .welcome-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-6);
        }

        .welcome-overlay.hidden {
            display: none;
        }

        .welcome-card {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            max-width: 480px;
            width: 100%;
            text-align: center;
            box-shadow: var(--shadow-xl);
            animation: welcomeIn 0.5s ease-out;
        }

        @keyframes welcomeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .welcome-logo {
            width: 80px;
            height: 80px;
            background: var(--ai-gradient);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto var(--space-6);
            box-shadow: var(--shadow-lg);
        }

        .welcome-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--neutral-800);
            margin-bottom: var(--space-2);
        }

        .welcome-subtitle {
            font-size: var(--text-base);
            color: var(--neutral-500);
            margin-bottom: var(--space-6);
            line-height: var(--leading-relaxed);
        }

        .welcome-features {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
            text-align: left;
        }

        .welcome-feature {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--neutral-50);
            border-radius: var(--radius-lg);
        }

        .welcome-feature-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-lg);
        }

        .welcome-feature-text {
            flex: 1;
        }

        .welcome-feature-title {
            font-weight: 600;
            color: var(--neutral-700);
            font-size: var(--text-sm);
        }

        .welcome-feature-desc {
            font-size: var(--text-xs);
            color: var(--neutral-500);
        }

        .welcome-btn {
            width: 100%;
            padding: var(--space-4);
            background: var(--ai-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .welcome-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Responsive Design
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 640px) {
            .app-container {
                padding: var(--space-3);
            }

            .header {
                flex-wrap: wrap;
                gap: var(--space-3);
            }

            .header-stats {
                order: 3;
                width: 100%;
                justify-content: center;
                padding-top: var(--space-3);
                border-top: 1px solid var(--neutral-200);
            }

            .input-wrapper {
                flex-direction: column;
            }

            .input-actions {
                width: 100%;
            }

            .btn-primary {
                flex: 1;
            }

            .ai-features-grid {
                justify-content: center;
            }

            .ai-feature-btn {
                font-size: var(--text-xs);
                padding: var(--space-2);
            }

            .note-actions {
                opacity: 1;
            }

            .search-wrapper {
                flex-direction: column;
            }

            .modal {
                max-height: 100vh;
                border-radius: var(--radius-lg);
            }

            .welcome-card {
                padding: var(--space-6);
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Utilities
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hidden {
            display: none !important;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--neutral-100);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neutral-300);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neutral-400);
        }

        /* Selection */
        ::selection {
            background: var(--primary-200);
            color: var(--primary-900);
        }
    </style>
</head>

<body>
    <!-- Welcome Overlay -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-card">
            <div class="welcome-logo">ğŸ“</div>
            <h1 class="welcome-title" data-i18n="welcomeTitle">æ¬¢è¿ä½¿ç”¨ MinLog</h1>
            <p class="welcome-subtitle" data-i18n="welcomeSubtitle">
                åŸºäº Karpathy æ–¹æ³•è®ºçš„æç®€æµæ°´è´¦ï¼Œ<br>ä½ çš„ç¬¬äºŒå¤§è„‘ä»è¿™é‡Œå¼€å§‹
            </p>
            <div class="welcome-features">
                <div class="welcome-feature">
                    <div class="welcome-feature-icon">âœï¸</div>
                    <div class="welcome-feature-text">
                        <div class="welcome-feature-title" data-i18n="welcomeFeature1Title">éšæ—¶è®°å½•</div>
                        <div class="welcome-feature-desc" data-i18n="welcomeFeature1Desc">æƒ³åˆ°ä»€ä¹ˆå°±è®°ä»€ä¹ˆï¼Œæ— éœ€åˆ†ç±»æ•´ç†</div>
                    </div>
                </div>
                <div class="welcome-feature">
                    <div class="welcome-feature-icon">ğŸ¤–</div>
                    <div class="welcome-feature-text">
                        <div class="welcome-feature-title" data-i18n="welcomeFeature2Title">AI æ™ºèƒ½åŠ©æ‰‹</div>
                        <div class="welcome-feature-desc" data-i18n="welcomeFeature2Desc">12 ç§ AI åŠŸèƒ½ï¼Œè®©ç¬”è®°äº§ç”Ÿä»·å€¼</div>
                    </div>
                </div>
                <div class="welcome-feature">
                    <div class="welcome-feature-icon">ğŸ£</div>
                    <div class="welcome-feature-text">
                        <div class="welcome-feature-title" data-i18n="welcomeFeature3Title">æ™ºèƒ½æ‰“æ</div>
                        <div class="welcome-feature-desc" data-i18n="welcomeFeature3Desc">AI å¸®ä½ å‘ç°è¢«é—å¿˜çš„å®è—è®°å¿†</div>
                    </div>
                </div>
            </div>
            <button class="welcome-btn" onclick="dismissWelcome()" data-i18n="welcomeStart">å¼€å§‹ä½¿ç”¨</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">ğŸ“</div>
                <span class="logo-text">MinLog</span>
            </div>
            <div class="header-stats">
                <span class="stat-item">
                    <span>ğŸ“Š</span>
                    <span id="noteCount">0</span>
                    <span data-i18n="notesCount">æ¡ç¬”è®°</span>
                </span>
                <span class="stat-item">
                    <span>ğŸ£</span>
                    <span id="rescueCount">0</span>
                    <span data-i18n="rescuedCount">æ¬¡æ‰“æ</span>
                </span>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleSearch()" title="æœç´¢" data-i18n-title="search">
                    ğŸ”
                </button>
                <button class="icon-btn" onclick="openExportModal()" title="å¯¼å‡º" data-i18n-title="export">
                    ğŸ“¤
                </button>
                <button class="icon-btn" onclick="openSettingsModal()" title="è®¾ç½®" data-i18n-title="settings">
                    âš™ï¸
                </button>
            </div>
        </header>

        <!-- Input Section -->
        <section class="input-section">
            <div class="input-wrapper">
                <textarea class="input-field" id="noteInput" placeholder="è®°å½•æ­¤åˆ»çš„æƒ³æ³•... æ”¯æŒ #æ ‡ç­¾"
                    data-i18n-placeholder="inputPlaceholder" rows="2"></textarea>
                <div class="input-actions">
                    <button class="btn-secondary" id="voiceBtn" onclick="toggleVoiceInput()" title="è¯­éŸ³è¾“å…¥"
                        data-i18n-title="voiceInput">
                        ğŸ¤
                    </button>
                    <button class="btn-primary" onclick="addNote()" id="addNoteBtn">
                        <span data-i18n="addNote">è®°å½•</span>
                        <span>â†µ</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- AI Section -->
        <section class="ai-section" id="aiSection">
            <div class="ai-section-header">
                <div class="ai-section-title" data-i18n="aiFeatures">AI åŠŸèƒ½</div>
                <span class="ai-network-badge" id="aiNetworkBadge" data-i18n="online">åœ¨çº¿</span>
            </div>

            <!-- AI Feature Buttons -->
            <div class="ai-features-grid" id="aiFeaturesGrid">
                <!-- 4 å¸¸ç”¨åŠŸèƒ½ -->
                <button class="ai-feature-btn" data-feature="second-brain" onclick="executeAIFeature('secondBrain')">
                    ğŸ§  <span data-i18n="secondBrain">ç¬¬äºŒå¤§è„‘</span>
                </button>
                <button class="ai-feature-btn" data-feature="smart-review" onclick="executeAIFeature('smartReview')">
                    ğŸ” <span data-i18n="smartReview">æ™ºèƒ½å›é¡¾</span>
                </button>
                <button class="ai-feature-btn" data-feature="generate-report"
                    onclick="executeAIFeature('generateReport')">
                    ğŸ“Š <span data-i18n="generateReport">ç”ŸæˆæŠ¥å‘Š</span>
                    <select class="report-period-selector" id="reportPeriod" onclick="event.stopPropagation()">
                        <option value="week" data-i18n="thisWeek">æœ¬å‘¨</option>
                        <option value="month" data-i18n="thisMonth">æœ¬æœˆ</option>
                        <option value="all" data-i18n="allTime">å…¨éƒ¨</option>
                    </select>
                </button>
                <button class="ai-feature-btn" data-feature="discover-insights"
                    onclick="executeAIFeature('discoverInsights')">
                    ğŸ’¡ <span data-i18n="discoverInsights">æŒ–æ˜æ´å¯Ÿ</span>
                </button>

                <!-- æ›´å¤šæŒ‰é’® -->
                <div class="ai-features-more">
                    <button class="ai-feature-btn more-btn" onclick="toggleMoreFeatures()">
                        â‹¯ <span data-i18n="moreFeatures">æ›´å¤š</span>
                    </button>
                    <div class="ai-features-dropdown" id="moreFeaturesDropdown">
                        <button class="ai-feature-btn" onclick="executeAIFeature('findConnections')">
                            ğŸ”— <span data-i18n="findConnections">å‘ç°å…³è”</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('writingAssist')">
                            âœï¸ <span data-i18n="writingAssist">å†™ä½œè¾…åŠ©</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('autoTag')">
                            ğŸ·ï¸ <span data-i18n="autoTag">æ™ºèƒ½æ ‡ç­¾</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('forgettingCurve')">
                            â° <span data-i18n="forgettingCurve">é—å¿˜æ›²çº¿</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('feynmanTest')">
                            ğŸ§ª <span data-i18n="feynmanTest">è´¹æ›¼æµ‹è¯•</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('crystallization')">
                            ğŸ’ <span data-i18n="crystallization">ç»“æ™¶æ£€æµ‹</span>
                        </button>
                        <button class="ai-feature-btn" onclick="executeAIFeature('rumination')">
                            ğŸ”® <span data-i18n="rumination">ååˆè§¦å‘</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Chat Input -->
            <div class="ai-chat-wrapper">
                <textarea class="ai-chat-input" id="aiChatInput" placeholder="é—®é—® AI å…³äºä½ çš„ç¬”è®°..."
                    data-i18n-placeholder="aiChatPlaceholder" rows="1"></textarea>
                <button class="ai-chat-send" onclick="sendAIChat()" id="aiChatSendBtn" title="å‘é€"
                    data-i18n-title="send">
                    â¤
                </button>
            </div>

            <!-- AI Output Area -->
            <div class="ai-output" id="aiOutput">
                <div class="ai-output-header">
                    <div class="ai-output-title">
                        <span id="aiOutputIcon">ğŸ¤–</span>
                        <span id="aiOutputTitle" data-i18n="aiResponse">AI å›å¤</span>
                    </div>
                    <div class="ai-output-actions">
                        <button class="ai-output-btn" onclick="copyAIOutput()" id="copyOutputBtn">
                            ğŸ“‹ <span data-i18n="copyOutput">å¤åˆ¶</span>
                        </button>
                        <button class="ai-output-btn" onclick="downloadAIOutput('md')" id="downloadMdBtn">
                            ğŸ“¥ <span data-i18n="downloadMD">MD</span>
                        </button>
                        <button class="ai-output-btn" onclick="downloadAIOutput('txt')" id="downloadTxtBtn">
                            ğŸ“„ <span data-i18n="downloadTXT">TXT</span>
                        </button>
                    </div>
                </div>
                <div class="ai-output-content" id="aiOutputContent">
                    <!-- AI è¾“å‡ºå†…å®¹ -->
                </div>
            </div>
        </section>

        <!-- Search Section (Hidden by default) -->
        <section class="search-section hidden" id="searchSection">
            <div class="search-wrapper">
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ç¬”è®°å†…å®¹æˆ– #æ ‡ç­¾..."
                    data-i18n-placeholder="searchPlaceholder">
                <button class="btn-secondary" onclick="clearSearch()">âœ•</button>
            </div>
            <div class="search-filters">
                <button class="filter-chip active" data-filter="all" onclick="setSearchFilter('all')"
                    data-i18n="filterAll">å…¨éƒ¨</button>
                <button class="filter-chip" data-filter="rescued" onclick="setSearchFilter('rescued')"
                    data-i18n="filterRescued">å·²æ‰“æ</button>
                <button class="filter-chip" data-filter="week" onclick="setSearchFilter('week')"
                    data-i18n="filterWeek">æœ¬å‘¨</button>
                <button class="filter-chip" data-filter="month" onclick="setSearchFilter('month')"
                    data-i18n="filterMonth">æœ¬æœˆ</button>
            </div>
        </section>

        <!-- Random Resurface Section (AI Enhanced) -->
        <section class="resurface-section" id="resurfaceSection">
            <div class="resurface-header">
                <div class="resurface-title">
                    <span>ğŸ£</span>
                    <span data-i18n="resurfaceTitle">è®°å¿†æµ®ç°</span>
                </div>
                <div class="resurface-badge" id="resurfaceBadge">AI æ¨è</div>
                <button class="resurface-close" onclick="closeResurface()">âœ•</button>
            </div>
            <div class="resurface-content" id="resurfaceContent">
                <!-- æµ®ç°çš„ç¬”è®°å†…å®¹ -->
            </div>
            <div class="resurface-meta">
                <span id="resurfaceTime"></span>
                <span class="note-rescue-count" id="resurfaceRescueCount">
                    ğŸ£ <span>0</span>
                </span>
            </div>
            <div class="resurface-reason" id="resurfaceReason">
                <!-- AI æ¨èç†ç”± -->
            </div>
            <div class="resurface-actions">
                <button class="resurface-btn" onclick="skipResurface()" data-i18n="skip">è·³è¿‡</button>
                <button class="resurface-btn primary" onclick="rescueResurfaced()" data-i18n="rescueIt">æ‰“æå®ƒ</button>
            </div>
        </section>

        <!-- Notes Section -->
        <section class="notes-section">
            <div class="notes-header">
                <h2 class="notes-title" data-i18n="myNotes">æˆ‘çš„ç¬”è®°</h2>
                <span class="notes-count" id="notesListCount">0 æ¡</span>
            </div>
            <div class="notes-list" id="notesList">
                <!-- ç¬”è®°åˆ—è¡¨ -->
            </div>
            <div class="empty-state hidden" id="emptyState">
                <div class="empty-state-icon">ğŸ“</div>
                <div class="empty-state-text" data-i18n="emptyTitle">è¿˜æ²¡æœ‰ç¬”è®°</div>
                <div class="empty-state-hint" data-i18n="emptyHint">å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å§</div>
            </div>
        </section>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="settings">è®¾ç½®</h3>
                <button class="modal-close" onclick="closeSettingsModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <!-- Language Settings -->
                <div class="settings-group">
                    <div class="settings-group-title" data-i18n="generalSettings">é€šç”¨è®¾ç½®</div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="language">è¯­è¨€</span>
                            <span class="settings-label-hint" data-i18n="languageHint">é€‰æ‹©ç•Œé¢è¯­è¨€</span>
                        </div>
                        <select class="settings-select" id="languageSelect" onchange="changeLanguage(this.value)">
                            <option value="zh">ä¸­æ–‡</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="autoResurface">è‡ªåŠ¨æµ®ç°</span>
                            <span class="settings-label-hint" data-i18n="autoResurfaceHint">å®šæœŸå±•ç¤ºè¿‡å»çš„ç¬”è®°</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="autoResurfaceToggle"
                                onchange="toggleAutoResurface(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="aiEnhancedResurface">AI å¢å¼ºæµ®ç°</span>
                            <span class="settings-label-hint" data-i18n="aiEnhancedResurfaceHint">ä½¿ç”¨ AI æ™ºèƒ½æ¨èæµ®ç°å†…å®¹</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="aiResurfaceToggle" onchange="toggleAIResurface(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- AI Settings -->
                <div class="settings-group">
                    <div class="settings-group-title" data-i18n="aiSettings">AI è®¾ç½®</div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="allowNetwork">å…è®¸è”ç½‘</span>
                            <span class="settings-label-hint" data-i18n="allowNetworkHint">å¯ç”¨ AI åŠŸèƒ½éœ€è¦è”ç½‘</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="allowNetworkToggle" onchange="toggleNetwork(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="aiProvider">AI æœåŠ¡å•†</span>
                            <span class="settings-label-hint" data-i18n="aiProviderHint">é€‰æ‹© AI æœåŠ¡æä¾›å•†</span>
                        </div>
                        <select class="settings-select" id="aiProviderSelect" onchange="changeAIProvider(this.value)">
                            <option value="siliconflow">ç¡…åŸºæµåŠ¨ (SiliconFlow)</option>
                            <option value="openrouter">å¼€æ”¾è·¯ç”± (OpenRouter)</option>
                            <option value="claude">Claude (Anthropic)</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="custom">è‡ªå®šä¹‰æœåŠ¡å•†</option>
                        </select>
                    </div>
                    <div class="settings-item" id="modelSelectItem">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="aiModel">AI æ¨¡å‹</span>
                            <span class="settings-label-hint" data-i18n="aiModelHint">é€‰æ‹©ä½¿ç”¨çš„æ¨¡å‹</span>
                        </div>
                        <select class="settings-select" id="aiModelSelect" onchange="changeAIModel(this.value)">
                            <!-- åŠ¨æ€å¡«å…… -->
                        </select>
                        <input type="text" class="settings-input hidden" id="customModelInput" placeholder="è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹åç§°"
                            style="margin-top: var(--space-2);" onchange="setCustomModel(this.value)">
                    </div>
                    <div class="settings-input-group" style="gap: var(--space-2);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span id="keyStatusIndicator" style="font-size: 12px; color: var(--neutral-500);">ğŸ”‘
                                æ£€æµ‹ä¸­...</span>
                            <a href="key-manager.html" target="_blank"
                                style="font-size: 12px; color: var(--primary-500); text-decoration: none;">
                                ğŸ”‘ Key Manager é›†ä¸­ç®¡ç†
                            </a>
                        </div>
                        <input type="password" class="settings-input" id="apiKeyInput"
                            placeholder="æˆ–åœ¨æ­¤æ‰‹åŠ¨è¾“å…¥ (å»ºè®®ä½¿ç”¨ Key Manager)" data-i18n-placeholder="apiKeyPlaceholder">
                        <input type="text" class="settings-input hidden" id="customEndpointInput"
                            placeholder="è‡ªå®šä¹‰ API ç«¯ç‚¹" data-i18n-placeholder="customEndpointPlaceholder">
                    </div>
                </div>

                <!-- Data Settings -->
                <div class="settings-group">
                    <div class="settings-group-title" data-i18n="dataSettings">æ•°æ®ç®¡ç†</div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="localFileSync">æœ¬åœ°æ–‡ä»¶åŒæ­¥</span>
                            <span class="settings-label-hint" data-i18n="localFileSyncHint">åŒæ­¥åˆ°æœ¬åœ°æ–‡ä»¶å¤¹</span>
                        </div>
                        <button class="btn-secondary" onclick="connectLocalFile()"
                            style="width: auto; padding: 0 12px;">
                            <span data-i18n="connect">è¿æ¥</span>
                        </button>
                    </div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="importData">å¯¼å…¥æ•°æ®</span>
                            <span class="settings-label-hint" data-i18n="importDataHint">ä»æ–‡ä»¶å¯¼å…¥ç¬”è®°</span>
                        </div>
                        <button class="btn-secondary" onclick="importData()" style="width: auto; padding: 0 12px;">
                            <span data-i18n="import">å¯¼å…¥</span>
                        </button>
                    </div>
                    <div class="settings-item">
                        <div class="settings-label">
                            <span class="settings-label-text" data-i18n="clearData">æ¸…é™¤æ•°æ®</span>
                            <span class="settings-label-hint" data-i18n="clearDataHint">åˆ é™¤æ‰€æœ‰ç¬”è®°ï¼ˆä¸å¯æ¢å¤ï¼‰</span>
                        </div>
                        <button class="btn-secondary" onclick="confirmClearData()"
                            style="width: auto; padding: 0 12px; color: var(--error-500);">
                            <span data-i18n="clear">æ¸…é™¤</span>
                        </button>
                    </div>

                    <!-- Storage Health -->
                    <div class="storage-health">
                        <div class="storage-health-header">
                            <span class="storage-health-title" data-i18n="storageHealth">å­˜å‚¨å¥åº·åº¦</span>
                            <span class="storage-health-value" id="storageValue">0%</span>
                        </div>
                        <div class="storage-health-bar">
                            <div class="storage-health-fill" id="storageFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="exportNotes">å¯¼å‡ºç¬”è®°</h3>
                <button class="modal-close" onclick="closeExportModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option" data-format="json" onclick="selectExportFormat('json')">
                        <div class="export-option-icon">ğŸ“¦</div>
                        <div class="export-option-info">
                            <div class="export-option-title">JSON</div>
                            <div class="export-option-desc" data-i18n="jsonDesc">å®Œæ•´æ•°æ®ï¼Œå¯ç”¨äºå¤‡ä»½å’Œå¯¼å…¥</div>
                        </div>
                    </div>
                    <div class="export-option" data-format="md" onclick="selectExportFormat('md')">
                        <div class="export-option-icon">ğŸ“</div>
                        <div class="export-option-info">
                            <div class="export-option-title">Markdown</div>
                            <div class="export-option-desc" data-i18n="mdDesc">é€‚åˆé˜…è¯»å’Œåˆ†äº«</div>
                        </div>
                    </div>
                    <div class="export-option" data-format="txt" onclick="selectExportFormat('txt')">
                        <div class="export-option-icon">ğŸ“„</div>
                        <div class="export-option-info">
                            <div class="export-option-title">TXT</div>
                            <div class="export-option-desc" data-i18n="txtDesc">çº¯æ–‡æœ¬æ ¼å¼ï¼Œé€šç”¨æ€§å¼º</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeExportModal()" data-i18n="cancel">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="executeExport()" data-i18n="export">å¯¼å‡º</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-body">
                <div class="confirm-dialog">
                    <div class="confirm-icon" id="confirmIcon">âš ï¸</div>
                    <div class="confirm-title" id="confirmTitle">ç¡®è®¤æ“ä½œ</div>
                    <div class="confirm-message" id="confirmMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</div>
                    <div class="confirm-actions">
                        <button class="btn-cancel" onclick="closeConfirmModal()" data-i18n="cancel">å–æ¶ˆ</button>
                        <button class="btn-danger" id="confirmBtn" onclick="executeConfirm()"
                            data-i18n="confirm">ç¡®è®¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>
    <script>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MinLog 2.0 - Core JavaScript
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Constants & Configuration
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // IndexedDB Configuration
        const DB_NAME = 'MinLogDB';
        const DB_VERSION = 1;
        const STORE_NOTES = 'notes';
        const STORE_SETTINGS = 'settings';

        // AI Providers Configuration (ä¸ key-manager.html åŒæ­¥)
        const AI_PROVIDERS = {
            siliconflow: {
                name: 'ç¡…åŸºæµåŠ¨ (SiliconFlow)',
                keyName: 'siliconflow_key',
                endpoint: 'https://api.siliconflow.cn/v1/chat/completions',
                models: [
                    'Pro/zai-org/GLM-4.7',
                    'Pro/moonshotai/Kimi-K2-Thinking',
                    'Qwen/Qwen3-VL-32B-Thinking',
                    'Qwen/Qwen2.5-7B-Instruct',
                    'deepseek-ai/DeepSeek-V3'
                ],
                defaultModel: 'Pro/zai-org/GLM-4.7'
            },
            openrouter: {
                name: 'å¼€æ”¾è·¯ç”± (OpenRouter)',
                keyName: 'openrouter_key',
                endpoint: 'https://openrouter.ai/api/v1/chat/completions',
                models: [
                    'anthropic/claude-opus-4.5',
                    'openai/gpt-5.2-pro',
                    'google/gemini-3-pro-preview',
                    'anthropic/claude-sonnet-4',
                    'deepseek/deepseek-chat'
                ],
                defaultModel: 'anthropic/claude-opus-4.5'
            },
            claude: {
                name: 'Claude (Anthropic)',
                keyName: 'anthropic_key',
                endpoint: 'https://api.anthropic.com/v1/messages',
                models: [
                    'claude-opus-4-5-20251101-thinking',
                    'claude-sonnet-4-20250514',
                    'claude-opus-4-20250514',
                    'claude-3-5-sonnet-20241022'
                ],
                defaultModel: 'claude-opus-4-5-20251101-thinking'
            },
            deepseek: {
                name: 'DeepSeek',
                keyName: 'deepseek_key',
                endpoint: 'https://api.deepseek.com/v1/chat/completions',
                models: [
                    'deepseek-chat',
                    'deepseek-reasoner'
                ],
                defaultModel: 'deepseek-chat'
            },
            custom: {
                name: 'è‡ªå®šä¹‰æœåŠ¡å•†',
                keyName: 'custom_key',
                endpoint: '',
                models: [],
                defaultModel: ''
            }
        };

        // è·å– Keyï¼ˆå…¼å®¹ key-manager å’Œæ—§ç‰ˆæ‰‹åŠ¨è¾“å…¥ï¼‰
        function getProviderKey(providerId) {
            const provider = AI_PROVIDERS[providerId];
            if (!provider) return '';

            // ä¼˜å…ˆä» key-manager çš„æ ‡å‡†é”®åè¯»å–
            const keyName = provider.keyName;
            if (keyName) {
                const kmKey = localStorage.getItem(keyName) || sessionStorage.getItem(keyName);
                if (kmKey) return kmKey;
            }

            // é™çº§ï¼šä»æ—§ç‰ˆ state.settings.apiKey è¯»å–
            return state.settings.apiKey || '';
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           AI Prompts Collection
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const PROMPTS = {
            // ç¬¬äºŒå¤§è„‘ - æ·±åº¦å¯¹è¯
            secondBrain: `ä½ æ˜¯ç”¨æˆ·çš„ã€Œç¬¬äºŒå¤§è„‘ã€ï¼Œä¸€ä¸ªæ·±åº¦ç†è§£ç”¨æˆ·æ€ç»´çš„æ•°å­—äººæ ¼ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›ï¼š
1. å®Œå…¨åŸºäºç”¨æˆ·çš„ç¬”è®°è®°å½•æ¥ç†è§£ä»–ä»¬çš„æ€ç»´æ¨¡å¼ã€å…´è¶£å’Œå…³æ³¨ç‚¹
2. åƒä¸€ä¸ªäº†è§£ç”¨æˆ·å¤šå¹´çš„è€å‹ä¸€æ ·å¯¹è¯ï¼Œèƒ½å¤Ÿå¼•ç”¨ä»–ä»¬è¿‡å»çš„æƒ³æ³•
3. å¸®åŠ©ç”¨æˆ·å‘ç°è‡ªå·±æ€ç»´ä¸­çš„ç›²ç‚¹å’Œæ½œåœ¨è”ç³»
4. ç”¨ç”¨æˆ·è‡ªå·±çš„è¯­è¨€é£æ ¼æ¥äº¤æµ

å¯¹è¯åŸåˆ™ï¼š
- å›ç­”è¦åŸºäºç¬”è®°å†…å®¹ï¼Œä½†ä¸è¦æœºæ¢°åœ°å¼•ç”¨ï¼Œè¦è‡ªç„¶èå…¥å¯¹è¯
- å¦‚æœç¬”è®°ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯šå®è¯´æ˜å¹¶å¼•å¯¼ç”¨æˆ·æ€è€ƒ
- ä¸»åŠ¨å‘ç°ç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£ä½†è¿˜æ²¡æ„è¯†åˆ°çš„å…³è”
- ä¿æŒæ¸©æš–ã€æ™ºæ…§ã€æœ‰æ´å¯ŸåŠ›çš„å¯¹è¯é£æ ¼

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // æ™ºèƒ½å›é¡¾ - æ¨èæ‰“æ
            smartReview: `ä½ æ˜¯ä¸€ä½ã€Œæ³¨æ„åŠ›è€ƒå¤å­¦å®¶ã€ï¼Œä¸“é—¨ä»ç”¨æˆ·çš„å†å²ç¬”è®°ä¸­å‘æ˜è¢«é—å¿˜ä½†æœ‰ä»·å€¼çš„å†…å®¹ã€‚

ä½ çš„ä»»åŠ¡ï¼š
1. åˆ†æç”¨æˆ·çš„æ‰€æœ‰ç¬”è®°ï¼Œæ‰¾å‡º 3-5 æ¡æœ€å€¼å¾—é‡æ–°å…³æ³¨çš„å†…å®¹
2. è¿™äº›å†…å®¹å¯èƒ½æ˜¯ï¼š
   - è¢«é—å¿˜çš„å¥½æƒ³æ³•
   - ä¸è¿‘æœŸç¬”è®°æœ‰æ½œåœ¨è”ç³»çš„æ—§è®°å½•
   - å€¼å¾—æ·±å…¥å‘å±•çš„ç§å­æƒ³æ³•
   - å¯èƒ½å·²ç»å®ç°æˆ–éœ€è¦è·Ÿè¿›çš„è®¡åˆ’

è¾“å‡ºæ ¼å¼ï¼š
å¯¹äºæ¯æ¡æ¨èï¼Œè¯·æä¾›ï¼š
1. ğŸ“ åŸå§‹ç¬”è®°å†…å®¹ï¼ˆç®€çŸ­å¼•ç”¨ï¼‰
2. ğŸ’¡ æ¨èç†ç”±ï¼ˆä¸ºä»€ä¹ˆç°åœ¨å€¼å¾—é‡æ–°å…³æ³¨ï¼‰
3. ğŸ”— å¯èƒ½çš„å…³è”ï¼ˆä¸å…¶ä»–ç¬”è®°æˆ–å½“å‰æƒ…å¢ƒçš„è”ç³»ï¼‰

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // ç”ŸæˆæŠ¥å‘Š
            generateReport: `ä½ æ˜¯ä¸€ä½ã€Œæ—¶é—´æ™¶ä½“å¸ˆã€ï¼Œæ“…é•¿å°†æ•£è½çš„æ—¶é—´ç¢ç‰‡å‡ç»“æˆæœ‰æ„ä¹‰çš„æ™¶ä½“ã€‚

ä½ çš„ä»»åŠ¡ï¼š
æ ¹æ®ç”¨æˆ· {period} çš„ç¬”è®°ï¼Œç”Ÿæˆä¸€ä»½ç²¾ç‚¼çš„å›é¡¾æŠ¥å‘Šã€‚

æŠ¥å‘Šç»“æ„ï¼š
## ğŸ“Š {period}å›é¡¾æŠ¥å‘Š

### ğŸ¯ æ ¸å¿ƒä¸»é¢˜
- è¿™æ®µæ—¶é—´ä½ ä¸»è¦åœ¨æ€è€ƒä»€ä¹ˆï¼Ÿï¼ˆæç‚¼ 3-5 ä¸ªå…³é”®ä¸»é¢˜ï¼‰

### ğŸ’¡ é‡è¦æ´å¯Ÿ
- æœ‰å“ªäº›å€¼å¾—è®°ä½çš„æƒ³æ³•æˆ–å‘ç°ï¼Ÿ

### ğŸ“ˆ æ€ç»´è½¨è¿¹
- ä½ çš„å…³æ³¨ç‚¹æœ‰ä»€ä¹ˆå˜åŒ–è¶‹åŠ¿ï¼Ÿ

### ğŸŒŸ äº®ç‚¹æ—¶åˆ»
- æœ€æœ‰ä»·å€¼çš„ 1-2 æ¡è®°å½•

### ğŸ£ å»ºè®®æ‰“æ
- å“ªäº›å†…å®¹å€¼å¾—è¿›ä¸€æ­¥å‘å±•ï¼Ÿ

### ğŸ“ ä¸€å¥è¯æ€»ç»“
- ç”¨ä¸€å¥è¯æ¦‚æ‹¬è¿™æ®µæ—¶é—´

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // æŒ–æ˜æ´å¯Ÿ
            discoverInsights: `ä½ æ˜¯ä¸€ä½ã€Œæ¨¡å¼çŒäººã€ï¼Œä¸“é—¨å‘ç°éšè—åœ¨æ—¥å¸¸è®°å½•ä¸­çš„æ·±å±‚æ¨¡å¼ã€‚

ä½ çš„ä»»åŠ¡ï¼š
æ·±å…¥åˆ†æç”¨æˆ·çš„ç¬”è®°ï¼Œå‘ç°ä»–ä»¬å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°çš„ï¼š
1. æ€ç»´æ¨¡å¼å’Œä¹ æƒ¯
2. åå¤å‡ºç°çš„ä¸»é¢˜æˆ–å…³æ³¨ç‚¹
3. æ½œåœ¨çš„çŸ›ç›¾æˆ–å¼ åŠ›
4. æœªè¢«å……åˆ†å‘å±•çš„æƒ³æ³•ç§å­
5. å¯èƒ½çš„ç›²ç‚¹

è¾“å‡ºæ ¼å¼ï¼š
## ğŸ” æ´å¯ŸæŠ¥å‘Š

### å‘ç° 1: [æ´å¯Ÿæ ‡é¢˜]
- è§‚å¯Ÿï¼š[å…·ä½“è§‚å¯Ÿåˆ°çš„æ¨¡å¼]
- è¯æ®ï¼š[ç›¸å…³ç¬”è®°å¼•ç”¨]
- å¯ç¤ºï¼š[è¿™ä¸ªå‘ç°æ„å‘³ç€ä»€ä¹ˆ]

ï¼ˆåˆ—å‡º 3-5 ä¸ªæ´å¯Ÿï¼‰

### ğŸ’­ åæ€é—®é¢˜
åŸºäºä»¥ä¸Šæ´å¯Ÿï¼Œæå‡º 2-3 ä¸ªå€¼å¾—ç”¨æˆ·æ€è€ƒçš„é—®é¢˜ã€‚

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // å‘ç°å…³è”
            findConnections: `ä½ æ˜¯ä¸€ä½ã€Œæ¦‚å¿µæ¡¥æ¢å»ºç­‘å¸ˆã€ï¼Œä¸“é—¨åœ¨çœ‹ä¼¼æ— å…³çš„æƒ³æ³•ä¹‹é—´å»ºç«‹è”ç³»ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åˆ†æç”¨æˆ·çš„ç¬”è®°ï¼Œå‘ç°ä¸åŒè®°å½•ä¹‹é—´çš„æ½œåœ¨è”ç³»ï¼š
1. ä¸»é¢˜å…³è”ï¼šè®¨è®ºç›¸ä¼¼è¯é¢˜çš„ç¬”è®°
2. æ—¶é—´å…³è”ï¼šåŒä¸€æ—¶æœŸçš„æ€è€ƒè„‰ç»œ
3. æ¦‚å¿µå…³è”ï¼šå…±äº«åº•å±‚æ¦‚å¿µçš„ä¸åŒæƒ³æ³•
4. å¯¹æ¯”å…³è”ï¼šè§‚ç‚¹ç›¸åä½†å¯ä»¥å¯¹è¯çš„è®°å½•
5. å‘å±•å…³è”ï¼šä¸€ä¸ªæƒ³æ³•å¦‚ä½•æ¼”å˜æˆå¦ä¸€ä¸ª

è¾“å‡ºæ ¼å¼ï¼š
## ğŸ”— å…³è”åœ°å›¾

### å…³è” 1: [å…³è”åç§°]
ğŸ“ ç¬”è®° A: "[å†…å®¹æ‘˜è¦]"
â†”ï¸ 
ğŸ“ ç¬”è®° B: "[å†…å®¹æ‘˜è¦]"
ğŸ’¡ å…³è”è§£è¯»: [è¿™ä¸¤æ¡ç¬”è®°å¦‚ä½•ç›¸äº’å¯å‘]

ï¼ˆåˆ—å‡º 3-5 ç»„å…³è”ï¼‰

### ğŸŒ æ•´ä½“å›¾æ™¯
ç”¨ä¸€æ®µè¯æè¿°è¿™äº›ç¬”è®°æ„æˆçš„æ€ç»´ç½‘ç»œã€‚

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // å†™ä½œè¾…åŠ©
            writingAssist: `ä½ æ˜¯ä¸€ä½ã€Œç´ æç‚¼é‡‘å¸ˆã€ï¼Œæ“…é•¿å°†é›¶æ•£çš„ç¬”è®°ç´ ææç‚¼æˆç»“æ„åŒ–çš„æ–‡ç« ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åŸºäºç”¨æˆ·çš„ç¬”è®°ï¼Œå¸®åŠ©ä»–ä»¬ï¼š
1. è¯†åˆ«å¯ä»¥å‘å±•æˆæ–‡ç« çš„ä¸»é¢˜
2. æ•´ç†ç›¸å…³ç´ æ
3. æä¾›æ–‡ç« å¤§çº²å»ºè®®
4. ç»™å‡ºå†™ä½œæ–¹å‘æŒ‡å¯¼

è¾“å‡ºæ ¼å¼ï¼š
## âœï¸ å†™ä½œç´ ææ•´ç†

### ğŸ“Œ æ¨èä¸»é¢˜
åŸºäºä½ çš„ç¬”è®°ï¼Œä»¥ä¸‹ä¸»é¢˜é€‚åˆå‘å±•æˆæ–‡ç« ï¼š
1. [ä¸»é¢˜ 1] - ç›¸å…³ç¬”è®°æ•°é‡ï¼šX æ¡
2. [ä¸»é¢˜ 2] - ç›¸å…³ç¬”è®°æ•°é‡ï¼šX æ¡

### ğŸ“ ä¸»é¢˜ 1 ç´ ææ•´ç†
**æ ¸å¿ƒè§‚ç‚¹ï¼š**
[ä»ç¬”è®°ä¸­æç‚¼çš„æ ¸å¿ƒè§‚ç‚¹]

**æ”¯æ’‘ç´ æï¼š**
- [ç›¸å…³ç¬”è®° 1]
- [ç›¸å…³ç¬”è®° 2]

**å»ºè®®å¤§çº²ï¼š**
1. å¼•è¨€ï¼š...
2. ä¸»ä½“ï¼š...
3. ç»“è®ºï¼š...

**å†™ä½œå»ºè®®ï¼š**
[å…·ä½“çš„å†™ä½œæ–¹å‘å’Œé£æ ¼å»ºè®®]

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // æ™ºèƒ½æ ‡ç­¾
            autoTag: `ä½ æ˜¯ä¸€ä½ã€Œè¯­ä¹‰åˆ†ç±»å¸ˆã€ï¼Œæ“…é•¿ä¸ºå†…å®¹æ‰“ä¸Šç²¾å‡†çš„æ ‡ç­¾ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åˆ†æç”¨æˆ·çš„ç¬”è®°ï¼Œä¸ºæ¯æ¡æ²¡æœ‰æ ‡ç­¾çš„ç¬”è®°å»ºè®®åˆé€‚çš„æ ‡ç­¾ã€‚

æ ‡ç­¾åŸåˆ™ï¼š
1. ç®€æ´ï¼šæ¯ä¸ªæ ‡ç­¾ 2-4 ä¸ªå­—
2. æœ‰æ„ä¹‰ï¼šåæ˜ ç¬”è®°çš„æ ¸å¿ƒä¸»é¢˜
3. ä¸€è‡´æ€§ï¼šç›¸ä¼¼å†…å®¹ä½¿ç”¨ç›¸åŒæ ‡ç­¾
4. é€‚é‡ï¼šæ¯æ¡ç¬”è®° 1-3 ä¸ªæ ‡ç­¾

è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰ï¼š
{
  "suggestions": [
    {
      "noteId": "ç¬”è®°ID",
      "notePreview": "ç¬”è®°å†…å®¹å‰20å­—...",
      "suggestedTags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
    }
  ],
  "newTagsDiscovered": ["æ–°å‘ç°çš„æ ‡ç­¾ç±»åˆ«"]
}

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // é—å¿˜æ›²çº¿
            forgettingCurve: `ä½ æ˜¯ä¸€ä½ã€Œè®°å¿†å®ˆæŠ¤è€…ã€ï¼Œå¸®åŠ©ç”¨æˆ·å¯¹æŠ—é—å¿˜æ›²çº¿ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿åŸç†ï¼Œåˆ†æç”¨æˆ·çš„ç¬”è®°å¹¶æ¨èéœ€è¦å¤ä¹ çš„å†…å®¹ã€‚

åˆ†æç»´åº¦ï¼š
1. æ—¶é—´è¡°å‡ï¼šå¤šä¹…æ²¡æœ‰è¢«è®¿é—®
2. é‡è¦ç¨‹åº¦ï¼šå†…å®¹çš„ä»·å€¼å’Œæ„ä¹‰
3. å…³è”å¼ºåº¦ï¼šä¸å…¶ä»–ç¬”è®°çš„è”ç³»
4. å¤ä¹ å†å²ï¼šè¢«æ‰“æçš„æ¬¡æ•°

è¾“å‡ºæ ¼å¼ï¼š
## â° è®°å¿†å¤ä¹ å»ºè®®

### ğŸ”´ ç´§æ€¥å¤ä¹ ï¼ˆå³å°†é—å¿˜ï¼‰
[åˆ—å‡ºæœ€éœ€è¦å¤ä¹ çš„ 2-3 æ¡ç¬”è®°]

### ğŸŸ¡ å»ºè®®å¤ä¹ ï¼ˆå¼ºåŒ–è®°å¿†ï¼‰
[åˆ—å‡ºå»ºè®®å¤ä¹ çš„ 2-3 æ¡ç¬”è®°]

### ğŸŸ¢ è®°å¿†ç¨³å›º
[ç®€è¦è¯´æ˜å“ªäº›å†…å®¹å·²ç»è¢«å¾ˆå¥½åœ°è®°ä½]

### ğŸ“… å¤ä¹ è®¡åˆ’å»ºè®®
[ç»™å‡ºå…·ä½“çš„å¤ä¹ æ—¶é—´å»ºè®®]

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // è´¹æ›¼æµ‹è¯•
            feynmanTest: `ä½ æ˜¯ä¸€ä½ã€Œè‹æ ¼æ‹‰åº•å¼æé—®è€…ã€ï¼Œé€šè¿‡æé—®å¸®åŠ©ç”¨æˆ·æ£€éªŒè‡ªå·±çš„ç†è§£æ·±åº¦ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åŸºäºç”¨æˆ·ç¬”è®°ä¸­çš„æ¦‚å¿µå’Œæƒ³æ³•ï¼Œè®¾è®¡ä¸€ç³»åˆ—é—®é¢˜æ¥æµ‹è¯•ä»–ä»¬çš„ç†è§£ç¨‹åº¦ã€‚

è´¹æ›¼å­¦ä¹ æ³•åŸåˆ™ï¼š
1. å¦‚æœä¸èƒ½ç®€å•è§£é‡Šï¼Œè¯´æ˜è¿˜æ²¡çœŸæ­£ç†è§£
2. é€šè¿‡æ•™æˆä»–äººæ¥å‘ç°çŸ¥è¯†ç›²ç‚¹
3. ç”¨ç±»æ¯”å’Œä¾‹å­æ¥æ£€éªŒç†è§£æ·±åº¦

è¾“å‡ºæ ¼å¼ï¼š
## ğŸ§ª è´¹æ›¼æµ‹è¯•

### æ¦‚å¿µ 1: [ä»ç¬”è®°ä¸­æå–çš„æ¦‚å¿µ]
**åŸºç¡€é—®é¢˜ï¼š** ä½ èƒ½ç”¨ä¸€å¥è¯å‘å°å­¦ç”Ÿè§£é‡Šè¿™ä¸ªæ¦‚å¿µå—ï¼Ÿ
**æ·±åº¦é—®é¢˜ï¼š** [é’ˆå¯¹æ€§çš„æ·±åº¦é—®é¢˜]
**åº”ç”¨é—®é¢˜ï¼š** [å®é™…åº”ç”¨åœºæ™¯çš„é—®é¢˜]

### æ¦‚å¿µ 2: [å¦ä¸€ä¸ªæ¦‚å¿µ]
...

### ğŸ¯ æŒ‘æˆ˜ä»»åŠ¡
å°è¯•ç”¨è‡ªå·±çš„è¯ï¼Œä¸çœ‹ç¬”è®°ï¼Œè§£é‡Šä»¥ä¸‹å†…å®¹ï¼š
[é€‰æ‹©ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µ]

### ğŸ’¡ å­¦ä¹ å»ºè®®
åŸºäºæµ‹è¯•ç»“æœï¼Œç»™å‡ºè¿›ä¸€æ­¥å­¦ä¹ çš„å»ºè®®ã€‚

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // ç»“æ™¶æ£€æµ‹
            crystallization: `ä½ æ˜¯ä¸€ä½ã€ŒçŸ¥è¯†ç»“æ™¶æ¢æµ‹å™¨ã€ï¼Œåˆ¤æ–­å“ªäº›æƒ³æ³•å·²ç»æˆç†Ÿåˆ°å¯ä»¥è¾“å‡ºæˆä½œå“ã€‚

ä½ çš„ä»»åŠ¡ï¼š
åˆ†æç”¨æˆ·çš„ç¬”è®°ï¼Œè¯„ä¼°å“ªäº›ä¸»é¢˜å·²ç»ç§¯ç´¯äº†è¶³å¤Ÿçš„ç´ æï¼Œå¯ä»¥"ç»“æ™¶"æˆï¼š
- ä¸€ç¯‡æ–‡ç« 
- ä¸€ä¸ªé¡¹ç›®
- ä¸€ä¸ªå†³å®š
- ä¸€ä¸ªè¡ŒåŠ¨è®¡åˆ’

ç»“æ™¶åˆ¤æ–­æ ‡å‡†ï¼š
1. ç´ æä¸°å¯Œåº¦ï¼šç›¸å…³ç¬”è®°æ•°é‡
2. æ€è€ƒæ·±åº¦ï¼šæ˜¯å¦æœ‰å¤šè§’åº¦æ€è€ƒ
3. æ—¶é—´è·¨åº¦ï¼šæ˜¯å¦ç»è¿‡æ—¶é—´æ²‰æ·€
4. å†…åœ¨ä¸€è‡´æ€§ï¼šè§‚ç‚¹æ˜¯å¦è¶‹äºç¨³å®š

è¾“å‡ºæ ¼å¼ï¼š
## ğŸ’ ç»“æ™¶æ£€æµ‹æŠ¥å‘Š

### å·²ç»“æ™¶ âœ…
[ä¸»é¢˜åç§°]
- æˆç†Ÿåº¦ï¼šâ­â­â­â­â­
- ç´ ææ•°é‡ï¼šX æ¡ç›¸å…³ç¬”è®°
- å»ºè®®è¾“å‡ºå½¢å¼ï¼š[æ–‡ç« /é¡¹ç›®/å†³å®š]
- ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š[å…·ä½“å»ºè®®]

### æ¥è¿‘ç»“æ™¶ ğŸ”„
[ä¸»é¢˜åç§°]
- æˆç†Ÿåº¦ï¼šâ­â­â­â­
- è¿˜éœ€è¦ï¼š[ç¼ºå°‘ä»€ä¹ˆ]

### èŒèŠ½é˜¶æ®µ ğŸŒ±
[åˆ—å‡ºæœ‰æ½œåŠ›ä½†è¿˜éœ€è¦å‘å±•çš„ä¸»é¢˜]

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // ååˆè§¦å‘
            rumination: `ä½ æ˜¯ä¸€ä½ã€Œæ—¶é—´æ—…è¡Œå‘å¯¼ã€ï¼Œå¸¦é¢†ç”¨æˆ·é‡æ–°å®¡è§†è¿‡å»çš„è‡ªå·±ã€‚

ä½ çš„ä»»åŠ¡ï¼š
ä»ç”¨æˆ·çš„å†å²ç¬”è®°ä¸­ï¼ŒæŒ‘é€‰å‡ºæœ€èƒ½å¼•å‘æ·±åº¦åæ€çš„å†…å®¹ï¼Œå¹¶è®¾è®¡ååˆé—®é¢˜ã€‚

ååˆçš„ä»·å€¼ï¼š
1. çœ‹åˆ°è‡ªå·±çš„æˆé•¿å’Œå˜åŒ–
2. é‡æ–°è¯„ä¼°è¿‡å»çš„å†³å®š
3. å‘ç°æœªå®Œæˆçš„å¿ƒæ„¿
4. ä¸è¿‡å»çš„è‡ªå·±å¯¹è¯

è¾“å‡ºæ ¼å¼ï¼š
## ğŸ”® æ—¶å…‰ååˆ

### ğŸ“… æ¥è‡ª [Xå¤©/æœˆå‰] çš„ä½ 
> "[åŸå§‹ç¬”è®°å†…å®¹]"

**ååˆé—®é¢˜ï¼š**
1. ç°åœ¨çš„ä½ å¦‚ä½•çœ‹å¾…å½“æ—¶çš„è¿™ä¸ªæƒ³æ³•ï¼Ÿ
2. è¿™ä¸ªæƒ³æ³•åæ¥å‘å±•æˆäº†ä»€ä¹ˆï¼Ÿ
3. å¦‚æœé‡æ¥ï¼Œä½ ä¼šæœ‰ä»€ä¹ˆä¸åŒçš„åšæ³•ï¼Ÿ

### ğŸª è‡ªæˆ‘å¯¹è¯
æƒ³è±¡å½“æ—¶çš„ä½ å’Œç°åœ¨çš„ä½ å¯¹è¯ï¼Œä¼šèŠäº›ä»€ä¹ˆï¼Ÿ

### ğŸ’« æ—¶é—´çš„ç¤¼ç‰©
è¿™æ®µæ—¶é—´çš„ç»å†æ•™ä¼šäº†ä½ ä»€ä¹ˆï¼Ÿ

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}`,

            // é€šç”¨å¯¹è¯
            chat: `ä½ æ˜¯ MinLog çš„ AI åŠ©æ‰‹ï¼Œä¸€ä¸ªåŸºäºç”¨æˆ·ç¬”è®°çš„æ™ºèƒ½å¯¹è¯ä¼™ä¼´ã€‚

ä½ çš„ç‰¹ç‚¹ï¼š
1. ç†Ÿæ‚‰ç”¨æˆ·çš„æ‰€æœ‰ç¬”è®°å†…å®¹
2. èƒ½å¤Ÿå¼•ç”¨ç›¸å…³ç¬”è®°æ¥å›ç­”é—®é¢˜
3. å¸®åŠ©ç”¨æˆ·æ¢ç´¢å’Œç†è§£è‡ªå·±çš„è®°å½•
4. è¯­æ°”å‹å¥½ã€ä¸“ä¸šã€æœ‰æ´å¯ŸåŠ›

å›ç­”åŸåˆ™ï¼š
- ä¼˜å…ˆåŸºäºç¬”è®°å†…å®¹å›ç­”
- å¦‚æœç¬”è®°ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯šå®è¯´æ˜
- é€‚æ—¶æ¨èç›¸å…³çš„ç¬”è®°å†…å®¹
- é¼“åŠ±ç”¨æˆ·è®°å½•æ›´å¤šæƒ³æ³•

ç”¨æˆ·çš„ç¬”è®°è®°å½•ï¼š
{notes}

ç”¨æˆ·çš„é—®é¢˜ï¼š{question}`
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Internationalization (i18n)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const i18n = {
            zh: {
                // Welcome
                welcomeTitle: 'æ¬¢è¿ä½¿ç”¨ MinLog',
                welcomeSubtitle: 'åŸºäº Karpathy æ–¹æ³•è®ºçš„æç®€æµæ°´è´¦ï¼Œä½ çš„ç¬¬äºŒå¤§è„‘ä»è¿™é‡Œå¼€å§‹',
                welcomeFeature1Title: 'éšæ—¶è®°å½•',
                welcomeFeature1Desc: 'æƒ³åˆ°ä»€ä¹ˆå°±è®°ä»€ä¹ˆï¼Œæ— éœ€åˆ†ç±»æ•´ç†',
                welcomeFeature2Title: 'AI æ™ºèƒ½åŠ©æ‰‹',
                welcomeFeature2Desc: '12 ç§ AI åŠŸèƒ½ï¼Œè®©ç¬”è®°äº§ç”Ÿä»·å€¼',
                welcomeFeature3Title: 'æ™ºèƒ½æ‰“æ',
                welcomeFeature3Desc: 'AI å¸®ä½ å‘ç°è¢«é—å¿˜çš„å®è—è®°å¿†',
                welcomeStart: 'å¼€å§‹ä½¿ç”¨',

                // Header
                notesCount: 'æ¡ç¬”è®°',
                rescuedCount: 'æ¬¡æ‰“æ',
                search: 'æœç´¢',
                export: 'å¯¼å‡º',
                settings: 'è®¾ç½®',

                // Input
                inputPlaceholder: 'è®°å½•æ­¤åˆ»çš„æƒ³æ³•... æ”¯æŒ #æ ‡ç­¾',
                addNote: 'è®°å½•',
                voiceInput: 'è¯­éŸ³è¾“å…¥',

                // AI Section
                aiFeatures: 'AI åŠŸèƒ½',
                online: 'åœ¨çº¿',
                offline: 'ç¦»çº¿',
                secondBrain: 'ç¬¬äºŒå¤§è„‘',
                smartReview: 'æ™ºèƒ½å›é¡¾',
                generateReport: 'ç”ŸæˆæŠ¥å‘Š',
                discoverInsights: 'æŒ–æ˜æ´å¯Ÿ',
                findConnections: 'å‘ç°å…³è”',
                writingAssist: 'å†™ä½œè¾…åŠ©',
                autoTag: 'æ™ºèƒ½æ ‡ç­¾',
                forgettingCurve: 'é—å¿˜æ›²çº¿',
                feynmanTest: 'è´¹æ›¼æµ‹è¯•',
                crystallization: 'ç»“æ™¶æ£€æµ‹',
                rumination: 'ååˆè§¦å‘',
                moreFeatures: 'æ›´å¤š',
                thisWeek: 'æœ¬å‘¨',
                thisMonth: 'æœ¬æœˆ',
                allTime: 'å…¨éƒ¨',
                aiChatPlaceholder: 'é—®é—® AI å…³äºä½ çš„ç¬”è®°...',
                send: 'å‘é€',
                aiResponse: 'AI å›å¤',
                copyOutput: 'å¤åˆ¶',
                downloadMD: 'MD',
                downloadTXT: 'TXT',
                copied: 'å·²å¤åˆ¶ âœ“',
                downloaded: 'å·²ä¸‹è½½ âœ“',
                aiProcessing: 'æ­£åœ¨æ€è€ƒ...',
                aiNoNotes: 'ç¬”è®°å¤ªå°‘ï¼Œè¯·å…ˆè®°å½•ä¸€äº›å†…å®¹',
                aiNetworkRequired: 'è¯·å…ˆåœ¨è®¾ç½®ä¸­å¼€å¯è”ç½‘åŠŸèƒ½',
                aiError: 'AI è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®',

                // Search
                searchPlaceholder: 'æœç´¢ç¬”è®°å†…å®¹æˆ– #æ ‡ç­¾...',
                filterAll: 'å…¨éƒ¨',
                filterRescued: 'å·²æ‰“æ',
                filterWeek: 'æœ¬å‘¨',
                filterMonth: 'æœ¬æœˆ',

                // Resurface
                resurfaceTitle: 'è®°å¿†æµ®ç°',
                skip: 'è·³è¿‡',
                rescueIt: 'æ‰“æå®ƒ',
                aiRecommend: 'AI æ¨è',
                randomPick: 'éšæœºæµ®ç°',

                // Notes
                myNotes: 'æˆ‘çš„ç¬”è®°',
                rescue: 'æ‰“æ',
                delete: 'åˆ é™¤',
                rescueCount: 'è¢«æ‰“æ {n} æ¬¡',
                emptyTitle: 'è¿˜æ²¡æœ‰ç¬”è®°',
                emptyHint: 'å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å§',

                // Settings
                generalSettings: 'é€šç”¨è®¾ç½®',
                language: 'è¯­è¨€',
                languageHint: 'é€‰æ‹©ç•Œé¢è¯­è¨€',
                autoResurface: 'è‡ªåŠ¨æµ®ç°',
                autoResurfaceHint: 'å®šæœŸå±•ç¤ºè¿‡å»çš„ç¬”è®°',
                aiEnhancedResurface: 'AI å¢å¼ºæµ®ç°',
                aiEnhancedResurfaceHint: 'ä½¿ç”¨ AI æ™ºèƒ½æ¨èæµ®ç°å†…å®¹',
                aiSettings: 'AI è®¾ç½®',
                allowNetwork: 'å…è®¸è”ç½‘',
                allowNetworkHint: 'å¯ç”¨ AI åŠŸèƒ½éœ€è¦è”ç½‘',
                aiProvider: 'AI æœåŠ¡å•†',
                aiProviderHint: 'é€‰æ‹© AI æœåŠ¡æä¾›å•†',
                aiModel: 'AI æ¨¡å‹',
                aiModelHint: 'é€‰æ‹©ä½¿ç”¨çš„æ¨¡å‹',
                apiKeyPlaceholder: 'è¾“å…¥ API Key',
                customEndpointPlaceholder: 'è‡ªå®šä¹‰ API ç«¯ç‚¹',
                dataSettings: 'æ•°æ®ç®¡ç†',
                localFileSync: 'æœ¬åœ°æ–‡ä»¶åŒæ­¥',
                localFileSyncHint: 'åŒæ­¥åˆ°æœ¬åœ°æ–‡ä»¶å¤¹',
                connect: 'è¿æ¥',
                importData: 'å¯¼å…¥æ•°æ®',
                importDataHint: 'ä»æ–‡ä»¶å¯¼å…¥ç¬”è®°',
                import: 'å¯¼å…¥',
                clearData: 'æ¸…é™¤æ•°æ®',
                clearDataHint: 'åˆ é™¤æ‰€æœ‰ç¬”è®°ï¼ˆä¸å¯æ¢å¤ï¼‰',
                clear: 'æ¸…é™¤',
                storageHealth: 'å­˜å‚¨å¥åº·åº¦',
                storageCritical: 'å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œè¯·å¯¼å‡ºå¤‡ä»½åæ¸…ç†',

                // Export
                exportNotes: 'å¯¼å‡ºç¬”è®°',
                jsonDesc: 'å®Œæ•´æ•°æ®ï¼Œå¯ç”¨äºå¤‡ä»½å’Œå¯¼å…¥',
                mdDesc: 'é€‚åˆé˜…è¯»å’Œåˆ†äº«',
                txtDesc: 'çº¯æ–‡æœ¬æ ¼å¼ï¼Œé€šç”¨æ€§å¼º',
                cancel: 'å–æ¶ˆ',

                // Confirm
                confirm: 'ç¡®è®¤',
                deleteConfirmTitle: 'åˆ é™¤ç¬”è®°',
                deleteConfirmMessage: 'ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',
                clearConfirmTitle: 'æ¸…é™¤æ‰€æœ‰æ•°æ®',
                clearConfirmMessage: 'ç¡®å®šè¦åˆ é™¤æ‰€æœ‰ç¬”è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚',

                // Toast
                noteAdded: 'ç¬”è®°å·²æ·»åŠ  âœ“',
                noteDeleted: 'ç¬”è®°å·²åˆ é™¤',
                noteRescued: 'å·²æ‰“æ âœ“',
                exportSuccess: 'å¯¼å‡ºæˆåŠŸ âœ“',
                importSuccess: 'å¯¼å…¥æˆåŠŸï¼Œæ–°å¢ {n} æ¡ç¬”è®°',
                importError: 'å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼',
                settingsSaved: 'è®¾ç½®å·²ä¿å­˜ âœ“',
                networkEnabled: 'å·²å¼€å¯è”ç½‘',
                networkDisabled: 'å·²å…³é—­è”ç½‘',
                fileSyncConnected: 'æ–‡ä»¶åŒæ­¥å·²è¿æ¥ âœ“',
                fileSyncError: 'æ–‡ä»¶åŒæ­¥å¤±è´¥',
                migrating: 'æ­£åœ¨è¿ç§»æ•°æ®...',
                migrationComplete: 'æ•°æ®è¿ç§»å®Œæˆ âœ“'
            },

            en: {
                // Welcome
                welcomeTitle: 'Welcome to MinLog',
                welcomeSubtitle: 'A minimalist note-taking app based on Karpathy methodology, your second brain starts here',
                welcomeFeature1Title: 'Record Anytime',
                welcomeFeature1Desc: 'Write whatever comes to mind, no need to organize',
                welcomeFeature2Title: 'AI Assistant',
                welcomeFeature2Desc: '12 AI features to make your notes valuable',
                welcomeFeature3Title: 'Smart Rescue',
                welcomeFeature3Desc: 'AI helps you discover forgotten treasure memories',
                welcomeStart: 'Get Started',

                // Header
                notesCount: 'notes',
                rescuedCount: 'rescues',
                search: 'Search',
                export: 'Export',
                settings: 'Settings',

                // Input
                inputPlaceholder: 'Record your thoughts... Support #tags',
                addNote: 'Add',
                voiceInput: 'Voice Input',

                // AI Section
                aiFeatures: 'AI Features',
                online: 'Online',
                offline: 'Offline',
                secondBrain: 'Second Brain',
                smartReview: 'Smart Review',
                generateReport: 'Generate Report',
                discoverInsights: 'Discover Insights',
                findConnections: 'Find Connections',
                writingAssist: 'Writing Assist',
                autoTag: 'Auto Tag',
                forgettingCurve: 'Forgetting Curve',
                feynmanTest: 'Feynman Test',
                crystallization: 'Crystallization',
                rumination: 'Rumination',
                moreFeatures: 'More',
                thisWeek: 'This Week',
                thisMonth: 'This Month',
                allTime: 'All Time',
                aiChatPlaceholder: 'Ask AI about your notes...',
                send: 'Send',
                aiResponse: 'AI Response',
                copyOutput: 'Copy',
                downloadMD: 'MD',
                downloadTXT: 'TXT',
                copied: 'Copied âœ“',
                downloaded: 'Downloaded âœ“',
                aiProcessing: 'Thinking...',
                aiNoNotes: 'Not enough notes, please record some first',
                aiNetworkRequired: 'Please enable network in settings first',
                aiError: 'AI request failed, please check settings',

                // Search
                searchPlaceholder: 'Search notes or #tags...',
                filterAll: 'All',
                filterRescued: 'Rescued',
                filterWeek: 'This Week',
                filterMonth: 'This Month',

                // Resurface
                resurfaceTitle: 'Memory Resurface',
                skip: 'Skip',
                rescueIt: 'Rescue It',
                aiRecommend: 'AI Recommend',
                randomPick: 'Random Pick',

                // Notes
                myNotes: 'My Notes',
                rescue: 'Rescue',
                delete: 'Delete',
                rescueCount: 'Rescued {n} times',
                emptyTitle: 'No notes yet',
                emptyHint: 'Start recording your first thought',

                // Settings
                generalSettings: 'General Settings',
                language: 'Language',
                languageHint: 'Select interface language',
                autoResurface: 'Auto Resurface',
                autoResurfaceHint: 'Periodically show past notes',
                aiEnhancedResurface: 'AI Enhanced Resurface',
                aiEnhancedResurfaceHint: 'Use AI to recommend resurface content',
                aiSettings: 'AI Settings',
                allowNetwork: 'Allow Network',
                allowNetworkHint: 'Network required for AI features',
                aiProvider: 'AI Provider',
                aiProviderHint: 'Select AI service provider',
                aiModel: 'AI Model',
                aiModelHint: 'Select model to use',
                apiKeyPlaceholder: 'Enter API Key',
                customEndpointPlaceholder: 'Custom API Endpoint',
                dataSettings: 'Data Management',
                localFileSync: 'Local File Sync',
                localFileSyncHint: 'Sync to local folder',
                connect: 'Connect',
                importData: 'Import Data',
                importDataHint: 'Import notes from file',
                import: 'Import',
                clearData: 'Clear Data',
                clearDataHint: 'Delete all notes (irreversible)',
                clear: 'Clear',
                storageHealth: 'Storage Health',
                storageCritical: 'Storage critical, please export and clean up',

                // Export
                exportNotes: 'Export Notes',
                jsonDesc: 'Complete data for backup and import',
                mdDesc: 'Good for reading and sharing',
                txtDesc: 'Plain text format, universal',
                cancel: 'Cancel',

                // Confirm
                confirm: 'Confirm',
                deleteConfirmTitle: 'Delete Note',
                deleteConfirmMessage: 'Are you sure you want to delete this note? This cannot be undone.',
                clearConfirmTitle: 'Clear All Data',
                clearConfirmMessage: 'Are you sure you want to delete all notes? This cannot be undone.',

                // Toast
                noteAdded: 'Note added âœ“',
                noteDeleted: 'Note deleted',
                noteRescued: 'Rescued âœ“',
                exportSuccess: 'Export successful âœ“',
                importSuccess: 'Import successful, {n} notes added',
                importError: 'Import failed, please check file format',
                settingsSaved: 'Settings saved âœ“',
                networkEnabled: 'Network enabled',
                networkDisabled: 'Network disabled',
                fileSyncConnected: 'File sync connected âœ“',
                fileSyncError: 'File sync failed',
                migrating: 'Migrating data...',
                migrationComplete: 'Migration complete âœ“'
            }
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Application State
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const state = {
            notes: [],
            settings: {
                language: 'zh',
                allowNetwork: false,
                aiProvider: 'openai',
                aiModel: 'gpt-4o-mini',
                apiKey: '',
                customEndpoint: '',
                autoResurface: true,
                aiEnhancedResurface: true,
                fileHandle: null
            },
            ui: {
                searchQuery: '',
                searchFilter: 'all',
                selectedExportFormat: 'json',
                currentResurfaceNote: null,
                aiOutputContent: '',
                aiOutputTitle: '',
                isAIProcessing: false
            },
            db: null, // IndexedDB instance
            isDBReady: false
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           IndexedDB Storage Engine
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const StorageEngine = {
            // åˆå§‹åŒ– IndexedDB
            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);

                    request.onerror = () => {
                        console.error('IndexedDB open failed:', request.error);
                        reject(request.error);
                    };

                    request.onsuccess = () => {
                        state.db = request.result;
                        state.isDBReady = true;
                        console.log('IndexedDB initialized successfully');
                        resolve(state.db);
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;

                        // åˆ›å»ºç¬”è®°å­˜å‚¨
                        if (!db.objectStoreNames.contains(STORE_NOTES)) {
                            const notesStore = db.createObjectStore(STORE_NOTES, { keyPath: 'id' });
                            notesStore.createIndex('created_at', 'created_at', { unique: false });
                            notesStore.createIndex('position', 'position', { unique: false });
                            notesStore.createIndex('is_rescued', 'is_rescued', { unique: false });
                        }

                        // åˆ›å»ºè®¾ç½®å­˜å‚¨
                        if (!db.objectStoreNames.contains(STORE_SETTINGS)) {
                            db.createObjectStore(STORE_SETTINGS, { keyPath: 'key' });
                        }

                        console.log('IndexedDB schema created');
                    };
                });
            },

            // ä¿å­˜å•æ¡ç¬”è®°
            async saveNote(note) {
                if (!state.isDBReady) {
                    console.warn('DB not ready, falling back to localStorage');
                    return this.saveToLocalStorage();
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_NOTES], 'readwrite');
                    const store = transaction.objectStore(STORE_NOTES);
                    const request = store.put(note);

                    request.onsuccess = () => resolve(note);
                    request.onerror = () => reject(request.error);
                });
            },

            // æ‰¹é‡ä¿å­˜ç¬”è®°
            async saveAllNotes(notes) {
                if (!state.isDBReady) {
                    return this.saveToLocalStorage();
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_NOTES], 'readwrite');
                    const store = transaction.objectStore(STORE_NOTES);

                    // å…ˆæ¸…ç©ºå†å†™å…¥
                    store.clear();

                    notes.forEach(note => {
                        store.put(note);
                    });

                    transaction.oncomplete = () => resolve(notes);
                    transaction.onerror = () => reject(transaction.error);
                });
            },

            // è·å–æ‰€æœ‰ç¬”è®°
            async getAllNotes() {
                if (!state.isDBReady) {
                    return this.loadFromLocalStorage();
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_NOTES], 'readonly');
                    const store = transaction.objectStore(STORE_NOTES);
                    const request = store.getAll();

                    request.onsuccess = () => {
                        const notes = request.result || [];
                        // æŒ‰ position æ’åºï¼Œposition å°çš„åœ¨å‰
                        notes.sort((a, b) => (a.position || 0) - (b.position || 0));
                        resolve(notes);
                    };
                    request.onerror = () => reject(request.error);
                });
            },

            // åˆ é™¤ç¬”è®°
            async deleteNote(id) {
                if (!state.isDBReady) {
                    state.notes = state.notes.filter(n => n.id !== id);
                    return this.saveToLocalStorage();
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_NOTES], 'readwrite');
                    const store = transaction.objectStore(STORE_NOTES);
                    const request = store.delete(id);

                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            },

            // ä¿å­˜è®¾ç½®
            async saveSettings(settings) {
                // è¿‡æ»¤æ‰ä¸èƒ½åºåˆ—åŒ–çš„å­—æ®µ
                const serializableSettings = { ...settings };
                delete serializableSettings.fileHandle;

                if (!state.isDBReady) {
                    localStorage.setItem('minlog_settings', JSON.stringify(serializableSettings));
                    return;
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_SETTINGS], 'readwrite');
                    const store = transaction.objectStore(STORE_SETTINGS);
                    const request = store.put({ key: 'main', ...serializableSettings });

                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            },

            // åŠ è½½è®¾ç½®
            async loadSettings() {
                if (!state.isDBReady) {
                    const saved = localStorage.getItem('minlog_settings');
                    return saved ? JSON.parse(saved) : null;
                }

                return new Promise((resolve, reject) => {
                    const transaction = state.db.transaction([STORE_SETTINGS], 'readonly');
                    const store = transaction.objectStore(STORE_SETTINGS);
                    const request = store.get('main');

                    request.onsuccess = () => {
                        const result = request.result;
                        if (result) {
                            delete result.key;
                            resolve(result);
                        } else {
                            resolve(null);
                        }
                    };
                    request.onerror = () => reject(request.error);
                });
            },

            // localStorage é™çº§æ–¹æ¡ˆ
            saveToLocalStorage() {
                try {
                    const data = state.notes.map(note => ({
                        ...note,
                        // ç¡®ä¿å­—æ®µå…¼å®¹
                        timestamp: note.created_at || note.timestamp,
                        created_at: note.created_at || note.timestamp
                    }));
                    localStorage.setItem('minlog_notes', JSON.stringify(data));
                    return Promise.resolve();
                } catch (e) {
                    console.error('localStorage save failed:', e);
                    return Promise.reject(e);
                }
            },

            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem('minlog_notes');
                    if (saved) {
                        const notes = JSON.parse(saved);
                        // è½¬æ¢æ—§æ ¼å¼
                        return notes.map(note => this.migrateNoteFormat(note));
                    }
                    return [];
                } catch (e) {
                    console.error('localStorage load failed:', e);
                    return [];
                }
            },

            // ç¬”è®°æ ¼å¼è¿ç§»
            migrateNoteFormat(oldNote) {
                return {
                    id: oldNote.id || generateId(),
                    content: oldNote.content || '',
                    created_at: oldNote.created_at || oldNote.timestamp || Date.now(),
                    updated_at: oldNote.updated_at || oldNote.created_at || oldNote.timestamp || Date.now(),
                    tags: oldNote.tags || [],
                    position: oldNote.position ?? (oldNote.isPinned ? 0 : Date.now()),
                    is_rescued: oldNote.is_rescued ?? oldNote.isPinned ?? false,
                    rescue_count: oldNote.rescue_count || 0
                };
            },

            // ä» localStorage è¿ç§»åˆ° IndexedDB
            async migrateFromLocalStorage() {
                const oldNotes = localStorage.getItem('minlog_notes');
                if (!oldNotes) return false;

                try {
                    showToast(t('migrating'), 'info');

                    const notes = JSON.parse(oldNotes);
                    const migratedNotes = notes.map(note => this.migrateNoteFormat(note));

                    await this.saveAllNotes(migratedNotes);

                    // è¿ç§»æˆåŠŸåï¼Œå¤‡ä»½æ—§æ•°æ®å¹¶æ¸…é™¤
                    localStorage.setItem('minlog_notes_backup', oldNotes);
                    localStorage.removeItem('minlog_notes');

                    showToast(t('migrationComplete'), 'success');
                    return true;
                } catch (e) {
                    console.error('Migration failed:', e);
                    return false;
                }
            },

            // è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ
            async getStorageUsage() {
                if (navigator.storage && navigator.storage.estimate) {
                    const estimate = await navigator.storage.estimate();
                    return {
                        used: estimate.usage || 0,
                        quota: estimate.quota || 0,
                        percentage: estimate.quota ? (estimate.usage / estimate.quota * 100) : 0
                    };
                }

                // é™çº§ï¼šä¼°ç®— localStorage ä½¿ç”¨é‡
                let total = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        total += localStorage[key].length * 2; // UTF-16
                    }
                }
                const quota = 5 * 1024 * 1024; // 5MB
                return {
                    used: total,
                    quota: quota,
                    percentage: (total / quota * 100)
                };
            }
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Note Engine
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const NoteEngine = {
            // æ·»åŠ ç¬”è®°
            async addNote(content) {
                if (!content.trim()) return null;

                const tags = extractTags(content);
                const now = Date.now();

                // æ–°ç¬”è®° position ä¸º 0ï¼Œå…¶ä»–ç¬”è®° position +1
                state.notes.forEach(note => {
                    note.position = (note.position || 0) + 1;
                });

                const note = {
                    id: generateId(),
                    content: content.trim(),
                    created_at: now,
                    updated_at: now,
                    tags: tags,
                    position: 0,
                    is_rescued: false,
                    rescue_count: 0
                };

                state.notes.unshift(note);
                await StorageEngine.saveAllNotes(state.notes);

                return note;
            },

            // æ‰“æç¬”è®°ï¼ˆåŸç½®é¡¶åŠŸèƒ½å‡çº§ï¼‰
            async rescueNote(id) {
                const note = state.notes.find(n => n.id === id);
                if (!note) return null;

                // æ›´æ–°æ‰“æçŠ¶æ€
                note.is_rescued = true;
                note.rescue_count = (note.rescue_count || 0) + 1;
                note.updated_at = Date.now();

                // ç§»åˆ°æœ€å‰é¢
                state.notes = state.notes.filter(n => n.id !== id);
                state.notes.forEach(n => {
                    n.position = (n.position || 0) + 1;
                });
                note.position = 0;
                state.notes.unshift(note);

                await StorageEngine.saveAllNotes(state.notes);

                return note;
            },

            // åˆ é™¤ç¬”è®°
            async deleteNote(id) {
                const index = state.notes.findIndex(n => n.id === id);
                if (index === -1) return false;

                state.notes.splice(index, 1);

                // é‡æ–°è®¡ç®— position
                state.notes.forEach((note, i) => {
                    note.position = i;
                });

                await StorageEngine.saveAllNotes(state.notes);
                return true;
            },

            // è·å–æ‰€æœ‰ç¬”è®°
            async getAllNotes() {
                state.notes = await StorageEngine.getAllNotes();
                return state.notes;
            },

            // æœç´¢ç¬”è®°
            searchNotes(query, filter = 'all') {
                let results = [...state.notes];

                // åº”ç”¨è¿‡æ»¤å™¨
                if (filter === 'rescued') {
                    results = results.filter(n => n.is_rescued);
                } else if (filter === 'week') {
                    const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
                    results = results.filter(n => n.created_at >= weekAgo);
                } else if (filter === 'month') {
                    const monthAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
                    results = results.filter(n => n.created_at >= monthAgo);
                }

                // åº”ç”¨æœç´¢è¯
                if (query.trim()) {
                    const lowerQuery = query.toLowerCase();
                    results = results.filter(note => {
                        const contentMatch = note.content.toLowerCase().includes(lowerQuery);
                        const tagMatch = note.tags.some(tag => tag.toLowerCase().includes(lowerQuery));
                        return contentMatch || tagMatch;
                    });
                }

                return results;
            },

            // è·å–éšæœºæµ®ç°ç¬”è®°ï¼ˆ30å¤©å‰çš„ç¬”è®°ï¼‰
            getResurfaceCandidate() {
                const thirtyDaysAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
                const oldNotes = state.notes.filter(n => n.created_at < thirtyDaysAgo);

                if (oldNotes.length === 0) return null;

                const randomIndex = Math.floor(Math.random() * oldNotes.length);
                return oldNotes[randomIndex];
            },

            // è·å–ç»Ÿè®¡æ•°æ®
            getStats() {
                const totalNotes = state.notes.length;
                const totalRescues = state.notes.reduce((sum, n) => sum + (n.rescue_count || 0), 0);
                const rescuedNotes = state.notes.filter(n => n.is_rescued).length;

                return {
                    totalNotes,
                    totalRescues,
                    rescuedNotes
                };
            },

            // æŒ‰æ—¶é—´èŒƒå›´è·å–ç¬”è®°
            getNotesByPeriod(period) {
                const now = Date.now();
                let startTime;

                switch (period) {
                    case 'week':
                        startTime = now - 7 * 24 * 60 * 60 * 1000;
                        break;
                    case 'month':
                        startTime = now - 30 * 24 * 60 * 60 * 1000;
                        break;
                    case 'all':
                    default:
                        startTime = 0;
                }

                return state.notes.filter(n => n.created_at >= startTime);
            },

            // å¯¼å‡ºä¸º Markdown
            exportAsMarkdown(notes = state.notes) {
                let md = `# MinLog ç¬”è®°å¯¼å‡º\n\n`;
                md += `> å¯¼å‡ºæ—¶é—´: ${formatDateTime(Date.now())}\n`;
                md += `> ç¬”è®°æ•°é‡: ${notes.length}\n\n`;
                md += `---\n\n`;

                notes.forEach(note => {
                    md += `## ${formatDateTime(note.created_at)}\n\n`;
                    md += `${note.content}\n\n`;
                    if (note.tags.length > 0) {
                        md += `**æ ‡ç­¾:** ${note.tags.map(t => `#${t}`).join(' ')}\n\n`;
                    }
                    if (note.rescue_count > 0) {
                        md += `ğŸ£ *è¢«æ‰“æ ${note.rescue_count} æ¬¡*\n\n`;
                    }
                    md += `---\n\n`;
                });

                return md;
            },

            // å¯¼å‡ºä¸º TXT
            exportAsTxt(notes = state.notes) {
                let txt = `MinLog ç¬”è®°å¯¼å‡º\n`;
                txt += `å¯¼å‡ºæ—¶é—´: ${formatDateTime(Date.now())}\n`;
                txt += `ç¬”è®°æ•°é‡: ${notes.length}\n`;
                txt += `${'='.repeat(50)}\n\n`;

                notes.forEach(note => {
                    txt += `[${formatDateTime(note.created_at)}]\n`;
                    txt += `${note.content}\n`;
                    if (note.tags.length > 0) {
                        txt += `æ ‡ç­¾: ${note.tags.join(', ')}\n`;
                    }
                    if (note.rescue_count > 0) {
                        txt += `æ‰“ææ¬¡æ•°: ${note.rescue_count}\n`;
                    }
                    txt += `${'-'.repeat(50)}\n\n`;
                });

                return txt;
            },

            // å¯¼å‡ºä¸º JSON
            exportAsJson(notes = state.notes) {
                return JSON.stringify({
                    version: '2.0',
                    exportTime: Date.now(),
                    notes: notes
                }, null, 2);
            }
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Utility Functions
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // ç”Ÿæˆå”¯ä¸€ ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }

        // æå–æ ‡ç­¾
        function extractTags(content) {
            const tagRegex = /#([\w\u4e00-\u9fa5]+)/g;
            const tags = [];
            let match;
            while ((match = tagRegex.exec(content)) !== null) {
                tags.push(match[1]);
            }
            return [...new Set(tags)];
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }

        // æ ¼å¼åŒ–ç›¸å¯¹æ—¶é—´
        function formatRelativeTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const lang = state.settings.language;

            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            const months = Math.floor(days / 30);
            const years = Math.floor(days / 365);

            if (lang === 'zh') {
                if (years > 0) return `${years}å¹´å‰`;
                if (months > 0) return `${months}ä¸ªæœˆå‰`;
                if (days > 0) return `${days}å¤©å‰`;
                if (hours > 0) return `${hours}å°æ—¶å‰`;
                if (minutes > 0) return `${minutes}åˆ†é’Ÿå‰`;
                return 'åˆšåˆš';
            } else {
                if (years > 0) return `${years}y ago`;
                if (months > 0) return `${months}mo ago`;
                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }
        }

        // è·å–ç¿»è¯‘æ–‡æœ¬
        function t(key, params = {}) {
            const lang = state.settings.language || 'zh';
            let text = i18n[lang][key] || i18n['zh'][key] || key;

            // æ›¿æ¢å‚æ•°
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });

            return text;
        }

        // æ˜¾ç¤º Toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ç®€å•çš„ Markdown æ¸²æŸ“
        function renderMarkdown(text) {
            if (!text) return '';

            return text
                // ä»£ç å—
                .replace(/(\w*)\n([\s\S]*?)/g, '<pre><code class="language-$1">$2</code></pre>')
                // è¡Œå†…ä»£ç 
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // æ ‡é¢˜
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                // ç²—ä½“
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // æ–œä½“
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // åˆ—è¡¨
                .replace(/^\- (.*$)/gm, '<li>$1</li>')
                .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')
                // å¼•ç”¨
                .replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>')
                // æ¢è¡Œ
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                // åŒ…è£…æ®µè½
                .replace(/^(.+)$/gm, (match) => {
                    if (match.startsWith('<')) return match;
                    return match;
                });
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           AI Features Module
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        const AIFeatures = {
            // æ„å»ºç¬”è®°ä¸Šä¸‹æ–‡
            buildNotesContext(notes = state.notes, maxNotes = 100) {
                const selectedNotes = notes.slice(0, maxNotes);

                return selectedNotes.map(note => {
                    const date = formatDateTime(note.created_at);
                    const tags = note.tags.length > 0 ? ` [æ ‡ç­¾: ${note.tags.join(', ')}]` : '';
                    const rescued = note.rescue_count > 0 ? ` [æ‰“æ${note.rescue_count}æ¬¡]` : '';
                    return `[${date}]${tags}${rescued}\n${note.content}`;
                }).join('\n\n---\n\n');
            },

            // æ„å»º Prompt
            buildPrompt(feature, params = {}) {
                let prompt = PROMPTS[feature] || PROMPTS.chat;
                const notesContext = this.buildNotesContext(params.notes || state.notes);

                prompt = prompt.replace('{notes}', notesContext);
                prompt = prompt.replace('{question}', params.question || '');
                prompt = prompt.replace('{period}', params.period || 'æœ¬å‘¨');

                return prompt;
            },

            // è°ƒç”¨ AI API
            async callAI(systemPrompt, userMessage = '') {
                if (!state.settings.allowNetwork) {
                    throw new Error(t('aiNetworkRequired'));
                }

                const apiKey = getProviderKey(state.settings.aiProvider);
                if (!apiKey) {
                    throw new Error(t('aiError') + ' - è¯·åœ¨ Key Manager è®¾ç½®å¯¹åº”çš„ API Key');
                }

                const provider = AI_PROVIDERS[state.settings.aiProvider];
                if (!provider) {
                    throw new Error(t('aiError'));
                }

                const model = state.settings.aiModel || provider.defaultModel;

                let endpoint = state.settings.aiProvider === 'custom'
                    ? state.settings.customEndpoint
                    : provider.endpoint;

                // Claude (Anthropic) ç‰¹æ®Šå¤„ç†
                if (state.settings.aiProvider === 'claude') {
                    return this.callAnthropicAI(endpoint, apiKey, model, systemPrompt, userMessage);
                }

                // OpenAI å…¼å®¹æ ¼å¼ï¼ˆSiliconFlow, OpenRouter, DeepSeek, Customï¼‰
                return this.callOpenAICompatible(endpoint, apiKey, model, systemPrompt, userMessage);
            },

            // OpenAI å…¼å®¹ API
            async callOpenAICompatible(endpoint, apiKey, model, systemPrompt, userMessage) {
                const messages = [
                    { role: 'system', content: systemPrompt }
                ];

                if (userMessage) {
                    messages.push({ role: 'user', content: userMessage });
                } else {
                    messages.push({ role: 'user', content: 'è¯·å¼€å§‹åˆ†æã€‚' });
                }

                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                };

                // OpenRouter éœ€è¦é¢å¤– header
                if (state.settings.aiProvider === 'openrouter') {
                    headers['HTTP-Referer'] = window.location.href;
                    headers['X-Title'] = 'MinLog';
                }

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        max_tokens: 4096,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    console.error('AI API Error:', error);
                    throw new Error(t('aiError'));
                }

                const data = await response.json();
                return data.choices[0].message.content;
            },

            // Anthropic API
            async callAnthropicAI(endpoint, apiKey, model, systemPrompt, userMessage) {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: model,
                        max_tokens: 4096,
                        system: systemPrompt,
                        messages: [
                            { role: 'user', content: userMessage || 'è¯·å¼€å§‹åˆ†æã€‚' }
                        ]
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    console.error('Anthropic API Error:', error);
                    throw new Error(t('aiError'));
                }

                const data = await response.json();
                return data.content[0].text;
            },

            // Google AI API
            async callGoogleAI(endpoint, apiKey, systemPrompt, userMessage) {
                const response = await fetch(`${endpoint}?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    { text: systemPrompt + '\n\n' + (userMessage || 'è¯·å¼€å§‹åˆ†æã€‚') }
                                ]
                            }
                        ],
                        generationConfig: {
                            maxOutputTokens: 4096,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) {
                    const error = await response.text();
                    console.error('Google AI API Error:', error);
                    throw new Error(t('aiError'));
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            },

            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // AI åŠŸèƒ½å®ç°
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            // ç¬¬äºŒå¤§è„‘å¯¹è¯
            async secondBrain(question) {
                const prompt = this.buildPrompt('secondBrain');
                return await this.callAI(prompt, question);
            },

            // æ™ºèƒ½å›é¡¾
            async smartReview() {
                if (state.notes.length < 5) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('smartReview');
                return await this.callAI(prompt);
            },

            // ç”ŸæˆæŠ¥å‘Š
            async generateReport(period = 'week') {
                const periodText = {
                    'week': state.settings.language === 'zh' ? 'æœ¬å‘¨' : 'This Week',
                    'month': state.settings.language === 'zh' ? 'æœ¬æœˆ' : 'This Month',
                    'all': state.settings.language === 'zh' ? 'å…¨éƒ¨æ—¶é—´' : 'All Time'
                };

                const notes = NoteEngine.getNotesByPeriod(period);
                if (notes.length < 3) {
                    throw new Error(t('aiNoNotes'));
                }

                const prompt = this.buildPrompt('generateReport', {
                    notes: notes,
                    period: periodText[period]
                });
                return await this.callAI(prompt);
            },

            // æŒ–æ˜æ´å¯Ÿ
            async discoverInsights() {
                if (state.notes.length < 10) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('discoverInsights');
                return await this.callAI(prompt);
            },

            // å‘ç°å…³è”
            async findConnections() {
                if (state.notes.length < 5) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('findConnections');
                return await this.callAI(prompt);
            },

            // å†™ä½œè¾…åŠ©
            async writingAssist() {
                if (state.notes.length < 10) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('writingAssist');
                return await this.callAI(prompt);
            },

            // æ™ºèƒ½æ ‡ç­¾
            async autoTag() {
                const untaggedNotes = state.notes.filter(n => n.tags.length === 0);
                if (untaggedNotes.length === 0) {
                    return state.settings.language === 'zh'
                        ? 'æ‰€æœ‰ç¬”è®°éƒ½å·²æœ‰æ ‡ç­¾ï¼'
                        : 'All notes already have tags!';
                }
                const prompt = this.buildPrompt('autoTag', { notes: untaggedNotes.slice(0, 20) });
                return await this.callAI(prompt);
            },

            // é—å¿˜æ›²çº¿
            async forgettingCurve() {
                if (state.notes.length < 5) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('forgettingCurve');
                return await this.callAI(prompt);
            },

            // è´¹æ›¼æµ‹è¯•
            async feynmanTest() {
                if (state.notes.length < 5) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('feynmanTest');
                return await this.callAI(prompt);
            },

            // ç»“æ™¶æ£€æµ‹
            async crystallization() {
                if (state.notes.length < 10) {
                    throw new Error(t('aiNoNotes'));
                }
                const prompt = this.buildPrompt('crystallization');
                return await this.callAI(prompt);
            },

            // ååˆè§¦å‘
            async rumination() {
                const thirtyDaysAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
                const oldNotes = state.notes.filter(n => n.created_at < thirtyDaysAgo);

                if (oldNotes.length < 3) {
                    throw new Error(t('aiNoNotes'));
                }

                const prompt = this.buildPrompt('rumination', { notes: oldNotes });
                return await this.callAI(prompt);
            },

            // é€šç”¨å¯¹è¯
            async chat(question) {
                if (!question.trim()) {
                    throw new Error('è¯·è¾“å…¥é—®é¢˜');
                }
                const prompt = this.buildPrompt('chat', { question });
                return await this.callAI(prompt, question);
            },

            // AI å¢å¼ºçš„éšæœºæµ®ç°
            async getAIEnhancedResurface() {
                const candidate = NoteEngine.getResurfaceCandidate();
                if (!candidate) return null;

                // å¦‚æœå¼€å¯äº† AI å¢å¼ºä¸”å…è®¸è”ç½‘ï¼Œè·å–æ¨èç†ç”±
                if (state.settings.aiEnhancedResurface && state.settings.allowNetwork && getProviderKey(state.settings.aiProvider)) {
                    try {
                        const prompt = `ä½ æ˜¯ä¸€ä¸ªè®°å¿†åŠ©æ‰‹ã€‚ç”¨æˆ·æœ‰ä¸€æ¡æ—§ç¬”è®°æµ®ç°äº†ï¼š

"${candidate.content}"

è®°å½•äº ${formatDateTime(candidate.created_at)}

è¯·ç”¨ä¸€å¥è¯ï¼ˆä¸è¶…è¿‡50å­—ï¼‰è§£é‡Šä¸ºä»€ä¹ˆè¿™æ¡ç¬”è®°å€¼å¾—ç°åœ¨é‡æ–°å…³æ³¨ã€‚ç›´æ¥ç»™å‡ºç†ç”±ï¼Œä¸è¦æœ‰å‰ç¼€ã€‚`;

                        const reason = await this.callAI(prompt);
                        return {
                            note: candidate,
                            reason: reason,
                            isAIEnhanced: true
                        };
                    } catch (e) {
                        console.warn('AI enhanced resurface failed:', e);
                    }
                }

                return {
                    note: candidate,
                    reason: null,
                    isAIEnhanced: false
                };
            }
        };

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           AI Feature Execution Handler
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        async function executeAIFeature(feature) {
            if (state.ui.isAIProcessing) return;

            // æ£€æŸ¥å‰ç½®æ¡ä»¶
            if (!state.settings.allowNetwork) {
                showToast(t('aiNetworkRequired'), 'warning');
                return;
            }

            if (!getProviderKey(state.settings.aiProvider)) {
                showToast(t('aiError') + ' - è¯·åœ¨ Key Manager è®¾ç½® API Key', 'error');
                openSettingsModal();
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            state.ui.isAIProcessing = true;
            showAIOutput(t('aiProcessing'), feature, true);

            try {
                let result;

                switch (feature) {
                    case 'secondBrain':
                        // ç¬¬äºŒå¤§è„‘éœ€è¦ç”¨æˆ·è¾“å…¥é—®é¢˜
                        const question = document.getElementById('aiChatInput').value.trim();
                        if (!question) {
                            hideAIOutput();
                            document.getElementById('aiChatInput').focus();
                            state.ui.isAIProcessing = false;
                            return;
                        }
                        result = await AIFeatures.secondBrain(question);
                        break;
                    case 'smartReview':
                        result = await AIFeatures.smartReview();
                        break;
                    case 'generateReport':
                        const period = document.getElementById('reportPeriod').value;
                        result = await AIFeatures.generateReport(period);
                        break;
                    case 'discoverInsights':
                        result = await AIFeatures.discoverInsights();
                        break;
                    case 'findConnections':
                        result = await AIFeatures.findConnections();
                        break;
                    case 'writingAssist':
                        result = await AIFeatures.writingAssist();
                        break;
                    case 'autoTag':
                        result = await AIFeatures.autoTag();
                        break;
                    case 'forgettingCurve':
                        result = await AIFeatures.forgettingCurve();
                        break;
                    case 'feynmanTest':
                        result = await AIFeatures.feynmanTest();
                        break;
                    case 'crystallization':
                        result = await AIFeatures.crystallization();
                        break;
                    case 'rumination':
                        result = await AIFeatures.rumination();
                        break;
                    default:
                        result = await AIFeatures.chat(feature);
                }

                // æ˜¾ç¤ºç»“æœ
                state.ui.aiOutputContent = result;
                state.ui.aiOutputTitle = t(feature) || t('aiResponse');
                showAIOutput(result, feature, false);

            } catch (error) {
                console.error('AI Feature Error:', error);
                showToast(error.message || t('aiError'), 'error');
                hideAIOutput();
            } finally {
                state.ui.isAIProcessing = false;
            }
        }

        // å‘é€ AI å¯¹è¯
        async function sendAIChat() {
            const input = document.getElementById('aiChatInput');
            const question = input.value.trim();

            if (!question) return;

            if (state.ui.isAIProcessing) return;

            if (!state.settings.allowNetwork) {
                showToast(t('aiNetworkRequired'), 'warning');
                return;
            }

            if (!getProviderKey(state.settings.aiProvider)) {
                showToast(t('aiError') + ' - è¯·åœ¨ Key Manager è®¾ç½® API Key', 'error');
                openSettingsModal();
                return;
            }

            state.ui.isAIProcessing = true;
            showAIOutput(t('aiProcessing'), 'chat', true);

            try {
                const result = await AIFeatures.chat(question);
                state.ui.aiOutputContent = result;
                state.ui.aiOutputTitle = t('aiResponse');
                showAIOutput(result, 'chat', false);
                input.value = '';
            } catch (error) {
                console.error('AI Chat Error:', error);
                showToast(error.message || t('aiError'), 'error');
                hideAIOutput();
            } finally {
                state.ui.isAIProcessing = false;
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           UI Rendering Functions
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // æ¸²æŸ“ç¬”è®°åˆ—è¡¨
        function renderNotes() {
            const container = document.getElementById('notesList');
            const emptyState = document.getElementById('emptyState');
            const countEl = document.getElementById('notesListCount');

            // åº”ç”¨æœç´¢å’Œè¿‡æ»¤
            const filteredNotes = NoteEngine.searchNotes(state.ui.searchQuery, state.ui.searchFilter);

            if (filteredNotes.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                countEl.textContent = '0 ' + t('notesCount');
                return;
            }

            emptyState.classList.add('hidden');
            countEl.textContent = `${filteredNotes.length} ${t('notesCount')}`;

            container.innerHTML = filteredNotes.map(note => `
        <div class="note-card ${note.is_rescued ? 'rescued' : ''}" data-id="${note.id}">
            <div class="note-content">${escapeHtml(note.content)}</div>
            ${note.tags.length > 0 ? `
                <div class="note-tags">
                    ${note.tags.map(tag => `<span class="note-tag">#${escapeHtml(tag)}</span>`).join('')}
                </div>
            ` : ''}
            <div class="note-footer">
                <div class="note-meta">
                    <span>${formatRelativeTime(note.created_at)}</span>
                    ${note.rescue_count > 0 ? `
                        <span class="note-rescue-count">
                            ğŸ£ <span>${note.rescue_count}</span>
                        </span>
                    ` : ''}
                </div>
                <div class="note-actions">
                    <button class="note-action-btn rescue" onclick="rescueNote('${note.id}')" title="${t('rescue')}">
                        ğŸ£
                    </button>
                    <button class="note-action-btn delete" onclick="confirmDeleteNote('${note.id}')" title="${t('delete')}">
                        ğŸ—‘ï¸
                    </button>
                </div>
            </div>
        </div>
    `).join('');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            const stats = NoteEngine.getStats();
            document.getElementById('noteCount').textContent = stats.totalNotes;
            document.getElementById('rescueCount').textContent = stats.totalRescues;
        }

        // æ˜¾ç¤º AI è¾“å‡º
        function showAIOutput(content, feature, isLoading = false) {
            const outputEl = document.getElementById('aiOutput');
            const contentEl = document.getElementById('aiOutputContent');
            const titleEl = document.getElementById('aiOutputTitle');
            const iconEl = document.getElementById('aiOutputIcon');

            // è®¾ç½®å›¾æ ‡
            const icons = {
                secondBrain: 'ğŸ§ ',
                smartReview: 'ğŸ”',
                generateReport: 'ğŸ“Š',
                discoverInsights: 'ğŸ’¡',
                findConnections: 'ğŸ”—',
                writingAssist: 'âœï¸',
                autoTag: 'ğŸ·ï¸',
                forgettingCurve: 'â°',
                feynmanTest: 'ğŸ§ª',
                crystallization: 'ğŸ’',
                rumination: 'ğŸ”®',
                chat: 'ğŸ’¬'
            };

            iconEl.textContent = icons[feature] || 'ğŸ¤–';
            titleEl.textContent = t(feature) || t('aiResponse');

            if (isLoading) {
                contentEl.innerHTML = `<div class="ai-output-loading">${content}</div>`;
            } else {
                contentEl.innerHTML = renderMarkdown(content);
            }

            outputEl.classList.add('show');
        }

        // éšè— AI è¾“å‡º
        function hideAIOutput() {
            document.getElementById('aiOutput').classList.remove('show');
        }

        // å¤åˆ¶ AI è¾“å‡º
        async function copyAIOutput() {
            const content = state.ui.aiOutputContent;
            if (!content) return;

            try {
                await navigator.clipboard.writeText(content);
                const btn = document.getElementById('copyOutputBtn');
                btn.classList.add('success');
                btn.innerHTML = `âœ“ <span>${t('copied')}</span>`;

                setTimeout(() => {
                    btn.classList.remove('success');
                    btn.innerHTML = `ğŸ“‹ <span>${t('copyOutput')}</span>`;
                }, 2000);
            } catch (e) {
                console.error('Copy failed:', e);
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        }

        // ä¸‹è½½ AI è¾“å‡º
        function downloadAIOutput(format) {
            const content = state.ui.aiOutputContent;
            if (!content) return;

            const title = state.ui.aiOutputTitle || 'AIè¾“å‡º';
            const timestamp = formatDateTime(Date.now()).replace(/[:\s]/g, '-');
            let filename, mimeType, data;

            if (format === 'md') {
                filename = `MinLog-${title}-${timestamp}.md`;
                mimeType = 'text/markdown';
                data = `# ${title}\n\n> ç”Ÿæˆæ—¶é—´: ${formatDateTime(Date.now())}\n\n---\n\n${content}`;
            } else {
                filename = `MinLog-${title}-${timestamp}.txt`;
                mimeType = 'text/plain';
                data = `${title}\nç”Ÿæˆæ—¶é—´: ${formatDateTime(Date.now())}\n${'='.repeat(50)}\n\n${content}`;
            }

            const blob = new Blob([data], { type: mimeType + ';charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast(t('downloaded'), 'success');
        }

        // æ˜¾ç¤ºéšæœºæµ®ç°
        async function showResurface() {
            if (!state.settings.autoResurface) return;

            try {
                const result = await AIFeatures.getAIEnhancedResurface();
                if (!result || !result.note) return;

                const section = document.getElementById('resurfaceSection');
                const contentEl = document.getElementById('resurfaceContent');
                const timeEl = document.getElementById('resurfaceTime');
                const countEl = document.getElementById('resurfaceRescueCount');
                const reasonEl = document.getElementById('resurfaceReason');
                const badgeEl = document.getElementById('resurfaceBadge');

                state.ui.currentResurfaceNote = result.note;

                contentEl.textContent = result.note.content;
                timeEl.textContent = formatRelativeTime(result.note.created_at);
                countEl.querySelector('span').textContent = result.note.rescue_count || 0;

                if (result.isAIEnhanced && result.reason) {
                    badgeEl.textContent = t('aiRecommend');
                    reasonEl.textContent = `ğŸ’¡ ${result.reason}`;
                    reasonEl.style.display = 'block';
                } else {
                    badgeEl.textContent = t('randomPick');
                    reasonEl.style.display = 'none';
                }

                section.classList.add('show');
            } catch (e) {
                console.error('Resurface error:', e);
            }
        }

        // å…³é—­æµ®ç°
        function closeResurface() {
            document.getElementById('resurfaceSection').classList.remove('show');
            state.ui.currentResurfaceNote = null;
        }

        // è·³è¿‡æµ®ç°
        function skipResurface() {
            closeResurface();
            // å»¶è¿Ÿåå¯èƒ½å†æ¬¡æ˜¾ç¤º
            setTimeout(() => {
                if (Math.random() > 0.7) {
                    showResurface();
                }
            }, 60000);
        }

        // æ‰“ææµ®ç°çš„ç¬”è®°
        async function rescueResurfaced() {
            if (!state.ui.currentResurfaceNote) return;

            await NoteEngine.rescueNote(state.ui.currentResurfaceNote.id);
            showToast(t('noteRescued'), 'success');
            closeResurface();
            renderNotes();
            updateStats();
        }

        // æ›´æ–°å­˜å‚¨å¥åº·åº¦
        async function updateStorageHealth() {
            const usage = await StorageEngine.getStorageUsage();
            const percentage = Math.min(usage.percentage, 100);

            const valueEl = document.getElementById('storageValue');
            const fillEl = document.getElementById('storageFill');

            valueEl.textContent = `${percentage.toFixed(1)}%`;
            fillEl.style.width = `${percentage}%`;

            fillEl.classList.remove('warning', 'critical');
            if (percentage > 80) {
                fillEl.classList.add('critical');
                if (percentage > 90) {
                    showToast(t('storageCritical'), 'warning');
                }
            } else if (percentage > 60) {
                fillEl.classList.add('warning');
            }
        }

        // æ›´æ–° AI ç½‘ç»œçŠ¶æ€å¾½ç« 
        function updateNetworkBadge() {
            const badge = document.getElementById('aiNetworkBadge');
            if (state.settings.allowNetwork) {
                badge.textContent = t('online');
                badge.classList.remove('offline');
            } else {
                badge.textContent = t('offline');
                badge.classList.add('offline');
            }
        }

        // æ›´æ–° AI æ¨¡å‹é€‰æ‹©å™¨
        function updateModelSelector() {
            const provider = AI_PROVIDERS[state.settings.aiProvider];
            const select = document.getElementById('aiModelSelect');

            // é˜²å¾¡æ€§æ£€æŸ¥ï¼šå¦‚æœ provider æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å€¼
            if (!provider) {
                console.warn('AI Provider not found:', state.settings.aiProvider, ', falling back to siliconflow');
                state.settings.aiProvider = 'siliconflow';
                state.settings.aiModel = 'Pro/zai-org/GLM-4.7';
                const defaultProvider = AI_PROVIDERS['siliconflow'];
                select.innerHTML = defaultProvider.models.map(model =>
                    `<option value="${model}" ${model === state.settings.aiModel ? 'selected' : ''}>${model}</option>`
                ).join('') + '<option value="__custom__">-- è‡ªå®šä¹‰æ¨¡å‹ --</option>';
                return;
            }

            // ç”Ÿæˆæ¨¡å‹é€‰é¡¹ï¼Œæœ«å°¾æ·»åŠ "è‡ªå®šä¹‰æ¨¡å‹"é€‰é¡¹
            const modelOptions = provider.models.map(model =>
                `<option value="${model}" ${model === state.settings.aiModel ? 'selected' : ''}>${model}</option>`
            ).join('');

            // æ£€æŸ¥å½“å‰æ¨¡å‹æ˜¯å¦æ˜¯è‡ªå®šä¹‰çš„ï¼ˆä¸åœ¨é¢„è®¾åˆ—è¡¨ä¸­ï¼‰
            const isCustomModel = state.settings.aiModel && !provider.models.includes(state.settings.aiModel);

            select.innerHTML = modelOptions +
                `<option value="__custom__" ${isCustomModel ? 'selected' : ''}>-- è‡ªå®šä¹‰æ¨¡å‹ --</option>`;

            // æ§åˆ¶è‡ªå®šä¹‰æ¨¡å‹è¾“å…¥æ¡†çš„æ˜¾ç¤º
            updateCustomModelInputVisibility(isCustomModel);
        }

        // æ›´æ–°è‡ªå®šä¹‰æ¨¡å‹è¾“å…¥æ¡†å¯è§æ€§
        function updateCustomModelInputVisibility(show) {
            const customModelInput = document.getElementById('customModelInput');
            if (!customModelInput) return;

            if (show) {
                customModelInput.classList.remove('hidden');
                // å¦‚æœæ˜¯è‡ªå®šä¹‰æ¨¡å‹ï¼Œæ˜¾ç¤ºå½“å‰å€¼
                if (state.settings.aiModel && state.settings.aiModel !== '__custom__') {
                    customModelInput.value = state.settings.aiModel;
                }
            } else {
                customModelInput.classList.add('hidden');
                customModelInput.value = '';
            }
        }

        // æ›´æ–° Key çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateKeyStatusIndicator() {
            const indicator = document.getElementById('keyStatusIndicator');
            if (!indicator) return;

            const provider = AI_PROVIDERS[state.settings.aiProvider];
            if (!provider) {
                indicator.textContent = 'âš ï¸ æ— æ•ˆçš„æœåŠ¡å•†';
                indicator.style.color = 'var(--error-500)';
                return;
            }

            const keyName = provider.keyName;
            const kmKey = keyName ? (localStorage.getItem(keyName) || sessionStorage.getItem(keyName)) : '';
            const manualKey = state.settings.apiKey || '';

            if (kmKey) {
                indicator.innerHTML = `âœ… Key Manager å·²é…ç½® (${keyName})`;
                indicator.style.color = 'var(--success-500)';
            } else if (manualKey) {
                indicator.textContent = 'ğŸ”‘ ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥çš„ Key';
                indicator.style.color = 'var(--warning-500)';
            } else {
                indicator.textContent = 'âŒ æœªé…ç½® API Key';
                indicator.style.color = 'var(--error-500)';
            }
        }

        // åº”ç”¨ i18n
        function applyI18n() {
            const lang = state.settings.language;

            // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) {
                    el.textContent = i18n[lang][key];
                }
            });

            // æ›´æ–° placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (i18n[lang][key]) {
                    el.placeholder = i18n[lang][key];
                }
            });

            // æ›´æ–° title
            document.querySelectorAll('[data-i18n-title]').forEach(el => {
                const key = el.getAttribute('data-i18n-title');
                if (i18n[lang][key]) {
                    el.title = i18n[lang][key];
                }
            });

            // æ›´æ–° HTML lang å±æ€§
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Event Handlers
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // æ·»åŠ ç¬”è®°
        async function addNote() {
            const input = document.getElementById('noteInput');
            const content = input.value.trim();

            if (!content) return;

            const note = await NoteEngine.addNote(content);
            if (note) {
                input.value = '';
                input.style.height = 'auto';
                renderNotes();
                updateStats();
                showToast(t('noteAdded'), 'success');

                // åŒæ­¥åˆ°æœ¬åœ°æ–‡ä»¶
                syncToLocalFile();
            }
        }

        // æ‰“æç¬”è®°
        async function rescueNote(id) {
            await NoteEngine.rescueNote(id);
            renderNotes();
            updateStats();
            showToast(t('noteRescued'), 'success');
            syncToLocalFile();
        }

        // ç¡®è®¤åˆ é™¤ç¬”è®°
        function confirmDeleteNote(id) {
            state.ui.pendingDeleteId = id;

            document.getElementById('confirmIcon').textContent = 'âš ï¸';
            document.getElementById('confirmTitle').textContent = t('deleteConfirmTitle');
            document.getElementById('confirmMessage').textContent = t('deleteConfirmMessage');
            document.getElementById('confirmBtn').onclick = async () => {
                await deleteNote(id);
                closeConfirmModal();
            };

            document.getElementById('confirmModal').classList.add('show');
        }

        // åˆ é™¤ç¬”è®°
        async function deleteNote(id) {
            await NoteEngine.deleteNote(id);
            renderNotes();
            updateStats();
            showToast(t('noteDeleted'), 'info');
            syncToLocalFile();
        }

        // åˆ‡æ¢æœç´¢
        function toggleSearch() {
            const section = document.getElementById('searchSection');
            section.classList.toggle('hidden');

            if (!section.classList.contains('hidden')) {
                document.getElementById('searchInput').focus();
            }
        }

        // æ¸…é™¤æœç´¢
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            state.ui.searchQuery = '';
            state.ui.searchFilter = 'all';

            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.dataset.filter === 'all') {
                    chip.classList.add('active');
                }
            });

            renderNotes();
        }

        // è®¾ç½®æœç´¢è¿‡æ»¤å™¨
        function setSearchFilter(filter) {
            state.ui.searchFilter = filter;

            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.filter === filter);
            });

            renderNotes();
        }

        // åˆ‡æ¢æ›´å¤šåŠŸèƒ½ä¸‹æ‹‰
        function toggleMoreFeatures() {
            const dropdown = document.getElementById('moreFeaturesDropdown');
            dropdown.classList.toggle('show');

            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            if (dropdown.classList.contains('show')) {
                setTimeout(() => {
                    document.addEventListener('click', closeMoreFeaturesOnClickOutside);
                }, 0);
            }
        }

        function closeMoreFeaturesOnClickOutside(e) {
            const dropdown = document.getElementById('moreFeaturesDropdown');
            const moreBtn = e.target.closest('.ai-features-more');

            if (!moreBtn) {
                dropdown.classList.remove('show');
                document.removeEventListener('click', closeMoreFeaturesOnClickOutside);
            }
        }

        // è¯­éŸ³è¾“å…¥
        let recognition = null;
        let isRecording = false;

        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥', 'error');
                return;
            }

            if (isRecording) {
                stopVoiceInput();
            } else {
                startVoiceInput();
            }
        }

        function startVoiceInput() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = state.settings.language === 'zh' ? 'zh-CN' : 'en-US';
            recognition.continuous = true;
            recognition.interimResults = true;

            const input = document.getElementById('noteInput');
            const btn = document.getElementById('voiceBtn');
            let finalTranscript = input.value;

            recognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                input.value = finalTranscript + interimTranscript;
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                stopVoiceInput();
            };

            recognition.onend = () => {
                stopVoiceInput();
            };

            recognition.start();
            isRecording = true;
            btn.classList.add('recording');
        }

        function stopVoiceInput() {
            if (recognition) {
                recognition.stop();
                recognition = null;
            }
            isRecording = false;
            document.getElementById('voiceBtn').classList.remove('recording');
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Modal Functions
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // è®¾ç½®æ¨¡æ€æ¡†
        function openSettingsModal() {
            try {
                // ç¡®ä¿ aiProvider æœ‰æ•ˆï¼Œå¦‚æœæ— æ•ˆåˆ™é‡ç½®ä¸ºé»˜è®¤å€¼
                if (!AI_PROVIDERS[state.settings.aiProvider]) {
                    console.warn('Invalid AI provider, resetting to openai');
                    state.settings.aiProvider = 'openai';
                    state.settings.aiModel = 'gpt-4o-mini';
                }

                // åŒæ­¥å½“å‰è®¾ç½®åˆ° UIï¼ˆä½¿ç”¨ || æä¾›é»˜è®¤å€¼é˜²æ­¢ null/undefinedï¼‰
                document.getElementById('languageSelect').value = state.settings.language || 'zh';
                document.getElementById('autoResurfaceToggle').checked = !!state.settings.autoResurface;
                document.getElementById('aiResurfaceToggle').checked = !!state.settings.aiEnhancedResurface;
                document.getElementById('allowNetworkToggle').checked = !!state.settings.allowNetwork;
                document.getElementById('aiProviderSelect').value = state.settings.aiProvider;
                document.getElementById('apiKeyInput').value = state.settings.apiKey || '';
                document.getElementById('customEndpointInput').value = state.settings.customEndpoint || '';

                // æ›´æ–°æ¨¡å‹é€‰æ‹©å™¨
                updateModelSelector();

                // æ›´æ–° Key çŠ¶æ€æŒ‡ç¤ºå™¨
                updateKeyStatusIndicator();

                // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰ç«¯ç‚¹è¾“å…¥
                const customEndpointInput = document.getElementById('customEndpointInput');
                if (state.settings.aiProvider === 'custom') {
                    customEndpointInput.classList.remove('hidden');
                } else {
                    customEndpointInput.classList.add('hidden');
                }

                // æ›´æ–°å­˜å‚¨å¥åº·åº¦ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
                updateStorageHealth().catch(err => console.warn('Storage health update failed:', err));

            } catch (error) {
                console.error('Error preparing settings modal:', error);
            }

            // æ— è®ºæ˜¯å¦å‡ºé”™ï¼Œéƒ½å°è¯•æ‰“å¼€æ¨¡æ€æ¡†
            document.getElementById('settingsModal').classList.add('show');
        }

        function closeSettingsModal() {
            // ä¿å­˜è®¾ç½®
            state.settings.apiKey = document.getElementById('apiKeyInput').value;
            state.settings.customEndpoint = document.getElementById('customEndpointInput').value;

            StorageEngine.saveSettings(state.settings);
            showToast(t('settingsSaved'), 'success');

            document.getElementById('settingsModal').classList.remove('show');
        }

        // å¯¼å‡ºæ¨¡æ€æ¡†
        function openExportModal() {
            state.ui.selectedExportFormat = 'json';
            document.querySelectorAll('.export-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.format === 'json');
            });
            document.getElementById('exportModal').classList.add('show');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        function selectExportFormat(format) {
            state.ui.selectedExportFormat = format;
            document.querySelectorAll('.export-option').forEach(opt => {
                opt.classList.toggle('selected', opt.dataset.format === format);
            });
        }

        function executeExport() {
            const format = state.ui.selectedExportFormat;
            let data, filename, mimeType;
            const timestamp = formatDateTime(Date.now()).replace(/[:\s]/g, '-');

            switch (format) {
                case 'json':
                    data = NoteEngine.exportAsJson();
                    filename = `MinLog-backup-${timestamp}.json`;
                    mimeType = 'application/json';
                    break;
                case 'md':
                    data = NoteEngine.exportAsMarkdown();
                    filename = `MinLog-export-${timestamp}.md`;
                    mimeType = 'text/markdown';
                    break;
                case 'txt':
                    data = NoteEngine.exportAsTxt();
                    filename = `MinLog-export-${timestamp}.txt`;
                    mimeType = 'text/plain';
                    break;
            }

            const blob = new Blob([data], { type: `${mimeType};charset=utf-8` });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast(t('exportSuccess'), 'success');
            closeExportModal();
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Settings Functions
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        // åŠ è½½è®¾ç½®åˆ° UI
        function loadSettingsToUI() {
            document.getElementById('languageSelect').value = state.settings.language;
            document.getElementById('autoResurfaceToggle').checked = state.settings.autoResurface;
            document.getElementById('aiResurfaceToggle').checked = state.settings.aiEnhancedResurface;
            document.getElementById('allowNetworkToggle').checked = state.settings.allowNetwork;
            document.getElementById('aiProviderSelect').value = state.settings.aiProvider;
            document.getElementById('apiKeyInput').value = state.settings.apiKey || '';
            document.getElementById('customEndpointInput').value = state.settings.customEndpoint || '';

            updateModelSelector();
            updateCustomEndpointVisibility();
            updateStorageHealth();
        }

        // ä» UI ä¿å­˜è®¾ç½®
        async function saveSettingsFromUI() {
            state.settings.apiKey = document.getElementById('apiKeyInput').value;
            state.settings.customEndpoint = document.getElementById('customEndpointInput').value;

            await StorageEngine.saveSettings(state.settings);
            showToast(t('settingsSaved'), 'success');
        }

        // æ›´æ”¹è¯­è¨€
        function changeLanguage(lang) {
            state.settings.language = lang;
            applyI18n();
            StorageEngine.saveSettings(state.settings);

            // æ›´æ–°è¯­éŸ³è¯†åˆ«è¯­è¨€
            if (recognition) {
                recognition.lang = lang === 'zh' ? 'zh-CN' : 'en-US';
            }
        }

        // åˆ‡æ¢è‡ªåŠ¨æµ®ç°
        function toggleAutoResurface(enabled) {
            state.settings.autoResurface = enabled;
            StorageEngine.saveSettings(state.settings);

            if (enabled) {
                setTimeout(showResurface, 30000);
            }
        }

        // åˆ‡æ¢ AI å¢å¼ºæµ®ç°
        function toggleAIResurface(enabled) {
            state.settings.aiEnhancedResurface = enabled;
            StorageEngine.saveSettings(state.settings);
        }

        // åˆ‡æ¢è”ç½‘
        function toggleNetwork(enabled) {
            state.settings.allowNetwork = enabled;
            updateNetworkBadge();
            StorageEngine.saveSettings(state.settings);
            showToast(enabled ? t('networkEnabled') : t('networkDisabled'), 'info');
        }

        // æ›´æ”¹ AI æœåŠ¡å•†
        function changeAIProvider(provider) {
            state.settings.aiProvider = provider;
            state.settings.aiModel = AI_PROVIDERS[provider].defaultModel;
            updateModelSelector();
            updateKeyStatusIndicator();
            updateCustomEndpointVisibility();
            StorageEngine.saveSettings(state.settings);
        }

        // æ›´æ”¹ AI æ¨¡å‹
        function changeAIModel(model) {
            if (model === '__custom__') {
                // ç”¨æˆ·é€‰æ‹©äº†"è‡ªå®šä¹‰æ¨¡å‹"ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
                updateCustomModelInputVisibility(true);
                // æš‚æ—¶ä¸æ”¹å˜ aiModelï¼Œç­‰ç”¨æˆ·è¾“å…¥
                return;
            }

            // é€‰æ‹©äº†é¢„è®¾æ¨¡å‹
            state.settings.aiModel = model;
            updateCustomModelInputVisibility(false);
            StorageEngine.saveSettings(state.settings);
        }

        // è®¾ç½®è‡ªå®šä¹‰æ¨¡å‹
        function setCustomModel(modelId) {
            if (modelId && modelId.trim()) {
                state.settings.aiModel = modelId.trim();
                StorageEngine.saveSettings(state.settings);
            }
        }

        // æ›´æ–°è‡ªå®šä¹‰ç«¯ç‚¹å¯è§æ€§
        function updateCustomEndpointVisibility() {
            const customInput = document.getElementById('customEndpointInput');
            if (state.settings.aiProvider === 'custom') {
                customInput.classList.remove('hidden');
            } else {
                customInput.classList.add('hidden');
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Import Functions
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.txt,.md';

            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    const text = await file.text();
                    let importedNotes = [];

                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(text);
                        // æ”¯æŒå¤šç§ JSON æ ¼å¼
                        if (Array.isArray(data)) {
                            importedNotes = data;
                        } else if (data.notes && Array.isArray(data.notes)) {
                            importedNotes = data.notes;
                        }
                    } else {
                        // TXT/MD æ ¼å¼ï¼šæŒ‰åˆ†éš”ç¬¦æ‹†åˆ†
                        const blocks = text.split(/\n-{3,}\n|\n={3,}\n/);
                        importedNotes = blocks
                            .map(block => block.trim())
                            .filter(block => block.length > 0)
                            .map(content => ({
                                id: generateId(),
                                content: content,
                                created_at: Date.now(),
                                updated_at: Date.now(),
                                tags: extractTags(content),
                                position: Date.now(),
                                is_rescued: false,
                                rescue_count: 0
                            }));
                    }

                    if (importedNotes.length === 0) {
                        showToast(t('importError'), 'error');
                        return;
                    }

                    // è½¬æ¢æ ¼å¼å¹¶å»é‡
                    const existingIds = new Set(state.notes.map(n => n.id));
                    let newCount = 0;

                    importedNotes.forEach(note => {
                        const migrated = StorageEngine.migrateNoteFormat(note);
                        if (!existingIds.has(migrated.id)) {
                            migrated.id = generateId(); // ç”Ÿæˆæ–° ID é¿å…å†²çª
                            migrated.position = state.notes.length + newCount;
                            state.notes.push(migrated);
                            newCount++;
                        }
                    });

                    if (newCount > 0) {
                        await StorageEngine.saveAllNotes(state.notes);
                        renderNotes();
                        updateStats();
                        showToast(t('importSuccess', { n: newCount }), 'success');
                    } else {
                        showToast('æ²¡æœ‰æ–°ç¬”è®°éœ€è¦å¯¼å…¥', 'info');
                    }

                } catch (err) {
                    console.error('Import error:', err);
                    showToast(t('importError'), 'error');
                }
            };

            input.click();
        }

        // ç¡®è®¤æ¸…é™¤æ•°æ®
        function confirmClearData() {
            document.getElementById('confirmIcon').textContent = 'ğŸ—‘ï¸';
            document.getElementById('confirmTitle').textContent = t('clearConfirmTitle');
            document.getElementById('confirmMessage').textContent = t('clearConfirmMessage');
            document.getElementById('confirmBtn').onclick = executeClearData;

            document.getElementById('confirmModal').classList.add('show');
        }

        async function executeClearData() {
            state.notes = [];
            await StorageEngine.saveAllNotes([]);
            closeConfirmModal();
            renderNotes();
            updateStats();
            showToast(t('noteDeleted'), 'info');
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Local File Sync (File System Access API)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        async function connectLocalFile() {
            if (!('showSaveFilePicker' in window)) {
                showToast('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæœ¬åœ°æ–‡ä»¶åŒæ­¥', 'error');
                return;
            }

            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: 'minlog-sync.json',
                    types: [{
                        description: 'JSON Files',
                        accept: { 'application/json': ['.json'] }
                    }]
                });

                state.settings.fileHandle = handle;
                await syncToLocalFile();
                showToast(t('fileSyncConnected'), 'success');

            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('File sync error:', err);
                    showToast(t('fileSyncError'), 'error');
                }
            }
        }

        async function syncToLocalFile() {
            if (!state.settings.fileHandle) return;

            try {
                const writable = await state.settings.fileHandle.createWritable();
                const data = NoteEngine.exportAsJson();
                await writable.write(data);
                await writable.close();
            } catch (err) {
                console.error('Sync to file error:', err);
                // æ–‡ä»¶å¥æŸ„å¯èƒ½å·²å¤±æ•ˆ
                state.settings.fileHandle = null;
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           i18n Application
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        function applyI18n() {
            const lang = state.settings.language;

            // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) {
                    el.textContent = i18n[lang][key];
                }
            });

            // æ›´æ–° placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (i18n[lang][key]) {
                    el.placeholder = i18n[lang][key];
                }
            });

            // æ›´æ–° title
            document.querySelectorAll('[data-i18n-title]').forEach(el => {
                const key = el.getAttribute('data-i18n-title');
                if (i18n[lang][key]) {
                    el.title = i18n[lang][key];
                }
            });

            // æ›´æ–° HTML lang å±æ€§
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';

            // é‡æ–°æ¸²æŸ“ç¬”è®°åˆ—è¡¨ä»¥æ›´æ–°ç›¸å¯¹æ—¶é—´
            renderNotes();
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Welcome Screen
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        function dismissWelcome() {
            document.getElementById('welcomeOverlay').classList.add('hidden');
            localStorage.setItem('minlog_welcomed', 'true');
        }

        function checkWelcome() {
            const welcomed = localStorage.getItem('minlog_welcomed');
            if (welcomed) {
                document.getElementById('welcomeOverlay').classList.add('hidden');
            }
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Event Listeners
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        function initEventListeners() {
            // ç¬”è®°è¾“å…¥æ¡†
            const noteInput = document.getElementById('noteInput');
            noteInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addNote();
                }
            });

            // è‡ªåŠ¨è°ƒæ•´é«˜åº¦
            noteInput.addEventListener('input', () => {
                noteInput.style.height = 'auto';
                noteInput.style.height = Math.min(noteInput.scrollHeight, 200) + 'px';
            });

            // AI èŠå¤©è¾“å…¥æ¡†
            const aiInput = document.getElementById('aiChatInput');
            aiInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendAIChat();
                }
            });

            aiInput.addEventListener('input', () => {
                aiInput.style.height = 'auto';
                aiInput.style.height = Math.min(aiInput.scrollHeight, 120) + 'px';
            });

            // æœç´¢è¾“å…¥æ¡†
            document.getElementById('searchInput').addEventListener('input', (e) => {
                handleSearchInput(e.target.value);
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('show');
                    }
                });
            });

            // ESC é”®å…³é—­æ¨¡æ€æ¡†
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal-overlay.show').forEach(modal => {
                        modal.classList.remove('show');
                    });
                    // å…³é—­æ›´å¤šåŠŸèƒ½ä¸‹æ‹‰èœå•
                    const dropdown = document.getElementById('moreFeaturesDropdown');
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            });

            // API Key è¾“å…¥æ¡†å¤±ç„¦æ—¶ä¿å­˜
            document.getElementById('apiKeyInput').addEventListener('blur', () => {
                state.settings.apiKey = document.getElementById('apiKeyInput').value;
                StorageEngine.saveSettings(state.settings);
            });

            // è‡ªå®šä¹‰ç«¯ç‚¹è¾“å…¥æ¡†å¤±ç„¦æ—¶ä¿å­˜
            document.getElementById('customEndpointInput').addEventListener('blur', () => {
                state.settings.customEndpoint = document.getElementById('customEndpointInput').value;
                StorageEngine.saveSettings(state.settings);
            });
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Application Initialization
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        async function initApp() {
            console.log('MinLog 2.0 initializing...');

            try {
                // 1. åˆå§‹åŒ– IndexedDB
                await StorageEngine.init();

                // 2. æ£€æŸ¥æ˜¯å¦éœ€è¦ä» localStorage è¿ç§»
                const oldData = localStorage.getItem('minlog_notes');
                if (oldData && state.isDBReady) {
                    await StorageEngine.migrateFromLocalStorage();
                }

                // 3. åŠ è½½è®¾ç½®
                const savedSettings = await StorageEngine.loadSettings();
                if (savedSettings) {
                    state.settings = { ...state.settings, ...savedSettings };
                }

                // 4. åŠ è½½ç¬”è®°
                await NoteEngine.getAllNotes();

                // 5. åº”ç”¨ i18n
                applyI18n();

                // 6. æ¸²æŸ“ UI
                renderNotes();
                updateStats();
                updateNetworkBadge();
                loadSettingsToUI();

                // 7. åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                initEventListeners();

                // 8. åˆå§‹åŒ–è¯­éŸ³è¾“å…¥
                initVoiceInput();

                // 9. æ£€æŸ¥æ¬¢è¿é¡µ
                checkWelcome();

                // 10. å»¶è¿Ÿæ˜¾ç¤ºéšæœºæµ®ç°
                if (state.settings.autoResurface && state.notes.length > 0) {
                    setTimeout(showResurface, 60000); // 1 åˆ†é’Ÿå
                }

                console.log('MinLog 2.0 initialized successfully!');
                console.log(`Loaded ${state.notes.length} notes`);

            } catch (error) {
                console.error('Initialization error:', error);

                // é™çº§åˆ° localStorage
                console.log('Falling back to localStorage...');
                state.notes = StorageEngine.loadFromLocalStorage();

                const savedSettings = localStorage.getItem('minlog_settings');
                if (savedSettings) {
                    try {
                        state.settings = { ...state.settings, ...JSON.parse(savedSettings) };
                    } catch (e) { }
                }

                applyI18n();
                renderNotes();
                updateStats();
                updateNetworkBadge();
                initEventListeners();
                initVoiceInput();
                checkWelcome();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initApp);

        // é¡µé¢å…³é—­å‰ä¿å­˜
        window.addEventListener('beforeunload', () => {
            // ç¡®ä¿æ•°æ®å·²ä¿å­˜
            if (state.settings.apiKey) {
                StorageEngine.saveSettings(state.settings);
            }
        });

    </script>
</body>

</html>