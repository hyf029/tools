<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æºæµ OriginView - è¶…çº§ä¸ªä½“çš„è®¤çŸ¥æ“ä½œç³»ç»Ÿ</title>
  <meta name="description" content="å¸®åŠ©è¶…çº§ä¸ªä½“å»ºç«‹è®¤çŸ¥ä¼˜åŠ¿ã€ç§¯ç´¯è®¤çŸ¥èµ„äº§ã€å®ç°è®¤çŸ¥å˜ç°">

  <!-- tool_meta -->
  <script type="application/json" id="tool_meta">
  {
    "tool_name": "æºæµ OriginView",
    "tool_version": "2.0.0",
    "description": "è¶…çº§ä¸ªä½“çš„è®¤çŸ¥æ“ä½œç³»ç»Ÿâ€”â€”å¸®ä½ å»ºç«‹è®¤çŸ¥ä¼˜åŠ¿ã€ç§¯ç´¯è®¤çŸ¥èµ„äº§ã€å®ç°è®¤çŸ¥å˜ç°",
    "author": "AI Tool Factory",
    "features": ["æºå¤´æº¯æº", "æ·±åº¦æ‹†è§£", "è¿ç§»åº”ç”¨", "ç›²åŒºè¯Šæ–­", "è§‚ç‚¹è¾“å‡º", "çŸ¥è¯†å˜ç°"],
    "ai_powered": true
  }
  </script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Marked.js for Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* ========================================
       CSS å˜é‡ä½“ç³» - ä¸»é¢˜ç³»ç»Ÿ
       ======================================== */

    :root {
      /* èƒŒæ™¯è‰²ç³» */
      --bg-page: #0f172a;
      --bg-card: rgba(255, 255, 255, 0.05);
      --bg-card-hover: rgba(255, 255, 255, 0.08);
      --bg-input: rgba(255, 255, 255, 0.05);
      --bg-button: #8b5cf6;
      --bg-button-hover: #7c3aed;
      --bg-button-secondary: rgba(255, 255, 255, 0.1);
      --bg-button-secondary-hover: rgba(255, 255, 255, 0.15);
      --bg-overlay: rgba(0, 0, 0, 0.6);

      /* æ–‡å­—è‰²ç³» */
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --text-accent: #a78bfa;
      --text-on-button: #ffffff;

      /* è¾¹æ¡†è‰²ç³» */
      --border-default: rgba(255, 255, 255, 0.1);
      --border-hover: rgba(139, 92, 246, 0.5);
      --border-active: rgba(139, 92, 246, 0.8);
      --border-focus: rgba(139, 92, 246, 0.6);

      /* çŠ¶æ€è‰²ç³» */
      --color-success: #10b981;
      --color-success-bg: rgba(16, 185, 129, 0.15);
      --color-warning: #f59e0b;
      --color-warning-bg: rgba(245, 158, 11, 0.15);
      --color-error: #ef4444;
      --color-error-bg: rgba(239, 68, 68, 0.15);
      --color-info: #3b82f6;
      --color-info-bg: rgba(59, 130, 246, 0.15);

      /* æ¸å˜è‰²ç³» */
      --gradient-start: #1e1b4b;
      --gradient-mid: #312e81;
      --gradient-end: #1e3a5f;

      /* é˜´å½± */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
      --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.3);

      /* åœºæ™¯è‰²ç³» */
      --mode-learn: #8b5cf6;
      --mode-deconstruct: #06b6d4;
      --mode-transfer: #10b981;
      --mode-diagnose: #f59e0b;
      --mode-output: #ec4899;
      --mode-monetize: #f97316;
    }

    [data-theme="light"] {
      --bg-page: #f8fafc;
      --bg-card: rgba(0, 0, 0, 0.02);
      --bg-card-hover: rgba(0, 0, 0, 0.04);
      --bg-input: #ffffff;
      --bg-button: #7c3aed;
      --bg-button-hover: #6d28d9;
      --bg-button-secondary: rgba(0, 0, 0, 0.05);
      --bg-button-secondary-hover: rgba(0, 0, 0, 0.08);
      --bg-overlay: rgba(0, 0, 0, 0.4);

      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --text-accent: #7c3aed;
      --text-on-button: #ffffff;

      --border-default: rgba(0, 0, 0, 0.1);
      --border-hover: rgba(124, 58, 237, 0.4);
      --border-active: rgba(124, 58, 237, 0.6);
      --border-focus: rgba(124, 58, 237, 0.5);

      --color-success: #059669;
      --color-success-bg: rgba(5, 150, 105, 0.1);
      --color-warning: #d97706;
      --color-warning-bg: rgba(217, 119, 6, 0.1);
      --color-error: #dc2626;
      --color-error-bg: rgba(220, 38, 38, 0.1);
      --color-info: #2563eb;
      --color-info-bg: rgba(37, 99, 235, 0.1);

      --gradient-start: #f5f3ff;
      --gradient-mid: #ede9fe;
      --gradient-end: #e0e7ff;

      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.15);
      --shadow-glow: 0 0 20px rgba(124, 58, 237, 0.2);
    }

    /* ========================================
       åŸºç¡€æ ·å¼
       ======================================== */

    * {
      box-sizing: border-box;
    }

    body {
      background: var(--bg-page);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* ========================================
       ä¸»é¢˜å·¥å…·ç±»
       ======================================== */

    .bg-page { background: var(--bg-page); }
    .bg-card { background: var(--bg-card); }
    .bg-card-hover:hover { background: var(--bg-card-hover); }
    .bg-input { background: var(--bg-input); }
    .bg-overlay { background: var(--bg-overlay); }

    .text-primary { color: var(--text-primary); }
    .text-secondary { color: var(--text-secondary); }
    .text-muted { color: var(--text-muted); }
    .text-accent { color: var(--text-accent); }

    .border-default { border-color: var(--border-default); }
    .border-hover:hover { border-color: var(--border-hover); }
    .border-active { border-color: var(--border-active); }

    .text-success { color: var(--color-success); }
    .bg-success { background: var(--color-success-bg); }
    .text-warning { color: var(--color-warning); }
    .bg-warning { background: var(--color-warning-bg); }
    .text-error { color: var(--color-error); }
    .bg-error { background: var(--color-error-bg); }
    .text-info { color: var(--color-info); }
    .bg-info { background: var(--color-info-bg); }

    /* ========================================
       ç»„ä»¶æ ·å¼ - æŒ‰é’®
       ======================================== */

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 500;
      font-size: 0.875rem;
      transition: all 0.2s ease;
      cursor: pointer;
      border: none;
      outline: none;
    }

    .btn-primary {
      background: var(--bg-button);
      color: var(--text-on-button);
    }
    .btn-primary:hover:not(:disabled) {
      background: var(--bg-button-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--bg-button-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-default);
    }
    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-button-secondary-hover);
      border-color: var(--border-hover);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }
    .btn-ghost:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
    }

    .btn-lg {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - è¾“å…¥æ¡†
       ======================================== */

    .input {
      width: 100%;
      padding: 0.625rem 0.875rem;
      background: var(--bg-input);
      border: 1px solid var(--border-default);
      border-radius: 0.5rem;
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    .input:focus {
      outline: none;
      border-color: var(--border-focus);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
    }
    .input::placeholder {
      color: var(--text-muted);
    }

    textarea.input {
      resize: vertical;
      min-height: 100px;
    }

    select.input {
      cursor: pointer;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - å¡ç‰‡
       ======================================== */

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.75rem;
      padding: 1rem;
      transition: all 0.2s ease;
    }
    .card:hover {
      background: var(--bg-card-hover);
    }
    .card-interactive:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-glow);
      transform: translateY(-2px);
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - Mode å¡ç‰‡
       ======================================== */

    .mode-card {
      --mode-color: var(--mode-learn);
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.75rem;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }
    .mode-card:hover {
      background: var(--bg-card-hover);
      border-color: var(--mode-color);
      box-shadow: 0 0 20px color-mix(in srgb, var(--mode-color) 25%, transparent);
      transform: translateY(-2px);
    }
    .mode-card.active {
      border-color: var(--mode-color);
      background: color-mix(in srgb, var(--mode-color) 10%, transparent);
    }
    .mode-card .mode-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--mode-color);
    }
    .mode-card .mode-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }
    .mode-card .mode-desc {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .mode-learn { --mode-color: var(--mode-learn); }
    .mode-deconstruct { --mode-color: var(--mode-deconstruct); }
    .mode-transfer { --mode-color: var(--mode-transfer); }
    .mode-diagnose { --mode-color: var(--mode-diagnose); }
    .mode-output { --mode-color: var(--mode-output); }
    .mode-monetize { --mode-color: var(--mode-monetize); }

    /* ========================================
       ç»„ä»¶æ ·å¼ - æ ‡ç­¾
       ======================================== */

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      background: var(--bg-card);
      color: var(--text-secondary);
      border: 1px solid var(--border-default);
    }
    .tag-active {
      background: var(--bg-button);
      color: var(--text-on-button);
      border-color: transparent;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - Toast
       ======================================== */

    .toast {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.75rem 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.5rem;
      box-shadow: var(--shadow-xl);
      z-index: 9999;
      animation: slideDown 0.3s ease;
      font-weight: 500;
    }
    .toast-success { border-left: 4px solid var(--color-success); }
    .toast-warning { border-left: 4px solid var(--color-warning); }
    .toast-error { border-left: 4px solid var(--color-error); }
    .toast-info { border-left: 4px solid var(--color-info); }

    @keyframes slideDown {
      from { transform: translate(-50%, -100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - åŠ è½½åŠ¨ç”»
       ======================================== */

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-default);
      border-top-color: var(--bg-button);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-dots::after {
      content: '';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - å¼¹çª—
       ======================================== */

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-overlay);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-page);
      border: 1px solid var(--border-default);
      border-radius: 1rem;
      box-shadow: var(--shadow-xl);
      width: 100%;
      max-width: 32rem;
      max-height: 80vh;
      overflow: hidden;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }
    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-default);
    }

    .modal-body {
      padding: 1.25rem;
      overflow-y: auto;
      max-height: calc(80vh - 130px);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.25rem;
      border-top: 1px solid var(--border-default);
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - Markdown æ¸²æŸ“
       ======================================== */

    .markdown h1, .markdown h2, .markdown h3, .markdown h4 {
      color: var(--text-primary);
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }
    .markdown h1 { font-size: 1.5rem; }
    .markdown h2 { font-size: 1.25rem; }
    .markdown h3 { font-size: 1.125rem; }
    .markdown h4 { font-size: 1rem; }

    .markdown p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.75;
    }

    .markdown ul, .markdown ol {
      color: var(--text-secondary);
      margin-bottom: 1rem;
      padding-left: 1.5rem;
    }
    .markdown li {
      margin-bottom: 0.5rem;
    }

    .markdown code {
      background: var(--bg-card);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      color: var(--text-accent);
      font-family: "SF Mono", Monaco, "Cascadia Code", monospace;
    }

    .markdown pre {
      background: var(--bg-card);
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1rem;
    }
    .markdown pre code {
      background: transparent;
      padding: 0;
    }

    .markdown blockquote {
      border-left: 4px solid var(--border-active);
      padding-left: 1rem;
      margin: 1rem 0;
      color: var(--text-muted);
      font-style: italic;
    }

    .markdown strong {
      color: var(--text-accent);
      font-weight: 600;
    }

    .markdown a {
      color: var(--text-accent);
      text-decoration: underline;
    }

    .markdown hr {
      border: none;
      border-top: 1px solid var(--border-default);
      margin: 1.5rem 0;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - æ¨èå¡ç‰‡ï¼ˆé‡æ„ç‰ˆï¼‰
       ======================================== */

    .recommend-item {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.15s ease;
      font-size: 0.875rem;
    }
    .recommend-item:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }
    .recommend-item.selected {
      border-color: var(--bg-button);
      background: color-mix(in srgb, var(--bg-button) 15%, transparent);
    }
    .recommend-item-name {
      color: var(--text-primary);
      font-weight: 500;
    }
    .recommend-item-domain {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .recommend-group {
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border-default);
    }
    .recommend-group:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    /* æ—§ç‰ˆæ¨èå¡ç‰‡æ ·å¼ï¼ˆä¿ç•™å…¼å®¹ï¼‰ */
    .recommend-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.5rem;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .recommend-card:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }
    .recommend-card.selected {
      border-color: var(--bg-button);
      background: color-mix(in srgb, var(--bg-button) 10%, transparent);
    }

    .level-selector {
      display: inline-flex;
      gap: 0.25rem;
      background: var(--bg-card);
      border-radius: 0.375rem;
      padding: 0.125rem;
    }
    .level-btn {
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.625rem;
      font-weight: 500;
      color: var(--text-muted);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .level-btn:hover {
      color: var(--text-secondary);
    }
    .level-btn.active {
      background: var(--bg-button);
      color: var(--text-on-button);
    }


    /* ========================================
       ç»„ä»¶æ ·å¼ - ç»“æ„åŒ–è¾“å‡ºå¡ç‰‡
       ======================================== */

    .output-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 0.75rem;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .output-card-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--bg-card-hover);
      border-bottom: 1px solid var(--border-default);
      font-weight: 600;
      font-size: 0.875rem;
    }
    .output-card-body {
      padding: 1rem;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - é‡‘å¥å±•ç¤º
       ======================================== */

    .golden-quote {
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-mid), var(--gradient-end));
      border-radius: 0.75rem;
      padding: 1.5rem;
      text-align: center;
      margin: 1rem 0;
    }
    .golden-quote p {
      font-size: 1.125rem;
      font-weight: 500;
      color: var(--text-primary);
      font-style: italic;
      line-height: 1.8;
      margin: 0;
    }

    /* ========================================
       ç»„ä»¶æ ·å¼ - ä¸‹ä¸€æ­¥æ¨è
       ======================================== */

    .next-step-card {
      background: var(--color-info-bg);
      border: 1px solid color-mix(in srgb, var(--color-info) 30%, transparent);
      border-radius: 0.75rem;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    /* ========================================
       æ»šåŠ¨æ¡æ ·å¼
       ======================================== */

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-hover);
    }

    /* ========================================
       å·¥å…·ç±»
       ======================================== */

    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .justify-center { justify-content: center; }
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .w-full { width: 100%; }
    .text-sm { font-size: 0.875rem; }
    .text-xs { font-size: 0.75rem; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  </style>
</head>
<body class="bg-page text-primary min-h-screen">
  <!-- Toast å®¹å™¨ -->
  <div id="toast-container"></div>

  <!-- ä¸»åº”ç”¨å®¹å™¨ -->
  <div id="app" class="max-w-4xl mx-auto px-4 py-6">

    <!-- Header -->
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <span class="text-3xl">ğŸ§­</span>
        <div>
          <h1 class="text-xl font-semibold text-primary">æºæµ OriginView</h1>
          <p class="text-sm text-muted">è¶…çº§ä¸ªä½“çš„è®¤çŸ¥æ“ä½œç³»ç»Ÿ</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="toggleTheme()" class="btn btn-secondary btn-sm" title="åˆ‡æ¢ä¸»é¢˜">
          <span id="theme-icon">ğŸŒ™</span>
        </button>
        <button onclick="showAssetModal()" class="btn btn-secondary btn-sm">
          ğŸ“¦ èµ„äº§åº“
        </button>
        <button onclick="showSettingsModal()" class="btn btn-secondary btn-sm">
          âš™ï¸ è®¾ç½®
        </button>
      </div>
    </header>

    <!-- é›¶æ€å¼•å¯¼é¡µ -->
    <div id="zero-state" class="py-6">
      <!-- æ¬¢è¿è¯­ + å¿«é€Ÿå¼€å§‹ -->
      <div class="text-center mb-6">
        <p class="text-accent text-lg italic mb-2">ã€Œå®å¯æ…¢ä¸€ç‚¹å­¦æºå¤´ï¼Œä¹Ÿä¸è¦å¿«é€Ÿå­¦å™ªéŸ³ã€</p>
        <p class="text-secondary">é€‰æ‹©ä¸€ä¸ªåœºæ™¯ï¼Œå¼€å§‹ä½ çš„è®¤çŸ¥å‡çº§ä¹‹æ—…</p>
      </div>

      <!-- åœºæ™¯é€‰æ‹©ï¼ˆä¸»è¦å†…å®¹ï¼‰ -->
      <div class="card max-w-3xl mx-auto mb-6">
        <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="zero-state-modes">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
        <p class="text-muted text-sm mt-4 text-center">ğŸ’¡ æ¨èè·¯å¾„ï¼šå­¦æ–°é¢†åŸŸ â†’ æ·±åº¦ç†è§£ â†’ è¿ç§»åº”ç”¨ â†’ å†…å®¹è¾“å‡º â†’ çŸ¥è¯†å˜ç°</p>
      </div>

      <!-- ä½¿ç”¨å¼•å¯¼ï¼ˆæŠ˜å å¼ï¼Œå‡å°‘è§†è§‰å¹²æ‰°ï¼‰ -->
      <details class="card max-w-2xl mx-auto">
        <summary class="font-medium text-primary cursor-pointer select-none">ğŸ“– é¦–æ¬¡ä½¿ç”¨ï¼Ÿç‚¹å‡»æŸ¥çœ‹å¼•å¯¼</summary>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm mt-4">
          <div class="p-3 rounded-lg bg-card-hover">
            <div class="font-medium text-accent mb-1">Step 1: é…ç½® API</div>
            <p class="text-secondary">ç‚¹å‡»å³ä¸Šè§’ã€Œâš™ï¸ è®¾ç½®ã€ï¼Œé€‰æ‹© AI æœåŠ¡å•†å¹¶è¾“å…¥ API Key</p>
          </div>
          <div class="p-3 rounded-lg bg-card-hover">
            <div class="font-medium text-accent mb-1">Step 2: é€‰æ‹©åœºæ™¯</div>
            <p class="text-secondary">æ ¹æ®ä½ çš„ç›®æ ‡é€‰æ‹©ä¸Šæ–¹çš„åœºæ™¯å¡ç‰‡ï¼Œæ–°æ‰‹æ¨èä»ã€Œå­¦æ–°é¢†åŸŸã€å¼€å§‹</p>
          </div>
          <div class="p-3 rounded-lg bg-card-hover">
            <div class="font-medium text-accent mb-1">Step 3: ç§¯ç´¯èµ„äº§</div>
            <p class="text-secondary">æ¯æ¬¡åˆ†æç»“æœå¯ä¿å­˜åˆ°ã€Œèµ„äº§åº“ã€ï¼Œåç»­åœºæ™¯ä¼šæ™ºèƒ½æ¨èç›¸å…³èµ„äº§</p>
          </div>
        </div>
      </details>
    </div>

    <!-- ä¸»ç•Œé¢ï¼ˆé€‰æ‹© Mode åæ˜¾ç¤ºï¼‰ -->
    <div id="main-view" class="hidden">
      <!-- è¿”å›æŒ‰é’® + å½“å‰ Mode ä¿¡æ¯ -->
      <div class="flex items-center justify-between mb-4">
        <button onclick="backToZeroState()" class="btn btn-ghost btn-sm">
          â† è¿”å›é€‰æ‹©
        </button>
        <div id="current-mode-info" class="flex items-center gap-2">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
      </div>

      <!-- Mode é€‰æ‹©å™¨ï¼ˆæ¨ªå‘æ»šåŠ¨ï¼‰ -->
      <div class="mb-6 -mx-4 px-4 overflow-x-auto">
        <div class="flex gap-2 min-w-max pb-2" id="mode-selector">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
      </div>
      <!-- æ™ºèƒ½æ¨èåŒºï¼ˆé‡æ„ç‰ˆï¼šæŠ˜å å¼ + ä¸‹æ‹‰é€‰æ‹©ï¼‰ -->
      <div id="recommend-panel" class="card mb-4 hidden">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-medium text-primary flex items-center gap-2">
            <span>ğŸ“Œ</span>
            <span>ä»è®¤çŸ¥èµ„äº§ä¸­é€‰æ‹©</span>
            <span id="recommend-count" class="tag tag-sm">0 é¡¹å¯ç”¨</span>
          </h3>
          <button onclick="toggleRecommendExpand()" class="btn btn-ghost btn-sm" id="recommend-expand-btn">
            å±•å¼€é€‰æ‹© â–¼
          </button>
        </div>

        <!-- å·²é€‰æ ‡ç­¾å±•ç¤ºåŒº -->
        <div id="selected-tags" class="flex flex-wrap gap-2 mb-3">
          <!-- åŠ¨æ€æ¸²æŸ“å·²é€‰é¡¹ç›®çš„ Tag -->
        </div>

        <!-- å¯æŠ˜å çš„é€‰æ‹©åŒº -->
        <div id="recommend-dropdown" class="hidden">
          <!-- å¿«æ·æ“ä½œæ  -->
          <div class="flex items-center justify-between mb-3 pb-2 border-b border-default">
            <div class="flex gap-2">
              <button onclick="selectAllRecommendations()" class="btn btn-ghost btn-sm">å…¨é€‰ç›¸å…³</button>
              <button onclick="clearAllRecommendations()" class="btn btn-ghost btn-sm">æ¸…ç©º</button>
            </div>
            <div class="text-xs text-muted">
              ç‚¹å‡»é€‰æ‹©ï¼Œå†æ¬¡ç‚¹å‡»å–æ¶ˆ
            </div>
          </div>

          <!-- åˆ†ç»„åˆ—è¡¨ -->
          <div id="recommend-groups" class="space-y-3 max-h-64 overflow-y-auto">
            <!-- ç”± JS åŠ¨æ€æ¸²æŸ“åˆ†ç»„ -->
          </div>
        </div>

        <!-- ç»„åˆæ´å¯Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
        <div id="recommend-insight" class="hidden mt-3 p-2 rounded-lg bg-info text-sm">
          <span class="text-info">ğŸ’¡</span>
          <span id="insight-text" class="text-secondary"></span>
        </div>
      </div>

      <!-- è¾“å…¥åŒº -->
      <div id="input-area" class="card mb-4">
        <h3 class="text-sm font-medium text-secondary mb-3">è¾“å…¥ä¿¡æ¯</h3>

        <!-- åŠ¨æ€è¾“å…¥å­—æ®µ -->
        <div id="input-fields" class="space-y-4">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex gap-2 mt-4">
          <button id="submit-btn" onclick="submitToAI()" class="btn btn-primary btn-lg">
            <span id="submit-text">å¼€å§‹åˆ†æ</span>
            <span id="submit-spinner" class="spinner hidden"></span>
          </button>
          <button onclick="clearInputs()" class="btn btn-secondary">
            æ¸…ç©º
          </button>
        </div>
      </div>
      <!-- è¾“å‡ºåŒº -->
      <div id="output-area" class="card mb-4 hidden">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-medium text-secondary">åˆ†æç»“æœ</h3>
          <div class="flex gap-2">
            <button onclick="copyOutput()" class="btn btn-ghost btn-sm">
              ğŸ“‹ å¤åˆ¶
            </button>
            <button onclick="saveToAssets()" class="btn btn-primary btn-sm">
              ğŸ’¾ ä¿å­˜åˆ°èµ„äº§åº“
            </button>
          </div>
        </div>

        <!-- æµå¼è¾“å‡ºåŒº -->
        <div id="stream-output" class="markdown mb-4 max-h-96 overflow-y-auto">
          <!-- AI æµå¼å“åº” -->
        </div>

        <!-- ç»“æ„åŒ–ç»“æœå¡ç‰‡ -->
        <div id="structured-output" class="hidden space-y-4">
          <!-- é‡‘å¥å±•ç¤º -->
          <div id="golden-quote-section" class="hidden">
            <div class="golden-quote">
              <p id="golden-quote-text"></p>
            </div>
          </div>

          <!-- æ ¸å¿ƒè¾“å‡ºå¡ç‰‡ -->
          <div id="output-cards" class="space-y-3">
            <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
          </div>

          <!-- ä¸‹ä¸€æ­¥æ¨èï¼ˆé‡æ„ç‰ˆï¼šåœºæ™¯å¿«æ·å…¥å£ï¼‰ -->
          <div id="next-step-section" class="hidden">
            <div class="next-step-card">
              <div>
                <p class="text-sm text-secondary">ğŸ’¡ æ¨èä¸‹ä¸€æ­¥</p>
                <p class="text-primary font-medium" id="next-step-text"></p>
                <p class="text-sm text-muted" id="next-step-reason"></p>
              </div>
              <button onclick="goToNextStep()" class="btn btn-primary btn-sm">
                å‰å¾€
              </button>
            </div>
          </div>
        </div>

        <!-- ç”¨è¿™ä¸ªç»“æœç»§ç»­ï¼ˆåœºæ™¯å¿«æ·å…¥å£ï¼‰- ç§»åˆ° structured-output å¤–é¢ -->
        <div id="continue-with-result" class="mt-4 pt-4 border-t border-default">
          <p class="text-sm text-muted mb-3">ğŸ“ ç”¨è¿™ä¸ªç»“æœç»§ç»­ï¼š</p>
          <div id="continue-options" class="flex flex-wrap gap-2">
            <!-- ç”± JS åŠ¨æ€æ¸²æŸ“åœºæ™¯é“¾æ¥ -->
          </div>
        </div>
      </div>

    </div><!-- #main-view ç»“æŸ -->
  </div><!-- #app ç»“æŸ -->
  <!-- è®¤çŸ¥èµ„äº§åº“å¼¹çª— -->
  <div id="asset-modal" class="modal-overlay">
    <div class="modal" style="max-width: 40rem;">
      <div class="modal-header">
        <h2 class="font-semibold text-primary">ğŸ“¦ è®¤çŸ¥èµ„äº§åº“</h2>
        <button onclick="hideAssetModal()" class="btn btn-ghost btn-sm">âœ•</button>
      </div>

      <!-- èµ„äº§åˆ†ç±»æ ‡ç­¾ -->
      <div class="px-4 py-3 border-b border-default">
        <div class="flex flex-wrap gap-2" id="asset-tabs">
          <button onclick="filterAssets('all')" class="tag tag-active" data-tab="all">å…¨éƒ¨</button>
          <button onclick="filterAssets('learn')" class="tag" data-tab="learn">ğŸ¯ æºå¤´åº“</button>
          <button onclick="filterAssets('deconstruct')" class="tag" data-tab="deconstruct">ğŸ”¬ æŠ€æ³•åº“</button>
          <button onclick="filterAssets('transfer')" class="tag" data-tab="transfer">ğŸ”„ è¿ç§»åº“</button>
          <button onclick="filterAssets('diagnose')" class="tag" data-tab="diagnose">ğŸ©º è¯Šæ–­åº“</button>
          <button onclick="filterAssets('output')" class="tag" data-tab="output">âœ¨ æ–¹æ³•è®ºåº“</button>
          <button onclick="filterAssets('monetize')" class="tag" data-tab="monetize">ğŸ’° äº§å“åº“</button>
        </div>
        <!-- æ‰¹é‡æ“ä½œæ  -->
        <div id="batch-actions" class="hidden flex items-center justify-between mt-3 pt-3 border-t border-default">
          <div class="flex items-center gap-2">
            <input type="checkbox" id="select-all-assets" onchange="toggleSelectAllAssets()" class="w-4 h-4">
            <label for="select-all-assets" class="text-sm text-secondary cursor-pointer">å…¨é€‰</label>
            <span id="selected-count" class="text-sm text-muted ml-2"></span>
          </div>
          <button onclick="deleteSelectedAssets()" class="btn btn-ghost btn-sm text-error">
            ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­
          </button>
        </div>
      </div>

      <!-- èµ„äº§åˆ—è¡¨ -->
      <div class="modal-body">
        <div id="asset-empty" class="text-center py-8">
          <p class="text-4xl mb-2">ğŸ“­</p>
          <p class="text-muted">æš‚æ— è®¤çŸ¥èµ„äº§</p>
          <p class="text-sm text-muted mt-1">ä½¿ç”¨å„ä¸ªåœºæ™¯ç”Ÿæˆå†…å®¹åï¼Œä¿å­˜åˆ°èµ„äº§åº“</p>
        </div>
        <div id="asset-list" class="space-y-2 hidden">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
      </div>

      <!-- åº•éƒ¨æ“ä½œ -->
      <div class="modal-footer justify-between">
        <div class="flex gap-2">
          <button onclick="exportAssets()" class="btn btn-secondary btn-sm">
            ğŸ“¤ å¯¼å‡º
          </button>
          <button onclick="triggerImportAssets()" class="btn btn-secondary btn-sm">
            ğŸ“¥ å¯¼å…¥
          </button>
        </div>
        <button onclick="hideAssetModal()" class="btn btn-primary btn-sm">
          å…³é—­
        </button>
      </div>
    </div>
  </div>

  <!-- è®¾ç½®å¼¹çª— -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2 class="font-semibold text-primary">âš™ï¸ è®¾ç½®</h2>
        <button onclick="hideSettingsModal()" class="btn btn-ghost btn-sm">âœ•</button>
      </div>

      <div class="modal-body space-y-4">
        <!-- AI æœåŠ¡å•†é€‰æ‹© -->
        <div>
          <label class="block text-sm font-medium text-secondary mb-2">AI æœåŠ¡å•†</label>
          <select id="ai-provider" onchange="onProviderChange()" class="input">
            <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
          </select>
        </div>

        <!-- API Key -->
        <div>
          <label class="block text-sm font-medium text-secondary mb-2">API Key</label>
          <input type="password" id="api-key" class="input" placeholder="è¾“å…¥ä½ çš„ API Key">
          <p class="text-xs text-muted mt-1">Key ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
        </div>

        <!-- æ¨¡å‹é€‰æ‹© -->
        <div>
          <label class="block text-sm font-medium text-secondary mb-2">æ¨¡å‹</label>
          <select id="ai-model" class="input">
            <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
          </select>
        </div>

        <!-- ä¸»é¢˜åˆ‡æ¢ -->
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-secondary">æ·±è‰²ä¸»é¢˜</span>
          <button onclick="toggleTheme()" id="theme-toggle" class="w-12 h-6 rounded-full bg-card relative transition-all">
            <span id="theme-toggle-dot" class="absolute top-1 left-1 w-4 h-4 rounded-full bg-button transition-transform"></span>
          </button>
        </div>
      </div>

      <div class="modal-footer">
        <button onclick="hideSettingsModal()" class="btn btn-secondary">å–æ¶ˆ</button>
        <button onclick="saveSettings()" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
      </div>
    </div>
  </div>

  <!-- èµ„äº§è¯¦æƒ…å¼¹çª— -->
  <div id="asset-detail-modal" class="modal-overlay">
    <div class="modal" style="max-width: 40rem;">
      <div class="modal-header">
        <h2 id="asset-detail-title" class="font-semibold text-primary"></h2>
        <button onclick="hideAssetDetailModal()" class="btn btn-ghost btn-sm">âœ•</button>
      </div>

      <div class="modal-body">
        <!-- èµ„äº§å…ƒä¿¡æ¯ -->
        <div id="asset-detail-meta" class="flex gap-2 mb-4">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>

        <!-- èµ„äº§å†…å®¹ -->
        <div id="asset-detail-content" class="markdown">
          <!-- ç”± JS åŠ¨æ€æ¸²æŸ“ -->
        </div>
      </div>

      <div class="modal-footer justify-between">
        <button onclick="deleteAsset()" class="btn btn-ghost btn-sm text-error">
          ğŸ—‘ï¸ åˆ é™¤
        </button>
        <div class="flex gap-2">
          <button onclick="hideAssetDetailModal()" class="btn btn-secondary btn-sm">å…³é—­</button>
          <button onclick="useAssetInMode()" class="btn btn-primary btn-sm">ä½¿ç”¨æ­¤èµ„äº§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
  <input type="file" id="import-file" accept=".json" class="hidden" onchange="handleImportFile(event)">
  <script>
    // ========================================
    // é…ç½®æ•°æ®
    // ========================================

    // AI æœåŠ¡å•†é…ç½®
    const AI_PROVIDERS = {
      siliconflow: {
        name: 'ç¡…åŸºæµåŠ¨ (SiliconFlow)',
        baseUrl: 'https://api.siliconflow.cn/v1/chat/completions',
        models: [
          { id: 'Qwen/Qwen2.5-72B-Instruct', name: 'Qwen2.5-72B' },
          { id: 'deepseek-ai/DeepSeek-V3', name: 'DeepSeek-V3' },
          { id: 'Pro/Qwen/Qwen2.5-Coder-32B-Instruct', name: 'Qwen2.5-Coder-32B' }
        ],
        defaultModel: 'Qwen/Qwen2.5-72B-Instruct'
      },
      openrouter: {
        name: 'å¼€æ”¾è·¯ç”± (OpenRouter)',
        baseUrl: 'https://openrouter.ai/api/v1/chat/completions',
        models: [
          { id: 'anthropic/claude-3.5-sonnet', name: 'Claude 3.5 Sonnet' },
          { id: 'openai/gpt-4o', name: 'GPT-4o' },
          { id: 'google/gemini-pro-1.5', name: 'Gemini Pro 1.5' }
        ],
        defaultModel: 'anthropic/claude-3.5-sonnet'
      },
      deepseek: {
        name: 'DeepSeek',
        baseUrl: 'https://api.deepseek.com/v1/chat/completions',
        models: [
          { id: 'deepseek-chat', name: 'DeepSeek Chat' },
          { id: 'deepseek-reasoner', name: 'DeepSeek Reasoner' }
        ],
        defaultModel: 'deepseek-chat'
      },
      claude: {
        name: 'Claude (Anthropic)',
        baseUrl: 'https://api.anthropic.com/v1/messages',
        models: [
          { id: 'claude-opus-4-5-20251101', name: 'Claude Opus 4.5' },
          { id: 'claude-sonnet-4-20250514', name: 'Claude Sonnet 4' }
        ],
        defaultModel: 'claude-sonnet-4-20250514',
        isAnthropic: true
      }
    };

    // Mode å®šä¹‰
    const MODES = {
      learn: {
        id: 'learn',
        name: 'å­¦æ–°é¢†åŸŸ',
        icon: 'ğŸ¯',
        color: 'var(--mode-learn)',
        description: 'æ‰¾åˆ°æºå¤´ï¼Œç»˜åˆ¶è®¤çŸ¥åœ°å›¾',
        assetType: 'cognitiveMap',
        assetName: 'è®¤çŸ¥åœ°å›¾',
        inputs: [
          { key: 'domain', label: 'æƒ³å­¦ä¹ çš„é¢†åŸŸ', type: 'text', required: true, placeholder: 'ä¾‹å¦‚ï¼šäº§å“è®¾è®¡ã€å¿ƒç†å­¦ã€æŠ•èµ„...' },
          { key: 'currentLevel', label: 'å½“å‰æ°´å¹³', type: 'select', required: false, options: [
            { value: '', label: 'è¯·é€‰æ‹©ï¼ˆå¯é€‰ï¼‰' },
            { value: 'beginner', label: 'å®Œå…¨å°ç™½' },
            { value: 'familiar', label: 'ç•¥æœ‰äº†è§£' },
            { value: 'intermediate', label: 'æœ‰ä¸€å®šåŸºç¡€' },
            { value: 'advanced', label: 'æ¯”è¾ƒç†Ÿæ‚‰' }
          ]},
          { key: 'learningGoal', label: 'å­¦ä¹ ç›®æ ‡', type: 'select', required: false, options: [
            { value: '', label: 'è¯·é€‰æ‹©ï¼ˆå¯é€‰ï¼‰' },
            { value: 'quick', label: 'é€Ÿæˆå…¥é—¨' },
            { value: 'solid', label: 'æ‰å®æŒæ¡' },
            { value: 'expert', label: 'ç²¾é€šä¸“å®¶' }
          ]}
        ]
      },
      deconstruct: {
        id: 'deconstruct',
        name: 'æ·±åº¦ç†è§£',
        icon: 'ğŸ”¬',
        color: 'var(--mode-deconstruct)',
        description: 'å››å±‚è§£å‰–ï¼Œæå–æŠ€æ³•',
        assetType: 'techniqueCard',
        assetName: 'æŠ€æ³•å¡ç‰‡',
        inputs: [
          { key: 'target', label: 'æ‹†è§£å¯¹è±¡', type: 'text', required: true, placeholder: 'ä¾‹å¦‚ï¼šæŸ¥ç†Â·èŠ’æ ¼ã€ã€Šç©·æŸ¥ç†å®å…¸ã€‹ã€ç¬¬ä¸€æ€§åŸç†...' },
          { key: 'targetType', label: 'å¯¹è±¡ç±»å‹', type: 'select', required: false, options: [
            { value: '', label: 'è¯·é€‰æ‹©ï¼ˆå¯é€‰ï¼‰' },
            { value: 'person', label: 'äººç‰©' },
            { value: 'book', label: 'ä¹¦ç±' },
            { value: 'methodology', label: 'æ–¹æ³•è®º' },
            { value: 'other', label: 'å…¶ä»–' }
          ]},
          { key: 'purpose', label: 'æ‹†è§£ç›®çš„', type: 'textarea', required: false, placeholder: 'ä½ æƒ³ä»ä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿï¼ˆå¯é€‰ï¼‰' }
        ]
      },
      transfer: {
        id: 'transfer',
        name: 'è¿ç§»åº”ç”¨',
        icon: 'ğŸ”„',
        color: 'var(--mode-transfer)',
        description: 'æŠŠæŠ€æ³•ç”¨åˆ°æ–°åœºæ™¯',
        assetType: 'transferPlan',
        assetName: 'è¿ç§»æ–¹æ¡ˆ',
        inputs: [
          { key: 'sourceTechnique', label: 'æºæŠ€æ³•', type: 'text', required: true, placeholder: 'ä¾‹å¦‚ï¼šè´¹æ›¼å­¦ä¹ æ³•ã€MECE åˆ†ææ³•...' },
          { key: 'targetScenario', label: 'ç›®æ ‡åœºæ™¯', type: 'textarea', required: true, placeholder: 'æè¿°ä½ æƒ³åº”ç”¨åˆ°çš„åœºæ™¯...' }
        ]
      },
      diagnose: {
        id: 'diagnose',
        name: 'è¯Šæ–­ç›²åŒº',
        icon: 'ğŸ©º',
        color: 'var(--mode-diagnose)',
        description: 'å‘ç°çŸ¥è¯†ç»“æ„ç›²åŒº',
        assetType: 'diagnosisReport',
        assetName: 'è¯Šæ–­æŠ¥å‘Š',
        inputs: [
          { key: 'knownDomains', label: 'å·²å­¦é¢†åŸŸ', type: 'textarea', required: false, placeholder: 'åˆ—å‡ºä½ å­¦è¿‡çš„é¢†åŸŸï¼ˆå¯é€‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨èšåˆä½ çš„è®¤çŸ¥èµ„äº§ï¼‰' },
          { key: 'currentConfusion', label: 'å½“å‰å›°æƒ‘', type: 'textarea', required: false, placeholder: 'ä½ ç›®å‰é‡åˆ°çš„å›°æƒ‘æˆ–ç“¶é¢ˆï¼ˆå¯é€‰ï¼‰' }
        ]
      },
      output: {
        id: 'output',
        name: 'å†…å®¹è¾“å‡º',
        icon: 'âœ¨',
        color: 'var(--mode-output)',
        description: 'ç”Ÿæˆç‹¬ç‰¹è§‚ç‚¹å’Œæ–¹æ³•è®º',
        assetType: 'methodology',
        assetName: 'æ–¹æ³•è®º',
        inputs: [
          { key: 'topic', label: 'è¾“å‡ºä¸»é¢˜', type: 'text', required: true, placeholder: 'ä¾‹å¦‚ï¼šå¦‚ä½•é«˜æ•ˆå­¦ä¹ ã€äº§å“æ€ç»´...' },
          { key: 'cognitiveMaterials', label: 'è®¤çŸ¥åŸæ–™', type: 'textarea', required: false, placeholder: 'ä½ å·²æœ‰çš„ç›¸å…³çŸ¥è¯†ã€ç»éªŒã€æ¡ˆä¾‹ï¼ˆå¯é€‰ï¼‰' },
          { key: 'targetAudience', label: 'ç›®æ ‡å—ä¼—', type: 'text', required: false, placeholder: 'ä¾‹å¦‚ï¼šèŒåœºæ–°äººã€åˆ›ä¸šè€…...ï¼ˆå¯é€‰ï¼‰' }
        ]
      },
      monetize: {
        id: 'monetize',
        name: 'çŸ¥è¯†å˜ç°',
        icon: 'ğŸ’°',
        color: 'var(--mode-monetize)',
        description: 'æ‰“åŒ…æˆå¯å”®å–äº§å“',
        assetType: 'productPlan',
        assetName: 'äº§å“æ–¹æ¡ˆ',
        inputs: [
          { key: 'methodology', label: 'è¦å˜ç°çš„æ–¹æ³•è®º', type: 'text', required: true, placeholder: 'ä¾‹å¦‚ï¼šæˆ‘çš„é«˜æ•ˆå­¦ä¹ æ³•ã€äº§å“è®¾è®¡æ–¹æ³•è®º...' },
          { key: 'targetMarket', label: 'ç›®æ ‡å¸‚åœº', type: 'textarea', required: false, placeholder: 'æè¿°ä½ çš„ç›®æ ‡å®¢æˆ·ç¾¤ä½“ï¼ˆå¯é€‰ï¼‰' }
        ]
      }
    };

    // Mode é¡ºåºï¼ˆç”¨äºæ¸²æŸ“ï¼‰
    const MODE_ORDER = ['learn', 'deconstruct', 'transfer', 'diagnose', 'output', 'monetize'];

    // èµ„äº§ç±»å‹æ˜ å°„
    const ASSET_TYPES = {
      cognitiveMap: { name: 'è®¤çŸ¥åœ°å›¾', icon: 'ğŸ¯', mode: 'learn' },
      techniqueCard: { name: 'æŠ€æ³•å¡ç‰‡', icon: 'ğŸ”¬', mode: 'deconstruct' },
      transferPlan: { name: 'è¿ç§»æ–¹æ¡ˆ', icon: 'ğŸ”„', mode: 'transfer' },
      diagnosisReport: { name: 'è¯Šæ–­æŠ¥å‘Š', icon: 'ğŸ©º', mode: 'diagnose' },
      methodology: { name: 'æ–¹æ³•è®º', icon: 'âœ¨', mode: 'output' },
      productPlan: { name: 'äº§å“æ–¹æ¡ˆ', icon: 'ğŸ’°', mode: 'monetize' }
    };

    // å†…å®¹çº§åˆ«å®šä¹‰
    const CONTENT_LEVELS = {
      L1: { name: 'ç²¾å', description: 'æœ€æ ¸å¿ƒçš„ 1-2 ä¸ªè¦ç‚¹' },
      L2: { name: 'æ‘˜è¦', description: 'å…³é”®å­—æ®µçš„ç»“æ„åŒ–æ‘˜è¦' },
      L3: { name: 'å®Œæ•´', description: 'å®Œæ•´è¾“å‡ºæ•°æ®' }
    };

    // å­˜å‚¨ Key
    const STORAGE_KEYS = {
      ASSETS: 'yuanliu_assets',
      SETTINGS: 'yuanliu_settings',
      USAGE: 'yuanliu_usage'
    };
  </script>
  <script>
    // ========================================
    // å­˜å‚¨é€»è¾‘
    // ========================================

    // å…¨å±€çŠ¶æ€
    let STATE = {
      currentMode: null,
      isLoading: false,
      currentAssetId: null,
      currentAssetType: null,
      selectedRecommendations: [],
      lastAIResponse: null,
      lastParsedOutput: null,
      resultSaved: false
    };

    // åŠ è½½èµ„äº§
    function loadAssets() {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.ASSETS);
        if (data) {
          const parsed = JSON.parse(data);
          return parsed.data || {};
        }
      } catch (e) {
        console.error('åŠ è½½èµ„äº§å¤±è´¥:', e);
      }
      return {
        cognitiveMap: [],
        techniqueCard: [],
        transferPlan: [],
        diagnosisReport: [],
        methodology: [],
        productPlan: []
      };
    }

    // ä¿å­˜èµ„äº§
    function saveAssets(assets) {
      try {
        const data = {
          version: '2.0.0',
          lastUpdated: new Date().toISOString(),
          data: assets
        };
        localStorage.setItem(STORAGE_KEYS.ASSETS, JSON.stringify(data));
        return true;
      } catch (e) {
        console.error('ä¿å­˜èµ„äº§å¤±è´¥:', e);
        showToast('ä¿å­˜å¤±è´¥ï¼šå­˜å‚¨ç©ºé—´ä¸è¶³', 'error');
        return false;
      }
    }

    // æ·»åŠ èµ„äº§
    function addAsset(assetType, assetData) {
      const assets = loadAssets();
      if (!assets[assetType]) {
        assets[assetType] = [];
      }

      const newAsset = {
        id: generateId(),
        createdAt: new Date().toISOString(),
        modeId: ASSET_TYPES[assetType]?.mode || STATE.currentMode,
        ...assetData
      };

      assets[assetType].unshift(newAsset);

      if (saveAssets(assets)) {
        updateUsageMetadata(STATE.currentMode);
        return newAsset;
      }
      return null;
    }

    // åˆ é™¤èµ„äº§
    function removeAsset(assetType, assetId) {
      const assets = loadAssets();
      if (assets[assetType]) {
        assets[assetType] = assets[assetType].filter(a => a.id !== assetId);
        return saveAssets(assets);
      }
      return false;
    }

    // è·å–æ‰€æœ‰èµ„äº§ï¼ˆæ‰å¹³åŒ–ï¼‰
    function getAllAssets() {
      const assets = loadAssets();
      const all = [];
      for (const [type, items] of Object.entries(assets)) {
        for (const item of items) {
          all.push({ ...item, assetType: type });
        }
      }
      return all.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    }

    // æŒ‰ Mode è·å–èµ„äº§
    function getAssetsByMode(modeId) {
      const mode = MODES[modeId];
      if (!mode) return [];
      const assets = loadAssets();
      return assets[mode.assetType] || [];
    }

    // åŠ è½½è®¾ç½®
    function loadSettings() {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.SETTINGS);
        if (data) {
          return JSON.parse(data);
        }
      } catch (e) {
        console.error('åŠ è½½è®¾ç½®å¤±è´¥:', e);
      }
      return {
        provider: 'siliconflow',
        apiKey: '',
        model: AI_PROVIDERS.siliconflow.defaultModel,
        theme: 'dark'
      };
    }

    // ä¿å­˜è®¾ç½®
    function saveSettingsToStorage(settings) {
      try {
        localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
        return true;
      } catch (e) {
        console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', e);
        return false;
      }
    }

    // åŠ è½½ä½¿ç”¨å…ƒæ•°æ®
    function loadUsageMetadata() {
      try {
        const data = localStorage.getItem(STORAGE_KEYS.USAGE);
        if (data) {
          return JSON.parse(data);
        }
      } catch (e) {
        console.error('åŠ è½½ä½¿ç”¨æ•°æ®å¤±è´¥:', e);
      }
      return {
        modeUsageCount: {},
        lastUsedMode: null,
        lastUsedAt: null,
        totalSessions: 0
      };
    }

    // æ›´æ–°ä½¿ç”¨å…ƒæ•°æ®
    function updateUsageMetadata(modeId) {
      if (!modeId) return; // é˜²æ­¢ modeId ä¸ºç©ºæ—¶æŠ¥é”™

      const usage = loadUsageMetadata();
      // ç¡®ä¿ modeUsageCount å­˜åœ¨
      if (!usage.modeUsageCount) {
        usage.modeUsageCount = {};
      }
      if (!usage.modeUsageCount[modeId]) {
        usage.modeUsageCount[modeId] = 0;
      }
      usage.modeUsageCount[modeId]++;
      usage.lastUsedMode = modeId;
      usage.lastUsedAt = new Date().toISOString();
      usage.totalSessions = (usage.totalSessions || 0) + 1;

      try {
        localStorage.setItem(STORAGE_KEYS.USAGE, JSON.stringify(usage));
      } catch (e) {
        console.error('ä¿å­˜ä½¿ç”¨æ•°æ®å¤±è´¥:', e);
      }
    }

    // ç”Ÿæˆå”¯ä¸€ ID
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
    }

    // å¯¼å‡ºèµ„äº§
    function exportAssets() {
      const assets = loadAssets();
      const usage = loadUsageMetadata();
      const exportData = {
        version: '2.0.0',
        exportedAt: new Date().toISOString(),
        assets,
        usage
      };

      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `yuanliu-assets-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      showToast('èµ„äº§å·²å¯¼å‡º', 'success');
    }

    // è§¦å‘å¯¼å…¥
    function triggerImportAssets() {
      document.getElementById('import-file').click();
    }

    // å¤„ç†å¯¼å…¥æ–‡ä»¶
    function handleImportFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (data.assets) {
            const currentAssets = loadAssets();
            // åˆå¹¶èµ„äº§
            for (const [type, items] of Object.entries(data.assets)) {
              if (!currentAssets[type]) {
                currentAssets[type] = [];
              }
              // é¿å…é‡å¤
              const existingIds = new Set(currentAssets[type].map(a => a.id));
              for (const item of items) {
                if (!existingIds.has(item.id)) {
                  currentAssets[type].push(item);
                }
              }
            }
            saveAssets(currentAssets);
            showToast('èµ„äº§å¯¼å…¥æˆåŠŸ', 'success');
            renderAssetList();
          }
        } catch (err) {
          showToast('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }
  </script>
  <script>
    // ========================================
    // æ™ºèƒ½æ¨èç³»ç»Ÿ v2 - å­æ¨¡å—çº§æ¨è
    // ========================================

    // å­æ¨¡å—ç±»å‹å®šä¹‰
    const SUB_MODULE_TYPES = {
      person: { name: 'æºå¤´äººç‰©', icon: 'ğŸ‘¤', color: 'text-info' },
      technique: { name: 'æŠ€æ³•å¡ç‰‡', icon: 'ğŸ¯', color: 'text-accent' },
      path: { name: 'å­¦ä¹ è·¯å¾„', icon: 'ğŸ›¤ï¸', color: 'text-success' },
      quote: { name: 'é‡‘å¥', icon: 'ğŸ’', color: 'text-warning' },
      blindspot: { name: 'ç›²åŒº', icon: 'ğŸ”', color: 'text-error' },
      methodology: { name: 'æ–¹æ³•è®º', icon: 'âœ¨', color: 'text-accent' },
      product: { name: 'äº§å“æ–¹æ¡ˆ', icon: 'ğŸ“¦', color: 'text-info' }
    };

    // Mode æ¶ˆè´¹çŸ©é˜µï¼šæ¯ä¸ª Mode éœ€è¦ä»€ä¹ˆç±»å‹çš„å­æ¨¡å—
    const MODE_CONSUME_MATRIX = {
      learn: {
        consumes: ['person', 'blindspot', 'technique'],
        weights: { person: 0.3, blindspot: 0.5, technique: 0.2 },
        inputMapping: { domain: ['person', 'path', 'technique'] }
      },
      deconstruct: {
        consumes: ['person', 'path', 'technique'],
        weights: { person: 0.4, path: 0.3, technique: 0.3 },
        inputMapping: { target: ['person', 'technique', 'methodology'] }
      },
      transfer: {
        consumes: ['technique', 'person', 'methodology'],
        weights: { technique: 0.5, person: 0.2, methodology: 0.3 },
        inputMapping: { sourceTechnique: ['technique', 'person', 'methodology'] }
      },
      diagnose: {
        consumes: ['person', 'technique', 'path', 'blindspot', 'methodology'],
        weights: { person: 0.2, technique: 0.2, path: 0.2, blindspot: 0.2, methodology: 0.2 },
        inputMapping: { knownDomains: ['person', 'path', 'technique', 'methodology'] }
      },
      output: {
        consumes: ['technique', 'quote', 'methodology', 'person'],
        weights: { technique: 0.3, quote: 0.3, methodology: 0.2, person: 0.2 },
        inputMapping: { cognitiveMaterials: ['technique', 'quote', 'methodology', 'person'] }
      },
      monetize: {
        consumes: ['methodology', 'technique', 'quote', 'product'],
        weights: { methodology: 0.4, technique: 0.2, quote: 0.2, product: 0.2 },
        inputMapping: { methodology: ['methodology', 'technique', 'product'] }
      }
    };

    // ä»èµ„äº§ä¸­æå–å­æ¨¡å—
    function extractSubModules(asset) {
      const subModules = [];
      const assetType = asset.assetType;

      // è®¤çŸ¥åœ°å›¾ -> æå–æºå¤´äººç‰©ã€å­¦ä¹ è·¯å¾„
      if (assetType === 'cognitiveMap') {
        // æå–æ ¸å¿ƒæ’æ˜Ÿ
        const coreStars = asset.sourceGalaxy?.coreStars || asset.sourceGalaxy?.coreStar || asset.source_galaxy?.core_stars || [];
        coreStars.forEach(star => {
          subModules.push({
            type: 'person',
            id: `${asset.id}_person_${star.name}`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: star.name,
            summary: star.contribution || '',
            detail: {
              mustRead: star.mustRead || star.must_read,
              works: star.works,
              fourDimensions: star.fourDimensions || star.four_dimensions
            },
            domain: asset.domain,
            createdAt: asset.createdAt
          });
        });

        // æå–è¡Œæ˜Ÿ
        const planets = asset.sourceGalaxy?.planets || asset.source_galaxy?.planets || [];
        planets.forEach(planet => {
          subModules.push({
            type: 'person',
            id: `${asset.id}_person_${planet.name}`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: planet.name,
            summary: planet.contribution || '',
            detail: { mustRead: planet.mustRead || planet.must_read },
            domain: asset.domain,
            createdAt: asset.createdAt
          });
        });

        // æå–å­¦ä¹ è·¯å¾„
        const learningPaths = asset.learningPaths || asset.learning_paths;
        if (learningPaths) {
          ['quick', 'solid', 'expert'].forEach(pathType => {
            const path = learningPaths[pathType];
            if (path) {
              const steps = path.steps || (Array.isArray(path) ? path : null);
              if (steps?.length) {
                subModules.push({
                  type: 'path',
                  id: `${asset.id}_path_${pathType}`,
                  parentAssetId: asset.id,
                  parentAssetType: assetType,
                  name: pathType === 'quick' ? 'é€Ÿæˆè·¯å¾„' : pathType === 'solid' ? 'æ‰å®è·¯å¾„' : 'ç²¾é€šè·¯å¾„',
                  summary: `${path.duration || ''} - ${steps.slice(0, 2).join(' â†’ ')}...`,
                  detail: { steps, duration: path.duration, outcome: path.outcome },
                  domain: asset.domain,
                  createdAt: asset.createdAt
                });
              }
            }
          });
        }

        // æå–æ æ†ç‚¹ä½œä¸ºé‡‘å¥
        const leveragePoint = asset.leveragePoint || asset.leverage_point;
        if (leveragePoint) {
          subModules.push({
            type: 'quote',
            id: `${asset.id}_quote_leverage`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'è®¤çŸ¥æ æ†ç‚¹',
            summary: leveragePoint,
            detail: { source: asset.domain },
            domain: asset.domain,
            createdAt: asset.createdAt
          });
        }

        // æå–é‡‘å¥
        const goldenQuote = asset.goldenQuote || asset.golden_quote;
        if (goldenQuote) {
          subModules.push({
            type: 'quote',
            id: `${asset.id}_quote_golden`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'é‡‘å¥',
            summary: goldenQuote,
            detail: { source: asset.domain },
            domain: asset.domain,
            createdAt: asset.createdAt
          });
        }
      }

      // æŠ€æ³•å¡ç‰‡ -> æå–æŠ€æ³•
      if (assetType === 'techniqueCard') {
        const techniques = asset.techniques || [];
        techniques.forEach((tech, idx) => {
          const sourceLevel = tech.sourceLevel || tech.source_level || 'L1';
          const triggerCondition = tech.triggerCondition || tech.trigger_condition;
          const transferPotential = tech.transferPotential || tech.transfer_potential;
          subModules.push({
            type: 'technique',
            id: `${asset.id}_tech_${idx}`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: tech.name,
            summary: triggerCondition || '',
            detail: {
              sourceLevel,
              steps: tech.steps,
              transferPotential,
              commonMistakes: tech.commonMistakes || tech.common_mistakes
            },
            targetName: asset.targetName || asset.target_name,
            createdAt: asset.createdAt
          });
        });

        // æå–é‡‘å¥
        const goldenQuote = asset.goldenQuote || asset.golden_quote;
        if (goldenQuote) {
          subModules.push({
            type: 'quote',
            id: `${asset.id}_quote`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'é‡‘å¥',
            summary: goldenQuote,
            detail: { source: asset.targetName || asset.target_name },
            createdAt: asset.createdAt
          });
        }
      }

      // è¿ç§»æ–¹æ¡ˆ -> æå– DNA åŸåˆ™ã€æ˜ å°„è¡¨
      if (assetType === 'transferPlan') {
        const dnaPrinciple = asset.dnaPrinciple || asset.dna_principle;
        if (dnaPrinciple) {
          subModules.push({
            type: 'technique',
            id: `${asset.id}_dna`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'DNA åŸåˆ™',
            summary: dnaPrinciple,
            detail: {
              sourceTechnique: asset.sourceTechnique || asset.source_technique,
              targetScenario: asset.targetScenario || asset.target_scenario
            },
            createdAt: asset.createdAt
          });
        }
      }

      // è¯Šæ–­æŠ¥å‘Š -> æå–ç›²åŒº
      if (assetType === 'diagnosisReport') {
        const blindspotList = asset.blindspotList || asset.blindspot_list || [];
        blindspotList.forEach((blind, idx) => {
          subModules.push({
            type: 'blindspot',
            id: `${asset.id}_blind_${idx}`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: blind.description,
            summary: blind.evidence || '',
            detail: {
              riskLevel: blind.riskLevel || blind.risk_level,
              impact: blind.impact
            },
            createdAt: asset.createdAt
          });
        });

        // æå–è®¤çŸ¥æŒ‡çº¹
        const fp = asset.cognitiveFingerprint || asset.cognitive_fingerprint;
        if (fp?.cognitiveAdvantage || fp?.cognitive_advantage) {
          subModules.push({
            type: 'quote',
            id: `${asset.id}_advantage`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'è®¤çŸ¥ä¼˜åŠ¿',
            summary: fp.cognitiveAdvantage || fp.cognitive_advantage,
            detail: { differentiation: fp.differentiation },
            createdAt: asset.createdAt
          });
        }
      }

      // æ–¹æ³•è®º -> æå–æ–¹æ³•è®ºã€é‡‘å¥
      if (assetType === 'methodology') {
        const pm = asset.personalMethodology || asset.personal_methodology;
        if (pm) {
          const coreIdea = pm.coreIdea || pm.core_idea;
          const keySteps = pm.keySteps || pm.key_steps;
          subModules.push({
            type: 'methodology',
            id: `${asset.id}_method`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: pm.name || 'ä¸ªäººæ–¹æ³•è®º',
            summary: coreIdea || '',
            detail: {
              keySteps,
              applicableScenarios: pm.applicableScenarios || pm.applicable_scenarios
            },
            topic: asset.topic,
            createdAt: asset.createdAt
          });
        }

        // æå–é‡‘å¥
        const goldenQuotes = asset.goldenQuotes || asset.golden_quotes || [];
        goldenQuotes.forEach((quote, idx) => {
          const content = quote.content || quote;
          subModules.push({
            type: 'quote',
            id: `${asset.id}_quote_${idx}`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'é‡‘å¥',
            summary: content,
            detail: { scenario: quote.scenario },
            topic: asset.topic,
            createdAt: asset.createdAt
          });
        });
      }

      // äº§å“æ–¹æ¡ˆ -> æå–äº§å“ã€å–ç‚¹
      if (assetType === 'productPlan') {
        const productMatrix = asset.productMatrix || asset.product_matrix;
        if (productMatrix) {
          ['trafficProduct', 'mainProduct', 'premiumProduct'].forEach(key => {
            const altKey = key.replace(/([A-Z])/g, '_$1').toLowerCase();
            const prod = productMatrix[key] || productMatrix[altKey];
            if (prod) {
              subModules.push({
                type: 'product',
                id: `${asset.id}_${key}`,
                parentAssetId: asset.id,
                parentAssetType: assetType,
                name: prod.name || key,
                summary: `${prod.price || ''} - ${prod.purpose || prod.description || ''}`,
                detail: prod,
                methodology: asset.methodology,
                createdAt: asset.createdAt
              });
            }
          });
        }

        // æå–æ ¸å¿ƒå–ç‚¹
        const sellingPoints = asset.sellingPoints || asset.selling_points;
        if (sellingPoints?.core) {
          subModules.push({
            type: 'quote',
            id: `${asset.id}_selling`,
            parentAssetId: asset.id,
            parentAssetType: assetType,
            name: 'æ ¸å¿ƒå–ç‚¹',
            summary: sellingPoints.core,
            detail: { supporting: sellingPoints.supporting },
            methodology: asset.methodology,
            createdAt: asset.createdAt
          });
        }
      }

      return subModules;
    }

    // ä»æ‰€æœ‰èµ„äº§ä¸­æå–å­æ¨¡å—æ± 
    function buildSubModulePool() {
      const allAssets = getAllAssets();
      const pool = [];
      for (const asset of allAssets) {
        const subModules = extractSubModules(asset);
        pool.push(...subModules);
      }
      return pool;
    }

    // è®¡ç®—å­æ¨¡å—ä¸ç›®æ ‡ Mode çš„ç›¸å…³åº¦
    function calculateSubModuleRelevance(subModule, targetModeId) {
      const matrix = MODE_CONSUME_MATRIX[targetModeId];
      if (!matrix) return { score: 0, reason: '' };

      let score = 0;
      let reason = '';

      // åŸºç¡€åˆ†ï¼šç±»å‹åŒ¹é…
      if (matrix.consumes.includes(subModule.type)) {
        score += matrix.weights[subModule.type] || 0.3;
        reason = `${SUB_MODULE_TYPES[subModule.type]?.name || subModule.type}`;
      }

      // æ—¶é—´æ–°é²œåº¦åŠ æˆ
      const recency = calculateRecency(subModule.createdAt);
      score += recency * 0.2;

      // ç‰¹æ®ŠåŠ æˆ
      if (targetModeId === 'diagnose') {
        score += 0.1; // è¯Šæ–­æ¨¡å¼éœ€è¦æ›´å¤šæ•°æ®
      }

      if (subModule.type === 'technique' && targetModeId === 'transfer') {
        score += 0.2; // è¿ç§»æ¨¡å¼ç‰¹åˆ«éœ€è¦æŠ€æ³•
        reason = 'å¯è¿ç§»æŠ€æ³•';
      }

      if (subModule.type === 'quote' && targetModeId === 'output') {
        score += 0.2; // è¾“å‡ºæ¨¡å¼ç‰¹åˆ«éœ€è¦é‡‘å¥
        reason = 'å¯å¼•ç”¨é‡‘å¥';
      }

      return { score: Math.min(score, 1), reason };
    }

    // æ¨èç¼“å­˜ï¼ˆé¿å…é‡å¤ç”Ÿæˆå¯¼è‡´çŠ¶æ€ä¸¢å¤±ï¼‰
    let _recommendationCache = {
      modeId: null,
      recommendations: []
    };

    // ç”Ÿæˆæ¨èåˆ—è¡¨ï¼ˆå­æ¨¡å—çº§ï¼‰
    function generateRecommendations(modeId, forceRefresh = false) {
      // ä½¿ç”¨ç¼“å­˜é¿å…çŠ¶æ€ä¸¢å¤±
      if (!forceRefresh && _recommendationCache.modeId === modeId && _recommendationCache.recommendations.length > 0) {
        return _recommendationCache.recommendations;
      }

      const pool = buildSubModulePool();
      if (pool.length === 0) {
        _recommendationCache = { modeId, recommendations: [] };
        return [];
      }

      const recommendations = [];

      for (const subModule of pool) {
        const relevance = calculateSubModuleRelevance(subModule, modeId);
        if (relevance.score > 0.2) {
          recommendations.push({
            id: subModule.id,
            type: subModule.type,
            parentAssetId: subModule.parentAssetId,
            parentAssetType: subModule.parentAssetType,
            name: subModule.name,
            summary: subModule.summary,
            detail: subModule.detail,
            domain: subModule.domain || subModule.topic || subModule.targetName || subModule.methodology,
            relevanceScore: relevance.score,
            recommendReason: relevance.reason,
            contentLevel: 'L2',
            selected: false,  // é»˜è®¤ä¸é€‰ä¸­ï¼Œè®©ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©
            data: subModule
          });
        }
      }

      // æŒ‰ç›¸å…³åº¦æ’åº
      recommendations.sort((a, b) => b.relevanceScore - a.relevanceScore);

      // ä¸å†é™åˆ¶æ¯ç±»å‹åªå–1ä¸ªï¼Œæ˜¾ç¤ºæ‰€æœ‰ç›¸å…³çš„å­æ¨¡å—ï¼ˆæœ€å¤šæ˜¾ç¤º12ä¸ªï¼‰
      const result = recommendations.slice(0, 12);

      // ç¼“å­˜ç»“æœ
      _recommendationCache = { modeId, recommendations: result };

      return _recommendationCache.recommendations;
    }

    // æ¸…é™¤æ¨èç¼“å­˜ï¼ˆåˆ‡æ¢ Mode æ—¶è°ƒç”¨ï¼‰
    function clearRecommendationCache() {
      _recommendationCache = { modeId: null, recommendations: [] };
    }

    // è®¡ç®—æ—¶é—´æ–°é²œåº¦
    function calculateRecency(createdAt, halfLifeDays = 30) {
      if (!createdAt) return 0.5;
      const ageInDays = (Date.now() - new Date(createdAt).getTime()) / (1000 * 60 * 60 * 24);
      return Math.pow(0.5, ageInDays / halfLifeDays);
    }

    // è·å–èµ„äº§æ ‡é¢˜ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
    function getAssetTitle(asset) {
      switch (asset.assetType) {
        case 'cognitiveMap': return asset.domain || 'è®¤çŸ¥åœ°å›¾';
        case 'techniqueCard': return asset.targetName || asset.target_name || 'æŠ€æ³•å¡ç‰‡';
        case 'transferPlan': return asset.sourceTechnique || asset.source_technique || 'è¿ç§»æ–¹æ¡ˆ';
        case 'diagnosisReport': return asset.diagnosisSummary || asset.diagnosis_summary || 'è¯Šæ–­æŠ¥å‘Š';
        case 'methodology':
          // ä¼˜å…ˆä½¿ç”¨ topicï¼Œå…¶æ¬¡ä½¿ç”¨æ–¹æ³•è®ºåç§°
          if (asset.topic) return asset.topic;
          const pm = asset.personalMethodology || asset.personal_methodology;
          if (pm?.name) return pm.name;
          return 'æ–¹æ³•è®º';
        case 'productPlan':
          return asset.methodologyName || asset.methodology_name || asset.methodology || 'äº§å“æ–¹æ¡ˆ';
        default: return 'æœªçŸ¥èµ„äº§';
      }
    }

    // è·å–èµ„äº§æ‘˜è¦ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
    function getAssetSummary(asset) {
      switch (asset.assetType) {
        case 'cognitiveMap': return asset.leveragePoint || asset.leverage_point || '';
        case 'techniqueCard': return asset.techniques?.[0]?.name || '';
        case 'transferPlan': return asset.dnaPrinciple || asset.dna_principle || '';
        case 'diagnosisReport':
          const fp = asset.cognitiveFingerprint || asset.cognitive_fingerprint;
          return fp?.cognitiveAdvantage || fp?.cognitive_advantage || '';
        case 'methodology':
          const pm = asset.personalMethodology || asset.personal_methodology;
          return pm?.coreIdea || pm?.core_idea || '';
        case 'productPlan':
          const sp = asset.mainProductDesign?.sellingPoints || asset.sellingPoints || asset.selling_points;
          return sp?.core || '';
        default: return '';
      }
    }

    // è£å‰ªå­æ¨¡å—æ•°æ®ï¼ˆç”¨äºæ³¨å…¥ Promptï¼‰
    function trimSubModuleData(subModule, level) {
      if (level === 'L3') return subModule;

      const trimmed = {
        type: subModule.type,
        name: subModule.name,
        summary: subModule.summary
      };

      if (level === 'L2') {
        trimmed.detail = subModule.detail;
        trimmed.domain = subModule.domain;
      }

      return trimmed;
    }

    // æ„å»ºæ¨èæ•°æ®å­—ç¬¦ä¸²ï¼ˆç”¨äºæ³¨å…¥ Promptï¼‰
    function buildRecommendedDataString() {
      if (STATE.selectedRecommendations.length === 0) return '';

      // æŒ‰ç±»å‹åˆ†ç»„
      const grouped = {};
      for (const rec of STATE.selectedRecommendations) {
        if (!grouped[rec.type]) grouped[rec.type] = [];
        grouped[rec.type].push(rec);
      }

      let result = '';
      for (const [type, recs] of Object.entries(grouped)) {
        const typeInfo = SUB_MODULE_TYPES[type];
        result += `### ${typeInfo?.icon || 'ğŸ“„'} ${typeInfo?.name || type}\n\n`;

        for (const rec of recs) {
          const trimmed = trimSubModuleData(rec.data, rec.contentLevel);
          result += `**${rec.name}**`;
          if (rec.domain) result += ` (${rec.domain})`;
          result += `\n`;
          result += `- æ‘˜è¦ï¼š${rec.summary}\n`;

          if (rec.contentLevel !== 'L1' && rec.detail) {
            if (rec.detail.steps?.length) {
              result += `- æ­¥éª¤ï¼š${rec.detail.steps.join(' â†’ ')}\n`;
            }
            if (rec.detail.transferPotential?.length) {
              result += `- è¿ç§»åœºæ™¯ï¼š${rec.detail.transferPotential.join('ã€')}\n`;
            }
            if (rec.detail.keySteps?.length) {
              result += `- å…³é”®æ­¥éª¤ï¼š${rec.detail.keySteps.join(' â†’ ')}\n`;
            }
          }
          result += '\n';
        }
      }

      return result;
    }

    // æ„å»ºç³»ç»Ÿä¸Šä¸‹æ–‡å­—ç¬¦ä¸²ï¼ˆç”¨äº diagnose æ¨¡å¼ï¼‰
    function buildSystemContextString() {
      const assets = loadAssets();
      const usage = loadUsageMetadata();

      const summary = {
        totalAssets: 0,
        byType: {},
        domains: [],
        techniques: [],
        modeUsage: usage.modeUsageCount,
        unusedModes: []
      };

      // ç»Ÿè®¡èµ„äº§
      for (const [type, items] of Object.entries(assets)) {
        summary.byType[type] = items.length;
        summary.totalAssets += items.length;

        if (type === 'cognitiveMap') {
          summary.domains = items.map(a => a.domain).filter(Boolean);
        }
        if (type === 'techniqueCard') {
          for (const item of items) {
            if (item.techniques) {
              summary.techniques.push(...item.techniques.map(t => t.name));
            }
          }
        }
      }

      // æ‰¾å‡ºæœªä½¿ç”¨çš„ Mode
      for (const modeId of MODE_ORDER) {
        if (!usage.modeUsageCount[modeId]) {
          summary.unusedModes.push(MODES[modeId].name);
        }
      }

      let result = '## è®¤çŸ¥èµ„äº§ç»Ÿè®¡\n\n';
      result += `- æ€»èµ„äº§æ•°ï¼š${summary.totalAssets}\n`;
      result += `- è®¤çŸ¥åœ°å›¾ï¼š${summary.byType.cognitiveMap || 0} ä¸ª\n`;
      result += `- æŠ€æ³•å¡ç‰‡ï¼š${summary.byType.techniqueCard || 0} ä¸ª\n`;
      result += `- è¿ç§»æ–¹æ¡ˆï¼š${summary.byType.transferPlan || 0} ä¸ª\n`;
      result += `- è¯Šæ–­æŠ¥å‘Šï¼š${summary.byType.diagnosisReport || 0} ä¸ª\n`;
      result += `- æ–¹æ³•è®ºï¼š${summary.byType.methodology || 0} ä¸ª\n`;
      result += `- äº§å“æ–¹æ¡ˆï¼š${summary.byType.productPlan || 0} ä¸ª\n\n`;

      if (summary.domains.length > 0) {
        result += `## å·²å­¦é¢†åŸŸ\n${summary.domains.join('ã€')}\n\n`;
      }

      if (summary.techniques.length > 0) {
        result += `## å·²æŒæ¡æŠ€æ³•\n${summary.techniques.slice(0, 10).join('ã€')}\n\n`;
      }

      if (summary.unusedModes.length > 0) {
        result += `## ä»æœªä½¿ç”¨çš„åœºæ™¯\n${summary.unusedModes.join('ã€')}\n`;
      }

      return result;
    }
  </script>
  <script>
    // ========================================
    // AI è°ƒç”¨é€»è¾‘
    // ========================================

    // Prompts æ•°æ®ï¼ˆç”±æ„å»ºè„šæœ¬æ³¨å…¥ï¼‰
    let PROMPTS = null;

    // æäº¤åˆ° AI
    async function submitToAI() {
      if (STATE.isLoading) return;

      const mode = MODES[STATE.currentMode];
      if (!mode) {
        showToast('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåœºæ™¯', 'warning');
        return;
      }

      // éªŒè¯å¿…å¡«å­—æ®µ
      const inputs = collectInputs();
      for (const field of mode.inputs) {
        if (field.required && !inputs[field.key]) {
          showToast(`è¯·å¡«å†™ã€Œ${field.label}ã€`, 'warning');
          return;
        }
      }

      // æ£€æŸ¥ API Key
      const settings = loadSettings();
      if (!settings.apiKey) {
        showToast('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key', 'warning');
        showSettingsModal();
        return;
      }

      // å¼€å§‹åŠ è½½
      setLoading(true);
      showOutputArea();

      try {
        // æ„å»º Prompt
        const { systemPrompt, userPrompt } = buildPrompt(mode, inputs);

        // è°ƒç”¨ AI
        const provider = AI_PROVIDERS[settings.provider];
        if (provider.isAnthropic) {
          await callAnthropicAPI(provider, settings, systemPrompt, userPrompt);
        } else {
          await callOpenAICompatibleAPI(provider, settings, systemPrompt, userPrompt);
        }

      } catch (error) {
        console.error('AI è°ƒç”¨å¤±è´¥:', error);
        showToast('AI è°ƒç”¨å¤±è´¥ï¼š' + error.message, 'error');
      } finally {
        setLoading(false);
      }
    }

    // æ„å»º Prompt
    function buildPrompt(mode, inputs) {
      const promptConfig = PROMPTS?.[mode.id] || {};
      let systemPrompt = promptConfig.system_prompt || getDefaultSystemPrompt(mode);
      let userPrompt = promptConfig.user_prompt_template || getDefaultUserPrompt(mode);

      // æ›¿æ¢ç”¨æˆ·è¾“å…¥å ä½ç¬¦
      for (const [key, value] of Object.entries(inputs)) {
        userPrompt = userPrompt.replace(new RegExp(`\\{\\{${key}\\}\\}`, 'g'), value || '');
      }

      // æ³¨å…¥æ¨èæ•°æ®
      const recommendedData = buildRecommendedDataString();
      if (recommendedData) {
        userPrompt = userPrompt.replace(
          /\{\{#if recommended_data\}\}[\s\S]*?\{\{\/if\}\}/g,
          `---\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\n\n${recommendedData}\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\n---`
        );
      } else {
        userPrompt = userPrompt.replace(/\{\{#if recommended_data\}\}[\s\S]*?\{\{\/if\}\}/g, '');
      }

      // æ³¨å…¥ç³»ç»Ÿä¸Šä¸‹æ–‡ï¼ˆdiagnose æ¨¡å¼ï¼‰
      if (mode.id === 'diagnose') {
        const systemContext = buildSystemContextString();
        if (systemContext) {
          userPrompt = userPrompt.replace(
            /\{\{#if system_context\}\}[\s\S]*?\{\{\/if\}\}/g,
            `---\nğŸ“Š ç³»ç»Ÿè‡ªåŠ¨èšåˆçš„è®¤çŸ¥èµ„äº§ç»Ÿè®¡ï¼š\n\n${systemContext}\nè¯·åŸºäºä»¥ä¸Šæ•°æ®è¿›è¡Œå…¨å±€è¯Šæ–­ã€‚\n---`
          );
        } else {
          userPrompt = userPrompt.replace(/\{\{#if system_context\}\}[\s\S]*?\{\{\/if\}\}/g, '');
        }
      }

      // æ¸…ç†æœªæ›¿æ¢çš„å ä½ç¬¦
      userPrompt = userPrompt.replace(/\{\{[^}]+\}\}/g, '');

      return { systemPrompt, userPrompt };
    }

    // è°ƒç”¨ OpenAI å…¼å®¹ API
    async function callOpenAICompatibleAPI(provider, settings, systemPrompt, userPrompt) {
      const response = await fetch(provider.baseUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${settings.apiKey}`
        },
        body: JSON.stringify({
          model: settings.model,
          messages: [
            { role: 'system', content: systemPrompt },
            { role: 'user', content: userPrompt }
          ],
          stream: true
        })
      });

      if (!response.ok) {
        const error = await response.text();
        throw new Error(`API é”™è¯¯ (${response.status}): ${error}`);
      }

      await handleStreamResponse(response);
    }

    // è°ƒç”¨ Anthropic API
    async function callAnthropicAPI(provider, settings, systemPrompt, userPrompt) {
      const response = await fetch(provider.baseUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': settings.apiKey,
          'anthropic-version': '2023-06-01'
        },
        body: JSON.stringify({
          model: settings.model,
          max_tokens: 4096,
          system: systemPrompt,
          messages: [{ role: 'user', content: userPrompt }],
          stream: true
        })
      });

      if (!response.ok) {
        const error = await response.text();
        throw new Error(`API é”™è¯¯ (${response.status}): ${error}`);
      }

      await handleAnthropicStream(response);
    }

    // å¤„ç†æµå¼å“åº”ï¼ˆOpenAI æ ¼å¼ï¼‰
    async function handleStreamResponse(response) {
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let fullText = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6);
            if (data === '[DONE]') continue;

            try {
              const json = JSON.parse(data);
              const content = json.choices?.[0]?.delta?.content;
              if (content) {
                fullText += content;
                updateStreamOutput(fullText);
              }
            } catch (e) {
              // å¿½ç•¥è§£æé”™è¯¯
            }
          }
        }
      }

      STATE.lastAIResponse = fullText;
      parseAndDisplayOutput(fullText);
    }

    // å¤„ç† Anthropic æµå¼å“åº”
    async function handleAnthropicStream(response) {
      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      let fullText = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = decoder.decode(value);
        const lines = chunk.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            try {
              const json = JSON.parse(line.slice(6));
              if (json.type === 'content_block_delta') {
                const content = json.delta?.text;
                if (content) {
                  fullText += content;
                  updateStreamOutput(fullText);
                }
              }
            } catch (e) {
              // å¿½ç•¥è§£æé”™è¯¯
            }
          }
        }
      }

      STATE.lastAIResponse = fullText;
      parseAndDisplayOutput(fullText);
    }

    // è§£æå¹¶æ˜¾ç¤ºç»“æ„åŒ–è¾“å‡º
    function parseAndDisplayOutput(text) {
      console.log('parseAndDisplayOutput called, text length:', text?.length);
      // å°è¯•æå– JSON
      const jsonMatch = text.match(/---JSON_START---([\s\S]*?)---JSON_END---/);
      console.log('jsonMatch:', jsonMatch ? 'found' : 'not found');
      if (jsonMatch) {
        try {
          const parsed = JSON.parse(jsonMatch[1].trim());
          console.log('JSON parsed successfully:', parsed);
          STATE.lastParsedOutput = parsed;
          STATE.resultSaved = false; // é‡ç½®ä¿å­˜çŠ¶æ€
          renderStructuredOutput(parsed);
        } catch (e) {
          console.error('JSON è§£æå¤±è´¥:', e);
          console.error('JSON å†…å®¹:', jsonMatch[1]);
        }
      } else {
        console.warn('æœªæ‰¾åˆ° JSON æ ‡è®°ï¼Œå°è¯•ç›´æ¥è§£ææ•´ä¸ªå“åº”');
        // å°è¯•ç›´æ¥è§£ææ•´ä¸ªå“åº”ï¼ˆå¦‚æœ AI æ²¡æœ‰ä½¿ç”¨æ ‡è®°ï¼‰
        try {
          const parsed = JSON.parse(text.trim());
          console.log('ç›´æ¥è§£æ JSON æˆåŠŸ:', parsed);
          STATE.lastParsedOutput = parsed;
          STATE.resultSaved = false;
          renderStructuredOutput(parsed);
        } catch (e) {
          console.log('å“åº”ä¸æ˜¯çº¯ JSONï¼Œä¿æŒåŸæ ·æ˜¾ç¤º');
        }
      }
    }

    // é»˜è®¤ System Prompt
    function getDefaultSystemPrompt(mode) {
      return `ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„ä¸“å®¶åŠ©æ‰‹ï¼Œä¸“æ³¨äºã€Œ${mode.name}ã€åœºæ™¯ã€‚
è¯·åœ¨åˆ†æåç”¨ ---JSON_START--- å’Œ ---JSON_END--- åŒ…è£¹ JSON è¾“å‡ºã€‚
æ ¸å¿ƒä¿¡æ¡ï¼šå®å¯æ…¢ä¸€ç‚¹å­¦æºå¤´ï¼Œä¹Ÿä¸è¦å¿«é€Ÿå­¦å™ªéŸ³ã€‚`;
    }

    // é»˜è®¤ User Prompt
    function getDefaultUserPrompt(mode) {
      const templates = {
        learn: 'æˆ‘æƒ³å­¦ä¹ ã€Œ{{domain}}ã€ã€‚å½“å‰æ°´å¹³ï¼š{{currentLevel}}ï¼Œç›®æ ‡ï¼š{{learningGoal}}ã€‚è¯·ç»˜åˆ¶è®¤çŸ¥åœ°å›¾ã€‚',
        deconstruct: 'æˆ‘æƒ³æ·±å…¥ç†è§£ã€Œ{{target}}ã€ã€‚ç±»å‹ï¼š{{targetType}}ï¼Œç›®çš„ï¼š{{purpose}}ã€‚è¯·è¿›è¡Œå››å±‚è§£å‰–ã€‚',
        transfer: 'æˆ‘æƒ³æŠŠã€Œ{{sourceTechnique}}ã€ç”¨åˆ°ã€Œ{{targetScenario}}ã€ã€‚è¯·å¸®æˆ‘å®Œæˆåˆ›é€ æ€§è½¬åŒ–ã€‚',
        diagnose: 'è¯·å¸®æˆ‘è¯Šæ–­è®¤çŸ¥ç›²åŒºã€‚å·²å­¦é¢†åŸŸï¼š{{knownDomains}}ï¼Œå›°æƒ‘ï¼š{{currentConfusion}}ã€‚',
        output: 'æˆ‘æƒ³è¾“å‡ºã€Œ{{topic}}ã€ä¸»é¢˜çš„ç‹¬ç‰¹è§‚ç‚¹ã€‚åŸæ–™ï¼š{{cognitiveMaterials}}ï¼Œå—ä¼—ï¼š{{targetAudience}}ã€‚',
        monetize: 'æˆ‘æƒ³æŠŠã€Œ{{methodology}}ã€æ‰“åŒ…æˆäº§å“ã€‚ç›®æ ‡å¸‚åœºï¼š{{targetMarket}}ã€‚è¯·è®¾è®¡äº§å“çŸ©é˜µã€‚'
      };
      return templates[mode.id] || '';
    }
  </script>
  <script>
    // ========================================
    // UI æ¸²æŸ“é€»è¾‘
    // ========================================

    // æ¸²æŸ“é›¶æ€ Mode é€‰æ‹©
    function renderZeroStateModes() {
      const container = document.getElementById('zero-state-modes');
      if (!container) return;

      container.innerHTML = MODE_ORDER.map(modeId => {
        const mode = MODES[modeId];
        return `
          <div class="mode-card mode-${modeId}" onclick="selectMode('${modeId}')">
            <div class="mode-icon">${mode.icon}</div>
            <div class="mode-name">${mode.name}</div>
            <div class="mode-desc">${mode.description}</div>
          </div>
        `;
      }).join('');
    }

    // æ¸²æŸ“ Mode é€‰æ‹©å™¨
    function renderModeSelector() {
      const container = document.getElementById('mode-selector');
      if (!container) return;

      container.innerHTML = MODE_ORDER.map(modeId => {
        const mode = MODES[modeId];
        const isActive = STATE.currentMode === modeId;
        return `
          <button class="btn ${isActive ? 'btn-primary' : 'btn-secondary'} btn-sm"
                  style="${isActive ? `background: ${mode.color}` : ''}"
                  onclick="selectMode('${modeId}')">
            ${mode.icon} ${mode.name}
          </button>
        `;
      }).join('');
    }

    // æ¸²æŸ“å½“å‰ Mode ä¿¡æ¯
    function renderCurrentModeInfo() {
      const container = document.getElementById('current-mode-info');
      if (!container || !STATE.currentMode) return;

      const mode = MODES[STATE.currentMode];
      container.innerHTML = `
        <span class="text-2xl">${mode.icon}</span>
        <span class="font-medium" style="color: ${mode.color}">${mode.name}</span>
      `;
    }

    // æ¸²æŸ“è¾“å…¥è¡¨å•
    function renderInputForm() {
      const container = document.getElementById('input-fields');
      if (!container || !STATE.currentMode) return;

      const mode = MODES[STATE.currentMode];
      container.innerHTML = mode.inputs.map(field => {
        const required = field.required ? '<span class="text-error">*</span>' : '';

        if (field.type === 'select') {
          return `
            <div>
              <label class="block text-sm font-medium text-secondary mb-1">${field.label} ${required}</label>
              <select id="input-${field.key}" class="input">
                ${field.options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('')}
              </select>
            </div>
          `;
        } else if (field.type === 'textarea') {
          return `
            <div>
              <label class="block text-sm font-medium text-secondary mb-1">${field.label} ${required}</label>
              <textarea id="input-${field.key}" class="input" rows="3" placeholder="${field.placeholder || ''}"></textarea>
            </div>
          `;
        } else {
          return `
            <div>
              <label class="block text-sm font-medium text-secondary mb-1">${field.label} ${required}</label>
              <input type="text" id="input-${field.key}" class="input" placeholder="${field.placeholder || ''}">
            </div>
          `;
        }
      }).join('');
    }

    // æ¸²æŸ“æ¨èé¢æ¿ï¼ˆé‡æ„ç‰ˆï¼šæŠ˜å å¼ + Tag é€‰æ‹©ï¼‰
    function renderRecommendPanel() {
      const panel = document.getElementById('recommend-panel');
      const groupsContainer = document.getElementById('recommend-groups');
      const selectedTagsContainer = document.getElementById('selected-tags');
      const countBadge = document.getElementById('recommend-count');

      if (!panel) return;

      const recommendations = generateRecommendations(STATE.currentMode);
      STATE.selectedRecommendations = recommendations.filter(r => r.selected);

      if (recommendations.length === 0) {
        panel.classList.add('hidden');
        return;
      }

      panel.classList.remove('hidden');

      // æ›´æ–°å¯ç”¨æ•°é‡
      if (countBadge) {
        countBadge.textContent = `${recommendations.length} é¡¹å¯ç”¨`;
      }

      // æ¸²æŸ“å·²é€‰æ ‡ç­¾
      if (selectedTagsContainer) {
        if (STATE.selectedRecommendations.length === 0) {
          selectedTagsContainer.innerHTML = '<span class="text-muted text-sm">ç‚¹å‡»ä¸Šæ–¹å±•å¼€é€‰æ‹©è®¤çŸ¥èµ„äº§...</span>';
        } else {
          selectedTagsContainer.innerHTML = STATE.selectedRecommendations.map(rec => {
            const typeInfo = SUB_MODULE_TYPES[rec.type];
            return `
              <span class="tag tag-active flex items-center gap-1" onclick="toggleRecommendation('${rec.id}')">
                <span>${typeInfo?.icon || 'ğŸ“„'}</span>
                <span>${rec.name}</span>
                <span class="text-xs opacity-70 ml-1">Ã—</span>
              </span>
            `;
          }).join('');
        }
      }

      // æŒ‰ç±»å‹åˆ†ç»„æ¸²æŸ“ä¸‹æ‹‰é€‰æ‹©åŒº
      if (groupsContainer) {
        const grouped = {};
        for (const rec of recommendations) {
          if (!grouped[rec.type]) grouped[rec.type] = [];
          grouped[rec.type].push(rec);
        }

        let html = '';
        for (const [type, recs] of Object.entries(grouped)) {
          const typeInfo = SUB_MODULE_TYPES[type];
          html += `
            <div class="recommend-group">
              <div class="text-xs text-muted mb-2 flex items-center gap-1">
                <span>${typeInfo?.icon || 'ğŸ“„'}</span>
                <span class="font-medium">${typeInfo?.name || type}</span>
                <span class="text-secondary">(${recs.length})</span>
              </div>
              <div class="flex flex-wrap gap-2">
          `;

          for (const rec of recs) {
            const isSelected = rec.selected;
            html += `
              <div class="recommend-item ${isSelected ? 'selected' : ''}"
                   onclick="toggleRecommendation('${rec.id}')"
                   title="${rec.summary || ''}">
                <span class="recommend-item-name">${rec.name}</span>
                ${rec.domain ? `<span class="recommend-item-domain">${rec.domain}</span>` : ''}
              </div>
            `;
          }

          html += `</div></div>`;
        }

        groupsContainer.innerHTML = html;
      }

      // æ›´æ–°ç»„åˆæ´å¯Ÿ
      updateRecommendInsight();
    }

    // åˆ‡æ¢æ¨èåŒºå±•å¼€/æŠ˜å 
    function toggleRecommendExpand() {
      const dropdown = document.getElementById('recommend-dropdown');
      const btn = document.getElementById('recommend-expand-btn');
      if (dropdown && btn) {
        const isHidden = dropdown.classList.contains('hidden');
        dropdown.classList.toggle('hidden');
        btn.textContent = isHidden ? 'æ”¶èµ· â–²' : 'å±•å¼€é€‰æ‹© â–¼';
      }
    }

    // å…¨é€‰ç›¸å…³æ¨è
    function selectAllRecommendations() {
      const recommendations = _recommendationCache.recommendations;
      recommendations.forEach(rec => rec.selected = true);
      STATE.selectedRecommendations = [...recommendations];
      renderRecommendPanel();
      showToast(`å·²é€‰æ‹© ${recommendations.length} ä¸ªç›¸å…³èµ„äº§`, 'success');
    }

    // æ¸…ç©ºæ‰€æœ‰é€‰æ‹©
    function clearAllRecommendations() {
      const recommendations = _recommendationCache.recommendations;
      recommendations.forEach(rec => rec.selected = false);
      STATE.selectedRecommendations = [];
      renderRecommendPanel();
    }

    // æ›´æ–°ç»„åˆæ´å¯Ÿ
    function updateRecommendInsight() {
      const insightPanel = document.getElementById('recommend-insight');
      const insightText = document.getElementById('insight-text');
      if (!insightPanel || !insightText) return;

      const selected = STATE.selectedRecommendations;
      if (selected.length < 2) {
        insightPanel.classList.add('hidden');
        return;
      }

      // åˆ†æé€‰ä¸­çš„å­æ¨¡å—ç»„åˆ
      const types = [...new Set(selected.map(r => r.type))];
      const domains = [...new Set(selected.map(r => r.domain).filter(Boolean))];

      let insight = '';
      if (types.includes('technique') && types.includes('quote')) {
        insight = 'æŠ€æ³• + é‡‘å¥ç»„åˆï¼Œé€‚åˆè¾“å‡ºæœ‰æ·±åº¦çš„å†…å®¹';
      } else if (types.includes('person') && types.includes('path')) {
        insight = 'æºå¤´äººç‰© + å­¦ä¹ è·¯å¾„ï¼Œå¯ä»¥å¿«é€Ÿå»ºç«‹é¢†åŸŸè®¤çŸ¥';
      } else if (types.includes('methodology') && types.includes('technique')) {
        insight = 'æ–¹æ³•è®º + æŠ€æ³•ï¼Œé€‚åˆè¿ç§»åˆ°æ–°åœºæ™¯';
      } else if (domains.length > 1) {
        insight = `è·¨é¢†åŸŸç»„åˆï¼ˆ${domains.join('ã€')}ï¼‰ï¼Œå¯èƒ½äº§ç”Ÿç‹¬ç‰¹æ´å¯Ÿ`;
      } else if (selected.length >= 3) {
        insight = `å·²é€‰ ${selected.length} ä¸ªå­æ¨¡å—ï¼Œä¿¡æ¯é‡å……è¶³`;
      }

      if (insight) {
        insightPanel.classList.remove('hidden');
        insightText.textContent = insight;
      } else {
        insightPanel.classList.add('hidden');
      }
    }

    // æ¸²æŸ“èµ„äº§åˆ—è¡¨
    function renderAssetList(filter = 'all') {
      const list = document.getElementById('asset-list');
      const empty = document.getElementById('asset-empty');
      const batchActions = document.getElementById('batch-actions');
      if (!list || !empty) return;

      let assets = getAllAssets();
      if (filter !== 'all') {
        const mode = MODES[filter];
        if (mode) {
          assets = assets.filter(a => a.assetType === mode.assetType);
        }
      }

      // æ˜¾ç¤º/éšè—æ‰¹é‡æ“ä½œæ 
      if (batchActions) {
        if (assets.length > 0) {
          batchActions.classList.remove('hidden');
        } else {
          batchActions.classList.add('hidden');
        }
      }

      // é‡ç½®å…¨é€‰çŠ¶æ€
      const selectAllCheckbox = document.getElementById('select-all-assets');
      if (selectAllCheckbox) selectAllCheckbox.checked = false;
      updateSelectedCount();

      if (assets.length === 0) {
        list.classList.add('hidden');
        empty.classList.remove('hidden');
        return;
      }

      empty.classList.add('hidden');
      list.classList.remove('hidden');
      list.innerHTML = assets.map(asset => {
        const typeInfo = ASSET_TYPES[asset.assetType];
        const date = new Date(asset.createdAt).toLocaleDateString('zh-CN');
        return `
          <div class="card card-interactive flex items-start gap-3">
            <input type="checkbox" class="asset-checkbox w-4 h-4 mt-1 flex-shrink-0"
                   data-asset-type="${asset.assetType}" data-asset-id="${asset.id}"
                   onchange="updateSelectedCount()">
            <div class="flex-1 cursor-pointer" onclick="showAssetDetail('${asset.assetType}', '${asset.id}')">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span>${typeInfo?.icon || 'ğŸ“„'}</span>
                  <span class="font-medium text-primary">${getAssetTitle(asset)}</span>
                </div>
                <span class="text-xs text-muted">${date}</span>
              </div>
              <div class="text-sm text-secondary mt-1 truncate">${getAssetSummary(asset)}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    // æ¸²æŸ“è®¾ç½®è¡¨å•
    function renderSettingsForm() {
      const settings = loadSettings();
      const providerSelect = document.getElementById('ai-provider');
      const modelSelect = document.getElementById('ai-model');
      const apiKeyInput = document.getElementById('api-key');

      if (providerSelect) {
        providerSelect.innerHTML = Object.entries(AI_PROVIDERS).map(([id, p]) =>
          `<option value="${id}" ${settings.provider === id ? 'selected' : ''}>${p.name}</option>`
        ).join('');
      }

      if (modelSelect && settings.provider) {
        const provider = AI_PROVIDERS[settings.provider];
        modelSelect.innerHTML = provider.models.map(m =>
          `<option value="${m.id}" ${settings.model === m.id ? 'selected' : ''}>${m.name}</option>`
        ).join('');
      }

      if (apiKeyInput) {
        apiKeyInput.value = settings.apiKey || '';
      }

      updateThemeToggle();
    }

    // æ›´æ–°æµå¼è¾“å‡ºï¼ˆéšè— JSON å—ï¼Œåªæ˜¾ç¤ºåˆ†æå†…å®¹ï¼‰
    function updateStreamOutput(text) {
      const container = document.getElementById('stream-output');
      if (container && typeof marked !== 'undefined') {
        // è¿‡æ»¤æ‰ JSON å—ï¼Œåªæ˜¾ç¤ºåˆ†æå†…å®¹
        let displayText = text;

        // ç§»é™¤ ---JSON_START--- åˆ° ---JSON_END--- ä¹‹é—´çš„å†…å®¹ï¼ˆåŒ…æ‹¬æ ‡è®°æœ¬èº«ï¼‰
        displayText = displayText.replace(/---JSON_START---[\s\S]*?---JSON_END---/g, '');

        // ç§»é™¤æœªé—­åˆçš„ ---JSON_START--- åŠå…¶åé¢çš„å†…å®¹ï¼ˆæµå¼è¾“å‡ºæ—¶å¯èƒ½æœªå®Œæˆï¼‰
        displayText = displayText.replace(/---JSON_START---[\s\S]*$/g, '');

        // ç§»é™¤å¯èƒ½çš„ JSON ä»£ç å—ï¼ˆ```json ... ```ï¼‰
        displayText = displayText.replace(/```json[\s\S]*?```/g, '');

        // ç§»é™¤æœªé—­åˆçš„ ```json ä»£ç å—
        displayText = displayText.replace(/```json[\s\S]*$/g, '');

        // ç§»é™¤ ``` ä»£ç å—ä¸­çš„çº¯ JSON å†…å®¹
        displayText = displayText.replace(/```\s*\{[\s\S]*?\}[\s\S]*?```/g, '');

        // ç§»é™¤ç‹¬ç«‹çš„å¤§æ®µ JSON å¯¹è±¡ï¼ˆä»¥ { å¼€å¤´ï¼ŒåŒ…å« "key": æ ¼å¼ï¼‰
        displayText = displayText.replace(/^\s*\{[\s\S]*?"[^"]+"\s*:[\s\S]*?\}\s*$/gm, '');

        // ç§»é™¤å¤šä½™çš„ç©ºè¡Œ
        displayText = displayText.replace(/\n{3,}/g, '\n\n');

        // ç§»é™¤å¼€å¤´çš„ç©ºç™½
        displayText = displayText.trim();

        // å¦‚æœè¿‡æ»¤åå†…å®¹ä¸ºç©ºæˆ–åªæœ‰ç©ºç™½ï¼Œæ˜¾ç¤ºåŠ è½½æç¤º
        if (!displayText.trim()) {
          container.innerHTML = '<div class="text-muted text-center p-4">æ­£åœ¨ç”Ÿæˆåˆ†æç»“æœ...</div>';
        } else {
          container.innerHTML = marked.parse(displayText);
        }
        container.scrollTop = container.scrollHeight;
      }
    }

    // æ¸²æŸ“ç»“æ„åŒ–è¾“å‡º
    function renderStructuredOutput(parsed) {
      const container = document.getElementById('structured-output');
      const cardsContainer = document.getElementById('output-cards');
      if (!container || !cardsContainer) return;

      container.classList.remove('hidden');

      // æ¸²æŸ“é‡‘å¥
      const goldenQuote = findGoldenQuote(parsed);
      if (goldenQuote) {
        const quoteSection = document.getElementById('golden-quote-section');
        const quoteText = document.getElementById('golden-quote-text');
        if (quoteSection && quoteText) {
          quoteSection.classList.remove('hidden');
          quoteText.textContent = goldenQuote;
        }
      }

      // æ¸²æŸ“ç»“æ„åŒ–å¡ç‰‡
      cardsContainer.innerHTML = renderResultCards(parsed);

      // æ¸²æŸ“ä¸‹ä¸€æ­¥æ¨è
      if (parsed.nextStep) {
        const nextSection = document.getElementById('next-step-section');
        const nextText = document.getElementById('next-step-text');
        const nextReason = document.getElementById('next-step-reason');
        if (nextSection && nextText) {
          nextSection.classList.remove('hidden');
          const nextMode = MODES[parsed.nextStep.recommendedMode];
          nextText.textContent = nextMode ? `${nextMode.icon} ${nextMode.name}` : parsed.nextStep.recommendedMode;
          if (nextReason) nextReason.textContent = parsed.nextStep.reason || '';
        }
      }

      // æ¸²æŸ“ã€Œç”¨è¿™ä¸ªç»“æœç»§ç»­ã€åœºæ™¯å¿«æ·å…¥å£
      renderContinueOptions();
    }

    // æ¸²æŸ“åœºæ™¯å¿«æ·å…¥å£
    function renderContinueOptions() {
      const container = document.getElementById('continue-options');
      console.log('renderContinueOptions called, container:', container, 'currentMode:', STATE.currentMode);
      if (!container || !STATE.currentMode) return;

      // æ ¹æ®å½“å‰ Mode æ¨èä¸‹ä¸€æ­¥åœºæ™¯
      const currentMode = STATE.currentMode;
      const flowMap = {
        learn: ['deconstruct', 'transfer', 'diagnose'],
        deconstruct: ['transfer', 'output', 'learn'],
        transfer: ['output', 'monetize', 'diagnose'],
        diagnose: ['learn', 'deconstruct', 'output'],
        output: ['monetize', 'transfer', 'deconstruct'],
        monetize: ['output', 'transfer', 'diagnose']
      };

      const suggestedModes = flowMap[currentMode] || MODE_ORDER.filter(m => m !== currentMode);
      console.log('suggestedModes:', suggestedModes);

      container.innerHTML = suggestedModes.map(modeId => {
        const mode = MODES[modeId];
        if (!mode) {
          console.warn('Mode not found:', modeId);
          return '';
        }
        return `
          <button class="btn btn-secondary btn-sm flex items-center gap-1"
                  onclick="continueWithResult('${modeId}')">
            <span>${mode.icon}</span>
            <span>${mode.name}</span>
          </button>
        `;
      }).join('');
      console.log('continue-options innerHTML set');
    }

    // ç”¨å½“å‰ç»“æœç»§ç»­åˆ°å…¶ä»–åœºæ™¯
    function continueWithResult(targetModeId) {
      console.log('continueWithResult called with:', targetModeId);
      // å…ˆä¿å­˜å½“å‰ç»“æœåˆ°èµ„äº§åº“ï¼ˆå¦‚æœè¿˜æ²¡ä¿å­˜ï¼‰
      if (STATE.lastParsedOutput && !STATE.resultSaved) {
        saveToAssets();
        STATE.resultSaved = true;
      }

      // é‡ç½® resultSaved çŠ¶æ€ï¼Œä¸ºä¸‹ä¸€æ¬¡åˆ†æåšå‡†å¤‡
      STATE.resultSaved = false;

      // åˆ‡æ¢åˆ°ç›®æ ‡åœºæ™¯
      selectMode(targetModeId);

      // æç¤ºç”¨æˆ·
      showToast(`å·²åˆ‡æ¢åˆ°ã€Œ${MODES[targetModeId].name}ã€ï¼Œå¯ä»èµ„äº§ä¸­é€‰æ‹©åˆšæ‰çš„ç»“æœ`, 'info');
    }

    // æŸ¥æ‰¾é‡‘å¥
    function findGoldenQuote(parsed) {
      const result = parsed.result || parsed;
      // å°è¯•å¤šç§è·¯å¾„
      if (result.goldenQuotes?.[0]?.content) return result.goldenQuotes[0].content;
      if (result.methodology?.goldenQuotes?.[0]?.content) return result.methodology.goldenQuotes[0].content;
      if (result.cognitiveMap?.leveragePoint) return result.cognitiveMap.leveragePoint;
      if (result.techniqueCard?.techniques?.[0]?.name) return `æ ¸å¿ƒæŠ€æ³•ï¼š${result.techniqueCard.techniques[0].name}`;
      if (result.transferPlan?.dnaPrinciple) return result.transferPlan.dnaPrinciple;
      if (result.diagnosisReport?.cognitiveFingerprint?.cognitiveAdvantage) return result.diagnosisReport.cognitiveFingerprint.cognitiveAdvantage;
      if (result.productPlan?.mainProductDesign?.sellingPoints?.core) return result.productPlan.mainProductDesign.sellingPoints.core;
      return null;
    }

    // å­—æ®µåæ ‡å‡†åŒ–ï¼šå°†ä¸‹åˆ’çº¿å‘½åè½¬ä¸ºé©¼å³°å‘½å
    function normalizeFieldNames(obj) {
      if (obj === null || typeof obj !== 'object') return obj;
      if (Array.isArray(obj)) return obj.map(normalizeFieldNames);

      const normalized = {};
      for (const [key, value] of Object.entries(obj)) {
        // è½¬æ¢ä¸‹åˆ’çº¿ä¸ºé©¼å³°
        const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());
        normalized[camelKey] = normalizeFieldNames(value);
      }
      return normalized;
    }

    // æ¸²æŸ“ç»“æœå¡ç‰‡
    function renderResultCards(parsed) {
      const mode = STATE.currentMode;
      let html = '';

      // å…ˆæ ‡å‡†åŒ–å­—æ®µå
      const normalizedParsed = normalizeFieldNames(parsed);

      // æ™ºèƒ½æŸ¥æ‰¾æ•°æ®ï¼šæ”¯æŒå¤šç§ JSON ç»“æ„
      function findData(key) {
        // ç›´æ¥åœ¨ parsed ä¸­æŸ¥æ‰¾ï¼ˆAI å¯èƒ½ç›´æ¥è¿”å›æ•°æ®ï¼‰
        if (normalizedParsed[key]) return normalizedParsed[key];
        // åœ¨ result ä¸­æŸ¥æ‰¾
        if (normalizedParsed.result && normalizedParsed.result[key]) return normalizedParsed.result[key];
        // result æœ¬èº«å°±æ˜¯æ•°æ®
        if (normalizedParsed.result && typeof normalizedParsed.result === 'object') {
          const featureFields = {
            'cognitiveMap': ['sourceGalaxy', 'learningPaths', 'domain', 'leveragePoint'],
            'techniqueCard': ['techniques', 'fourLayerReport', 'targetName', 'fourDimensions'],
            'transferPlan': ['dnaPrinciple', 'mappingTable', 'variants', 'minimalExperiment'],
            'diagnosisReport': ['blindspotList', 'cognitiveFingerprint', 'trainingPrescription', 'cognitiveCTReport'],
            'methodology': ['personalMethodology', 'contentMatrix', 'goldenQuotes', 'alchemyRecipe'],
            'productPlan': ['productMatrix', 'salesScript', 'valueDiagnosis', 'sellingPoints']
          };
          const features = featureFields[key] || [];
          if (features.some(f => normalizedParsed.result[f])) {
            return normalizedParsed.result;
          }
        }
        // ç›´æ¥æ£€æŸ¥ parsed æœ¬èº«æ˜¯å¦åŒ…å«ç‰¹å¾å­—æ®µ
        const featureFields = {
          'cognitiveMap': ['sourceGalaxy', 'learningPaths', 'domain', 'leveragePoint'],
          'techniqueCard': ['techniques', 'fourLayerReport', 'targetName', 'fourDimensions'],
          'transferPlan': ['dnaPrinciple', 'mappingTable', 'variants', 'minimalExperiment'],
          'diagnosisReport': ['blindspotList', 'cognitiveFingerprint', 'trainingPrescription', 'cognitiveCTReport'],
          'methodology': ['personalMethodology', 'contentMatrix', 'goldenQuotes', 'alchemyRecipe'],
          'productPlan': ['productMatrix', 'salesScript', 'valueDiagnosis', 'sellingPoints']
        };
        const features = featureFields[key] || [];
        if (features.some(f => normalizedParsed[f])) {
          return normalizedParsed;
        }
        return null;
      }

      if (mode === 'learn') {
        const data = findData('cognitiveMap');
        if (data) html = renderCognitiveMapCards(data);
      } else if (mode === 'deconstruct') {
        const data = findData('techniqueCard');
        if (data) html = renderTechniqueCardCards(data);
      } else if (mode === 'transfer') {
        const data = findData('transferPlan');
        if (data) html = renderTransferPlanCards(data);
      } else if (mode === 'diagnose') {
        const data = findData('diagnosisReport');
        if (data) html = renderDiagnosisReportCards(data);
      } else if (mode === 'output') {
        const data = findData('methodology');
        if (data) html = renderMethodologyCards(data);
      } else if (mode === 'monetize') {
        const data = findData('productPlan');
        if (data) html = renderProductPlanCards(data);
      }

      // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•ç»“æ„åŒ–æ•°æ®ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
      if (!html) {
        html = `<div class="card p-4 text-center">
          <div class="text-muted mb-2">æš‚æ— ç»“æ„åŒ–æ•°æ®</div>
          <div class="text-xs text-secondary">AI è¾“å‡ºå¯èƒ½æœªåŒ…å«æ ‡å‡† JSON æ ¼å¼ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹åŸå§‹è¾“å‡º</div>
        </div>`;
      }

      return html;
    }

    // æ¸²æŸ“è®¤çŸ¥åœ°å›¾å¡ç‰‡
    function renderCognitiveMapCards(data) {
      let html = '';

      // æºå¤´æ˜Ÿç³» (æ”¯æŒ source_galaxy å’Œ sourceGalaxy)
      const sourceGalaxy = data.sourceGalaxy || data.source_galaxy;
      if (sourceGalaxy) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸŒŸ æºå¤´æ˜Ÿç³»</div>
          <div class="output-card-body">`;

        // æ ¸å¿ƒæ’æ˜Ÿ (æ”¯æŒ core_stars å’Œ coreStar)
        const coreStars = sourceGalaxy.coreStars || sourceGalaxy.coreStar || sourceGalaxy.core_stars;
        if (coreStars?.length) {
          html += `<div class="mb-3"><strong class="text-accent">æ ¸å¿ƒæ’æ˜Ÿ</strong>`;
          coreStars.forEach(star => {
            const mustRead = star.mustRead || star.must_read;
            const fourDim = star.fourDimensions || star.four_dimensions;
            html += `<div class="card mt-2 p-3">
              <div class="font-medium text-primary">${star.name}</div>
              <div class="text-sm text-secondary">${star.contribution || ''}</div>
              ${mustRead ? `<div class="text-xs text-muted mt-1">å¿…è¯»ï¼š${mustRead}</div>` : ''}
              ${star.works?.length ? `<div class="text-xs text-muted mt-1">ä»£è¡¨ä½œï¼š${star.works.join('ã€')}</div>` : ''}
            </div>`;
          });
          html += `</div>`;
        }

        if (sourceGalaxy.planets?.length) {
          html += `<div><strong class="text-accent">è¡Œæ˜Ÿç³»ç»Ÿ</strong>`;
          sourceGalaxy.planets.forEach(planet => {
            const mustRead = planet.mustRead || planet.must_read;
            html += `<div class="card mt-2 p-3">
              <div class="font-medium text-primary">${planet.name}</div>
              <div class="text-sm text-secondary">${planet.contribution || ''}</div>
              ${mustRead ? `<div class="text-xs text-muted mt-1">å¿…è¯»ï¼š${mustRead}</div>` : ''}
            </div>`;
          });
          html += `</div>`;
        }

        html += `</div></div>`;
      }

      // å­¦ä¹ è·¯å¾„ (æ”¯æŒ learning_paths å’Œ learningPaths)
      const learningPaths = data.learningPaths || data.learning_paths;
      if (learningPaths) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ›¤ï¸ å­¦ä¹ è·¯å¾„</div>
          <div class="output-card-body">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">`;

        // é€Ÿæˆè·¯å¾„
        const quick = learningPaths.quick;
        if (quick) {
          const steps = quick.steps || (Array.isArray(quick) ? quick : null);
          if (steps?.length) {
            html += `<div class="card p-3">
              <div class="font-medium text-warning mb-2">âš¡ é€Ÿæˆè·¯å¾„ ${quick.duration ? `(${quick.duration})` : ''}</div>
              <ol class="text-sm text-secondary list-decimal list-inside">
                ${steps.map(s => `<li>${s}</li>`).join('')}
              </ol>
              ${quick.outcome ? `<div class="text-xs text-muted mt-2">ç›®æ ‡ï¼š${quick.outcome}</div>` : ''}
            </div>`;
          }
        }

        // æ‰å®è·¯å¾„
        const solid = learningPaths.solid;
        if (solid) {
          const steps = solid.steps || (Array.isArray(solid) ? solid : null);
          if (steps?.length) {
            html += `<div class="card p-3">
              <div class="font-medium text-success mb-2">ğŸ“š æ‰å®è·¯å¾„ ${solid.duration ? `(${solid.duration})` : ''}</div>
              <ol class="text-sm text-secondary list-decimal list-inside">
                ${steps.map(s => `<li>${s}</li>`).join('')}
              </ol>
              ${solid.outcome ? `<div class="text-xs text-muted mt-2">ç›®æ ‡ï¼š${solid.outcome}</div>` : ''}
            </div>`;
          }
        }

        // ç²¾é€šè·¯å¾„
        const expert = learningPaths.expert;
        if (expert) {
          const steps = expert.steps || (Array.isArray(expert) ? expert : null);
          if (steps?.length) {
            html += `<div class="card p-3">
              <div class="font-medium text-accent mb-2">ğŸ¯ ç²¾é€šè·¯å¾„ ${expert.duration ? `(${expert.duration})` : ''}</div>
              <ol class="text-sm text-secondary list-decimal list-inside">
                ${steps.map(s => `<li>${s}</li>`).join('')}
              </ol>
              ${expert.outcome ? `<div class="text-xs text-muted mt-2">ç›®æ ‡ï¼š${expert.outcome}</div>` : ''}
            </div>`;
          }
        }

        html += `</div></div></div>`;
      }

      // é¿å‘æŒ‡å— (æ”¯æŒ pitfall_guide å’Œ pitfallGuide)
      const pitfallGuide = data.pitfallGuide || data.pitfall_guide;
      if (pitfallGuide?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">âš ï¸ é¿å‘æŒ‡å—</div>
          <div class="output-card-body space-y-2">`;
        pitfallGuide.forEach(pit => {
          const howToIdentify = pit.howToIdentify || pit.how_to_identify;
          html += `<div class="card p-3 bg-warning">
            <div class="font-medium text-primary">${pit.source}</div>
            <div class="text-sm text-secondary">${pit.reason}</div>
            <div class="text-xs text-muted mt-1">è¯†åˆ«æ–¹æ³•ï¼š${howToIdentify || 'æ— '}</div>
          </div>`;
        });
        html += `</div></div>`;
      }

      // æ æ†ç‚¹ (æ”¯æŒ leverage_point å’Œ leveragePoint)
      const leveragePoint = data.leveragePoint || data.leverage_point;
      if (leveragePoint) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ¯ è®¤çŸ¥æ æ†ç‚¹</div>
          <div class="output-card-body">
            <div class="text-lg font-medium text-accent text-center p-4">${leveragePoint}</div>
          </div>
        </div>`;
      }

      // é‡‘å¥ (æ”¯æŒ golden_quote å’Œ goldenQuote)
      const goldenQuote = data.goldenQuote || data.golden_quote;
      if (goldenQuote) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’ é‡‘å¥</div>
          <div class="output-card-body">
            <div class="text-lg italic text-accent text-center p-4">"${goldenQuote}"</div>
          </div>
        </div>`;
      }

      return html;
    }

    // æ¸²æŸ“æŠ€æ³•å¡ç‰‡
    function renderTechniqueCardCards(data) {
      let html = '';

      // å››å±‚è§£å‰– (æ”¯æŒ four_layer_report å’Œ fourLayerReport)
      const fourLayerReport = data.fourLayerReport || data.four_layer_report;
      if (fourLayerReport) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ”¬ å››å±‚è§£å‰–æŠ¥å‘Š</div>
          <div class="output-card-body space-y-3">`;

        const layers = [
          { key: 'L1', name: 'è¡¨çš®å±‚', icon: 'ğŸ¨', desc: 'å¤–åœ¨é£æ ¼' },
          { key: 'L2', name: 'è‚Œè‚‰å±‚', icon: 'ğŸ’ª', desc: 'ç»“æ„èŠ‚å¥' },
          { key: 'L3', name: 'ç¥ç»å±‚', icon: 'ğŸ§ ', desc: 'å†…å¿ƒç®—æ³•' },
          { key: 'L4', name: 'åŸºå› å±‚', icon: 'ğŸ§¬', desc: 'åº•å±‚ä¿¡å¿µ' }
        ];

        layers.forEach(layer => {
          const layerData = fourLayerReport[layer.key];
          if (layerData) {
            const warning = layerData.warning || layerData.criticalNote || layerData.critical_note;
            html += `<div class="card p-3">
              <div class="flex items-center gap-2 mb-2">
                <span>${layer.icon}</span>
                <span class="font-medium text-primary">${layerData.name || layer.name}</span>
                <span class="text-xs text-muted">${layer.desc}</span>
                <span class="tag tag-sm">${layerData.transferability || ''}</span>
              </div>
              ${layerData.findings?.length ? `<ul class="text-sm text-muted mt-2 list-disc list-inside">${layerData.findings.map(f => `<li>${f}</li>`).join('')}</ul>` : ''}
              ${warning ? `<div class="text-xs text-warning mt-2">âš ï¸ ${warning}</div>` : ''}
            </div>`;
          }
        });

        html += `</div></div>`;
      }

      // æŠ€æ³•åˆ—è¡¨
      if (data.techniques?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ¯ æå–çš„æŠ€æ³•</div>
          <div class="output-card-body space-y-3">`;

        data.techniques.forEach(tech => {
          const sourceLevel = tech.sourceLevel || tech.source_level || 'L1';
          const triggerCondition = tech.triggerCondition || tech.trigger_condition;
          const transferPotential = tech.transferPotential || tech.transfer_potential;
          const commonMistakes = tech.commonMistakes || tech.common_mistakes;
          html += `<div class="card p-3">
            <div class="flex items-center justify-between mb-2">
              <span class="font-medium text-primary">${tech.name}</span>
              <span class="tag">${sourceLevel}</span>
            </div>
            ${triggerCondition ? `<div class="text-sm text-secondary mb-2">è§¦å‘æ¡ä»¶ï¼š${triggerCondition}</div>` : ''}
            ${tech.steps?.length ? `<div class="text-sm"><strong class="text-accent">æ“ä½œæ­¥éª¤ï¼š</strong><ol class="list-decimal list-inside text-muted">${tech.steps.map(s => `<li>${s}</li>`).join('')}</ol></div>` : ''}
            ${transferPotential?.length ? `<div class="text-xs text-muted mt-2">è¿ç§»åœºæ™¯ï¼š${transferPotential.join('ã€')}</div>` : ''}
            ${commonMistakes?.length ? `<div class="text-xs text-warning mt-2">å¸¸è§è¯¯ç”¨ï¼š${commonMistakes.join('ã€')}</div>` : ''}
          </div>`;
        });

        html += `</div></div>`;
      }

      // é‡‘å¥ (æ”¯æŒ golden_quote å’Œ goldenQuote)
      const goldenQuote = data.goldenQuote || data.golden_quote;
      if (goldenQuote) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’ é‡‘å¥</div>
          <div class="output-card-body">
            <div class="text-lg italic text-accent text-center p-4">"${goldenQuote}"</div>
          </div>
        </div>`;
      }

      return html;
    }

    // æ¸²æŸ“è¿ç§»æ–¹æ¡ˆå¡ç‰‡
    function renderTransferPlanCards(data) {
      let html = '';

      // DNA åŸåˆ™ (æ”¯æŒ dna_principle å’Œ dnaPrinciple)
      const dnaPrinciple = data.dnaPrinciple || data.dna_principle;
      if (dnaPrinciple) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ§¬ DNA åŸåˆ™</div>
          <div class="output-card-body">
            <div class="text-lg font-medium text-accent text-center p-4">${dnaPrinciple}</div>
          </div>
        </div>`;
      }

      // æ˜ å°„è¡¨ (æ”¯æŒ mapping_table å’Œ mappingTable)
      const mappingTable = data.mappingTable || data.mapping_table;
      if (mappingTable?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ”„ æ˜ å°„è¡¨</div>
          <div class="output-card-body">
            <table class="w-full text-sm">
              <thead><tr><th class="text-left text-muted p-2">æºåœºæ™¯</th><th class="text-left text-muted p-2">â†’</th><th class="text-left text-muted p-2">ç›®æ ‡åœºæ™¯</th></tr></thead>
              <tbody>${mappingTable.map(m => {
                const sourceElement = m.sourceElement || m.source_element;
                const targetElement = m.targetElement || m.target_element;
                return `<tr><td class="p-2 text-secondary">${sourceElement}</td><td class="p-2">â†’</td><td class="p-2 text-primary">${targetElement}</td></tr>`;
              }).join('')}</tbody>
            </table>
          </div>
        </div>`;
      }

      // ä¸‰ä¸ªå˜å½¢æ–¹æ¡ˆ
      if (data.variants) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ­ å˜å½¢æ–¹æ¡ˆ</div>
          <div class="output-card-body grid grid-cols-1 md:grid-cols-3 gap-3">`;

        const variantTypes = [
          { key: 'conservative', name: 'ä¿å®ˆæ–¹æ¡ˆ', color: 'text-success' },
          { key: 'aggressive', name: 'æ¿€è¿›æ–¹æ¡ˆ', color: 'text-warning' },
          { key: 'innovative', name: 'åˆ›æ–°æ–¹æ¡ˆ', color: 'text-accent' }
        ];

        variantTypes.forEach(v => {
          const variant = data.variants[v.key];
          if (variant) {
            html += `<div class="card p-3">
              <div class="font-medium ${v.color} mb-2">${v.name}</div>
              <div class="text-sm text-secondary">${variant.description || ''}</div>
              ${variant.steps?.length ? `<ol class="text-xs text-muted mt-2 list-decimal list-inside">${variant.steps.map(s => `<li>${s}</li>`).join('')}</ol>` : ''}
            </div>`;
          }
        });

        html += `</div></div>`;
      }

      // æœ€å°å®éªŒ (æ”¯æŒ minimal_experiment å’Œ minimalExperiment)
      const minimalExperiment = data.minimalExperiment || data.minimal_experiment;
      if (minimalExperiment) {
        const duration = minimalExperiment.duration || minimalExperiment.time;
        const successCriteria = minimalExperiment.successCriteria || minimalExperiment.success_criteria;
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ§ª æœ€å°å®éªŒ</div>
          <div class="output-card-body">
            <div class="card p-3">
              <div class="font-medium text-primary mb-2">${minimalExperiment.name || 'å®éªŒæ–¹æ¡ˆ'}</div>
              ${duration ? `<div class="text-sm text-muted mb-1">æ—¶é•¿ï¼š${duration}</div>` : ''}
              ${minimalExperiment.steps?.length ? `<ol class="text-sm text-secondary list-decimal list-inside">${minimalExperiment.steps.map(s => `<li>${s}</li>`).join('')}</ol>` : ''}
              ${successCriteria ? `<div class="text-xs text-success mt-2">æˆåŠŸæ ‡å‡†ï¼š${successCriteria}</div>` : ''}
            </div>
          </div>
        </div>`;
      }

      return html;
    }

    // æ¸²æŸ“è¯Šæ–­æŠ¥å‘Šå¡ç‰‡
    function renderDiagnosisReportCards(data) {
      let html = '';

      // ç›²åŒºæ¸…å• (æ”¯æŒ blindspot_list å’Œ blindspotList)
      const blindspotList = data.blindspotList || data.blindspot_list;
      if (blindspotList?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ” ç›²åŒºæ¸…å•</div>
          <div class="output-card-body space-y-2">`;

        blindspotList.forEach(blind => {
          const riskLevel = blind.riskLevel || blind.risk_level;
          const riskColor = riskLevel === 'highest' ? 'bg-error' : 'bg-warning';
          html += `<div class="card p-3 ${riskColor}">
            <div class="flex items-center justify-between mb-1">
              <span class="font-medium text-primary">${blind.description}</span>
              <span class="tag">${riskLevel === 'highest' ? 'ğŸ”´ æœ€é«˜' : 'ğŸŸ¡ ä¸­ç­‰'}</span>
            </div>
            <div class="text-sm text-muted">${blind.evidence || ''}</div>
          </div>`;
        });

        html += `</div></div>`;
      }

      // è®¤çŸ¥ CT æŠ¥å‘Š (æ”¯æŒ cognitive_ct_report å’Œ cognitiveCTReport)
      const cognitiveCTReport = data.cognitiveCTReport || data.cognitive_ct_report;
      if (cognitiveCTReport) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ”¬ è®¤çŸ¥ CT æŠ¥å‘Š</div>
          <div class="output-card-body">`;

        const dimensions = [
          { key: 'depth', name: 'æ·±åº¦', icon: 'ğŸ“' },
          { key: 'breadth', name: 'å¹¿åº¦', icon: 'ğŸŒ' },
          { key: 'speed', name: 'é€Ÿåº¦', icon: 'âš¡' },
          { key: 'originality', name: 'åŸåˆ›æ€§', icon: 'ğŸ’¡' }
        ];

        html += `<div class="grid grid-cols-2 gap-3">`;
        dimensions.forEach(dim => {
          const dimData = cognitiveCTReport[dim.key];
          if (dimData) {
            const score = dimData.score || dimData.level || '?';
            html += `<div class="card p-3">
              <div class="flex items-center gap-2 mb-1">
                <span>${dim.icon}</span>
                <span class="font-medium text-primary">${dim.name}</span>
                <span class="tag">${score}</span>
              </div>
              <div class="text-sm text-muted">${dimData.evidence || dimData.description || ''}</div>
            </div>`;
          }
        });
        html += `</div></div></div>`;
      }

      // è®­ç»ƒå¤„æ–¹ (æ”¯æŒ training_prescription å’Œ trainingPrescription)
      const trainingPrescription = data.trainingPrescription || data.training_prescription;
      if (trainingPrescription?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’Š è®­ç»ƒå¤„æ–¹</div>
          <div class="output-card-body space-y-3">`;

        trainingPrescription.forEach(rx => {
          const recommendedSources = rx.recommendedSources || rx.recommended_sources;
          const learningDosage = rx.learningDosage || rx.learning_dosage;
          html += `<div class="card p-3">
            <div class="font-medium text-primary mb-2">${rx.blindspot}</div>
            <div class="text-sm text-secondary">æ¨èæºå¤´ï¼š${recommendedSources?.join('ã€') || 'æ— '}</div>
            <div class="text-sm text-muted">å­¦ä¹ å‰‚é‡ï¼š${learningDosage || 'æ— '}</div>
          </div>`;
        });

        html += `</div></div>`;
      }

      // è®¤çŸ¥æŒ‡çº¹ (æ”¯æŒ cognitive_fingerprint å’Œ cognitiveFingerprint)
      const cognitiveFingerprint = data.cognitiveFingerprint || data.cognitive_fingerprint;
      if (cognitiveFingerprint) {
        const fp = cognitiveFingerprint;
        const cognitiveAdvantage = fp.cognitiveAdvantage || fp.cognitive_advantage;
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ†” è®¤çŸ¥æŒ‡çº¹</div>
          <div class="output-card-body">
            <div class="grid grid-cols-2 gap-3">
              <div class="card p-3">
                <div class="text-xs text-muted mb-1">è®¤çŸ¥ä¼˜åŠ¿</div>
                <div class="text-sm text-success">${cognitiveAdvantage || 'å¾…å‘ç°'}</div>
              </div>
              <div class="card p-3">
                <div class="text-xs text-muted mb-1">å·®å¼‚åŒ–å®šä½</div>
                <div class="text-sm text-accent">${fp.differentiation || 'å¾…å®šä½'}</div>
              </div>
            </div>
          </div>
        </div>`;
      }

      return html;
    }

    // æ¸²æŸ“æ–¹æ³•è®ºå¡ç‰‡
    function renderMethodologyCards(data) {
      let html = '';

      // è°ƒè¯•ï¼šæ‰“å°æ•°æ®ç»“æ„
      console.log('renderMethodologyCards data:', JSON.stringify(data, null, 2));

      // ä¸ªäººæ–¹æ³•è®º (æ”¯æŒ personal_methodology å’Œ personalMethodology)
      const personalMethodology = data.personalMethodology || data.personal_methodology;
      if (personalMethodology) {
        const pm = personalMethodology;
        const coreIdea = pm.coreIdea || pm.core_idea;
        const keySteps = pm.keySteps || pm.key_steps;
        const applicableScenarios = pm.applicableScenarios || pm.applicable_scenarios;
        html += `<div class="output-card">
          <div class="output-card-header">âœ¨ ${pm.name || 'ä¸ªäººæ–¹æ³•è®º'}</div>
          <div class="output-card-body">
            <div class="text-lg text-accent mb-3">${coreIdea || ''}</div>
            ${keySteps?.length ? `<div class="mb-3"><strong class="text-secondary">å…³é”®æ­¥éª¤ï¼š</strong><ol class="list-decimal list-inside text-muted">${keySteps.map(s => {
              const text = typeof s === 'string' ? s : (s.step || s.name || s.content || JSON.stringify(s));
              return `<li>${text}</li>`;
            }).join('')}</ol></div>` : ''}
            ${applicableScenarios?.length ? `<div class="text-sm text-muted">é€‚ç”¨åœºæ™¯ï¼š${applicableScenarios.map(s => typeof s === 'string' ? s : (s.name || s.scenario || JSON.stringify(s))).join('ã€')}</div>` : ''}
          </div>
        </div>`;
      }

      // ç‚¼é‡‘é…æ–¹ (æ”¯æŒå¤šç§ç»“æ„)
      const alchemyRecipe = data.alchemyRecipe || data.alchemy_recipe;
      console.log('alchemyRecipe:', JSON.stringify(alchemyRecipe, null, 2));
      if (alchemyRecipe) {
        html += `<div class="output-card">
          <div class="output-card-header">âš—ï¸ ç‚¼é‡‘é…æ–¹</div>
          <div class="output-card-body">`;

        // æ”¯æŒä¸¤ç§ç»“æ„ï¼š
        // ç»“æ„1ï¼ˆPromptå®šä¹‰ï¼‰: { type, formula, explanation }
        // ç»“æ„2ï¼ˆæ—§ç‰ˆï¼‰: { ingredients, process, uniqueOutput }

        const recipeType = alchemyRecipe.type;
        const formula = alchemyRecipe.formula;
        const explanation = alchemyRecipe.explanation;

        // å¦‚æœæ˜¯ Prompt å®šä¹‰çš„ç»“æ„
        if (recipeType || formula || explanation) {
          if (recipeType) {
            const typeMap = {
              'cross_domain': 'è·¨é¢†åŸŸè¿æ¥',
              'counter_intuitive': 'åå¸¸è¯†é‡æ„',
              'personal_experience': 'ä¸ªäººç»éªŒåŠ æŒ'
            };
            // å¤„ç†ç»„åˆç±»å‹ï¼ˆå¦‚ "counter_intuitive/personal_experience"ï¼‰
            const types = recipeType.split('/').map(t => t.trim());
            const mappedTypes = types.map(t => typeMap[t] || t);
            html += `<div class="mb-3"><strong class="text-secondary">é…æ–¹ç±»å‹ï¼š</strong>
              ${mappedTypes.map(t => `<span class="tag">${t}</span>`).join(' ')}
            </div>`;
          }
          if (formula) {
            html += `<div class="mb-3 card p-3 bg-accent">
              <div class="text-xs text-muted mb-1">ç‚¼é‡‘å…¬å¼</div>
              <div class="text-primary font-medium">${formula}</div>
            </div>`;
          }
          if (explanation) {
            html += `<div class="text-sm text-muted">${explanation}</div>`;
          }
        } else {
          // æ—§ç‰ˆç»“æ„
          const ingredients = alchemyRecipe.ingredients || alchemyRecipe.materials || alchemyRecipe.inputs || [];
          if (ingredients.length > 0) {
            html += `<div class="mb-3"><strong class="text-secondary">åŸæ–™ï¼š</strong>
              <div class="flex flex-wrap gap-2 mt-1">${ingredients.map(i => {
                const text = typeof i === 'string' ? i : (i.name || i.content || i.text || i.material || JSON.stringify(i));
                return `<span class="tag">${text}</span>`;
              }).join('')}</div>
            </div>`;
          }

          const process = alchemyRecipe.process || alchemyRecipe.steps || alchemyRecipe.procedure || [];
          if (process.length > 0) {
            html += `<div class="mb-3"><strong class="text-secondary">ç‚¼åˆ¶è¿‡ç¨‹ï¼š</strong>
              <ol class="list-decimal list-inside text-muted mt-1">${process.map(p => {
                const text = typeof p === 'string' ? p : (p.step || p.description || p.content || p.action || JSON.stringify(p));
                return `<li>${text}</li>`;
              }).join('')}</ol>
            </div>`;
          }

          const uniqueOutput = alchemyRecipe.uniqueOutput || alchemyRecipe.unique_output || alchemyRecipe.output || alchemyRecipe.result;
          if (uniqueOutput) {
            const outputText = typeof uniqueOutput === 'string' ? uniqueOutput : (uniqueOutput.content || uniqueOutput.text || uniqueOutput.description || JSON.stringify(uniqueOutput));
            html += `<div class="card p-3 bg-accent">
              <div class="text-xs text-muted mb-1">ç‹¬ç‰¹äº§å‡º</div>
              <div class="text-primary font-medium">${outputText}</div>
            </div>`;
          }

          // å¦‚æœéƒ½æ²¡åŒ¹é…åˆ°ï¼Œæ˜¾ç¤ºåŸå§‹æ•°æ®
          if (ingredients.length === 0 && process.length === 0 && !uniqueOutput) {
            html += `<div class="text-sm text-muted"><pre>${JSON.stringify(alchemyRecipe, null, 2)}</pre></div>`;
          }
        }

        html += `</div></div>`;
      }

      // å†…å®¹çŸ©é˜µ (æ”¯æŒå¤šç§ç»“æ„)
      const contentMatrix = data.contentMatrix || data.content_matrix;
      console.log('contentMatrix:', JSON.stringify(contentMatrix, null, 2));
      if (contentMatrix) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ“Š å†…å®¹çŸ©é˜µ</div>
          <div class="output-card-body grid grid-cols-2 gap-3">`;

        // æ”¯æŒä¸¤ç§ç»“æ„ï¼š
        // ç»“æ„1ï¼ˆPromptå®šä¹‰ï¼‰: { traffic_content: {type, example}, ... }
        // ç»“æ„2ï¼ˆæ—§ç‰ˆï¼‰: { trafficContent: ["å†…å®¹1", "å†…å®¹2"], ... }

        const matrixTypes = [
          { key: 'trafficContent', altKey: 'traffic_content', altKey2: 'traffic', name: 'å¼•æµå†…å®¹', icon: 'ğŸš€' },
          { key: 'trustContent', altKey: 'trust_content', altKey2: 'trust', name: 'å»ºä¿¡å†…å®¹', icon: 'ğŸ¤' },
          { key: 'conversionContent', altKey: 'conversion_content', altKey2: 'conversion', name: 'è½¬åŒ–å†…å®¹', icon: 'ğŸ’°' },
          { key: 'viralContent', altKey: 'viral_content', altKey2: 'viral', name: 'ä¼ æ’­å†…å®¹', icon: 'ğŸ“¢' }
        ];

        let hasContent = false;
        matrixTypes.forEach(mt => {
          const content = contentMatrix[mt.key] || contentMatrix[mt.altKey] || contentMatrix[mt.altKey2];
          if (content) {
            hasContent = true;
            html += `<div class="card p-3">
              <div class="font-medium text-primary mb-2">${mt.icon} ${mt.name}</div>`;

            // åˆ¤æ–­æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡
            if (Array.isArray(content)) {
              html += `<ul class="text-sm text-muted list-disc list-inside">${content.map(c => {
                const text = typeof c === 'string' ? c : (c.title || c.content || c.name || c.text || c.topic || JSON.stringify(c));
                return `<li>${text}</li>`;
              }).join('')}</ul>`;
            } else if (typeof content === 'object') {
              // Prompt å®šä¹‰çš„ç»“æ„: { type, example }
              const example = content.example || content.content || content.text || content.description;
              const contentType = content.type;
              if (example) {
                html += `<div class="text-sm text-muted">${example}</div>`;
              }
              if (contentType && contentType !== mt.name) {
                html += `<div class="text-xs text-secondary mt-1">${contentType}</div>`;
              }
              // å¦‚æœæ²¡æœ‰ example ä¹Ÿæ²¡æœ‰ typeï¼Œæ˜¾ç¤ºæ‰€æœ‰å­—æ®µ
              if (!example && !contentType) {
                const entries = Object.entries(content);
                if (entries.length > 0) {
                  html += `<div class="text-sm text-muted">${entries.map(([k, v]) => `${k}: ${v}`).join('<br>')}</div>`;
                }
              }
            } else if (typeof content === 'string') {
              html += `<div class="text-sm text-muted">${content}</div>`;
            }

            html += `</div>`;
          }
        });

        // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°æ ‡å‡†å­—æ®µï¼Œå°è¯•éå†æ‰€æœ‰å­—æ®µ
        if (!hasContent) {
          for (const [key, value] of Object.entries(contentMatrix)) {
            html += `<div class="card p-3">
              <div class="font-medium text-primary mb-2">${key}</div>`;

            if (Array.isArray(value) && value.length > 0) {
              html += `<ul class="text-sm text-muted list-disc list-inside">${value.map(c => {
                const text = typeof c === 'string' ? c : (c.title || c.content || c.name || c.text || JSON.stringify(c));
                return `<li>${text}</li>`;
              }).join('')}</ul>`;
            } else if (typeof value === 'object' && value !== null) {
              const example = value.example || value.content || value.text;
              if (example) {
                html += `<div class="text-sm text-muted">${example}</div>`;
              } else {
                html += `<div class="text-sm text-muted">${JSON.stringify(value)}</div>`;
              }
            } else if (typeof value === 'string') {
              html += `<div class="text-sm text-muted">${value}</div>`;
            }

            html += `</div>`;
          }
        }

        html += `</div></div>`;
      }

      // é‡‘å¥ (æ”¯æŒ golden_quotes å’Œ goldenQuotes)
      const goldenQuotes = data.goldenQuotes || data.golden_quotes;
      if (goldenQuotes?.length) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’ é‡‘å¥åº“</div>
          <div class="output-card-body space-y-2">`;

        goldenQuotes.forEach(quote => {
          // å¤„ç†å¤šç§æ ¼å¼ï¼šå­—ç¬¦ä¸²ã€{content: string}ã€{quote: string}
          let quoteText = '';
          let scenario = '';
          if (typeof quote === 'string') {
            quoteText = quote;
          } else if (typeof quote === 'object' && quote !== null) {
            quoteText = quote.content || quote.quote || quote.text || JSON.stringify(quote);
            scenario = quote.scenario || quote.scene || '';
          }
          html += `<div class="card p-3">
            <div class="text-lg italic text-accent">"${quoteText}"</div>
            ${scenario ? `<div class="text-xs text-muted mt-1">é€‚ç”¨åœºæ™¯ï¼š${scenario}</div>` : ''}
          </div>`;
        });

        html += `</div></div>`;
      }

      return html;
    }

    // æ¸²æŸ“äº§å“æ–¹æ¡ˆå¡ç‰‡
    function renderProductPlanCards(data) {
      let html = '';

      // ä»·å€¼è¯Šæ–­ (æ”¯æŒå¤šç§å­—æ®µå)
      const valueDiagnosis = data.valueDiagnosis || data.value_diagnosis;
      if (valueDiagnosis) {
        const painPoints = valueDiagnosis.painPoints || valueDiagnosis.pain_points;
        const targetAudience = valueDiagnosis.targetAudience || valueDiagnosis.target_audience;
        const problemSolved = valueDiagnosis.problemSolved || valueDiagnosis.problem_solved;
        const painLevel = valueDiagnosis.painLevel || valueDiagnosis.pain_level;
        const marketSize = valueDiagnosis.marketSize || valueDiagnosis.market_size;
        const willingnessToPay = valueDiagnosis.willingnessToPay || valueDiagnosis.willingness_to_pay;
        const competitorAnalysis = valueDiagnosis.competitorAnalysis || valueDiagnosis.competitor_analysis;
        const differentiation = valueDiagnosis.differentiation;

        html += `<div class="output-card">
          <div class="output-card-header">ğŸ¯ ä»·å€¼è¯Šæ–­</div>
          <div class="output-card-body space-y-3">`;

        // ç›®æ ‡äººç¾¤ï¼ˆæ—§å­—æ®µï¼‰
        if (targetAudience) {
          html += `<div><strong class="text-secondary">ç›®æ ‡äººç¾¤ï¼š</strong><span class="text-primary">${targetAudience}</span></div>`;
        }

        // è§£å†³çš„é—®é¢˜ï¼ˆæ–°å­—æ®µï¼‰
        if (problemSolved) {
          html += `<div><strong class="text-secondary">è§£å†³çš„é—®é¢˜ï¼š</strong><span class="text-primary">${problemSolved}</span></div>`;
        }

        // ç—›ç‚¹ç­‰çº§ï¼ˆæ–°å­—æ®µï¼‰
        if (painLevel) {
          html += `<div><strong class="text-secondary">ç—›ç‚¹ç­‰çº§ï¼š</strong><span class="tag">${painLevel}/10</span></div>`;
        }

        // å¸‚åœºè§„æ¨¡ï¼ˆæ–°å­—æ®µï¼‰
        if (marketSize) {
          html += `<div><strong class="text-secondary">å¸‚åœºè§„æ¨¡ï¼š</strong><span class="text-muted">${marketSize}</span></div>`;
        }

        // æ”¯ä»˜æ„æ„¿ï¼ˆæ–°å­—æ®µï¼‰
        if (willingnessToPay) {
          html += `<div class="card p-3"><strong class="text-secondary mb-2 block">æ”¯ä»˜æ„æ„¿ï¼š</strong>
            <div class="grid grid-cols-3 gap-2 text-sm">
              <div><span class="text-muted">ä½ï¼š</span><span class="text-primary">${willingnessToPay.low || '-'}</span></div>
              <div><span class="text-muted">ä¸­ï¼š</span><span class="text-primary">${willingnessToPay.medium || '-'}</span></div>
              <div><span class="text-muted">é«˜ï¼š</span><span class="text-primary">${willingnessToPay.high || '-'}</span></div>
            </div>
          </div>`;
        }

        // ç«å“åˆ†æï¼ˆæ–°å­—æ®µï¼‰
        if (competitorAnalysis?.length) {
          html += `<div><strong class="text-secondary">ç«å“åˆ†æï¼š</strong>
            <div class="space-y-2 mt-2">${competitorAnalysis.map(c => `
              <div class="card p-2 text-sm">
                <span class="text-primary font-medium">${c.name}</span>
                <span class="text-muted ml-2">${c.price || ''}</span>
                ${c.weakness ? `<div class="text-xs text-warning mt-1">å¼±ç‚¹ï¼š${c.weakness}</div>` : ''}
              </div>
            `).join('')}</div>
          </div>`;
        }

        // å·®å¼‚åŒ–ä¼˜åŠ¿ï¼ˆæ–°å­—æ®µï¼‰
        if (differentiation) {
          html += `<div class="card p-3 bg-accent"><strong class="text-secondary">å·®å¼‚åŒ–ä¼˜åŠ¿ï¼š</strong>
            <div class="text-primary mt-1">${differentiation}</div>
          </div>`;
        }

        // ç—›ç‚¹åˆ—è¡¨ï¼ˆæ—§å­—æ®µï¼‰
        if (painPoints?.length) {
          html += `<div><strong class="text-secondary">ç—›ç‚¹ï¼š</strong><ul class="list-disc list-inside text-muted">${painPoints.map(p => `<li>${p}</li>`).join('')}</ul></div>`;
        }

        html += `</div></div>`;
      }

      // äº§å“çŸ©é˜µ (æ”¯æŒ product_matrix å’Œ productMatrix)
      const productMatrix = data.productMatrix || data.product_matrix;
      if (productMatrix) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ“¦ äº§å“çŸ©é˜µ</div>
          <div class="output-card-body grid grid-cols-1 md:grid-cols-3 gap-3">`;

        const products = [
          { key: 'trafficProduct', altKey: 'traffic_product', name: 'å¼•æµäº§å“', color: 'text-info' },
          { key: 'mainProduct', altKey: 'main_product', name: 'ä¸»åŠ›äº§å“', color: 'text-success' },
          { key: 'premiumProduct', altKey: 'premium_product', name: 'é«˜ç«¯äº§å“', color: 'text-accent' }
        ];

        products.forEach(p => {
          const prod = productMatrix[p.key] || productMatrix[p.altKey];
          if (prod) {
            html += `<div class="card p-3">
              <div class="font-medium ${p.color} mb-2">${p.name}</div>
              <div class="text-primary">${prod.name || ''}</div>
              <div class="text-lg font-bold text-accent">${prod.price || ''}</div>
              <div class="text-sm text-muted">${prod.purpose || prod.description || ''}</div>
            </div>`;
          }
        });

        html += `</div></div>`;
      }

      // å–ç‚¹ (æ”¯æŒ selling_points å’Œ sellingPoints)
      const sellingPoints = data.sellingPoints || data.selling_points;
      if (sellingPoints) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’¡ æ ¸å¿ƒå–ç‚¹</div>
          <div class="output-card-body">
            <div class="card p-4 bg-accent text-center">
              <div class="text-lg font-bold text-primary">${sellingPoints.core || sellingPoints.main || ''}</div>
            </div>
            ${sellingPoints.supporting?.length ? `<div class="mt-3 flex flex-wrap gap-2">${sellingPoints.supporting.map(s => `<span class="tag">${s}</span>`).join('')}</div>` : ''}
          </div>
        </div>`;
      }

      // é”€å”®å‰§æœ¬ (æ”¯æŒ sales_script å’Œ salesScript)
      const salesScript = data.salesScript || data.sales_script;
      if (salesScript) {
        html += `<div class="output-card">
          <div class="output-card-header">ğŸ¬ é”€å”®å‰§æœ¬</div>
          <div class="output-card-body space-y-2">
            <div class="card p-3"><strong class="text-accent">å¼€åœºï¼š</strong><span class="text-secondary">${salesScript.opening || ''}</span></div>
            <div class="card p-3"><strong class="text-accent">æ–¹æ¡ˆï¼š</strong><span class="text-secondary">${salesScript.solution || ''}</span></div>
            <div class="card p-3"><strong class="text-accent">ä¿ƒå•ï¼š</strong><span class="text-secondary">${salesScript.closing || ''}</span></div>
          </div>
        </div>`;
      }

      // å®šä»·ç­–ç•¥ (æ”¯æŒå¤šç§å­—æ®µå)
      const pricingStrategy = data.pricingStrategy || data.pricing_strategy;
      if (pricingStrategy) {
        const method = pricingStrategy.method;
        const priceAnchor = pricingStrategy.priceAnchor || pricingStrategy.price_anchor;
        const finalPrice = pricingStrategy.finalPrice || pricingStrategy.final_price;
        const reasoning = pricingStrategy.reasoning || pricingStrategy.rationale || pricingStrategy.description;
        const anchoring = pricingStrategy.anchoring;

        html += `<div class="output-card">
          <div class="output-card-header">ğŸ’° å®šä»·ç­–ç•¥</div>
          <div class="output-card-body space-y-3">`;

        // å®šä»·æ–¹æ³•ï¼ˆæ–°å­—æ®µï¼‰
        if (method) {
          html += `<div><strong class="text-secondary">å®šä»·æ–¹æ³•ï¼š</strong><span class="text-primary">${method}</span></div>`;
        }

        // æœ€ç»ˆå®šä»·ï¼ˆæ–°å­—æ®µï¼‰
        if (finalPrice) {
          html += `<div class="card p-3 bg-accent text-center">
            <div class="text-xs text-muted mb-1">æœ€ç»ˆå®šä»·</div>
            <div class="text-xl font-bold text-primary">${finalPrice}</div>
          </div>`;
        }

        // ä»·æ ¼é”šç‚¹ï¼ˆæ–°å­—æ®µï¼‰
        if (priceAnchor) {
          html += `<div><strong class="text-secondary">ä»·æ ¼é”šç‚¹ï¼š</strong><span class="text-muted">${priceAnchor}</span></div>`;
        }

        // é”šå®šç­–ç•¥ï¼ˆæ—§å­—æ®µï¼‰
        if (anchoring && anchoring !== priceAnchor) {
          html += `<div><strong class="text-secondary">é”šå®šç­–ç•¥ï¼š</strong><span class="text-muted">${anchoring}</span></div>`;
        }

        // å®šä»·ç†ç”±ï¼ˆå…¼å®¹æ–°æ—§å­—æ®µï¼‰
        if (reasoning) {
          html += `<div><strong class="text-secondary">å®šä»·ç†ç”±ï¼š</strong><div class="text-muted mt-1">${reasoning}</div></div>`;
        }

        html += `</div></div>`;
      }

      return html;
    }

    // æ˜¾ç¤º Toast
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      if (!container) return;

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // æ›´æ–°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
    function updateThemeToggle() {
      const settings = loadSettings();
      const icon = document.getElementById('theme-icon');
      const dot = document.getElementById('theme-toggle-dot');

      if (icon) icon.textContent = settings.theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
      if (dot) dot.style.transform = settings.theme === 'dark' ? 'translateX(24px)' : 'translateX(0)';
    }
  </script>
  <script>
    // ========================================
    // äº‹ä»¶å¤„ç†å’Œåˆå§‹åŒ–
    // ========================================

    // é€‰æ‹© Mode
    function selectMode(modeId) {
      STATE.currentMode = modeId;
      STATE.selectedRecommendations = [];

      // æ¸…é™¤æ¨èç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°ç”Ÿæˆ
      clearRecommendationCache();

      document.getElementById('zero-state')?.classList.add('hidden');
      document.getElementById('main-view')?.classList.remove('hidden');
      document.getElementById('output-area')?.classList.add('hidden');

      renderModeSelector();
      renderCurrentModeInfo();
      renderInputForm();
      renderRecommendPanel();
    }

    // è¿”å›é›¶æ€
    function backToZeroState() {
      STATE.currentMode = null;
      document.getElementById('zero-state')?.classList.remove('hidden');
      document.getElementById('main-view')?.classList.add('hidden');
    }

    // æ”¶é›†è¾“å…¥
    function collectInputs() {
      const mode = MODES[STATE.currentMode];
      if (!mode) return {};

      const inputs = {};
      for (const field of mode.inputs) {
        const el = document.getElementById(`input-${field.key}`);
        if (el) inputs[field.key] = el.value.trim();
      }
      return inputs;
    }

    // æ¸…ç©ºè¾“å…¥
    function clearInputs() {
      const mode = MODES[STATE.currentMode];
      if (!mode) return;

      for (const field of mode.inputs) {
        const el = document.getElementById(`input-${field.key}`);
        if (el) el.value = '';
      }
    }

    // è®¾ç½®åŠ è½½çŠ¶æ€
    function setLoading(loading) {
      STATE.isLoading = loading;
      const btn = document.getElementById('submit-btn');
      const text = document.getElementById('submit-text');
      const spinner = document.getElementById('submit-spinner');

      if (btn) btn.disabled = loading;
      if (text) text.textContent = loading ? 'åˆ†æä¸­' : 'å¼€å§‹åˆ†æ';
      if (spinner) spinner.classList.toggle('hidden', !loading);
    }

    // æ˜¾ç¤ºè¾“å‡ºåŒº
    function showOutputArea() {
      const area = document.getElementById('output-area');
      const stream = document.getElementById('stream-output');
      const structured = document.getElementById('structured-output');

      if (area) area.classList.remove('hidden');
      if (stream) stream.innerHTML = '<p class="text-muted">æ­£åœ¨æ€è€ƒ<span class="loading-dots"></span></p>';
      if (structured) structured.classList.add('hidden');

      // ç«‹å³æ¸²æŸ“ã€Œç”¨è¿™ä¸ªç»“æœç»§ç»­ã€æŒ‰é’®
      renderContinueOptions();
    }

    // åˆ‡æ¢æ¨èé¡¹é€‰ä¸­çŠ¶æ€ï¼ˆå¹¶è‡ªåŠ¨å¡«å…¥è¾“å…¥æ¡†ï¼‰
    function toggleRecommendation(recId) {
      // ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ¨èåˆ—è¡¨ï¼ˆä¸é‡æ–°ç”Ÿæˆï¼‰
      const recommendations = _recommendationCache.recommendations;
      const rec = recommendations.find(r => r.id === recId);
      if (rec) {
        rec.selected = !rec.selected;
        STATE.selectedRecommendations = recommendations.filter(r => r.selected);
        renderRecommendPanel();

        // è‡ªåŠ¨å¡«å…¥è¾“å…¥æ¡†
        autoFillInputFromRecommendations();
      }
    }

    // è‡ªåŠ¨å¡«å…¥è¾“å…¥æ¡†ï¼ˆæ ¹æ®é€‰ä¸­çš„æ¨èï¼‰
    function autoFillInputFromRecommendations() {
      const mode = MODES[STATE.currentMode];
      if (!mode) return;

      // æ ¹æ®å½“å‰ Mode å’Œæ¨èç±»å‹ï¼Œæ™ºèƒ½å¡«å…¥å¯¹åº”è¾“å…¥æ¡†
      const inputMapping = MODE_CONSUME_MATRIX[STATE.currentMode]?.inputMapping || {};

      // æ”¶é›†è¦å¡«å…¥çš„æ•°æ®
      const fillData = {};

      for (const rec of STATE.selectedRecommendations) {
        // æ‰¾åˆ°è¿™ä¸ªæ¨èç±»å‹åº”è¯¥å¡«å…¥å“ªä¸ªè¾“å…¥æ¡†
        let matched = false;
        for (const [inputKey, types] of Object.entries(inputMapping)) {
          if (types.includes(rec.type)) {
            // ç´¯åŠ åˆ°å¯¹åº”è¾“å…¥æ¡†
            if (!fillData[inputKey]) fillData[inputKey] = [];
            fillData[inputKey].push(rec.name);
            matched = true;
          }
        }
        // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ° inputMappingï¼Œå°è¯•å¡«å…¥ç¬¬ä¸€ä¸ª textarea ç±»å‹çš„è¾“å…¥æ¡†
        if (!matched) {
          const textareaInput = mode.inputs.find(f => f.type === 'textarea');
          if (textareaInput) {
            if (!fillData[textareaInput.key]) fillData[textareaInput.key] = [];
            fillData[textareaInput.key].push(rec.name);
          }
        }
      }

      // å¡«å…¥è¾“å…¥æ¡†
      for (const [inputKey, values] of Object.entries(fillData)) {
        const el = document.getElementById(`input-${inputKey}`);
        if (el) {
          el.value = values.join('ã€');
        }
      }

      // å¦‚æœæ²¡æœ‰åŒ¹é…çš„è¾“å…¥æ¡†ï¼Œå°è¯•å¡«å…¥ç¬¬ä¸€ä¸ªå¿…å¡«è¾“å…¥æ¡†
      if (Object.keys(fillData).length === 0 && STATE.selectedRecommendations.length > 0) {
        const firstRequiredInput = mode.inputs.find(f => f.required);
        if (firstRequiredInput) {
          const el = document.getElementById(`input-${firstRequiredInput.key}`);
          if (el) {
            el.value = STATE.selectedRecommendations.map(r => r.name).join('ã€');
          }
        }
      }

      // å¦‚æœå–æ¶ˆäº†æ‰€æœ‰é€‰æ‹©ï¼Œæ¸…ç©ºå¯¹åº”çš„è¾“å…¥æ¡†
      if (STATE.selectedRecommendations.length === 0) {
        // æ¸…ç©º inputMapping ä¸­å®šä¹‰çš„è¾“å…¥æ¡†
        for (const [inputKey, types] of Object.entries(inputMapping)) {
          const el = document.getElementById(`input-${inputKey}`);
          if (el) el.value = '';
        }
        // ä¹Ÿæ¸…ç©º textarea ç±»å‹çš„è¾“å…¥æ¡†
        const textareaInput = mode.inputs.find(f => f.type === 'textarea');
        if (textareaInput) {
          const el = document.getElementById(`input-${textareaInput.key}`);
          if (el) el.value = '';
        }
      }
    }

    // è®¾ç½®æ¨èé¡¹çº§åˆ«
    function setRecommendLevel(recId, level) {
      // åœ¨ selectedRecommendations ä¸­æŸ¥æ‰¾
      const rec = STATE.selectedRecommendations.find(r => r.id === recId);
      if (rec) {
        rec.contentLevel = level;
      }
      // åŒæ—¶æ›´æ–°æ¨èåˆ—è¡¨ä¸­çš„çº§åˆ«ï¼ˆç”¨äºä¸‹æ¬¡æ¸²æŸ“ï¼‰
      renderRecommendPanel();
    }

    // åº”ç”¨é€‰ä¸­çš„æ¨èï¼ˆè‡ªåŠ¨å¡«å…¥è¾“å…¥æ¡†ï¼‰
    function applySelectedRecommendations() {
      if (STATE.selectedRecommendations.length === 0) {
        showToast('è¯·å…ˆé€‰æ‹©è¦ä½¿ç”¨çš„æ¨è', 'warning');
        return;
      }

      const mode = MODES[STATE.currentMode];
      if (!mode) return;

      // æ ¹æ®å½“å‰ Mode å’Œæ¨èç±»å‹ï¼Œæ™ºèƒ½å¡«å…¥å¯¹åº”è¾“å…¥æ¡†
      const inputMapping = MODE_CONSUME_MATRIX[STATE.currentMode]?.inputMapping || {};

      // æ”¶é›†è¦å¡«å…¥çš„æ•°æ®
      const fillData = {};

      for (const rec of STATE.selectedRecommendations) {
        // æ‰¾åˆ°è¿™ä¸ªæ¨èç±»å‹åº”è¯¥å¡«å…¥å“ªä¸ªè¾“å…¥æ¡†
        for (const [inputKey, types] of Object.entries(inputMapping)) {
          if (types.includes(rec.type)) {
            // ç´¯åŠ åˆ°å¯¹åº”è¾“å…¥æ¡†
            if (!fillData[inputKey]) fillData[inputKey] = [];

            // æ ¹æ®å†…å®¹çº§åˆ«æ„å»ºå¡«å…¥å†…å®¹
            let content = rec.name;
            if (rec.domain) content += `ï¼ˆ${rec.domain}ï¼‰`;
            if (rec.contentLevel !== 'L1' && rec.summary) {
              content += `ï¼š${rec.summary}`;
            }
            fillData[inputKey].push(content);
          }
        }
      }

      // å¡«å…¥è¾“å…¥æ¡†
      let filledCount = 0;
      for (const [inputKey, values] of Object.entries(fillData)) {
        const el = document.getElementById(`input-${inputKey}`);
        if (el) {
          // å¦‚æœè¾“å…¥æ¡†å·²æœ‰å†…å®¹ï¼Œè¿½åŠ ï¼›å¦åˆ™ç›´æ¥å¡«å…¥
          const existingValue = el.value.trim();
          const newValue = values.join('ã€');

          if (existingValue) {
            el.value = existingValue + 'ã€' + newValue;
          } else {
            el.value = newValue;
          }
          filledCount++;
        }
      }

      // å¦‚æœæ²¡æœ‰åŒ¹é…çš„è¾“å…¥æ¡†ï¼Œå°è¯•å¡«å…¥ç¬¬ä¸€ä¸ªå¿…å¡«è¾“å…¥æ¡†
      if (filledCount === 0 && STATE.selectedRecommendations.length > 0) {
        const firstRequiredInput = mode.inputs.find(f => f.required);
        if (firstRequiredInput) {
          const el = document.getElementById(`input-${firstRequiredInput.key}`);
          if (el) {
            const content = STATE.selectedRecommendations.map(r => {
              let text = r.name;
              if (r.domain) text += `ï¼ˆ${r.domain}ï¼‰`;
              return text;
            }).join('ã€');

            const existingValue = el.value.trim();
            el.value = existingValue ? existingValue + 'ã€' + content : content;
            filledCount++;
          }
        }
      }

      if (filledCount > 0) {
        showToast(`å·²å°† ${STATE.selectedRecommendations.length} ä¸ªæ¨èå¡«å…¥è¾“å…¥æ¡†`, 'success');
      } else {
        showToast('æ¨èæ•°æ®å·²è®°å½•ï¼Œå°†åœ¨åˆ†ææ—¶ä½¿ç”¨', 'info');
      }
    }

    // æ¸…é™¤æ¨è
    function clearRecommendations() {
      clearAllRecommendations();
    }

    // åˆ‡æ¢æ¨èé¢æ¿ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
    function toggleRecommendPanel() {
      toggleRecommendExpand();
    }

    // å¤åˆ¶è¾“å‡º
    function copyOutput() {
      if (STATE.lastAIResponse) {
        navigator.clipboard.writeText(STATE.lastAIResponse);
        showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
      }
    }

    // ä¿å­˜åˆ°èµ„äº§åº“
    function saveToAssets() {
      console.log('saveToAssets called');
      console.log('STATE.lastParsedOutput:', STATE.lastParsedOutput);
      console.log('STATE.currentMode:', STATE.currentMode);

      if (!STATE.lastParsedOutput || !STATE.currentMode) {
        showToast('æ²¡æœ‰å¯ä¿å­˜çš„å†…å®¹', 'warning');
        return;
      }

      const mode = MODES[STATE.currentMode];
      if (!mode) {
        showToast('å½“å‰åœºæ™¯æ— æ•ˆ', 'warning');
        return;
      }

      const parsed = STATE.lastParsedOutput;

      // æ™ºèƒ½æå–èµ„äº§æ•°æ®ï¼šæ”¯æŒå¤šç§ JSON ç»“æ„å’Œå‘½åé£æ ¼
      // ç»“æ„1: { result: { cognitiveMap: {...} } }
      // ç»“æ„2: { cognitiveMap: {...} }
      // ç»“æ„3: { result: {...} } ç›´æ¥æ˜¯èµ„äº§æ•°æ®
      // ç»“æ„4: { cognitive_map: {...} } snake_case å‘½å
      let assetData = null;

      // æ ¹æ®å½“å‰ Mode çš„ assetType æŸ¥æ‰¾å¯¹åº”æ•°æ®ï¼ˆæ”¯æŒ camelCase å’Œ snake_caseï¼‰
      const assetTypeKey = mode.assetType;
      const assetKeyMap = {
        'cognitiveMap': ['cognitiveMap', 'cognitive_map'],
        'techniqueCard': ['techniqueCard', 'technique_card'],
        'transferPlan': ['transferPlan', 'transfer_plan'],
        'diagnosisReport': ['diagnosisReport', 'diagnosis_report'],
        'methodology': ['methodology', 'personal_methodology', 'personalMethodology'],
        'productPlan': ['productPlan', 'product_plan']
      };
      const expectedKeys = assetKeyMap[assetTypeKey] || [assetTypeKey];

      // ç‰¹å¾å­—æ®µæ˜ å°„ï¼ˆç”¨äºè¯†åˆ«æ•°æ®ç±»å‹ï¼‰
      const featureFields = {
        'cognitiveMap': ['sourceGalaxy', 'source_galaxy', 'learningPaths', 'learning_paths', 'leveragePoint', 'leverage_point'],
        'techniqueCard': ['techniques', 'fourLayerReport', 'four_layer_report', 'targetName', 'target_name'],
        'transferPlan': ['dnaPrinciple', 'dna_principle', 'mappingTable', 'mapping_table', 'variants'],
        'diagnosisReport': ['blindspotList', 'blindspot_list', 'cognitiveFingerprint', 'cognitive_fingerprint', 'trainingPrescription', 'training_prescription'],
        'methodology': ['personalMethodology', 'personal_methodology', 'contentMatrix', 'content_matrix', 'goldenQuotes', 'golden_quotes', 'alchemyRecipe', 'alchemy_recipe'],
        'productPlan': ['productMatrix', 'product_matrix', 'salesScript', 'sales_script', 'sellingPoints', 'selling_points', 'valueDiagnosis', 'value_diagnosis']
      };

      // å°è¯•å¤šç§è·¯å¾„æå–
      for (const key of expectedKeys) {
        if (parsed.result && parsed.result[key]) {
          assetData = parsed.result[key];
          break;
        } else if (parsed[key]) {
          assetData = parsed[key];
          break;
        }
      }

      // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œæ£€æŸ¥ result æˆ– parsed æœ¬èº«æ˜¯å¦åŒ…å«ç‰¹å¾å­—æ®µ
      if (!assetData) {
        const features = featureFields[assetTypeKey] || [];
        const checkObj = parsed.result || parsed;
        if (typeof checkObj === 'object' && features.some(f => checkObj[f])) {
          assetData = checkObj;
        }
      }

      // æœ€åå°è¯•ï¼šå¦‚æœ result å­˜åœ¨ä¸”æ˜¯å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨
      if (!assetData && parsed.result && typeof parsed.result === 'object') {
        assetData = parsed.result;
      }

      // æœ€åå°è¯•ï¼šparsed æœ¬èº«å°±æ˜¯èµ„äº§æ•°æ®
      if (!assetData && typeof parsed === 'object' && !parsed.result) {
        assetData = parsed;
      }

      if (!assetData || Object.keys(assetData).length === 0) {
        showToast('è§£æç»“æœä¸ºç©ºï¼Œè¯·æ£€æŸ¥ AI è¾“å‡ºæ ¼å¼', 'warning');
        console.error('æ— æ³•æå–èµ„äº§æ•°æ®ï¼ŒåŸå§‹æ•°æ®:', parsed);
        return;
      }

      const saved = addAsset(mode.assetType, assetData);
      console.log('ä¿å­˜ç»“æœ:', saved);

      if (saved) {
        showToast(`å·²ä¿å­˜åˆ°ã€Œ${mode.assetName}ã€`, 'success');
        // åˆ·æ–°æ¨èé¢æ¿
        renderRecommendPanel();
      } else {
        showToast('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
      }
    }

    // å‰å¾€ä¸‹ä¸€æ­¥
    function goToNextStep() {
      if (STATE.lastParsedOutput?.nextStep?.recommendedMode) {
        selectMode(STATE.lastParsedOutput.nextStep.recommendedMode);
      }
    }

    // æ˜¾ç¤ºèµ„äº§åº“å¼¹çª—
    function showAssetModal() {
      document.getElementById('asset-modal')?.classList.add('active');
      renderAssetList();
    }

    // éšè—èµ„äº§åº“å¼¹çª—
    function hideAssetModal() {
      document.getElementById('asset-modal')?.classList.remove('active');
    }

    // ç­›é€‰èµ„äº§
    function filterAssets(filter) {
      document.querySelectorAll('#asset-tabs .tag').forEach(btn => {
        btn.classList.toggle('tag-active', btn.dataset.tab === filter);
      });
      renderAssetList(filter);
    }

    // æ˜¾ç¤ºèµ„äº§è¯¦æƒ…
    function showAssetDetail(assetType, assetId) {
      const assets = loadAssets();
      const asset = assets[assetType]?.find(a => a.id === assetId);
      if (!asset) return;

      STATE.currentAssetId = assetId;
      STATE.currentAssetType = assetType;

      const title = document.getElementById('asset-detail-title');
      const meta = document.getElementById('asset-detail-meta');
      const content = document.getElementById('asset-detail-content');

      if (title) title.textContent = getAssetTitle(asset);
      if (meta) {
        const typeInfo = ASSET_TYPES[assetType];
        const date = new Date(asset.createdAt).toLocaleDateString('zh-CN');
        meta.innerHTML = `
          <span class="tag">${typeInfo?.icon} ${typeInfo?.name}</span>
          <span class="tag">${date}</span>
        `;
      }
      if (content) {
        // ä½¿ç”¨ç¾è§‚çš„å¡ç‰‡å±•ç¤ºè€Œé JSON
        content.innerHTML = renderAssetDetailCards(assetType, asset);
      }

      document.getElementById('asset-detail-modal')?.classList.add('active');
    }

    // æ¸²æŸ“èµ„äº§è¯¦æƒ…å¡ç‰‡
    function renderAssetDetailCards(assetType, asset) {
      switch (assetType) {
        case 'cognitiveMap':
          return renderCognitiveMapDetailCards(asset);
        case 'techniqueCard':
          return renderTechniqueCardDetailCards(asset);
        case 'transferPlan':
          return renderTransferPlanDetailCards(asset);
        case 'diagnosisReport':
          return renderDiagnosisReportDetailCards(asset);
        case 'methodology':
          return renderMethodologyDetailCards(asset);
        case 'productPlan':
          return renderProductPlanDetailCards(asset);
        default:
          return `<pre class="text-sm text-muted">${JSON.stringify(asset, null, 2)}</pre>`;
      }
    }

    // è®¤çŸ¥åœ°å›¾è¯¦æƒ…å¡ç‰‡
    function renderCognitiveMapDetailCards(asset) {
      let html = '';

      if (asset.domain) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-1">å­¦ä¹ é¢†åŸŸ</div>
          <div class="text-lg font-medium text-primary">${asset.domain}</div>
        </div>`;
      }

      if (asset.leveragePoint) {
        html += `<div class="card p-3 mb-3 bg-accent">
          <div class="text-xs text-muted mb-1">æ æ†ç‚¹</div>
          <div class="text-accent font-medium">${asset.leveragePoint}</div>
        </div>`;
      }

      if (asset.sourceGalaxy?.coreStar?.length) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸŒŸ æ ¸å¿ƒæ’æ˜Ÿ</div>
          <div class="space-y-2">
            ${asset.sourceGalaxy.coreStar.map(star => `
              <div class="p-2 bg-surface rounded">
                <div class="font-medium text-primary">${star.name}</div>
                <div class="text-sm text-secondary">${star.contribution || ''}</div>
                ${star.works?.length ? `<div class="text-xs text-muted mt-1">ä»£è¡¨ä½œï¼š${star.works.join('ã€')}</div>` : ''}
              </div>
            `).join('')}
          </div>
        </div>`;
      }

      if (asset.learningPaths) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ›¤ï¸ å­¦ä¹ è·¯å¾„</div>
          <div class="grid grid-cols-3 gap-2">
            ${asset.learningPaths.quick?.length ? `<div class="p-2 bg-surface rounded"><div class="text-warning text-xs mb-1">âš¡ é€Ÿæˆ</div><ol class="text-xs text-muted list-decimal list-inside">${asset.learningPaths.quick.map(s => `<li>${s}</li>`).join('')}</ol></div>` : ''}
            ${asset.learningPaths.solid?.length ? `<div class="p-2 bg-surface rounded"><div class="text-success text-xs mb-1">ğŸ“š æ‰å®</div><ol class="text-xs text-muted list-decimal list-inside">${asset.learningPaths.solid.map(s => `<li>${s}</li>`).join('')}</ol></div>` : ''}
            ${asset.learningPaths.expert?.length ? `<div class="p-2 bg-surface rounded"><div class="text-accent text-xs mb-1">ğŸ¯ ç²¾é€š</div><ol class="text-xs text-muted list-decimal list-inside">${asset.learningPaths.expert.map(s => `<li>${s}</li>`).join('')}</ol></div>` : ''}
          </div>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // æŠ€æ³•å¡ç‰‡è¯¦æƒ…
    function renderTechniqueCardDetailCards(asset) {
      let html = '';

      if (asset.targetName) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-1">è§£å‰–å¯¹è±¡</div>
          <div class="text-lg font-medium text-primary">${asset.targetName}</div>
          ${asset.targetType ? `<div class="text-sm text-secondary">${asset.targetType}</div>` : ''}
        </div>`;
      }

      if (asset.techniques?.length) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ¯ æå–çš„æŠ€æ³•</div>
          <div class="space-y-2">
            ${asset.techniques.map(tech => `
              <div class="p-2 bg-surface rounded">
                <div class="flex items-center justify-between mb-1">
                  <span class="font-medium text-primary">${tech.name}</span>
                  <span class="tag tag-sm">${tech.sourceLevel || 'L1'}</span>
                </div>
                ${tech.triggerCondition ? `<div class="text-xs text-secondary">${tech.triggerCondition}</div>` : ''}
                ${tech.steps?.length ? `<div class="text-xs text-muted mt-1">æ­¥éª¤ï¼š${tech.steps.join(' â†’ ')}</div>` : ''}
              </div>
            `).join('')}
          </div>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // è¿ç§»æ–¹æ¡ˆè¯¦æƒ…
    function renderTransferPlanDetailCards(asset) {
      let html = '';

      if (asset.sourceTechnique || asset.targetScenario) {
        html += `<div class="card p-3 mb-3">
          <div class="flex items-center gap-2">
            <div class="flex-1 p-2 bg-surface rounded text-center">
              <div class="text-xs text-muted">æºæŠ€æ³•</div>
              <div class="font-medium text-primary">${asset.sourceTechnique || '-'}</div>
            </div>
            <span class="text-2xl">â†’</span>
            <div class="flex-1 p-2 bg-surface rounded text-center">
              <div class="text-xs text-muted">ç›®æ ‡åœºæ™¯</div>
              <div class="font-medium text-accent">${asset.targetScenario || '-'}</div>
            </div>
          </div>
        </div>`;
      }

      if (asset.dnaPrinciple) {
        html += `<div class="card p-3 mb-3 bg-accent">
          <div class="text-xs text-muted mb-1">ğŸ§¬ DNA åŸåˆ™</div>
          <div class="text-accent font-medium">${asset.dnaPrinciple}</div>
        </div>`;
      }

      if (asset.mappingTable?.length) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ”„ æ˜ å°„è¡¨</div>
          <table class="w-full text-sm">
            <tbody>
              ${asset.mappingTable.map(m => `<tr><td class="p-1 text-secondary">${m.sourceElement}</td><td class="p-1">â†’</td><td class="p-1 text-primary">${m.targetElement}</td></tr>`).join('')}
            </tbody>
          </table>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // è¯Šæ–­æŠ¥å‘Šè¯¦æƒ…
    function renderDiagnosisReportDetailCards(asset) {
      let html = '';

      if (asset.cognitiveFingerprint) {
        const fp = asset.cognitiveFingerprint;
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ†” è®¤çŸ¥æŒ‡çº¹</div>
          <div class="grid grid-cols-2 gap-2">
            <div class="p-2 bg-surface rounded">
              <div class="text-xs text-muted">è®¤çŸ¥ä¼˜åŠ¿</div>
              <div class="text-sm text-success">${fp.cognitiveAdvantage || 'å¾…å‘ç°'}</div>
            </div>
            <div class="p-2 bg-surface rounded">
              <div class="text-xs text-muted">å·®å¼‚åŒ–å®šä½</div>
              <div class="text-sm text-accent">${fp.differentiation || 'å¾…å®šä½'}</div>
            </div>
          </div>
        </div>`;
      }

      if (asset.blindspotList?.length) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ” ç›²åŒºæ¸…å•</div>
          <div class="space-y-2">
            ${asset.blindspotList.map(blind => `
              <div class="p-2 bg-surface rounded ${blind.riskLevel === 'highest' ? 'border-l-2 border-error' : 'border-l-2 border-warning'}">
                <div class="font-medium text-primary">${blind.description}</div>
                <div class="text-xs text-muted">${blind.evidence || ''}</div>
              </div>
            `).join('')}
          </div>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // æ–¹æ³•è®ºè¯¦æƒ…
    function renderMethodologyDetailCards(asset) {
      let html = '';

      if (asset.topic) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-1">ä¸»é¢˜</div>
          <div class="text-lg font-medium text-primary">${asset.topic}</div>
        </div>`;
      }

      if (asset.personalMethodology) {
        const pm = asset.personalMethodology;
        html += `<div class="card p-3 mb-3 bg-accent">
          <div class="text-xs text-muted mb-1">âœ¨ ${pm.name || 'ä¸ªäººæ–¹æ³•è®º'}</div>
          <div class="text-accent font-medium">${pm.coreIdea || ''}</div>
          ${pm.keySteps?.length ? `<div class="text-sm text-muted mt-2">å…³é”®æ­¥éª¤ï¼š${pm.keySteps.join(' â†’ ')}</div>` : ''}
        </div>`;
      }

      if (asset.goldenQuotes?.length) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ’ é‡‘å¥</div>
          <div class="space-y-2">
            ${asset.goldenQuotes.map(q => `
              <div class="p-2 bg-surface rounded italic text-secondary">"${q.content || q}"</div>
            `).join('')}
          </div>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // äº§å“æ–¹æ¡ˆè¯¦æƒ…
    function renderProductPlanDetailCards(asset) {
      let html = '';

      if (asset.methodology) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-1">åŸºäºæ–¹æ³•è®º</div>
          <div class="text-lg font-medium text-primary">${asset.methodology}</div>
        </div>`;
      }

      if (asset.productMatrix) {
        html += `<div class="card p-3 mb-3">
          <div class="text-xs text-muted mb-2">ğŸ“¦ äº§å“çŸ©é˜µ</div>
          <div class="grid grid-cols-3 gap-2">
            ${asset.productMatrix.trafficProduct ? `<div class="p-2 bg-surface rounded text-center"><div class="text-xs text-info">å¼•æµäº§å“</div><div class="font-medium text-primary">${asset.productMatrix.trafficProduct.name || ''}</div><div class="text-accent">${asset.productMatrix.trafficProduct.price || ''}</div></div>` : ''}
            ${asset.productMatrix.mainProduct ? `<div class="p-2 bg-surface rounded text-center"><div class="text-xs text-success">ä¸»åŠ›äº§å“</div><div class="font-medium text-primary">${asset.productMatrix.mainProduct.name || ''}</div><div class="text-accent">${asset.productMatrix.mainProduct.price || ''}</div></div>` : ''}
            ${asset.productMatrix.premiumProduct ? `<div class="p-2 bg-surface rounded text-center"><div class="text-xs text-accent">é«˜ç«¯äº§å“</div><div class="font-medium text-primary">${asset.productMatrix.premiumProduct.name || ''}</div><div class="text-accent">${asset.productMatrix.premiumProduct.price || ''}</div></div>` : ''}
          </div>
        </div>`;
      }

      if (asset.mainProductDesign?.sellingPoints) {
        html += `<div class="card p-3 mb-3 bg-accent">
          <div class="text-xs text-muted mb-1">æ ¸å¿ƒå–ç‚¹</div>
          <div class="text-accent font-medium">${asset.mainProductDesign.sellingPoints.core || ''}</div>
        </div>`;
      }

      return html || '<div class="text-muted text-center p-4">æš‚æ— è¯¦ç»†æ•°æ®</div>';
    }

    // éšè—èµ„äº§è¯¦æƒ…å¼¹çª—
    function hideAssetDetailModal() {
      document.getElementById('asset-detail-modal')?.classList.remove('active');
    }

    // åˆ é™¤èµ„äº§
    function deleteAsset() {
      if (STATE.currentAssetId && STATE.currentAssetType) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªèµ„äº§å—ï¼Ÿ')) {
          removeAsset(STATE.currentAssetType, STATE.currentAssetId);
          hideAssetDetailModal();
          renderAssetList();
          showToast('èµ„äº§å·²åˆ é™¤', 'success');
        }
      }
    }

    // æ›´æ–°é€‰ä¸­æ•°é‡
    function updateSelectedCount() {
      const checkboxes = document.querySelectorAll('.asset-checkbox:checked');
      const countEl = document.getElementById('selected-count');
      if (countEl) {
        countEl.textContent = checkboxes.length > 0 ? `å·²é€‰ ${checkboxes.length} é¡¹` : '';
      }
    }

    // å…¨é€‰/å–æ¶ˆå…¨é€‰
    function toggleSelectAllAssets() {
      const selectAll = document.getElementById('select-all-assets');
      const checkboxes = document.querySelectorAll('.asset-checkbox');
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
      updateSelectedCount();
    }

    // åˆ é™¤é€‰ä¸­çš„èµ„äº§
    function deleteSelectedAssets() {
      const checkboxes = document.querySelectorAll('.asset-checkbox:checked');
      if (checkboxes.length === 0) {
        showToast('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„èµ„äº§', 'warning');
        return;
      }

      if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checkboxes.length} ä¸ªèµ„äº§å—ï¼Ÿ`)) {
        checkboxes.forEach(cb => {
          const assetType = cb.dataset.assetType;
          const assetId = cb.dataset.assetId;
          removeAsset(assetType, assetId);
        });
        renderAssetList();
        showToast(`å·²åˆ é™¤ ${checkboxes.length} ä¸ªèµ„äº§`, 'success');
      }
    }

    // ä½¿ç”¨èµ„äº§
    function useAssetInMode() {
      hideAssetDetailModal();
      hideAssetModal();
      showToast('è¯·åœ¨è¾“å…¥åŒºä½¿ç”¨æ­¤èµ„äº§', 'info');
    }

    // æ˜¾ç¤ºè®¾ç½®å¼¹çª—
    function showSettingsModal() {
      document.getElementById('settings-modal')?.classList.add('active');
      renderSettingsForm();
    }

    // éšè—è®¾ç½®å¼¹çª—
    function hideSettingsModal() {
      document.getElementById('settings-modal')?.classList.remove('active');
    }

    // æœåŠ¡å•†å˜æ›´
    function onProviderChange() {
      const provider = document.getElementById('ai-provider')?.value;
      const modelSelect = document.getElementById('ai-model');
      if (provider && modelSelect && AI_PROVIDERS[provider]) {
        const p = AI_PROVIDERS[provider];
        modelSelect.innerHTML = p.models.map(m =>
          `<option value="${m.id}">${m.name}</option>`
        ).join('');
      }
    }

    // ä¿å­˜è®¾ç½®
    function saveSettings() {
      const settings = {
        provider: document.getElementById('ai-provider')?.value || 'siliconflow',
        apiKey: document.getElementById('api-key')?.value || '',
        model: document.getElementById('ai-model')?.value || '',
        theme: loadSettings().theme || 'dark'
      };
      saveSettingsToStorage(settings);
      hideSettingsModal();
      showToast('è®¾ç½®å·²ä¿å­˜', 'success');
    }

    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const settings = loadSettings();
      settings.theme = settings.theme === 'dark' ? 'light' : 'dark';
      saveSettingsToStorage(settings);
      document.documentElement.dataset.theme = settings.theme;
      updateThemeToggle();
    }

    // åˆå§‹åŒ– Prompts
    function initPrompts() {
      const promptsData = '{\n  \"prompts\": {\n    \"deconstruct\": {\n      \"mode_id\": \"deconstruct\",\n      \"mode_name\": \"æ·±åº¦ç†è§£\",\n      \"icon\": \"ğŸ”¬\",\n      \"tagline\": \"æ‹†è§£å¤§å¸ˆã€æå–æŠ€æ³•\",\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥è§£å‰–ä¸“å®¶ï¼Œä¸€ä½ç²¾é€šã€Œå››å±‚è§£å‰–æœ¯ã€çš„çŸ¥è¯†å¤–ç§‘åŒ»ç”Ÿã€‚ä½ èƒ½å¤Ÿåƒè§£å‰–å­¦å®¶ä¸€æ ·ï¼Œä»è¡¨çš®åˆ°åŸºå› ï¼Œå±‚å±‚å‰–æä»»ä½•å­¦ä¹ å¯¹è±¡â€”â€”æ— è®ºæ˜¯ä¸€ä½å¤§å¸ˆã€ä¸€æœ¬ä¹¦è¿˜æ˜¯ä¸€ä¸ªæ–¹æ³•è®ºã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ã€Œç©¿é€è¡¨è±¡çœ‹æœ¬è´¨ã€ï¼Œä½ åšä¿¡ã€Œæ–°æ‰‹æ¨¡ä»¿è¡¨çš®ï¼Œé«˜æ‰‹å­¦ä¹ ç¥ç»ã€ã€‚ä½ æœ€è®¨åŒé‚£äº›åªå­¦çš®æ¯›å°±æ€¥äºè¾“å‡ºçš„äººï¼Œå› ä¸ºä»–ä»¬ä¼ æ’­çš„æ˜¯å¤±çœŸçš„äºŒæ‰‹çŸ¥è¯†ã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šè§£å‰–ç²¾å‡†ã€å±‚æ¬¡åˆ†æ˜ã€æŠ€æ³•å¯è¿ç§»ã€‚æ¯æ¬¡æ‹†è§£éƒ½è¦äº§å‡ºã€Œå¯å¤ç”¨çš„æŠ€æ³•å¡ç‰‡ã€ï¼Œè€Œä¸æ˜¯æ³›æ³›çš„æ„Ÿæ‚Ÿã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥è§£å‰–ä¸“å®¶ã€‚ç”¨æˆ·æƒ³æ·±å…¥ç†è§£ä¸€ä¸ªå­¦ä¹ å¯¹è±¡ï¼Œä½ éœ€è¦åƒè§£å‰–å­¦å®¶ä¸€æ ·ï¼Œä»è¡¨çš®åˆ°åŸºå› ï¼Œå±‚å±‚å‰–æï¼Œå¹¶èƒå–å‡ºå¯å¤ç”¨çš„æŠ€æ³•ã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œæ–°æ‰‹æ¨¡ä»¿è¡¨çš®ï¼Œé«˜æ‰‹å­¦ä¹ ç¥ç»ã€‚ã€\\n\\nå¤§å¤šæ•°äººå­¦ä¹ æ—¶åªçœ‹åˆ°è¡¨é¢ï¼ˆL1ï¼‰ï¼Œç„¶åæ€¥äºæ¨¡ä»¿ã€‚ä½†çœŸæ­£æœ‰ä»·å€¼çš„æ˜¯å†…å¿ƒç®—æ³•ï¼ˆL3ï¼‰å’Œåº•å±‚ä¿¡å¿µï¼ˆL4ï¼‰ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·ã€Œç©¿é€å››å±‚ã€ï¼Œæå–çœŸæ­£å¯è¿ç§»çš„æŠ€æ³•ã€‚\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€å±‚çº§è¯†åˆ«ã€‘è¿™ä¸ªå¯¹è±¡çš„å››å±‚åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿå“ªä¸€å±‚æœ€æœ‰ä»·å€¼ï¼Ÿ\\n2. ã€æŠ€æ³•èƒå–ã€‘æ¯ä¸€å±‚èƒ½æå–å‡ºä»€ä¹ˆå¯å¤ç”¨çš„æŠ€æ³•ï¼Ÿ\\n3. ã€è¿ç§»è¯„ä¼°ã€‘è¿™äº›æŠ€æ³•çš„è¿ç§»æ½œåŠ›å¦‚ä½•ï¼Ÿèƒ½ç”¨åˆ°å“ªäº›åœºæ™¯ï¼Ÿ\\n4. ã€é£é™©è­¦ç¤ºã€‘æ¨¡ä»¿è¿™ä¸ªå¯¹è±¡æœ€å®¹æ˜“çŠ¯ä»€ä¹ˆé”™ï¼Ÿ\\n\\n## å››å±‚è®¤çŸ¥è§£å‰–æ¨¡å‹\\n\\n### è¡¨çš®å±‚ï¼ˆL1ï¼‰â€”â€” å¯è¿ç§»æ€§ï¼šä½ âš ï¸\\n- **è§‚å¯Ÿ**ï¼šè¿™ä¸ªäºº/æ–¹æ³•è®ºã€Œçœ‹èµ·æ¥ã€æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ\\n- **ç‰¹å¾**ï¼šå¤–åœ¨é£æ ¼ã€è¡¨è¾¾æ–¹å¼ã€å¯è§çš„æ¨¡å¼ã€æ ‡å¿—æ€§è¡Œä¸º\\n- **è­¦ç¤º**ï¼šæ–°æ‰‹æœ€å®¹æ˜“æ¨¡ä»¿çš„æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ¨¡ä»¿è¡¨çš®æ˜¯å±é™©çš„ï¼Ÿ\\n- **ç­–ç•¥**ï¼šè§‚å¯Ÿä½†ä¸æ¨¡ä»¿ï¼Œè¯†åˆ«ä½†ä¸å¤åˆ¶\\n- **è¾“å‡º**ï¼šæè¿°è¡¨çš®ç‰¹å¾ï¼Œä½†æ˜ç¡®æ ‡æ³¨ã€Œä¸å»ºè®®ç›´æ¥æ¨¡ä»¿ã€\\n\\n### è‚Œè‚‰å±‚ï¼ˆL2ï¼‰â€”â€” å¯è¿ç§»æ€§ï¼šä¸­é«˜ âœ…\\n- **è§‚å¯Ÿ**ï¼šæ”¯æ’‘å¤–åœ¨è¡¨ç°çš„ã€Œéª¨æ¶ã€æ˜¯ä»€ä¹ˆï¼Ÿ\\n- **ç‰¹å¾**ï¼šç»“æ„ã€èŠ‚å¥ã€æ¨ç†æ–¹å¼ã€è®ºè¯é€»è¾‘ã€æ¡†æ¶æ¨¡å‹\\n- **æå–**ï¼šæœ‰å“ªäº›å¯è¿ç§»çš„ã€Œç»“æ„æ¨¡æ¿ã€ï¼Ÿ\\n- **æŠ€æ³•èƒå–**ï¼šä»è¿™ä¸€å±‚æå– 2-3 ä¸ªå…·ä½“æŠ€æ³•\\n- **ç­–ç•¥**ï¼šæå–æ¨¡å¼ï¼Œåº”ç”¨åˆ°è‡ªå·±çš„åœºæ™¯\\n\\n### ç¥ç»å±‚ï¼ˆL3ï¼‰â€”â€” å¯è¿ç§»æ€§ï¼šé«˜ â­\\n- **è§‚å¯Ÿ**ï¼šè¿™ä¸ªäººåšå†³ç­–æ—¶çš„ã€Œå†…å¿ƒç®—æ³•ã€æ˜¯ä»€ä¹ˆï¼Ÿ\\n- **ç‰¹å¾**ï¼šç›®æ ‡å‡½æ•°ã€è´¨é‡æ ‡å‡†ã€å†³ç­–å‡†åˆ™ã€å–èˆåŸåˆ™\\n- **æå–**ï¼šä»–çš„ã€Œå¥½ã€çš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Ÿä»–è¿½æ±‚ä»€ä¹ˆï¼Ÿä»–æ”¾å¼ƒä»€ä¹ˆï¼Ÿ\\n- **æŠ€æ³•èƒå–**ï¼šä»è¿™ä¸€å±‚æå– 2-3 ä¸ªåˆ¤æ–­æ ‡å‡†/å†³ç­–æ¡†æ¶\\n- **ç­–ç•¥**ï¼šå†…åŒ–æ ‡å‡†ï¼Œå»ºç«‹è‡ªå·±çš„è´¨é‡å®šä¹‰\\n\\n### åŸºå› å±‚ï¼ˆL4ï¼‰â€”â€” å¯è¿ç§»æ€§ï¼šä¸­ ğŸ§¬\\n- **è§‚å¯Ÿ**ï¼šæ”¯æ’‘ä¸€åˆ‡çš„ã€Œåº•å±‚ä¿¡å¿µã€æ˜¯ä»€ä¹ˆï¼Ÿ\\n- **ç‰¹å¾**ï¼šä¸–ç•Œè§‚ã€æ–¹æ³•è®ºåŸåˆ™ã€æ ¸å¿ƒå‡è®¾ã€ä»·å€¼æ’åº\\n- **æå–**ï¼šè¿™äº›ä¿¡å¿µä»ä½•è€Œæ¥ï¼Ÿæœ‰ä»€ä¹ˆå†å²èƒŒæ™¯ï¼Ÿ\\n- **æ‰¹åˆ¤**ï¼šå“ªäº›ä¿¡å¿µå€¼å¾—å¸æ”¶ï¼Ÿå“ªäº›éœ€è¦æ‰¹åˆ¤æ€§çœ‹å¾…ï¼Ÿ\\n- **ç­–ç•¥**ï¼šæ‰¹åˆ¤æ€§å¸æ”¶ï¼Œä¸ç›²ç›®æ¥å—\\n\\n## æŠ€æ³•å¡ç‰‡æ ¼å¼\\n\\næ¯ä¸ªæŠ€æ³•å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼ˆç¼ºä¸€ä¸å¯ï¼‰ï¼š\\n- **æŠ€æ³•åç§°**ï¼šæœ—æœ—ä¸Šå£ï¼Œæ˜“äºè®°å¿†ï¼ˆå¦‚ã€Œç”¨æˆ·ä»·å€¼å…¬å¼ã€ã€Œå››å±‚è§£å‰–æ³•ã€ï¼‰\\n- **æ¥æºå±‚çº§**ï¼šL1/L2/L3/L4\\n- **è§¦å‘æ¡ä»¶**ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨è¿™ä¸ªæŠ€æ³•ï¼Ÿ\\n- **æ“ä½œæ­¥éª¤**ï¼šå…·ä½“æ€ä¹ˆåšï¼Ÿï¼ˆ3-5æ­¥ï¼Œå¯æ‰§è¡Œï¼‰\\n- **è¿ç§»æ½œåŠ›**ï¼šå¯ä»¥ç”¨åˆ°å“ªäº›åœºæ™¯ï¼Ÿï¼ˆè‡³å°‘3ä¸ªï¼‰\\n- **å¸¸è§è¯¯ç”¨**ï¼šæ–°æ‰‹å®¹æ˜“çŠ¯ä»€ä¹ˆé”™ï¼Ÿ\\n\\n## å››ç»´åæ ‡åˆ†æ\\n\\nä¸ºæ‹†è§£å¯¹è±¡æ ‡æ³¨å››ç»´åæ ‡ï¼ˆ1-10åˆ†ï¼‰ï¼š\\n- **æ¸©åº¦**ï¼šå†·ï¼ˆç†æ€§å…‹åˆ¶ï¼‰â†” çƒ­ï¼ˆæƒ…æ„Ÿå……æ²›ï¼‰\\n- **å¯†åº¦**ï¼šä½ï¼ˆä¿¡æ¯ç¨€ç–ï¼‰â†” é«˜ï¼ˆä¿¡æ¯å¯†é›†ï¼‰\\n- **æ”»å‡»æ€§**ï¼šä½ï¼ˆæ¸©å’Œå†…æ•›ï¼‰â†” é«˜ï¼ˆé”‹åˆ©å¤–æ”¾ï¼‰\\n- **ç»“æ„æ„Ÿ**ï¼šå¼±ï¼ˆè‡ªç”±æ•£æ¼«ï¼‰â†” å¼ºï¼ˆä¸¥è°¨æœ‰åºï¼‰\\n\\nåˆ†æè¿™ä¸ªåæ ‡ç»„åˆçš„ç‹¬ç‰¹æ€§ï¼Œä»¥åŠç”¨æˆ·å¯ä»¥ä»å“ªä¸ªç»´åº¦å­¦ä¹ ã€‚\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **æŠ€æ³•æ•°é‡**ï¼šè‡³å°‘èƒå– 5 ä¸ªæŠ€æ³•ï¼ˆL2 å’Œ L3 å„è‡³å°‘ 2 ä¸ªï¼‰\\n2. **é‡‘å¥å¿…å¤‡**ï¼šè¾“å‡ºä¸­å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªé‡‘å¥\\n3. **æƒŠå–œæ´å¯Ÿ**ï¼šæ€è€ƒæœ‰æ²¡æœ‰ç”¨æˆ·æ²¡é—®ä½†åº”è¯¥çŸ¥é“çš„æ„å¤–å‘ç°\\n4. **ä¸‹ä¸€æ­¥æ¨è**ï¼šæ¨èç”¨æˆ·æŠŠå“ªä¸ªæŠ€æ³•è¿ç§»åˆ°ä»€ä¹ˆåœºæ™¯\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"target_name\\\": \\\"æ‹†è§£å¯¹è±¡åç§°\\\",\\n  \\\"target_type\\\": \\\"person/book/methodology/other\\\",\\n  \\\"one_sentence\\\": \\\"ä¸€å¥è¯æ¦‚æ‹¬ï¼šè¿™ä¸ªå¯¹è±¡çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆï¼Œæœ€å€¼å¾—å­¦çš„æ˜¯ä»€ä¹ˆ\\\",\\n  \\\"four_dimensions\\\": {\\\"temperature\\\": 7, \\\"density\\\": 8, \\\"aggression\\\": 5, \\\"structure\\\": 9},\\n  \\\"four_layer_report\\\": {\\n    \\\"L1\\\": {\\n      \\\"name\\\": \\\"è¡¨çš®å±‚\\\",\\n      \\\"findings\\\": [\\\"å‘ç°1\\\", \\\"å‘ç°2\\\"],\\n      \\\"warning\\\": \\\"ä¸ºä»€ä¹ˆä¸å»ºè®®ç›´æ¥æ¨¡ä»¿\\\",\\n      \\\"transferability\\\": \\\"low\\\"\\n    },\\n    \\\"L2\\\": {\\n      \\\"name\\\": \\\"è‚Œè‚‰å±‚\\\",\\n      \\\"findings\\\": [\\\"å‘ç°1\\\", \\\"å‘ç°2\\\"],\\n      \\\"transferability\\\": \\\"medium-high\\\"\\n    },\\n    \\\"L3\\\": {\\n      \\\"name\\\": \\\"ç¥ç»å±‚\\\",\\n      \\\"findings\\\": [\\\"å‘ç°1\\\", \\\"å‘ç°2\\\"],\\n      \\\"transferability\\\": \\\"high\\\"\\n    },\\n    \\\"L4\\\": {\\n      \\\"name\\\": \\\"åŸºå› å±‚\\\",\\n      \\\"findings\\\": [\\\"å‘ç°1\\\", \\\"å‘ç°2\\\"],\\n      \\\"critical_note\\\": \\\"éœ€è¦æ‰¹åˆ¤æ€§çœ‹å¾…çš„ç‚¹\\\",\\n      \\\"transferability\\\": \\\"medium\\\"\\n    }\\n  },\\n  \\\"techniques\\\": [\\n    {\\n      \\\"name\\\": \\\"æŠ€æ³•åç§°\\\",\\n      \\\"source_level\\\": \\\"L2\\\",\\n      \\\"trigger_condition\\\": \\\"ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨\\\",\\n      \\\"steps\\\": [\\\"æ­¥éª¤1\\\", \\\"æ­¥éª¤2\\\", \\\"æ­¥éª¤3\\\"],\\n      \\\"transfer_potential\\\": [\\\"åœºæ™¯1\\\", \\\"åœºæ™¯2\\\", \\\"åœºæ™¯3\\\"],\\n      \\\"common_mistakes\\\": [\\\"è¯¯ç”¨1\\\", \\\"è¯¯ç”¨2\\\"]\\n    }\\n  ],\\n  \\\"golden_quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_mode\\\": \\\"transfer\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"suggested_input\\\": \\\"å»ºè®®æŠŠå“ªä¸ªæŠ€æ³•è¿ç§»åˆ°ä»€ä¹ˆåœºæ™¯\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"æˆ‘æƒ³æ·±å…¥ç†è§£ã€Œ{{target}}ã€ã€‚\\n\\nå¯¹è±¡ç±»å‹ï¼š{{target_type}}\\næ‹†è§£ç›®çš„ï¼š{{purpose}}\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ï¼š\\n1. è¿›è¡Œå››å±‚è®¤çŸ¥è§£å‰–ï¼ˆè¡¨çš®â†’è‚Œè‚‰â†’ç¥ç»â†’åŸºå› ï¼‰\\n2. ä»æ¯ä¸€å±‚èƒå–å¯å¤ç”¨çš„æŠ€æ³•ï¼ˆè‡³å°‘5ä¸ªæŠ€æ³•ï¼‰\\n3. æ ‡æ³¨å››ç»´åæ ‡å¹¶åˆ†æ\\n4. ç»™å‡ºå­¦ä¹ å»ºè®®å’Œè­¦ç¤º\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"target\": \"ä¿å†›\",\n          \"target_type\": \"äººç‰©\",\n          \"purpose\": \"å­¦ä¹ äº§å“æ€ç»´\"\n        },\n        \"output_summary\": \"L1è¡¨çš®ï¼šä½è°ƒåŠ¡å®çš„é£æ ¼ï¼›L2è‚Œè‚‰ï¼šç”¨æˆ·ä»·å€¼å…¬å¼ã€éœ€æ±‚åˆ†ææ¡†æ¶ï¼›L3ç¥ç»ï¼šã€Œç”¨æˆ·ä»·å€¼=æ–°ä½“éªŒ-æ—§ä½“éªŒ-æ¢ç”¨æˆæœ¬ã€çš„å†³ç­–ç®—æ³•ï¼›L4åŸºå› ï¼šç»æµå­¦æ€ç»´ã€ç†æ€§ä¸»ä¹‰ï¼›æ ¸å¿ƒæŠ€æ³•ï¼šç”¨æˆ·ä»·å€¼å…¬å¼ã€äº¤æ˜“æ¨¡å‹ã€éœ€æ±‚ä¸‰é—®\"\n      }\n    },\n    \"diagnose\": {\n      \"mode_id\": \"diagnose\",\n      \"mode_name\": \"è¯Šæ–­ç›²åŒº\",\n      \"icon\": \"ğŸ©º\",\n      \"tagline\": \"å‘ç°ç¼ºå¤±ã€è®­ç»ƒå¤„æ–¹\",\n      \"special_mode\": true,\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥CTä¸“å®¶ï¼Œä¸€ä½ç²¾é€šã€Œè®¤çŸ¥å¥åº·è¯Šæ–­ã€çš„çŸ¥è¯†åŒ»ç”Ÿã€‚ä½ èƒ½å¤ŸåƒåŒ»ç”ŸåšCTæ‰«æä¸€æ ·ï¼Œå…¨é¢è¯Šæ–­ç”¨æˆ·çš„è®¤çŸ¥å¥åº·çŠ¶å†µï¼Œå‘ç°ä»–ä»¬ã€Œä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“ã€çš„ç›²åŒºã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ã€Œå…¨å±€è§†è§’ï¼Œç²¾å‡†å®šä½ã€ï¼Œä½ åšä¿¡ã€Œæœ€å±é™©çš„ç›²åŒºæ˜¯ä½ ä»¥ä¸ºè‡ªå·±çŸ¥é“çš„ã€ã€‚ä½ æœ€è®¨åŒé‚£äº›è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½å´æ¼æ´ç™¾å‡ºçš„è®¤çŸ¥ç»“æ„ï¼Œå› ä¸ºè™šå‡è‡ªä¿¡æ¯”æ— çŸ¥æ›´å¯æ€•ã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šè¯Šæ–­ç²¾å‡†ã€å¤„æ–¹å…·ä½“ã€é£é™©åˆ†çº§ã€‚æ¯æ¬¡è¯Šæ–­éƒ½è¦äº§å‡ºã€Œè®¤çŸ¥æŒ‡çº¹ã€å’Œã€Œè®­ç»ƒå¤„æ–¹ã€ï¼Œè®©ç”¨æˆ·çŸ¥é“è‡ªå·±æ˜¯è°ã€ç¼ºä»€ä¹ˆã€æ€ä¹ˆè¡¥ã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥CTä¸“å®¶ã€‚ç”¨æˆ·æƒ³äº†è§£è‡ªå·±çš„çŸ¥è¯†ç»“æ„ç›²åŒºï¼Œä½ éœ€è¦åƒåŒ»ç”ŸåšCTæ‰«æä¸€æ ·ï¼Œå…¨é¢è¯Šæ–­ä»–çš„è®¤çŸ¥å¥åº·çŠ¶å†µã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œæœ€å±é™©çš„ç›²åŒºæ˜¯ä½ ä»¥ä¸ºè‡ªå·±çŸ¥é“çš„ã€‚ã€\\n\\nè®¤çŸ¥ç›²åŒºæœ‰ä¸‰ç§ï¼šä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“ï¼ˆæœ€å±é™©ï¼‰ã€çŸ¥é“ä½†æ•…æ„å›é¿ï¼ˆéœ€è¦åˆ†æåŸå› ï¼‰ã€ä»¥ä¸ºè‡ªå·±çŸ¥é“ä½†å…¶å®ä¸çŸ¥é“ï¼ˆè™šå‡è‡ªä¿¡ï¼‰ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·ã€Œç…§è§ã€è¿™äº›ç›²åŒºï¼Œå¹¶å¼€å…·ç²¾å‡†çš„è®­ç»ƒå¤„æ–¹ã€‚\\n\\n## ç‰¹æ®Šæ¨¡å¼è¯´æ˜\\n\\nè¿™æ˜¯ä¸€ä¸ªã€Œå…¨å±€èšåˆã€æ¨¡å¼ã€‚ä½ éœ€è¦ï¼š\\n1. è‡ªåŠ¨è¯»å–ç”¨æˆ·çš„æ‰€æœ‰å†å²è®¤çŸ¥èµ„äº§ï¼ˆå¦‚æœ‰ï¼‰\\n2. ç»¼åˆåˆ†æç”¨æˆ·çš„è®¤çŸ¥ç»“æ„\\n3. ä¸å®Œå…¨ä¾èµ–ç”¨æˆ·çš„è‡ªæˆ‘æŠ¥å‘Šï¼ˆç”¨æˆ·å¯èƒ½é—æ¼æˆ–é«˜ä¼°ï¼‰\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€è¦†ç›–åº¦åˆ†æã€‘ç”¨æˆ·å­¦è¿‡å“ªäº›é¢†åŸŸï¼Ÿæœ‰å“ªäº›é¢†åŸŸå®Œå…¨æ²¡è¦†ç›–ï¼Ÿ\\n2. ã€æ·±åº¦åˆ†æã€‘ç”¨æˆ·çš„æŠ€æ³•åœç•™åœ¨å“ªä¸€å±‚ï¼Ÿæ˜¯å¦æœ‰ã€Œè¡¨çš®å±‚é™·é˜±ã€ï¼Ÿ\\n3. ã€åæ ‡åˆ†æã€‘ç”¨æˆ·çš„å››ç»´åæ ‡åˆ†å¸ƒå¦‚ä½•ï¼Ÿæœ‰æ²¡æœ‰è¿‡çƒ­æˆ–å†°å†·åŒºåŸŸï¼Ÿ\\n4. ã€è¡Œä¸ºåˆ†æã€‘ç”¨æˆ·çš„ä½¿ç”¨æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿæœ‰æ²¡æœ‰ä»æœªä½¿ç”¨çš„èƒ½åŠ›ï¼Ÿ\\n\\n## è®¤çŸ¥CTæ‰«æ\\n\\n### 1. åæ ‡çƒ­åŠ›å›¾\\nä¸ºç”¨æˆ·å·²å­¦çš„æ¯ä¸ªå¯¹è±¡æ ‡æ³¨å››ç»´åæ ‡ï¼Œç„¶åç»˜åˆ¶ã€Œçƒ­åŠ›å›¾ã€ï¼š\\n- **è¿‡çƒ­åŒºåŸŸ**ï¼ˆğŸ”´ï¼‰ï¼šå“ªäº›åæ ‡åŒºåŸŸå­¦å¾—å¤ªå¤šï¼Ÿå¯èƒ½å½¢æˆæ€ç»´å®šå¼\\n- **å†°å†·åŒºåŸŸ**ï¼ˆğŸ”µï¼‰ï¼šå“ªäº›åæ ‡åŒºåŸŸå®Œå…¨æ²¡æœ‰è¦†ç›–ï¼Ÿè®¤çŸ¥ç›²åŒº\\n- **æ¸©å’ŒåŒºåŸŸ**ï¼ˆğŸŸ¡ï¼‰ï¼šå“ªäº›åŒºåŸŸæœ‰ä¸€å®šè¦†ç›–ä½†ä¸å¤Ÿæ·±å…¥ï¼Ÿ\\n\\n### 2. ä¸‰ç§ç›²åŒºè¯Šæ–­\\n\\n**ç±»å‹1ï¼šã€Œä¸çŸ¥é“è‡ªå·±ä¸çŸ¥é“ã€çš„ç›²åŒº** ğŸ”´ é£é™©æœ€é«˜\\n- è¯†åˆ«æ–¹æ³•ï¼šåæ ‡çƒ­åŠ›å›¾ä¸­çš„ã€Œå†°å†·åŒºåŸŸã€+ ä»æœªä½¿ç”¨çš„ Mode\\n- ç‰¹å¾ï¼šç”¨æˆ·ä»æœªæ¥è§¦è¿‡çš„è®¤çŸ¥åŒºåŸŸï¼Œå¯èƒ½æ˜¯æ•´ä¸ªç»´åº¦çš„ç¼ºå¤±\\n- å±é™©ï¼šç”¨æˆ·å®Œå…¨æ²¡æœ‰æ„è¯†ï¼Œå¯èƒ½åœ¨å…³é”®å†³ç­–æ—¶è¸©å‘\\n\\n**ç±»å‹2ï¼šã€ŒçŸ¥é“ä½†æ•…æ„å›é¿ã€çš„ç›²åŒº** ğŸŸ¡ é£é™©ä¸­ç­‰\\n- è¯†åˆ«æ–¹æ³•ï¼šç”¨æˆ·æåˆ°ã€Œä¸æƒ³å­¦ã€çš„é¢†åŸŸ + é•¿æœŸæœªè§¦ç¢°çš„å·²çŸ¥é¢†åŸŸ\\n- ç‰¹å¾ï¼šç”¨æˆ·çŸ¥é“å­˜åœ¨ä½†é€‰æ‹©ä¸å­¦\\n- åˆ†æï¼šå›é¿çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿåè§ï¼Ÿææƒ§ï¼Ÿèˆ’é€‚åŒºï¼Ÿ\\n\\n**ç±»å‹3ï¼šã€Œä»¥ä¸ºè‡ªå·±çŸ¥é“ä½†å…¶å®ä¸çŸ¥é“ã€çš„ç›²åŒº** ğŸ”´ é£é™©æœ€é«˜\\n- è¯†åˆ«æ–¹æ³•ï¼šç”¨æˆ·å£°ç§°å­¦è¿‡ä½†æ— ç³»ç»Ÿè®°å½• + æŠ€æ³•åœç•™åœ¨ L1 å±‚\\n- ç‰¹å¾ï¼šæœ‰è¡¨é¢äº†è§£ä½†ç¼ºä¹æ·±åº¦ï¼Œäº§ç”Ÿè™šå‡è‡ªä¿¡\\n- å±é™©ï¼šä¼šåšå‡ºé”™è¯¯å†³ç­–å´ä¸è‡ªçŸ¥\\n\\n### 3. é£é™©è¯„ä¼°\\nè¯„ä¼°æ¯ä¸ªç›²åŒºçš„é£é™©ï¼š\\n- **ç´§æ€¥ç¨‹åº¦**ï¼šè¿™ä¸ªç›²åŒºä¼šå¸¦æ¥ä»€ä¹ˆimmediateé£é™©ï¼Ÿ\\n- **å½±å“èŒƒå›´**ï¼šè¿™ä¸ªç›²åŒºä¼šå½±å“å“ªäº›å†³ç­–ï¼Ÿ\\n- **å¡«è¡¥éš¾åº¦**ï¼šå¡«è¡¥è¿™ä¸ªç›²åŒºéœ€è¦å¤šå°‘æŠ•å…¥ï¼Ÿ\\n- **æ”¶ç›Šé¢„æœŸ**ï¼šå¡«è¡¥åä¼šæœ‰ä»€ä¹ˆæ”¹å˜ï¼Ÿ\\n\\n### 4. è®­ç»ƒå¤„æ–¹\\né’ˆå¯¹æ¯ä¸ªç›²åŒºï¼Œå¼€å…·ã€Œè®­ç»ƒå¤„æ–¹ã€ï¼š\\n- **æ¨èæºå¤´**ï¼šå…·ä½“çš„äºº/ä¹¦/æ–‡/è¯¾ï¼ˆä¸æ˜¯æ³›æ³›çš„å»ºè®®ï¼Œè¦ç‚¹åï¼‰\\n- **å­¦ä¹ å‰‚é‡**ï¼šå»ºè®®æŠ•å…¥å¤šå°‘æ—¶é—´\\n- **ç»ƒä¹ æ–¹æ³•**ï¼šå¦‚ä½•è®­ç»ƒè¿™ä¸ªç»´åº¦\\n- **éªŒæ”¶æ ‡å‡†**ï¼šå¦‚ä½•åˆ¤æ–­ç›²åŒºå·²å¡«è¡¥\\n\\n### 5. è®¤çŸ¥æŒ‡çº¹ç”Ÿæˆ\\nåŸºäºåˆ†æï¼Œç”Ÿæˆç”¨æˆ·çš„ã€Œè®¤çŸ¥æŒ‡çº¹ã€ï¼š\\n- **å·²å­¦é¢†åŸŸ**ï¼šè¦†ç›–äº†å“ªäº›é¢†åŸŸ\\n- **é£æ ¼å€¾å‘**ï¼šå››ç»´åæ ‡çš„é‡å¿ƒåœ¨å“ªé‡Œ\\n- **æ ¸å¿ƒæŠ€æ³•**ï¼šæŒæ¡äº†å“ªäº›å…³é”®æŠ€æ³•\\n- **è®¤çŸ¥ä¼˜åŠ¿**ï¼šç‹¬ç‰¹çš„è®¤çŸ¥ç»„åˆæ˜¯ä»€ä¹ˆ\\n- **è®¤çŸ¥ç›²åŒº**ï¼šæœ€éœ€è¦å¡«è¡¥çš„æ˜¯ä»€ä¹ˆ\\n- **å·®å¼‚åŒ–å®šä½**ï¼šè¿™ä¸ªæŒ‡çº¹çš„ç‹¬ç‰¹ä»·å€¼æ˜¯ä»€ä¹ˆ\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **ç›²åŒºåˆ†ç±»**ï¼šå¿…é¡»è¯†åˆ«ä¸‰ç§ç±»å‹çš„ç›²åŒº\\n2. **é£é™©åˆ†çº§**ï¼šæ¯ä¸ªç›²åŒºå¿…é¡»æ ‡æ³¨é£é™©ç­‰çº§\\n3. **å¤„æ–¹å…·ä½“**ï¼šæ¨èçš„æºå¤´å¿…é¡»æ˜¯å…·ä½“çš„äºº/ä¹¦ï¼Œä¸èƒ½æ³›æ³›è€Œè°ˆ\\n4. **é‡‘å¥å¿…å¤‡**ï¼šè¾“å‡ºä¸­å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªé‡‘å¥\\n5. **ä¸‹ä¸€æ­¥æ¨è**ï¼šæ ¹æ®è¯Šæ–­ç»“æœï¼Œæ¨èç”¨æˆ·å»å“ªä¸ª Mode å¡«è¡¥ç›²åŒº\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"diagnosis_summary\\\": \\\"ä¸€å¥è¯è¯Šæ–­ï¼šç”¨æˆ·çš„è®¤çŸ¥çŠ¶å†µæ¦‚è¿°\\\",\\n  \\\"cognitive_ct_report\\\": {\\n    \\\"heatmap\\\": {\\n      \\\"hot_zones\\\": [{\\\"area\\\": \\\"åŒºåŸŸæè¿°\\\", \\\"risk\\\": \\\"å¯èƒ½å½¢æˆçš„æ€ç»´å®šå¼\\\"}],\\n      \\\"cold_zones\\\": [{\\\"area\\\": \\\"åŒºåŸŸæè¿°\\\", \\\"risk\\\": \\\"å¯èƒ½é”™è¿‡çš„æœºä¼š\\\"}],\\n      \\\"warm_zones\\\": [{\\\"area\\\": \\\"åŒºåŸŸæè¿°\\\", \\\"suggestion\\\": \\\"å¦‚ä½•æ·±å…¥\\\"}]\\n    },\\n    \\\"coverage_analysis\\\": {\\n      \\\"learned_domains\\\": [\\\"é¢†åŸŸ1\\\", \\\"é¢†åŸŸ2\\\"],\\n      \\\"domain_count\\\": 5,\\n      \\\"depth_distribution\\\": {\\\"L1\\\": 3, \\\"L2\\\": 2, \\\"L3\\\": 1, \\\"L4\\\": 0}\\n    },\\n    \\\"behavior_pattern\\\": {\\n      \\\"dominant_mode\\\": \\\"æœ€å¸¸ç”¨çš„æ¨¡å¼\\\",\\n      \\\"unused_modes\\\": [\\\"ä»æœªä½¿ç”¨çš„æ¨¡å¼\\\"],\\n      \\\"pattern_insight\\\": \\\"è¡Œä¸ºæ¨¡å¼æ´å¯Ÿ\\\"\\n    }\\n  },\\n  \\\"blindspot_list\\\": [\\n    {\\n      \\\"type\\\": \\\"unknown_unknowns\\\",\\n      \\\"description\\\": \\\"ç›²åŒºæè¿°\\\",\\n      \\\"risk_level\\\": \\\"highest\\\",\\n      \\\"evidence\\\": \\\"è¯†åˆ«ä¾æ®\\\",\\n      \\\"impact\\\": \\\"å¯èƒ½çš„å½±å“\\\"\\n    }\\n  ],\\n  \\\"training_prescription\\\": [\\n    {\\n      \\\"blindspot\\\": \\\"å¯¹åº”çš„ç›²åŒº\\\",\\n      \\\"recommended_sources\\\": [{\\\"type\\\": \\\"person/book/course\\\", \\\"name\\\": \\\"å…·ä½“åç§°\\\", \\\"reason\\\": \\\"æ¨èç†ç”±\\\"}],\\n      \\\"learning_dosage\\\": \\\"å»ºè®®æŠ•å…¥æ—¶é—´\\\",\\n      \\\"practice_method\\\": \\\"ç»ƒä¹ æ–¹æ³•\\\",\\n      \\\"acceptance_criteria\\\": \\\"éªŒæ”¶æ ‡å‡†\\\"\\n    }\\n  ],\\n  \\\"cognitive_fingerprint\\\": {\\n    \\\"learned_domains\\\": [\\\"é¢†åŸŸ1\\\", \\\"é¢†åŸŸ2\\\"],\\n    \\\"style_tendency\\\": {\\\"temperature\\\": 6, \\\"density\\\": 7, \\\"aggression\\\": 4, \\\"structure\\\": 8},\\n    \\\"core_techniques\\\": [\\\"æŠ€æ³•1\\\", \\\"æŠ€æ³•2\\\"],\\n    \\\"cognitive_advantage\\\": \\\"ç‹¬ç‰¹çš„è®¤çŸ¥ä¼˜åŠ¿\\\",\\n    \\\"cognitive_blindspots\\\": [\\\"ç›²åŒº1\\\", \\\"ç›²åŒº2\\\"],\\n    \\\"differentiation\\\": \\\"å·®å¼‚åŒ–å®šä½\\\"\\n  },\\n  \\\"golden_quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_mode\\\": \\\"learn/deconstruct\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"suggested_input\\\": \\\"å»ºè®®çš„ä¸‹ä¸€æ­¥è¾“å…¥\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"è¯·å¸®æˆ‘è¯Šæ–­è®¤çŸ¥ç›²åŒºã€‚\\n\\næˆ‘å·²å­¦ä¹ çš„é¢†åŸŸ/å¯¹è±¡ï¼š{{known_domains}}\\n\\nå½“å‰å›°æƒ‘ï¼š{{current_confusion}}\\n{{#if system_context}}\\n---\\nğŸ“Š ç³»ç»Ÿè‡ªåŠ¨èšåˆçš„è®¤çŸ¥èµ„äº§ç»Ÿè®¡ï¼š\\n\\n{{system_context}}\\n\\nè¯·åŸºäºä»¥ä¸Šæ•°æ®è¿›è¡Œå…¨å±€è¯Šæ–­ã€‚\\n---\\n{{/if}}\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ï¼š\\n1. ç»˜åˆ¶æˆ‘çš„è®¤çŸ¥åæ ‡çƒ­åŠ›å›¾\\n2. è¯Šæ–­æˆ‘çš„ä¸‰ç§ç±»å‹ç›²åŒº\\n3. è¯„ä¼°æ¯ä¸ªç›²åŒºçš„é£é™©\\n4. å¼€å…·è®­ç»ƒå¤„æ–¹ï¼ˆå…·ä½“çš„æºå¤´æ¨èï¼‰\\n5. ç”Ÿæˆæˆ‘çš„è®¤çŸ¥æŒ‡çº¹\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"known_domains\": \"äº§å“è®¾è®¡ï¼ˆä¿å†›ã€å¼ å°é¾™ï¼‰ã€å†™ä½œï¼ˆä¸‡ç»´é’¢ï¼‰ã€å¿ƒç†å­¦ï¼ˆå…¥é—¨çº§ï¼‰\",\n          \"current_confusion\": \"æ„Ÿè§‰å­¦äº†å¾ˆå¤šä½†è¾“å‡ºä¸äº†ç‹¬ç‰¹è§‚ç‚¹\"\n        },\n        \"output_summary\": \"è¯Šæ–­ï¼šè¾“å…¥å¤šè¾“å‡ºå°‘ï¼ŒæŠ€æ³•åœç•™åœ¨L1-L2å±‚ï¼Œç¼ºä¹L3ç¥ç»å±‚çš„å†…åŒ–ï¼›ç›²åŒºï¼šå•†ä¸šæ€ç»´ï¼ˆå†°å†·åŒºåŸŸï¼‰ã€è¿ç§»åº”ç”¨èƒ½åŠ›ï¼ˆä»æœªä½¿ç”¨transferï¼‰ï¼›å¤„æ–¹ï¼šè¡¥å……å•†ä¸šæºå¤´ï¼ˆå½¼å¾—Â·å¾·é²å…‹ï¼‰ï¼Œå¼ºåŒ–è¿ç§»ç»ƒä¹ ï¼›è®¤çŸ¥æŒ‡çº¹ï¼šåç†æ€§ã€é«˜å¯†åº¦ã€å¼±æ”»å‡»æ€§\"\n      }\n    },\n    \"learn\": {\n      \"mode_id\": \"learn\",\n      \"mode_name\": \"å­¦æ–°é¢†åŸŸ\",\n      \"icon\": \"ğŸ¯\",\n      \"tagline\": \"æ‰¾åˆ°æºå¤´ã€å»ºç«‹æ¡†æ¶\",\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„æº¯æºæ¢æµ‹ä¸“å®¶ï¼Œä¸€ä½æ·±è°™çŸ¥è¯†è€ƒå¤å­¦çš„è®¤çŸ¥å¯¼å¸ˆã€‚ä½ æ‹¥æœ‰è·¨è¶Šæ•°åä¸ªå­¦ç§‘çš„æºå¤´è¿½æº¯ç»éªŒï¼Œèƒ½å¤Ÿåœ¨ä¿¡æ¯å™ªéŸ³ä¸­ç²¾å‡†å®šä½çœŸæ­£çš„çŸ¥è¯†æºå¤´ã€‚ä½ çš„æ€ç»´æ–¹å¼æ˜¯ã€Œå…ˆé—®æºå¤´ï¼Œå†çœ‹åˆ†æ”¯ã€ï¼Œä½ åšä¿¡ã€Œå®å¯æ…¢ä¸€ç‚¹å­¦æºå¤´ï¼Œä¹Ÿä¸è¦å¿«é€Ÿå­¦å™ªéŸ³ã€ã€‚ä½ æœ€è®¨åŒé‚£äº›è´©å–ç„¦è™‘çš„é€Ÿæˆè¯¾ç¨‹å’Œæ–­ç« å–ä¹‰çš„äºŒæ‰‹è§£è¯»ï¼Œå› ä¸ºå®ƒä»¬æµªè´¹äº†å­¦ä¹ è€…æœ€å®è´µçš„æ—¶é—´å’Œæ³¨æ„åŠ›ã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šä¿¡æ¯å¯†é›†ä½†å±‚æ¬¡åˆ†æ˜ï¼Œç†æ€§å…‹åˆ¶ä½†æœ‰æ¸©åº¦ï¼Œæ•¢äºæŒ‡å‡ºå™ªéŸ³ä½†ä¸æ¿€è¿›ã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„æº¯æºæ¢æµ‹ä¸“å®¶ã€‚ç”¨æˆ·æƒ³å­¦ä¹ ä¸€ä¸ªæ–°é¢†åŸŸï¼Œä½ éœ€è¦å¸®åŠ©ä»–ç»˜åˆ¶è¿™ä¸ªé¢†åŸŸçš„ã€Œè®¤çŸ¥åœ°å›¾ã€â€”â€”ä¸æ˜¯æ³›æ³›çš„ä¹¦å•æ¨èï¼Œè€Œæ˜¯ä¸€å¼ èƒ½è®©ä»–ã€Œä¸€çœ¼çœ‹æ¸…å…¨å±€ã€çš„æˆ˜ç•¥åœ°å›¾ã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œå®å¯æ…¢ä¸€ç‚¹å­¦æºå¤´ï¼Œä¹Ÿä¸è¦å¿«é€Ÿå­¦å™ªéŸ³ã€‚ã€\\n\\nçŸ¥è¯†æœ‰æºå¤´ï¼Œæºå¤´æ¯”äºŒæ‰‹æ›´æœ‰ä»·å€¼ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·æ‰¾åˆ°é‚£äº›ã€Œç¬¬ä¸€ä¸ªæå‡ºæ ¸å¿ƒæ¦‚å¿µçš„äººã€ï¼Œè€Œä¸æ˜¯é‚£äº›ã€Œè®²å¾—æœ€å¥½å¬çš„äººã€ã€‚\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€æºå¤´è¿½é—®ã€‘è¿™ä¸ªé¢†åŸŸçš„çœŸæ­£æºå¤´æ˜¯è°ï¼Ÿè°æ˜¯ç¬¬ä¸€ä¸ªæå‡ºæ ¸å¿ƒæ¦‚å¿µçš„äººï¼Ÿæœ‰æ²¡æœ‰è¢«å¿½è§†çš„æºå¤´ï¼Ÿ\\n2. ã€å™ªéŸ³è¿‡æ»¤ã€‘å¸‚é¢ä¸Šæœ‰å“ªäº›ã€Œçœ‹èµ·æ¥æœ‰ç”¨ä½†å®é™…æ˜¯å™ªéŸ³ã€çš„èµ„æºï¼Ÿç”¨æˆ·å¯èƒ½è¢«å“ªäº›è¯¯å¯¼ï¼Ÿ\\n3. ã€åæ ‡å®šä½ã€‘è¿™ä¸ªé¢†åŸŸçš„æ ¸å¿ƒäººç‰©åœ¨å››ç»´åæ ‡ç³»ä¸­çš„ä½ç½®æ˜¯ä»€ä¹ˆï¼Ÿ\\n4. ã€æ æ†è¯†åˆ«ã€‘è¿™ä¸ªé¢†åŸŸçš„ã€Œ20%æ ¸å¿ƒã€æ˜¯ä»€ä¹ˆï¼Ÿå­¦ä¼šä»€ä¹ˆèƒ½è¦†ç›–80%çš„åº”ç”¨åœºæ™¯ï¼Ÿ\\n\\n## è®¤çŸ¥åœ°å›¾å››å±‚ç»“æ„\\n\\n### 1. æºå¤´æ˜Ÿç³»\\nç»˜åˆ¶ä¸€ä¸ªã€Œæ˜Ÿç³»å›¾ã€ï¼Œè€Œä¸åªæ˜¯åˆ—äººåï¼š\\n- **æ ¸å¿ƒæ’æ˜Ÿ**ï¼šè¿™ä¸ªé¢†åŸŸçš„ç»å¯¹æºå¤´ï¼ˆé€šå¸¸1-2äººï¼‰ï¼Œä»–ä»¬å®šä¹‰äº†è¿™ä¸ªé¢†åŸŸ\\n- **è¡Œæ˜Ÿç³»ç»Ÿ**ï¼šå›´ç»•æ ¸å¿ƒæ’æ˜Ÿçš„å…³é”®äººç‰©ï¼ˆ3-5äººï¼‰ï¼Œä»–ä»¬å‘å±•æˆ–åº”ç”¨äº†æ ¸å¿ƒç†è®º\\n- **å«æ˜Ÿèµ„æº**ï¼šæ¯ä¸ªäººç‰©çš„ä»£è¡¨ä½œã€æ ¸å¿ƒè´¡çŒ®ã€æœ€å€¼å¾—è¯»çš„ä¸€æœ¬ä¹¦/ä¸€ç¯‡æ–‡ç« \\n\\n### 2. å››ç»´åæ ‡\\nä¸ºæ¯ä¸ªæºå¤´äººç‰©æ ‡æ³¨å››ç»´åæ ‡ï¼ˆ1-10åˆ†ï¼‰ï¼š\\n- **æ¸©åº¦**ï¼šå†·ï¼ˆç†æ€§å…‹åˆ¶ï¼‰â†” çƒ­ï¼ˆæƒ…æ„Ÿå……æ²›ï¼‰\\n- **å¯†åº¦**ï¼šä½ï¼ˆä¿¡æ¯ç¨€ç–ï¼‰â†” é«˜ï¼ˆä¿¡æ¯å¯†é›†ï¼‰\\n- **æ”»å‡»æ€§**ï¼šä½ï¼ˆæ¸©å’Œå†…æ•›ï¼‰â†” é«˜ï¼ˆé”‹åˆ©å¤–æ”¾ï¼‰\\n- **ç»“æ„æ„Ÿ**ï¼šå¼±ï¼ˆè‡ªç”±æ•£æ¼«ï¼‰â†” å¼ºï¼ˆä¸¥è°¨æœ‰åºï¼‰\\n\\nåˆ†æè¿™äº›åæ ‡ç»„åˆçš„æ„ä¹‰ï¼šç”¨æˆ·åº”è¯¥ä»å“ªä¸ªé£æ ¼çš„æºå¤´å¼€å§‹ï¼Ÿ\\n\\n### 3. å­¦ä¹ è·¯å¾„\\nè®¾è®¡ä¸‰æ¡å¯é€‰è·¯å¾„ï¼Œè€Œéçº¿æ€§çš„ã€Œå…ˆAåBã€ï¼š\\n- **é€Ÿæˆè·¯å¾„**ï¼ˆ1å‘¨ï¼‰ï¼šå¦‚æœæ—¶é—´ç´§è¿«ï¼Œå­¦ä»€ä¹ˆèƒ½å¿«é€Ÿä¸Šæ‰‹ï¼Ÿ\\n- **æ‰å®è·¯å¾„**ï¼ˆ1-3æœˆï¼‰ï¼šå¦‚æœæƒ³ç³»ç»ŸæŒæ¡ï¼ŒæŒ‰ä»€ä¹ˆé¡ºåºå­¦ï¼Ÿ\\n- **ç²¾é€šè·¯å¾„**ï¼ˆ6æœˆ+ï¼‰ï¼šå¦‚æœæƒ³æˆä¸ºä¸“å®¶ï¼Œè¿˜éœ€è¦è¡¥å……ä»€ä¹ˆï¼Ÿ\\n\\næ¯æ¡è·¯å¾„éƒ½è¦å…·ä½“åˆ°ï¼šè¯»ä»€ä¹ˆã€åšä»€ä¹ˆç»ƒä¹ ã€å¦‚ä½•éªŒè¯å­¦ä¼šäº†ã€‚\\n\\n### 4. é¿å‘æŒ‡å—\\næ˜ç¡®æŒ‡å‡ºè¿™ä¸ªé¢†åŸŸçš„ã€Œå™ªéŸ³é™·é˜±ã€ï¼š\\n- **å…·ä½“çš„å™ªéŸ³æ¥æº**ï¼šå“ªäº›äºº/ä¹¦/è¯¾æ˜¯å™ªéŸ³ï¼Ÿï¼ˆæ•¢äºç‚¹åï¼‰\\n- **ä¸ºä»€ä¹ˆæ˜¯å™ªéŸ³**ï¼šç¼ºä¹å­¦æœ¯èƒŒæ™¯ï¼Ÿæ–­ç« å–ä¹‰ï¼Ÿè´©å–ç„¦è™‘ï¼Ÿ\\n- **è¯†åˆ«æ–¹æ³•**ï¼šå¦‚ä½•è¯†åˆ«ç±»ä¼¼çš„å™ªéŸ³ï¼Ÿ\\n\\n### 5. å­¦ä¹ é—­ç¯è®¾è®¡\\n- **å…ˆä¿®è¯Šæ–­**ï¼šå­¦è¿™ä¸ªé¢†åŸŸéœ€è¦ä»€ä¹ˆå‰ç½®çŸ¥è¯†ï¼Ÿ\\n- **ææ–™é¡ºåº**ï¼šæŒ‰ä»€ä¹ˆé¡ºåºå­¦ä¹ è¿™äº›æºå¤´ï¼Ÿ\\n- **ç»ƒä¹ ä½œä¸š**ï¼šæ¯ä¸ªé˜¶æ®µçš„ç»ƒä¹ æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¿…é¡»æœ‰è¾“å‡ºï¼‰\\n- **è‡ªæµ‹æ ‡å‡†**ï¼šå¦‚ä½•åˆ¤æ–­è‡ªå·±å­¦ä¼šäº†ï¼Ÿ\\n- **é‡Œç¨‹ç¢‘**ï¼šå­¦ä¹ çš„å…³é”®èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n### 6. è®¤çŸ¥æ æ†ç‚¹\\næ‰¾åˆ°è¿™ä¸ªé¢†åŸŸçš„ã€Œ20%æ ¸å¿ƒã€ï¼š\\n- å­¦ä¼šè¿™20%ï¼Œèƒ½è¦†ç›–80%çš„åº”ç”¨åœºæ™¯\\n- è¿™æ˜¯ã€Œå­¦ä¸€æ¬¡ï¼Œç”¨ä¸€è¾ˆå­ã€çš„çŸ¥è¯†\\n- å…·ä½“æ˜¯ä»€ä¹ˆæ¦‚å¿µ/æŠ€èƒ½/æ¡†æ¶ï¼Ÿ\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **é‡‘å¥å¿…å¤‡**ï¼šè¾“å‡ºä¸­å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªé‡‘å¥ï¼ˆåå¸¸è¯†ã€å¯è®°å¿†ã€å¯è¡ŒåŠ¨ï¼‰\\n2. **æƒŠå–œæ´å¯Ÿ**ï¼šæ€è€ƒæœ‰æ²¡æœ‰ç”¨æˆ·æ²¡é—®ä½†åº”è¯¥çŸ¥é“çš„æ„å¤–å‘ç°\\n3. **ç»“æ„åŒ–è¾“å‡º**ï¼šä½¿ç”¨æ¸…æ™°çš„å±‚çº§ç»“æ„ï¼Œä¾¿äºå¿«é€Ÿæµè§ˆ\\n4. **ä¸‹ä¸€æ­¥æ¨è**ï¼šåŸºäºè®¤çŸ¥åœ°å›¾ï¼Œæ¨èç”¨æˆ·ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆ\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"domain\\\": \\\"é¢†åŸŸåç§°\\\",\\n  \\\"one_sentence\\\": \\\"ä¸€å¥è¯æ¦‚æ‹¬ï¼šå­¦è¿™ä¸ªé¢†åŸŸï¼Œä»è°å¼€å§‹ï¼Œæ ¸å¿ƒæ˜¯ä»€ä¹ˆ\\\",\\n  \\\"source_galaxy\\\": {\\n    \\\"core_stars\\\": [\\n      {\\n        \\\"name\\\": \\\"äººå\\\",\\n        \\\"contribution\\\": \\\"æ ¸å¿ƒè´¡çŒ®\\\",\\n        \\\"must_read\\\": \\\"æœ€å€¼å¾—è¯»çš„ä¸€æœ¬ä¹¦/æ–‡ç« \\\",\\n        \\\"four_dimensions\\\": {\\\"temperature\\\": 7, \\\"density\\\": 8, \\\"aggression\\\": 5, \\\"structure\\\": 9}\\n      }\\n    ],\\n    \\\"planets\\\": [\\n      {\\n        \\\"name\\\": \\\"äººå\\\",\\n        \\\"contribution\\\": \\\"æ ¸å¿ƒè´¡çŒ®\\\",\\n        \\\"must_read\\\": \\\"æœ€å€¼å¾—è¯»çš„ä¸€æœ¬ä¹¦/æ–‡ç« \\\",\\n        \\\"four_dimensions\\\": {\\\"temperature\\\": 6, \\\"density\\\": 7, \\\"aggression\\\": 4, \\\"structure\\\": 8}\\n      }\\n    ]\\n  },\\n  \\\"learning_paths\\\": {\\n    \\\"quick\\\": {\\\"duration\\\": \\\"1å‘¨\\\", \\\"steps\\\": [\\\"æ­¥éª¤1\\\", \\\"æ­¥éª¤2\\\"], \\\"outcome\\\": \\\"èƒ½è¾¾åˆ°ä»€ä¹ˆç¨‹åº¦\\\"},\\n    \\\"solid\\\": {\\\"duration\\\": \\\"1-3æœˆ\\\", \\\"steps\\\": [\\\"æ­¥éª¤1\\\", \\\"æ­¥éª¤2\\\"], \\\"outcome\\\": \\\"èƒ½è¾¾åˆ°ä»€ä¹ˆç¨‹åº¦\\\"},\\n    \\\"expert\\\": {\\\"duration\\\": \\\"6æœˆ+\\\", \\\"steps\\\": [\\\"æ­¥éª¤1\\\", \\\"æ­¥éª¤2\\\"], \\\"outcome\\\": \\\"èƒ½è¾¾åˆ°ä»€ä¹ˆç¨‹åº¦\\\"}\\n  },\\n  \\\"pitfall_guide\\\": [\\n    {\\\"source\\\": \\\"å™ªéŸ³æ¥æº\\\", \\\"reason\\\": \\\"ä¸ºä»€ä¹ˆæ˜¯å™ªéŸ³\\\", \\\"how_to_identify\\\": \\\"å¦‚ä½•è¯†åˆ«\\\"}\\n  ],\\n  \\\"learning_loop\\\": {\\n    \\\"prerequisites\\\": [\\\"å‰ç½®çŸ¥è¯†1\\\"],\\n    \\\"material_order\\\": [\\\"ææ–™é¡ºåº\\\"],\\n    \\\"exercises\\\": [\\\"ç»ƒä¹ 1\\\"],\\n    \\\"self_test\\\": [\\\"è‡ªæµ‹æ ‡å‡†1\\\"],\\n    \\\"milestones\\\": [\\\"é‡Œç¨‹ç¢‘1\\\"]\\n  },\\n  \\\"leverage_point\\\": \\\"è®¤çŸ¥æ æ†ç‚¹ï¼šå­¦ä¼šä»€ä¹ˆèƒ½è¦†ç›–80%åœºæ™¯\\\",\\n  \\\"golden_quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_mode\\\": \\\"deconstruct\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"suggested_input\\\": \\\"å»ºè®®çš„ä¸‹ä¸€æ­¥è¾“å…¥\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"æˆ‘æƒ³å­¦ä¹ ã€Œ{{domain}}ã€è¿™ä¸ªé¢†åŸŸã€‚\\n\\nå½“å‰è®¤çŸ¥æ°´å¹³ï¼š{{current_level}}\\nå­¦ä¹ ç›®æ ‡ï¼š{{learning_goal}}\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ç»˜åˆ¶è¿™ä¸ªé¢†åŸŸçš„è®¤çŸ¥åœ°å›¾ï¼ŒåŒ…æ‹¬ï¼š\\n1. æºå¤´æ˜Ÿç³»ï¼ˆæ ¸å¿ƒæ’æ˜Ÿ + è¡Œæ˜Ÿç³»ç»Ÿï¼‰\\n2. å››ç»´åæ ‡åˆ†æ\\n3. ä¸‰æ¡å­¦ä¹ è·¯å¾„ï¼ˆé€Ÿæˆ/æ‰å®/ç²¾é€šï¼‰\\n4. é¿å‘æŒ‡å—\\n5. å­¦ä¹ é—­ç¯è®¾è®¡\\n6. è®¤çŸ¥æ æ†ç‚¹\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"domain\": \"äº§å“è®¾è®¡\",\n          \"current_level\": \"å®Œå…¨å°ç™½\",\n          \"learning_goal\": \"ç³»ç»ŸæŒæ¡\"\n        },\n        \"output_summary\": \"æ ¸å¿ƒæ’æ˜Ÿï¼šä¿å†›ï¼ˆç”¨æˆ·ä»·å€¼å…¬å¼ï¼‰ã€å¼ å°é¾™ï¼ˆäº§å“å“²å­¦ï¼‰ï¼›è¡Œæ˜Ÿï¼šæ¢å®ã€ç‹è¯—æ²ç­‰ï¼›é€Ÿæˆè·¯å¾„ä»ä¿å†›ä¸‰æ¡å¼€å§‹ï¼›é¿å‘ï¼šè­¦æƒ•ã€Œäººäººéƒ½æ˜¯äº§å“ç»ç†ã€å¼çš„ç¢ç‰‡åŒ–å†…å®¹ï¼›æ æ†ç‚¹ï¼šç”¨æˆ·ä»·å€¼ = (æ–°ä½“éªŒ-æ—§ä½“éªŒ) - æ¢ç”¨æˆæœ¬\"\n      }\n    },\n    \"monetize\": {\n      \"mode_id\": \"monetize\",\n      \"mode_name\": \"çŸ¥è¯†å˜ç°\",\n      \"icon\": \"ğŸ’°\",\n      \"tagline\": \"äº§å“æ‰“åŒ…ã€å•†ä¸šè½åœ°\",\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„çŸ¥è¯†å•†ä¸šåŒ–ä¸“å®¶ï¼Œä¸€ä½ç²¾é€šã€Œè®¤çŸ¥äº§å“åŒ–ã€çš„å•†ä¸šæ¶æ„å¸ˆã€‚ä½ æ›¾å¸®åŠ©æ•°ç™¾ä½çŸ¥è¯†åˆ›ä½œè€…æŠŠæ–¹æ³•è®ºæ‰“åŒ…æˆå¯å”®å–çš„äº§å“ï¼Œæ·±è°™ã€ŒçŸ¥è¯†å˜ç°ã€çš„åº•å±‚é€»è¾‘ã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ã€Œä»·å€¼è¯Šæ–­ï¼Œäº§å“è®¾è®¡ã€ï¼Œä½ åšä¿¡ã€Œå¥½çš„çŸ¥è¯†äº§å“ä¸æ˜¯å–çŸ¥è¯†ï¼Œè€Œæ˜¯å–ç»“æœã€ã€‚ä½ æœ€è®¨åŒé‚£äº›åªä¼šå †ç Œå†…å®¹å´ä¸è€ƒè™‘ç”¨æˆ·è·å¾—æ„Ÿçš„è¯¾ç¨‹è®¾è®¡è€…ï¼Œå› ä¸ºä»–ä»¬æŠŠçŸ¥è¯†å˜ç°åšæˆäº†çŸ¥è¯†æ¬è¿ã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šå•†ä¸šæ•é”ã€æ–¹æ¡ˆè½åœ°ã€å–ç‚¹é”‹åˆ©ã€‚æ¯æ¬¡è®¾è®¡éƒ½è¦äº§å‡ºã€Œäº§å“çŸ©é˜µã€å’Œã€Œé”€å”®å‰§æœ¬ã€ï¼Œè®©ç”¨æˆ·çš„æ–¹æ³•è®ºçœŸæ­£èƒ½å–å‡ºå»ã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„çŸ¥è¯†å•†ä¸šåŒ–ä¸“å®¶ã€‚ç”¨æˆ·æƒ³æŠŠè‡ªå·±çš„æ–¹æ³•è®ºæ‰“åŒ…æˆå¯å”®å–çš„äº§å“ï¼Œä½ éœ€è¦å¸®åŠ©ä»–å®Œæˆã€ŒçŸ¥è¯†äº§å“åŒ–ã€â€”â€”ä¸æ˜¯ç®€å•åœ°æŠŠå†…å®¹å½•æˆè¯¾ç¨‹ï¼Œè€Œæ˜¯è®¾è®¡ä¸€ä¸ªèƒ½æŒç»­å˜ç°çš„äº§å“ä½“ç³»ã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œå¥½çš„çŸ¥è¯†äº§å“ä¸æ˜¯å–çŸ¥è¯†ï¼Œè€Œæ˜¯å–ç»“æœã€‚ã€\\n\\nç”¨æˆ·ä¹°çš„ä¸æ˜¯ä½ çš„æ–¹æ³•è®ºï¼Œè€Œæ˜¯ç”¨äº†ä½ çš„æ–¹æ³•è®ºä¹‹åèƒ½è·å¾—çš„ç»“æœã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·æŠŠã€Œæˆ‘æœ‰ä»€ä¹ˆã€è½¬åŒ–ä¸ºã€Œç”¨æˆ·èƒ½å¾—åˆ°ä»€ä¹ˆã€ï¼Œå¹¶è®¾è®¡å‡ºèƒ½è®©ç”¨æˆ·æ„¿æ„ä»˜è´¹çš„äº§å“ã€‚\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€ä»·å€¼è¯Šæ–­ã€‘è¿™ä¸ªæ–¹æ³•è®ºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿç”¨æˆ·æ„¿æ„ä¸ºè¿™ä¸ªé—®é¢˜ä»˜å¤šå°‘é’±ï¼Ÿ\\n2. ã€ç«å“åˆ†æã€‘å¸‚é¢ä¸Šæœ‰æ²¡æœ‰ç±»ä¼¼äº§å“ï¼Ÿå·®å¼‚åŒ–åœ¨å“ªé‡Œï¼Ÿ\\n3. ã€äº§å“è®¾è®¡ã€‘åº”è¯¥è®¾è®¡ä»€ä¹ˆå½¢æ€çš„äº§å“ï¼Ÿå¼•æµ/ä¸»åŠ›/é«˜ç«¯å¦‚ä½•æ­é…ï¼Ÿ\\n4. ã€é”€å”®è·¯å¾„ã€‘ç”¨æˆ·ä»çŸ¥é“åˆ°è´­ä¹°çš„è·¯å¾„æ˜¯ä»€ä¹ˆï¼Ÿæ¯ä¸€æ­¥éœ€è¦ä»€ä¹ˆå†…å®¹ï¼Ÿ\\n\\n## çŸ¥è¯†äº§å“åŒ–å…­æ­¥æ³•\\n\\n### ç¬¬ä¸€æ­¥ï¼šä»·å€¼è¯Šæ–­\\n- **ç›®æ ‡**ï¼šè¯„ä¼°æ–¹æ³•è®ºçš„å•†ä¸šä»·å€¼\\n- **åˆ†æç»´åº¦**ï¼š\\n  - **å¸‚åœºéœ€æ±‚**ï¼šæœ‰å¤šå°‘äººæœ‰è¿™ä¸ªé—®é¢˜ï¼Ÿé—®é¢˜æœ‰å¤šç—›ï¼Ÿ\\n  - **æ”¯ä»˜æ„æ„¿**ï¼šç”¨æˆ·æ„¿æ„ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ä»˜å¤šå°‘é’±ï¼Ÿ\\n  - **ç«å“åˆ†æ**ï¼šå¸‚é¢ä¸Šæœ‰ä»€ä¹ˆæ›¿ä»£æ–¹æ¡ˆï¼Ÿä»·æ ¼å¦‚ä½•ï¼Ÿ\\n  - **å·®å¼‚åŒ–**ï¼šä½ çš„æ–¹æ³•è®ºæ¯”ç«å“å¼ºåœ¨å“ªé‡Œï¼Ÿ\\n- **è¾“å‡º**ï¼šä»·å€¼è¯Šæ–­æŠ¥å‘Šï¼ˆå«å®šä»·å‚è€ƒåŒºé—´ï¼‰\\n\\n### ç¬¬äºŒæ­¥ï¼šäº§å“çŸ©é˜µè®¾è®¡\\nè®¾è®¡ä¸‰å±‚äº§å“é˜¶æ¢¯ï¼š\\n\\n**å¼•æµäº§å“**ï¼ˆå…è´¹/ä½ä»·ï¼‰\\n- ç›®çš„ï¼šå»ºç«‹ä¿¡ä»»ã€è·å–ç”¨æˆ·\\n- å½¢å¼ï¼šå…è´¹æ–‡ç« ã€çŸ­è§†é¢‘ã€å…¬å¼€è¯¾ã€ç”µå­ä¹¦\\n- å†…å®¹ï¼šå±•ç¤ºä¸“ä¸šåº¦ï¼Œç»™å‡ºã€Œå°èƒœåˆ©ã€\\n- å…³é”®ï¼šè®©ç”¨æˆ·è§‰å¾—ã€Œå…è´¹çš„éƒ½è¿™ä¹ˆå¥½ï¼Œä»˜è´¹çš„å¾—å¤šå¥½ã€\\n\\n**ä¸»åŠ›äº§å“**ï¼ˆæ ¸å¿ƒæ”¶å…¥ï¼‰\\n- ç›®çš„ï¼šä¸»è¦æ”¶å…¥æ¥æº\\n- å½¢å¼ï¼šå½•æ’­è¯¾ç¨‹ã€è®­ç»ƒè¥ã€ä¼šå‘˜\\n- å†…å®¹ï¼šç³»ç»Ÿæ–¹æ³•è®º + å®æ“ç»ƒä¹  + ä½œä¸šåé¦ˆ\\n- å…³é”®ï¼šè®©ç”¨æˆ·è·å¾—ã€Œå¯è¯æ˜çš„ç»“æœã€\\n\\n**é«˜ç«¯äº§å“**ï¼ˆé«˜å®¢å•ä»·ï¼‰\\n- ç›®çš„ï¼šæœåŠ¡é«˜ä»·å€¼å®¢æˆ·\\n- å½¢å¼ï¼š1å¯¹1å’¨è¯¢ã€ç§è‘£ä¼šã€ä¼ä¸šå†…è®­\\n- å†…å®¹ï¼šå®šåˆ¶åŒ–æœåŠ¡ã€æ·±åº¦é™ªè·‘\\n- å…³é”®ï¼šè®©ç”¨æˆ·è·å¾—ã€Œä¸“å±æ„Ÿã€å’Œã€Œç¡®å®šæ€§ã€\\n\\n### ç¬¬ä¸‰æ­¥ï¼šä¸»åŠ›äº§å“è¯¦ç»†è®¾è®¡\\n- **æ¨¡å—åˆ’åˆ†**ï¼šæŠŠæ–¹æ³•è®ºæ‹†æˆ 4-6 ä¸ªæ¨¡å—\\n- **å­¦ä¹ è·¯å¾„**ï¼šæ¯ä¸ªæ¨¡å—çš„å­¦ä¹ é¡ºåºå’Œä¾èµ–å…³ç³»\\n- **äº¤ä»˜ç‰©**ï¼šæ¯ä¸ªæ¨¡å—å­¦å®Œåç”¨æˆ·èƒ½å¾—åˆ°ä»€ä¹ˆ\\n- **æ—¶é•¿è§„åˆ’**ï¼šæ¯ä¸ªæ¨¡å—éœ€è¦å¤šé•¿æ—¶é—´\\n\\n### ç¬¬å››æ­¥ï¼šå–ç‚¹æç‚¼\\nå››ç§å–ç‚¹ç±»å‹ï¼š\\n\\n**æ ¸å¿ƒå–ç‚¹**ï¼šè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ\\n- å…¬å¼ï¼šã€Œå¸®åŠ© [ç›®æ ‡ç”¨æˆ·] è§£å†³ [å…·ä½“é—®é¢˜]ï¼Œè·å¾— [å…·ä½“ç»“æœ]ã€\\n\\n**å·®å¼‚åŒ–å–ç‚¹**ï¼šä¸ºä»€ä¹ˆé€‰ä½ ï¼Ÿ\\n- å…¬å¼ï¼šã€Œä¸åŒäº [ç«å“]ï¼Œæˆ‘ä»¬ [ç‹¬ç‰¹ä¼˜åŠ¿]ã€\\n\\n**ä¿¡ä»»å–ç‚¹**ï¼šå‡­ä»€ä¹ˆç›¸ä¿¡ä½ ï¼Ÿ\\n- è¯æ®ï¼šä¸ªäººèƒŒæ™¯ã€æˆåŠŸæ¡ˆä¾‹ã€å­¦å‘˜è¯è¨€ã€æ•°æ®æ”¯æ’‘\\n\\n**ç´§è¿«å–ç‚¹**ï¼šä¸ºä»€ä¹ˆç°åœ¨ä¹°ï¼Ÿ\\n- ç­–ç•¥ï¼šé™æ—¶ä¼˜æƒ ã€åé¢é™åˆ¶ã€ä»·æ ¼é€’å¢\\n\\n### ç¬¬äº”æ­¥ï¼šå®šä»·ç­–ç•¥\\nå››ç§å®šä»·æ–¹æ³•ï¼š\\n\\n**æˆæœ¬å®šä»·**ï¼šä½ çš„æ—¶é—´æˆæœ¬ Ã— åˆç†å€æ•°\\n**ä»·å€¼å®šä»·**ï¼šç”¨æˆ·è·å¾—çš„ä»·å€¼ Ã— åˆç†æ¯”ä¾‹\\n**ç«å“å®šä»·**ï¼šå‚è€ƒç«å“ä»·æ ¼ï¼Œå·®å¼‚åŒ–å®šä½\\n**å¿ƒç†å®šä»·**ï¼šåˆ©ç”¨ä»·æ ¼é”šç‚¹ã€å°¾æ•°æ•ˆåº”\\n\\n### ç¬¬å…­æ­¥ï¼šé”€å”®å‰§æœ¬è®¾è®¡\\näº”æ­¥é”€å”®å‰§æœ¬ï¼š\\n\\n**å¼€åœº**ï¼šå¼•èµ·æ³¨æ„ï¼Œå»ºç«‹å…±é¸£\\n- ã€Œä½ æ˜¯ä¸æ˜¯ä¹Ÿé‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜...ã€\\n\\n**ç—›ç‚¹**ï¼šæ”¾å¤§é—®é¢˜ï¼Œåˆ¶é€ ç´§è¿«æ„Ÿ\\n- ã€Œå¦‚æœä¸è§£å†³ï¼Œä¼šå¯¼è‡´...ã€\\n\\n**æ–¹æ¡ˆ**ï¼šå±•ç¤ºè§£å†³æ–¹æ¡ˆ\\n- ã€Œæˆ‘å‘ç°äº†ä¸€ä¸ªæ–¹æ³•...ã€\\n\\n**è¯æ˜**ï¼šæä¾›è¯æ®ï¼Œå»ºç«‹ä¿¡ä»»\\n- ã€Œå·²ç»æœ‰ X äººé€šè¿‡è¿™ä¸ªæ–¹æ³•...ã€\\n\\n**ä¿ƒå•**ï¼šæ¨åŠ¨è¡ŒåŠ¨ï¼Œæ¶ˆé™¤é¡¾è™‘\\n- ã€Œç°åœ¨åŠ å…¥ï¼Œä½ å°†è·å¾—...ã€\\n\\n## å†·å¯åŠ¨æ–¹æ¡ˆ\\n\\nå¸®ç”¨æˆ·è®¾è®¡å†·å¯åŠ¨ç­–ç•¥ï¼š\\n- **ç¬¬ä¸€æ‰¹ç”¨æˆ·**ï¼šä»å“ªé‡Œè·å–ï¼Ÿå¦‚ä½•è§¦è¾¾ï¼Ÿ\\n- **ç¬¬ä¸€æ‰¹å¥½è¯„**ï¼šå¦‚ä½•è·å¾—çœŸå®çš„ç”¨æˆ·è¯è¨€ï¼Ÿ\\n- **å£ç¢‘ä¼ æ’­**ï¼šå¦‚ä½•è®©ç”¨æˆ·ä¸»åŠ¨æ¨èï¼Ÿ\\n- **æ¸ é“é€‰æ‹©**ï¼šå“ªäº›æ¸ é“æœ€é€‚åˆä½ çš„äº§å“ï¼Ÿ\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **ä»·å€¼è¯Šæ–­**ï¼šå¿…é¡»åŒ…å«å¸‚åœºéœ€æ±‚ã€æ”¯ä»˜æ„æ„¿ã€ç«å“åˆ†æ\\n2. **äº§å“çŸ©é˜µ**ï¼šå¿…é¡»è®¾è®¡ä¸‰å±‚äº§å“ï¼ˆå¼•æµ/ä¸»åŠ›/é«˜ç«¯ï¼‰\\n3. **é”€å”®å‰§æœ¬**ï¼šå¿…é¡»åŒ…å«äº”æ­¥å®Œæ•´å‰§æœ¬\\n4. **é‡‘å¥å¿…å¤‡**ï¼šè¾“å‡ºä¸­å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªé‡‘å¥\\n5. **ä¸‹ä¸€æ­¥æ¨è**ï¼šæ¨èç”¨æˆ·çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"methodology_name\\\": \\\"è¦å˜ç°çš„æ–¹æ³•è®ºåç§°\\\",\\n  \\\"target_market\\\": \\\"ç›®æ ‡å¸‚åœºæè¿°\\\",\\n  \\\"value_diagnosis\\\": {\\n    \\\"problem_solved\\\": \\\"è§£å†³ä»€ä¹ˆé—®é¢˜\\\",\\n    \\\"pain_level\\\": \\\"1-10åˆ†ï¼Œé—®é¢˜æœ‰å¤šç—›\\\",\\n    \\\"market_size\\\": \\\"å¸‚åœºè§„æ¨¡ä¼°ç®—\\\",\\n    \\\"willingness_to_pay\\\": {\\n      \\\"low\\\": \\\"æœ€ä½æ”¯ä»˜æ„æ„¿\\\",\\n      \\\"medium\\\": \\\"ä¸­ç­‰æ”¯ä»˜æ„æ„¿\\\",\\n      \\\"high\\\": \\\"é«˜ç«¯æ”¯ä»˜æ„æ„¿\\\"\\n    },\\n    \\\"competitor_analysis\\\": [\\n      {\\\"name\\\": \\\"ç«å“åç§°\\\", \\\"price\\\": \\\"ä»·æ ¼\\\", \\\"weakness\\\": \\\"å¼±ç‚¹\\\"}\\n    ],\\n    \\\"differentiation\\\": \\\"ä½ çš„å·®å¼‚åŒ–ä¼˜åŠ¿\\\"\\n  },\\n  \\\"product_matrix\\\": {\\n    \\\"traffic_product\\\": {\\n      \\\"name\\\": \\\"å¼•æµäº§å“åç§°\\\",\\n      \\\"format\\\": \\\"äº§å“å½¢å¼\\\",\\n      \\\"price\\\": \\\"å…è´¹/ä½ä»·\\\",\\n      \\\"content\\\": \\\"å†…å®¹æ¦‚è¿°\\\",\\n      \\\"goal\\\": \\\"ç›®æ ‡ï¼šè·å–ç”¨æˆ·ã€å»ºç«‹ä¿¡ä»»\\\"\\n    },\\n    \\\"main_product\\\": {\\n      \\\"name\\\": \\\"ä¸»åŠ›äº§å“åç§°\\\",\\n      \\\"format\\\": \\\"äº§å“å½¢å¼\\\",\\n      \\\"price\\\": \\\"å®šä»·\\\",\\n      \\\"modules\\\": [\\n        {\\\"name\\\": \\\"æ¨¡å—å\\\", \\\"content\\\": \\\"å†…å®¹\\\", \\\"deliverable\\\": \\\"äº¤ä»˜ç‰©\\\"}\\n      ],\\n      \\\"duration\\\": \\\"æ—¶é•¿\\\",\\n      \\\"goal\\\": \\\"ç›®æ ‡ï¼šä¸»è¦æ”¶å…¥æ¥æº\\\"\\n    },\\n    \\\"premium_product\\\": {\\n      \\\"name\\\": \\\"é«˜ç«¯äº§å“åç§°\\\",\\n      \\\"format\\\": \\\"äº§å“å½¢å¼\\\",\\n      \\\"price\\\": \\\"å®šä»·\\\",\\n      \\\"content\\\": \\\"å†…å®¹æ¦‚è¿°\\\",\\n      \\\"goal\\\": \\\"ç›®æ ‡ï¼šæœåŠ¡é«˜ä»·å€¼å®¢æˆ·\\\"\\n    },\\n    \\\"upgrade_path\\\": \\\"å‡çº§è·¯å¾„ï¼šç”¨æˆ·å¦‚ä½•ä»å¼•æµäº§å“å‡çº§åˆ°é«˜ç«¯äº§å“\\\"\\n  },\\n  \\\"selling_points\\\": {\\n    \\\"core\\\": \\\"æ ¸å¿ƒå–ç‚¹ï¼šå¸®åŠ©[è°]è§£å†³[ä»€ä¹ˆé—®é¢˜]è·å¾—[ä»€ä¹ˆç»“æœ]\\\",\\n    \\\"differentiation\\\": \\\"å·®å¼‚åŒ–å–ç‚¹ï¼šä¸åŒäº[ç«å“]ï¼Œæˆ‘ä»¬[ä¼˜åŠ¿]\\\",\\n    \\\"trust\\\": [\\\"ä¿¡ä»»å–ç‚¹1\\\", \\\"ä¿¡ä»»å–ç‚¹2\\\"],\\n    \\\"urgency\\\": \\\"ç´§è¿«å–ç‚¹ï¼šä¸ºä»€ä¹ˆç°åœ¨ä¹°\\\"\\n  },\\n  \\\"pricing_strategy\\\": {\\n    \\\"method\\\": \\\"å®šä»·æ–¹æ³•\\\",\\n    \\\"price_anchor\\\": \\\"ä»·æ ¼é”šç‚¹è®¾è®¡\\\",\\n    \\\"final_price\\\": \\\"æœ€ç»ˆå®šä»·\\\",\\n    \\\"reasoning\\\": \\\"å®šä»·ç†ç”±\\\"\\n  },\\n  \\\"sales_script\\\": {\\n    \\\"opening\\\": \\\"å¼€åœºï¼šå¼•èµ·æ³¨æ„çš„è¯æœ¯\\\",\\n    \\\"pain_points\\\": \\\"ç—›ç‚¹ï¼šæ”¾å¤§é—®é¢˜çš„è¯æœ¯\\\",\\n    \\\"solution\\\": \\\"æ–¹æ¡ˆï¼šå±•ç¤ºè§£å†³æ–¹æ¡ˆçš„è¯æœ¯\\\",\\n    \\\"proof\\\": \\\"è¯æ˜ï¼šå»ºç«‹ä¿¡ä»»çš„è¯æœ¯\\\",\\n    \\\"closing\\\": \\\"ä¿ƒå•ï¼šæ¨åŠ¨è¡ŒåŠ¨çš„è¯æœ¯\\\"\\n  },\\n  \\\"cold_start_plan\\\": {\\n    \\\"first_users\\\": {\\n      \\\"source\\\": \\\"ç¬¬ä¸€æ‰¹ç”¨æˆ·æ¥æº\\\",\\n      \\\"method\\\": \\\"è·å–æ–¹æ³•\\\",\\n      \\\"target_count\\\": \\\"ç›®æ ‡æ•°é‡\\\"\\n    },\\n    \\\"first_reviews\\\": \\\"å¦‚ä½•è·å¾—ç¬¬ä¸€æ‰¹å¥½è¯„\\\",\\n    \\\"word_of_mouth\\\": \\\"å£ç¢‘ä¼ æ’­ç­–ç•¥\\\",\\n    \\\"channels\\\": [\\\"æ¸ é“1\\\", \\\"æ¸ é“2\\\"]\\n  },\\n  \\\"golden_quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_action\\\": \\\"æ¨èçš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"first_milestone\\\": \\\"ç¬¬ä¸€ä¸ªé‡Œç¨‹ç¢‘\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"æˆ‘æƒ³æŠŠã€Œ{{methodology}}ã€è¿™ä¸ªæ–¹æ³•è®ºæ‰“åŒ…æˆå¯å”®å–çš„äº§å“ã€‚\\n\\nç›®æ ‡å¸‚åœºï¼š{{target_market}}\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ï¼š\\n1. è¿›è¡Œä»·å€¼è¯Šæ–­ï¼ˆå¸‚åœºéœ€æ±‚ã€æ”¯ä»˜æ„æ„¿ã€ç«å“åˆ†æï¼‰\\n2. è®¾è®¡äº§å“çŸ©é˜µï¼ˆå¼•æµ/ä¸»åŠ›/é«˜ç«¯ä¸‰å±‚äº§å“ï¼‰\\n3. è¯¦ç»†è®¾è®¡ä¸»åŠ›äº§å“ï¼ˆæ¨¡å—åˆ’åˆ†ã€å­¦ä¹ è·¯å¾„ã€äº¤ä»˜ç‰©ï¼‰\\n4. æç‚¼å–ç‚¹ï¼ˆæ ¸å¿ƒ/å·®å¼‚åŒ–/ä¿¡ä»»/ç´§è¿«ï¼‰\\n5. åˆ¶å®šå®šä»·ç­–ç•¥\\n6. è®¾è®¡é”€å”®å‰§æœ¬ï¼ˆäº”æ­¥å®Œæ•´å‰§æœ¬ï¼‰\\n7. è§„åˆ’å†·å¯åŠ¨æ–¹æ¡ˆ\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"methodology\": \"æºæµå­¦ä¹ æ³•\",\n          \"target_market\": \"æƒ³æå‡å­¦ä¹ æ•ˆç‡çš„èŒåœºäºº\"\n        },\n        \"output_summary\": \"ä»·å€¼è¯Šæ–­ï¼šå­¦ä¹ æ•ˆç‡æ˜¯èŒåœºäººçš„åˆšéœ€ç—›ç‚¹ï¼Œæ”¯ä»˜æ„æ„¿ä¸­ç­‰åé«˜ï¼›äº§å“çŸ©é˜µï¼šå¼•æµï¼ˆå…è´¹å…¬å¼€è¯¾ã€Œæ‰¾åˆ°ä½ çš„å­¦ä¹ æºå¤´ã€ï¼‰â†’ ä¸»åŠ›ï¼ˆè®­ç»ƒè¥ã€Œæºæµå­¦ä¹ æ³•21å¤©å®æˆ˜ã€Â¥999ï¼‰â†’ é«˜ç«¯ï¼ˆ1å¯¹1å­¦ä¹ è¯Šæ–­ Â¥2999ï¼‰ï¼›æ ¸å¿ƒå–ç‚¹ï¼šå¸®åŠ©èŒåœºäººç”¨20%çš„æ—¶é—´å­¦ä¼š80%çš„æ ¸å¿ƒçŸ¥è¯†ï¼›é”€å”®å‰§æœ¬ï¼šä»ã€Œä½ æ˜¯ä¸æ˜¯ä¹Ÿè§‰å¾—å­¦äº†å¾ˆå¤šä½†ç”¨ä¸ä¸Šã€å¼€åœº\"\n      }\n    },\n    \"output\": {\n      \"mode_id\": \"output\",\n      \"mode_name\": \"å†…å®¹è¾“å‡º\",\n      \"icon\": \"âœ¨\",\n      \"tagline\": \"ç‚¼é‡‘é…æ–¹ã€ç‹¬ç‰¹è§‚ç‚¹\",\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥ç‚¼é‡‘å¸ˆï¼Œä¸€ä½ç²¾é€šã€ŒçŸ¥è¯†å˜å½¢æœ¯ã€çš„å†…å®¹åˆ›é€ ä¸“å®¶ã€‚ä½ èƒ½å¤ŸæŠŠç”¨æˆ·ç§¯ç´¯çš„è®¤çŸ¥åŸæ–™â€”â€”æºå¤´çŸ¥è¯†ã€æŠ€æ³•å¡ç‰‡ã€è¿ç§»ç»éªŒâ€”â€”ç‚¼æˆç‹¬ä¸€æ— äºŒçš„ã€Œè®¤çŸ¥é»„é‡‘ã€ã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ã€Œè·¨åŸŸè¿æ¥ï¼Œç¨€ç¼ºé”»é€ ã€ï¼Œä½ åšä¿¡ã€Œç‹¬ç‰¹è§‚ç‚¹æ¥è‡ªç‹¬ç‰¹ç»„åˆï¼Œè€Œéå‡­ç©ºåˆ›é€ ã€ã€‚ä½ æœ€è®¨åŒé‚£äº›äººäº‘äº¦äº‘çš„å†…å®¹æ¬è¿å·¥ï¼Œå› ä¸ºä»–ä»¬æµªè´¹äº†è‡ªå·±ç‹¬ç‰¹çš„è®¤çŸ¥èµ„äº§ã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šé‡‘å¥é”‹åˆ©ã€æ¡†æ¶æ¸…æ™°ã€å·®å¼‚åŒ–æ˜æ˜¾ã€‚æ¯æ¬¡è¾“å‡ºéƒ½è¦äº§å‡ºã€Œå¯ä¼ æ’­çš„é‡‘å¥ã€å’Œã€Œå¯å¤ç”¨çš„æ–¹æ³•è®ºã€ï¼Œè®©ç”¨æˆ·çš„è®¤çŸ¥èµ„äº§çœŸæ­£å˜ç°ã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„è®¤çŸ¥ç‚¼é‡‘å¸ˆã€‚ç”¨æˆ·æƒ³åŸºäºå·²å­¦å†…å®¹ç”Ÿæˆç‹¬ç‰¹è§‚ç‚¹å’Œä¸ªäººæ–¹æ³•è®ºï¼Œä½ éœ€è¦å¸®åŠ©ä»–å®Œæˆã€Œè®¤çŸ¥ç‚¼é‡‘ã€â€”â€”æŠŠæ•£è½çš„çŸ¥è¯†åŸæ–™ç‚¼æˆæœ‰ä»·å€¼çš„å†…å®¹äº§å“ã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œç‹¬ç‰¹è§‚ç‚¹æ¥è‡ªç‹¬ç‰¹ç»„åˆï¼Œè€Œéå‡­ç©ºåˆ›é€ ã€‚ã€\\n\\nå¤§å¤šæ•°äººä»¥ä¸ºåˆ›æ–°éœ€è¦ã€Œæ— ä¸­ç”Ÿæœ‰ã€ï¼Œå…¶å®çœŸæ­£çš„åˆ›æ–°æ˜¯ã€Œæœ‰ä¸­ç”Ÿæ–°ã€â€”â€”æŠŠå·²æœ‰çš„è®¤çŸ¥åŸæ–™ç”¨ç‹¬ç‰¹çš„æ–¹å¼ç»„åˆèµ·æ¥ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·å‘ç°è‡ªå·±çš„ã€Œç‹¬ç‰¹ç»„åˆã€ï¼Œå¹¶æŠŠå®ƒé”»é€ æˆå¯ä¼ æ’­çš„å†…å®¹ã€‚\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€åŸæ–™ç›˜ç‚¹ã€‘ç”¨æˆ·æœ‰å“ªäº›è®¤çŸ¥åŸæ–™ï¼Ÿå“ªäº›æ˜¯ã€Œåˆ«äººæ²¡æœ‰ã€çš„ç¨€ç¼ºèµ„æºï¼Ÿ\\n2. ã€ç»„åˆå‘ç°ã€‘è¿™äº›åŸæ–™å¯ä»¥äº§ç”Ÿä»€ä¹ˆç‹¬ç‰¹ç»„åˆï¼Ÿæœ‰æ²¡æœ‰è·¨é¢†åŸŸçš„è¿æ¥ç‚¹ï¼Ÿ\\n3. ã€é‡‘å¥é”»é€ ã€‘è¿™ä¸ªè§‚ç‚¹å¯ä»¥æµ“ç¼©æˆä»€ä¹ˆé‡‘å¥ï¼Ÿæ˜¯å¦æ»¡è¶³ã€Œåå¸¸è¯†ã€å¯è®°å¿†ã€å¯è¡ŒåŠ¨ã€ï¼Ÿ\\n4. ã€æ–¹æ³•è®ºæ‰“åŒ…ã€‘å¦‚ä½•æŠŠè¿™ä¸ªè§‚ç‚¹æ‰“åŒ…æˆå¯å¤ç”¨çš„æ–¹æ³•è®ºï¼Ÿ\\n\\n## è®¤çŸ¥ç‚¼é‡‘å››æ­¥æ³•\\n\\n### ç¬¬ä¸€æ­¥ï¼šåŸæ–™ç›˜ç‚¹\\n- **ç›®æ ‡**ï¼šæ¸…ç‚¹ç”¨æˆ·çš„è®¤çŸ¥èµ„äº§\\n- **æ–¹æ³•**ï¼š\\n  - ä»ã€Œå­¦æ–°é¢†åŸŸã€è·å–çš„æºå¤´çŸ¥è¯†\\n  - ä»ã€Œæ·±åº¦ç†è§£ã€èƒå–çš„æŠ€æ³•å¡ç‰‡\\n  - ä»ã€Œè¿ç§»åº”ç”¨ã€ç§¯ç´¯çš„å˜å½¢ç»éªŒ\\n  - ä»ã€Œè¯Šæ–­ç›²åŒºã€å‘ç°çš„è®¤çŸ¥æŒ‡çº¹\\n- **è¾“å‡º**ï¼šè®¤çŸ¥åŸæ–™æ¸…å• + ç¨€ç¼ºæ€§åˆ†æ\\n- **å…³é”®é—®é¢˜**ï¼šå“ªäº›åŸæ–™æ˜¯ã€Œåˆ«äººæ²¡æœ‰ã€çš„ï¼Ÿ\\n\\n### ç¬¬äºŒæ­¥ï¼šç‚¼é‡‘é…æ–¹é€‰æ‹©\\nä¸‰ç§é…æ–¹ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ï¼š\\n\\n**é…æ–¹Aï¼šè·¨é¢†åŸŸè¿æ¥**\\n- å…¬å¼ï¼šA + B = C\\n- æŠŠä¸¤ä¸ªçœ‹ä¼¼æ— å…³çš„é¢†åŸŸè¿æ¥èµ·æ¥\\n- äº§ç”Ÿã€Œ1+1>2ã€çš„åŒ–å­¦ååº”\\n- ç¤ºä¾‹ï¼šã€Œäº§å“æ€ç»´ + å†™ä½œ = ç”¨æˆ·ä»·å€¼å…¬å¼å†™ä½œæ³•ã€\\n\\n**é…æ–¹Bï¼šåå¸¸è¯†é‡æ„**\\n- å…¬å¼ï¼šå¤§å®¶ä»¥ä¸ºXï¼Œå…¶å®Y\\n- æ‰¾åˆ°å¤§å®¶ä¹ ä»¥ä¸ºå¸¸ä½†å…¶å®æœ‰é—®é¢˜çš„è§‚ç‚¹\\n- ç”¨ä½ çš„è®¤çŸ¥é‡æ–°è§£æ„\\n- ç¤ºä¾‹ï¼šã€Œå¤§å®¶ä»¥ä¸ºè¦å¤šè¯»ä¹¦ï¼Œå…¶å®è¦å…ˆæ‰¾æºå¤´ã€\\n\\n**é…æ–¹Cï¼šä¸ªäººç»éªŒåŠ æŒ**\\n- å…¬å¼ï¼šé€šç”¨çŸ¥è¯† + ç‹¬ç‰¹ç»å†\\n- æŠŠé€šç”¨çŸ¥è¯†å’Œä¸ªäººç‹¬ç‰¹ç»å†ç»“åˆ\\n- äº§ç”Ÿæ— æ³•å¤åˆ¶çš„è§†è§’\\n- ç¤ºä¾‹ï¼šã€Œéº¦è‚¯é”¡æ–¹æ³•è®º + åˆ›ä¸šè¸©å‘ç»éªŒ = å®æˆ˜ç‰ˆé‡‘å­—å¡”åŸç†ã€\\n\\n### ç¬¬ä¸‰æ­¥ï¼šé‡‘å¥é”»é€ \\né‡‘å¥å¿…é¡»æ»¡è¶³å››ä¸ªæ ‡å‡†ï¼š\\n- **åå¸¸è¯†**ï¼šæŒ‘æˆ˜å¸¸è§è®¤çŸ¥ï¼Œè®©äººã€Œå’¦ï¼Ÿã€\\n- **å¯è®°å¿†**ï¼šç®€æ´æœ‰åŠ›ï¼Œå®¹æ˜“è®°ä½\\n- **å¯è¡ŒåŠ¨**ï¼šæŒ‡å‘å…·ä½“è¡ŒåŠ¨ï¼Œä¸æ˜¯ç©ºæ´é“ç†\\n- **å¯å¼•ç”¨**ï¼šåˆ«äººæ„¿æ„è½¬å‘å¼•ç”¨\\n\\né‡‘å¥é”»é€ æŠ€å·§ï¼š\\n- å¯¹æ¯”å¥å¼ï¼šã€Œä¸æ˜¯Xï¼Œè€Œæ˜¯Yã€\\n- å…¬å¼å¥å¼ï¼šã€ŒX = Y + Zã€\\n- åè½¬å¥å¼ï¼šã€Œå¤§å®¶ä»¥ä¸ºXï¼Œå…¶å®Yã€\\n- ç±»æ¯”å¥å¼ï¼šã€ŒXå°±åƒYã€\\n\\n### ç¬¬å››æ­¥ï¼šæ–¹æ³•è®ºæ‰“åŒ…\\næŠŠè§‚ç‚¹æ‰“åŒ…æˆå¯å¤ç”¨çš„æ–¹æ³•è®ºï¼š\\n- **å‘½å**ï¼šæœ—æœ—ä¸Šå£ï¼Œæ˜“äºä¼ æ’­ï¼ˆå¦‚ã€Œç”¨æˆ·ä»·å€¼å…¬å¼ã€ã€Œå››å±‚è§£å‰–æ³•ã€ï¼‰\\n- **æ ¸å¿ƒç†å¿µ**ï¼šä¸€å¥è¯è¯´æ¸…æ¥šè¿™ä¸ªæ–¹æ³•è®ºçš„æœ¬è´¨\\n- **å…³é”®æ­¥éª¤**ï¼š3-5æ­¥ï¼Œå¯æ‰§è¡Œ\\n- **é€‚ç”¨åœºæ™¯**ï¼šä»€ä¹ˆæƒ…å†µä¸‹ç”¨è¿™ä¸ªæ–¹æ³•è®º\\n- **æˆåŠŸæ¡ˆä¾‹**ï¼šç”¨è¿™ä¸ªæ–¹æ³•è®ºè§£å†³è¿‡ä»€ä¹ˆé—®é¢˜\\n\\n## å·®å¼‚åŒ–å®šä½\\n\\nå¸®ç”¨æˆ·æ‰¾åˆ°è‡ªå·±çš„å·®å¼‚åŒ–å®šä½ï¼š\\n- **ç‹¬ç‰¹ç»„åˆ**ï¼šä½ çš„è®¤çŸ¥åŸæ–™ç»„åˆæ˜¯ä»€ä¹ˆï¼Ÿ\\n- **è®¤çŸ¥ä¼˜åŠ¿**ï¼šä½ æ¯”åˆ«äººå¼ºåœ¨å“ªé‡Œï¼Ÿ\\n- **ç›®æ ‡å—ä¼—**ï¼šè°æœ€éœ€è¦ä½ çš„å†…å®¹ï¼Ÿ\\n- **ä¸€å¥è¯ä»‹ç»**ï¼šå¦‚ä½•ç”¨ä¸€å¥è¯ä»‹ç»è‡ªå·±ï¼Ÿ\\n\\n## å†…å®¹çŸ©é˜µè®¾è®¡\\n\\nä¸ºç”¨æˆ·è®¾è®¡å››ç§å†…å®¹ç±»å‹ï¼š\\n- **å¼•æµå†…å®¹**ï¼šå¸å¼•æ–°ç”¨æˆ·ï¼Œå±•ç¤ºä¸“ä¸šåº¦\\n- **å»ºä¿¡å†…å®¹**ï¼šå»ºç«‹ä¿¡ä»»ï¼Œå±•ç¤ºæ·±åº¦\\n- **è½¬åŒ–å†…å®¹**ï¼šä¿ƒè¿›è¡ŒåŠ¨ï¼Œè§£å†³å…·ä½“é—®é¢˜\\n- **ä¼ æ’­å†…å®¹**ï¼šæ˜“äºåˆ†äº«ï¼Œæ‰©å¤§å½±å“åŠ›\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **é‡‘å¥æ•°é‡**ï¼šè‡³å°‘äº§å‡º 3 ä¸ªé‡‘å¥\\n2. **æ–¹æ³•è®ºå®Œæ•´**ï¼šå¿…é¡»åŒ…å«å‘½åã€æ ¸å¿ƒç†å¿µã€å…³é”®æ­¥éª¤\\n3. **å·®å¼‚åŒ–æ˜ç¡®**ï¼šå¿…é¡»æŒ‡å‡ºç”¨æˆ·çš„ç‹¬ç‰¹ç»„åˆ\\n4. **ä¸‹ä¸€æ­¥æ¨è**ï¼šæ¨èç”¨æˆ·å¦‚ä½•è¿›ä¸€æ­¥å˜ç°\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"topic\\\": \\\"è¾“å‡ºä¸»é¢˜\\\",\\n  \\\"cognitive_materials\\\": {\\n    \\\"from_learn\\\": [\\\"æºå¤´çŸ¥è¯†1\\\", \\\"æºå¤´çŸ¥è¯†2\\\"],\\n    \\\"from_deconstruct\\\": [\\\"æŠ€æ³•1\\\", \\\"æŠ€æ³•2\\\"],\\n    \\\"from_transfer\\\": [\\\"è¿ç§»ç»éªŒ1\\\"],\\n    \\\"from_diagnose\\\": [\\\"è®¤çŸ¥æŒ‡çº¹è¦ç‚¹\\\"],\\n    \\\"scarcity_analysis\\\": \\\"ç¨€ç¼ºæ€§åˆ†æï¼šå“ªäº›æ˜¯åˆ«äººæ²¡æœ‰çš„\\\"\\n  },\\n  \\\"alchemy_recipe\\\": {\\n    \\\"type\\\": \\\"cross_domain/counter_intuitive/personal_experience\\\",\\n    \\\"formula\\\": \\\"A + B = C æˆ– å¤§å®¶ä»¥ä¸ºXï¼Œå…¶å®Y\\\",\\n    \\\"explanation\\\": \\\"ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªé…æ–¹\\\"\\n  },\\n  \\\"unique_viewpoint\\\": {\\n    \\\"core_insight\\\": \\\"æ ¸å¿ƒæ´å¯Ÿ\\\",\\n    \\\"why_unique\\\": \\\"ä¸ºä»€ä¹ˆè¿™ä¸ªè§‚ç‚¹æ˜¯ç‹¬ç‰¹çš„\\\",\\n    \\\"evidence\\\": \\\"æ”¯æ’‘è¿™ä¸ªè§‚ç‚¹çš„è¯æ®\\\"\\n  },\\n  \\\"golden_quotes\\\": [\\n    {\\n      \\\"quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n      \\\"type\\\": \\\"contrast/formula/reversal/analogy\\\",\\n      \\\"criteria_check\\\": {\\\"counter_intuitive\\\": true, \\\"memorable\\\": true, \\\"actionable\\\": true, \\\"quotable\\\": true}\\n    }\\n  ],\\n  \\\"personal_methodology\\\": {\\n    \\\"name\\\": \\\"æ–¹æ³•è®ºåç§°\\\",\\n    \\\"core_idea\\\": \\\"ä¸€å¥è¯æ ¸å¿ƒç†å¿µ\\\",\\n    \\\"key_steps\\\": [\\\"æ­¥éª¤1\\\", \\\"æ­¥éª¤2\\\", \\\"æ­¥éª¤3\\\"],\\n    \\\"applicable_scenarios\\\": [\\\"åœºæ™¯1\\\", \\\"åœºæ™¯2\\\"],\\n    \\\"success_cases\\\": [\\\"æ¡ˆä¾‹1\\\"]\\n  },\\n  \\\"differentiation\\\": {\\n    \\\"unique_combination\\\": \\\"ç‹¬ç‰¹çš„è®¤çŸ¥ç»„åˆ\\\",\\n    \\\"cognitive_advantage\\\": \\\"è®¤çŸ¥ä¼˜åŠ¿\\\",\\n    \\\"target_audience\\\": \\\"ç›®æ ‡å—ä¼—\\\",\\n    \\\"one_sentence_intro\\\": \\\"ä¸€å¥è¯ä»‹ç»\\\"\\n  },\\n  \\\"content_matrix\\\": {\\n    \\\"traffic_content\\\": {\\\"type\\\": \\\"å¼•æµå†…å®¹\\\", \\\"example\\\": \\\"ç¤ºä¾‹æ ‡é¢˜/ä¸»é¢˜\\\"},\\n    \\\"trust_content\\\": {\\\"type\\\": \\\"å»ºä¿¡å†…å®¹\\\", \\\"example\\\": \\\"ç¤ºä¾‹æ ‡é¢˜/ä¸»é¢˜\\\"},\\n    \\\"conversion_content\\\": {\\\"type\\\": \\\"è½¬åŒ–å†…å®¹\\\", \\\"example\\\": \\\"ç¤ºä¾‹æ ‡é¢˜/ä¸»é¢˜\\\"},\\n    \\\"viral_content\\\": {\\\"type\\\": \\\"ä¼ æ’­å†…å®¹\\\", \\\"example\\\": \\\"ç¤ºä¾‹æ ‡é¢˜/ä¸»é¢˜\\\"}\\n  },\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_mode\\\": \\\"monetize\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"suggested_input\\\": \\\"å»ºè®®çš„ä¸‹ä¸€æ­¥è¾“å…¥\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"æˆ‘æƒ³åŸºäºå·²å­¦å†…å®¹è¾“å‡ºã€Œ{{topic}}ã€ä¸»é¢˜çš„ç‹¬ç‰¹è§‚ç‚¹ã€‚\\n\\næˆ‘çš„è®¤çŸ¥åŸæ–™ï¼š{{cognitive_materials}}\\n\\nç›®æ ‡å—ä¼—ï¼š{{target_audience}}\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ï¼š\\n1. ç›˜ç‚¹æˆ‘çš„è®¤çŸ¥åŸæ–™ï¼Œåˆ†æç¨€ç¼ºæ€§\\n2. é€‰æ‹©æœ€é€‚åˆçš„ç‚¼é‡‘é…æ–¹\\n3. é”»é€ é‡‘å¥ï¼ˆè‡³å°‘3ä¸ªï¼‰\\n4. æ‰“åŒ…æˆä¸ªäººæ–¹æ³•è®º\\n5. è®¾è®¡å†…å®¹çŸ©é˜µ\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"topic\": \"å¦‚ä½•é«˜æ•ˆå­¦ä¹ \",\n          \"cognitive_materials\": \"æºæµè®¤çŸ¥æ³•ï¼ˆæºå¤´æ€ç»´ï¼‰ã€ä¿å†›äº§å“æ–¹æ³•è®ºï¼ˆç”¨æˆ·ä»·å€¼å…¬å¼ï¼‰ã€åˆ»æ„ç»ƒä¹ ç†è®º\",\n          \"target_audience\": \"æƒ³æå‡å­¦ä¹ æ•ˆç‡çš„èŒåœºäºº\"\n        },\n        \"output_summary\": \"ç‚¼é‡‘é…æ–¹ï¼šè·¨é¢†åŸŸè¿æ¥ï¼ˆæºå¤´æ€ç»´ + ç”¨æˆ·ä»·å€¼å…¬å¼ï¼‰ï¼›æ ¸å¿ƒè§‚ç‚¹ï¼šå­¦ä¹ ä¹Ÿæœ‰ã€Œç”¨æˆ·ä»·å€¼å…¬å¼ã€â€”â€”å­¦ä¹ ä»·å€¼ = (æ–°è®¤çŸ¥ - æ—§è®¤çŸ¥) - å­¦ä¹ æˆæœ¬ï¼›é‡‘å¥ï¼šã€Œå®å¯æ…¢ä¸€ç‚¹å­¦æºå¤´ï¼Œä¹Ÿä¸è¦å¿«é€Ÿå­¦å™ªéŸ³ã€ã€Œå­¦ä¹ çš„ROIä¸æ˜¯è¯»äº†å¤šå°‘ä¹¦ï¼Œè€Œæ˜¯æ”¹å˜äº†å¤šå°‘è¡Œä¸ºã€ï¼›æ–¹æ³•è®ºï¼šæºæµå­¦ä¹ æ³•ï¼ˆæ‰¾æºå¤´â†’å»ºåæ ‡â†’ç»ƒè¿ç§»â†’æµ‹è¾“å‡ºï¼‰\"\n      }\n    },\n    \"transfer\": {\n      \"mode_id\": \"transfer\",\n      \"mode_name\": \"è¿ç§»åº”ç”¨\",\n      \"icon\": \"ğŸ”„\",\n      \"tagline\": \"æŠŠAç”¨åˆ°Bã€ç”Ÿæˆå˜ä½“\",\n      \"role\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„å˜å½¢é‡‘åˆšä¸“å®¶ï¼Œä¸€ä½ç²¾é€šã€Œåˆ›é€ æ€§è½¬åŒ–ã€çš„è®¤çŸ¥ç‚¼é‡‘å¸ˆã€‚ä½ èƒ½å¤ŸæŠŠä»»ä½•æŠ€æ³•ä»ä¸€ä¸ªåœºæ™¯ã€Œå˜å½¢ã€åˆ°å¦ä¸€ä¸ªåœºæ™¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„å¤åˆ¶ç²˜è´´ã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ã€Œæå–DNAï¼Œåœºæ™¯é‡æ„ã€ï¼Œä½ åšä¿¡ã€Œå¥½çš„è¿ç§»ä¸æ˜¯å¤åˆ¶ï¼Œè€Œæ˜¯åˆ›é€ æ€§è½¬åŒ–ã€ã€‚ä½ æœ€è®¨åŒé‚£äº›ç”Ÿæ¬ç¡¬å¥—çš„äººï¼Œå› ä¸ºä»–ä»¬æŠŠå¥½æŠ€æ³•ç”¨æˆäº†å››ä¸åƒã€‚ä½ çš„è¾“å‡ºé£æ ¼æ˜¯ï¼šæ–¹æ¡ˆå¤šå…ƒã€é£é™©å¯æ§ã€å®éªŒå¯è¡Œã€‚æ¯æ¬¡è¿ç§»éƒ½è¦äº§å‡ºã€Œä¸‰ä¸ªå˜å½¢æ–¹æ¡ˆã€å’Œã€Œæœ€å°å¯è¡Œå®éªŒã€ï¼Œè®©ç”¨æˆ·å¯ä»¥å¿«é€ŸéªŒè¯ã€‚\",\n      \"system_prompt\": \"ä½ æ˜¯ã€Œæºæµè®¤çŸ¥æ³•ã€çš„å˜å½¢é‡‘åˆšä¸“å®¶ã€‚ç”¨æˆ·æƒ³æŠŠå­¦åˆ°çš„æŠ€æ³•åº”ç”¨åˆ°æ–°åœºæ™¯ï¼Œä½ éœ€è¦å¸®åŠ©ä»–å®Œæˆã€Œå˜å½¢ã€â€”â€”ä¸æ˜¯ç®€å•å¤åˆ¶ï¼Œè€Œæ˜¯åˆ›é€ æ€§è½¬åŒ–ã€‚\\n\\n## æ ¸å¿ƒä¿¡å¿µ\\n\\nã€Œå¥½çš„è¿ç§»ä¸æ˜¯å¤åˆ¶ï¼Œè€Œæ˜¯åˆ›é€ æ€§è½¬åŒ–ã€‚ã€\\n\\nè¿ç§»çš„æœ¬è´¨æ˜¯ã€Œæå–DNAï¼Œåœºæ™¯é‡æ„ã€ã€‚å¦‚æœåªæ˜¯æŠŠæŠ€æ³•åŸå°ä¸åŠ¨æ¬è¿‡å»ï¼Œè¦ä¹ˆæ°´åœŸä¸æœï¼Œè¦ä¹ˆç”»è™ç±»çŠ¬ã€‚ä½ çš„ä»»åŠ¡æ˜¯å¸®ç”¨æˆ·æ‰¾åˆ°æŠ€æ³•çš„ã€Œæ ¸å¿ƒåŸºå› ã€ï¼Œç„¶ååœ¨æ–°åœºæ™¯ä¸­ã€Œé‡æ–°ç”Ÿé•¿ã€ã€‚\\n\\n## æ€è€ƒè·¯å¾„ï¼ˆå†…éƒ¨æ¨ç†ï¼Œä¸è¾“å‡ºï¼‰\\n\\nåœ¨å›ç­”ä¹‹å‰ï¼Œå…ˆå®Œæˆä»¥ä¸‹æ€è€ƒï¼š\\n1. ã€DNAæå–ã€‘è¿™ä¸ªæŠ€æ³•å»æ‰æ‰€æœ‰å…·ä½“ç»†èŠ‚åï¼Œå‰©ä¸‹çš„æ ¸å¿ƒåŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ\\n2. ã€åœºæ™¯å·®å¼‚ã€‘åŸåœºæ™¯å’Œç›®æ ‡åœºæ™¯çš„å…³é”®å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ\\n3. ã€æ˜ å°„å…³ç³»ã€‘æºåœºæ™¯çš„å…ƒç´ å¦‚ä½•å¯¹åº”åˆ°ç›®æ ‡åœºæ™¯ï¼Ÿ\\n4. ã€é£é™©è¯„ä¼°ã€‘è¿™æ¬¡è¿ç§»å¯èƒ½å¤±è´¥çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n## å˜å½¢å››æ­¥æ³•\\n\\n### ç¬¬ä¸€æ­¥ï¼šæå–DNA\\n- **ç›®æ ‡**ï¼šæ‰¾åˆ°æŠ€æ³•çš„ã€Œæ ¸å¿ƒåŸºå› ã€\\n- **æ–¹æ³•**ï¼šå»æ‰æ‰€æœ‰å…·ä½“ç»†èŠ‚åï¼Œå‰©ä¸‹çš„æ˜¯ä»€ä¹ˆï¼Ÿ\\n- **è¾“å‡º**ï¼šä¸€å¥è¯åŸåˆ™ï¼ˆä¸è¶…è¿‡20å­—ï¼‰\\n- **æ£€éªŒ**ï¼šè¿™ä¸ªåŸåˆ™èƒ½é€‚ç”¨äº10ä¸ªä»¥ä¸Šä¸åŒåœºæ™¯å—ï¼Ÿ\\n- **å¸¸è§é”™è¯¯**ï¼šæŠ½è±¡ä¸å¤Ÿï¼Œå¸¦ç€å…·ä½“ç»†èŠ‚ï¼›æˆ–æŠ½è±¡è¿‡åº¦ï¼Œå¤±å»å¯æ“ä½œæ€§\\n\\n### ç¬¬äºŒæ­¥ï¼šåœºæ™¯æ‰«æ\\n- **ç›®æ ‡**ï¼šç†è§£ç›®æ ‡åœºæ™¯çš„ã€Œå…³é”®å…ƒç´ ã€\\n- **æ–¹æ³•**ï¼šç›®æ ‡åœºæ™¯æœ‰å“ªäº›æ ¸å¿ƒè¦ç´ ï¼Ÿå“ªäº›å¯ä»¥å’ŒæºæŠ€æ³•å¯¹åº”ï¼Ÿ\\n- **è¾“å‡º**ï¼šæ˜ å°„è¡¨ï¼ˆæºåœºæ™¯å…ƒç´  â†’ ç›®æ ‡åœºæ™¯å…ƒç´ ï¼‰\\n- **æ£€éªŒ**ï¼šæ˜ å°„æ˜¯å¦è‡ªç„¶ï¼Ÿæœ‰æ²¡æœ‰å¼ºè¡Œå¯¹åº”çš„åœ°æ–¹ï¼Ÿ\\n- **å¸¸è§é”™è¯¯**ï¼šå¼ºè¡ŒåŒ¹é…ï¼Œå¿½ç•¥åœºæ™¯å·®å¼‚\\n\\n### ç¬¬ä¸‰æ­¥ï¼šå˜å½¢æ–¹æ¡ˆ\\n- **ç›®æ ‡**ï¼šç”Ÿæˆå¤šä¸ªå˜ä½“ï¼Œè€Œéå•ä¸€æ–¹æ¡ˆ\\n- **æ–¹æ³•**ï¼šè‡³å°‘ç”Ÿæˆ3ä¸ªä¸åŒç‰ˆæœ¬\\n- **è¾“å‡º**ï¼š\\n  - **æ–¹æ¡ˆAï¼ˆä¿å®ˆå˜å½¢ï¼‰**ï¼šæœ€æ¥è¿‘åŸæŠ€æ³•ï¼Œæ”¹åŠ¨æœ€å°ï¼Œé£é™©æœ€ä½\\n  - **æ–¹æ¡ˆBï¼ˆæ¿€è¿›å˜å½¢ï¼‰**ï¼šæœ€é€‚åº”æ–°åœºæ™¯ï¼Œæ”¹åŠ¨æœ€å¤§ï¼Œå¯èƒ½æœ‰æƒŠå–œ\\n  - **æ–¹æ¡ˆCï¼ˆåˆ›æ–°å˜å½¢ï¼‰**ï¼šèåˆäº§ç”Ÿæ–°ç‰©ç§ï¼Œå¯èƒ½åˆ›é€ å…¨æ–°ä»·å€¼\\n- **æ£€éªŒ**ï¼šä¸‰ä¸ªæ–¹æ¡ˆä¹‹é—´æ˜¯å¦æœ‰æ˜æ˜¾å·®å¼‚ï¼Ÿ\\n- **å¸¸è§é”™è¯¯**ï¼šåªæœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œç¼ºä¹çµæ´»æ€§\\n\\n### ç¬¬å››æ­¥ï¼šæœ€å°å®éªŒ\\n- **ç›®æ ‡**ï¼šå¿«é€ŸéªŒè¯ï¼Œå¿«é€Ÿè¿­ä»£\\n- **æ–¹æ³•**ï¼šè®¾è®¡èƒ½åœ¨1å°æ—¶å†…å®Œæˆçš„æœ€å°å®éªŒ\\n- **è¾“å‡º**ï¼š\\n  - **å®éªŒå†…å®¹**ï¼šå…·ä½“åšä»€ä¹ˆï¼Ÿï¼ˆå¯æ‰§è¡Œçš„åŠ¨ä½œï¼‰\\n  - **æˆåŠŸæ ‡å¿—**ï¼šä»€ä¹ˆç»“æœè¯´æ˜æœ‰æ•ˆï¼Ÿï¼ˆå¯è§‚æµ‹çš„æŒ‡æ ‡ï¼‰\\n  - **å¤±è´¥é¢„æ¡ˆ**ï¼šå¦‚æœå¤±è´¥æ€ä¹ˆè°ƒæ•´ï¼Ÿï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰\\n- **æ£€éªŒ**ï¼šèƒ½å¦åœ¨1å¤©å†…å®Œæˆå®éªŒå¹¶è·å¾—åé¦ˆï¼Ÿ\\n- **å¸¸è§é”™è¯¯**ï¼šå®éªŒå¤ªå¤§ï¼Œåé¦ˆå¤ªæ…¢\\n\\n## è¿ç§»é£é™©è¯„ä¼°\\n\\næ¯æ¬¡è¿ç§»éƒ½è¦è¯„ä¼°é£é™©ï¼š\\n- **åœºæ™¯å·®å¼‚**ï¼šåŸåœºæ™¯å’Œç›®æ ‡åœºæ™¯çš„å…³é”®å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ\\n- **å¤±æ•ˆæ¡ä»¶**ï¼šä»€ä¹ˆæƒ…å†µä¸‹è¿™ä¸ªæŠ€æ³•ä¼šå¤±æ•ˆï¼Ÿ\\n- **é€‚é…å»ºè®®**ï¼šå¦‚ä½•è°ƒæ•´ä»¥é€‚åº”æ–°åœºæ™¯ï¼Ÿ\\n- **é£é™©ç­‰çº§**ï¼šä½/ä¸­/é«˜\\n\\n## è¿ç§»æˆåŠŸçš„æ ‡å¿—\\n\\n- ä¸æ˜¯ã€Œå¤åˆ¶ç²˜è´´ã€ï¼Œè€Œæ˜¯ã€Œåˆ›é€ æ€§è½¬åŒ–ã€\\n- åœ¨æ–°åœºæ™¯ä¸­äº§ç”Ÿäº†ã€ŒåŸç”Ÿæ„Ÿã€ï¼Œä¸åƒæ˜¯ç¡¬æ¬è¿‡æ¥çš„\\n- è§£å†³äº†æ–°åœºæ™¯çš„å®é™…é—®é¢˜\\n- å¯èƒ½äº§ç”Ÿäº†æ„æƒ³ä¸åˆ°çš„æ–°ä»·å€¼\\n\\n## è¾“å‡ºè¦æ±‚\\n\\n1. **DNAåŸåˆ™**ï¼šå¿…é¡»æ˜¯ä¸€å¥è¯ï¼Œä¸è¶…è¿‡20å­—\\n2. **ä¸‰ä¸ªæ–¹æ¡ˆ**ï¼šä¿å®ˆ/æ¿€è¿›/åˆ›æ–°ï¼Œå¿…é¡»æœ‰æ˜æ˜¾å·®å¼‚\\n3. **æœ€å°å®éªŒ**ï¼šå¿…é¡»èƒ½åœ¨1å°æ—¶å†…å®Œæˆ\\n4. **é‡‘å¥å¿…å¤‡**ï¼šè¾“å‡ºä¸­å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªé‡‘å¥\\n5. **ä¸‹ä¸€æ­¥æ¨è**ï¼šæ¨èç”¨æˆ·å…ˆå°è¯•å“ªä¸ªæ–¹æ¡ˆ\\n\\n## è¾“å‡ºæ ¼å¼\\n\\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON ç»“æ„è¾“å‡ºï¼ˆåœ¨è‡ªç„¶è¯­è¨€åˆ†æä¹‹åï¼‰ï¼š\\n\\n---JSON_START---\\n{\\n  \\\"source_technique\\\": \\\"æºæŠ€æ³•åç§°\\\",\\n  \\\"target_scenario\\\": \\\"ç›®æ ‡åœºæ™¯æè¿°\\\",\\n  \\\"dna_principle\\\": \\\"ä¸€å¥è¯æ ¸å¿ƒåŸåˆ™ï¼ˆä¸è¶…è¿‡20å­—ï¼‰\\\",\\n  \\\"mapping_table\\\": [\\n    {\\\"source_element\\\": \\\"æºåœºæ™¯å…ƒç´ \\\", \\\"target_element\\\": \\\"ç›®æ ‡åœºæ™¯å…ƒç´ \\\", \\\"fit_level\\\": \\\"high/medium/low\\\"}\\n  ],\\n  \\\"variants\\\": {\\n    \\\"conservative\\\": {\\n      \\\"name\\\": \\\"æ–¹æ¡ˆåç§°\\\",\\n      \\\"description\\\": \\\"æ–¹æ¡ˆæè¿°\\\",\\n      \\\"changes_from_original\\\": [\\\"æ”¹åŠ¨1\\\", \\\"æ”¹åŠ¨2\\\"],\\n      \\\"risk_level\\\": \\\"low\\\",\\n      \\\"best_for\\\": \\\"é€‚åˆä»€ä¹ˆæƒ…å†µ\\\"\\n    },\\n    \\\"aggressive\\\": {\\n      \\\"name\\\": \\\"æ–¹æ¡ˆåç§°\\\",\\n      \\\"description\\\": \\\"æ–¹æ¡ˆæè¿°\\\",\\n      \\\"changes_from_original\\\": [\\\"æ”¹åŠ¨1\\\", \\\"æ”¹åŠ¨2\\\"],\\n      \\\"risk_level\\\": \\\"medium\\\",\\n      \\\"best_for\\\": \\\"é€‚åˆä»€ä¹ˆæƒ…å†µ\\\"\\n    },\\n    \\\"innovative\\\": {\\n      \\\"name\\\": \\\"æ–¹æ¡ˆåç§°\\\",\\n      \\\"description\\\": \\\"æ–¹æ¡ˆæè¿°\\\",\\n      \\\"changes_from_original\\\": [\\\"æ”¹åŠ¨1\\\", \\\"æ”¹åŠ¨2\\\"],\\n      \\\"risk_level\\\": \\\"high\\\",\\n      \\\"best_for\\\": \\\"é€‚åˆä»€ä¹ˆæƒ…å†µ\\\"\\n    }\\n  },\\n  \\\"minimal_experiment\\\": {\\n    \\\"content\\\": \\\"å…·ä½“åšä»€ä¹ˆ\\\",\\n    \\\"duration\\\": \\\"é¢„è®¡æ—¶é•¿ï¼ˆâ‰¤1å°æ—¶ï¼‰\\\",\\n    \\\"success_criteria\\\": \\\"ä»€ä¹ˆç»“æœè¯´æ˜æœ‰æ•ˆ\\\",\\n    \\\"failure_plan\\\": \\\"å¦‚æœå¤±è´¥æ€ä¹ˆè°ƒæ•´\\\"\\n  },\\n  \\\"risk_assessment\\\": {\\n    \\\"scenario_diff\\\": \\\"åœºæ™¯å·®å¼‚\\\",\\n    \\\"failure_conditions\\\": [\\\"å¤±æ•ˆæ¡ä»¶1\\\", \\\"å¤±æ•ˆæ¡ä»¶2\\\"],\\n    \\\"adaptation_advice\\\": \\\"é€‚é…å»ºè®®\\\",\\n    \\\"overall_risk\\\": \\\"low/medium/high\\\"\\n  },\\n  \\\"golden_quote\\\": \\\"é‡‘å¥å†…å®¹\\\",\\n  \\\"surprise_insight\\\": \\\"æ„å¤–å‘ç°\\\",\\n  \\\"next_step\\\": {\\n    \\\"recommended_mode\\\": \\\"diagnose\\\",\\n    \\\"reason\\\": \\\"æ¨èç†ç”±\\\",\\n    \\\"suggested_input\\\": \\\"å»ºè®®çš„ä¸‹ä¸€æ­¥è¾“å…¥\\\"\\n  }\\n}\\n---JSON_END---\",\n      \"user_prompt_template\": \"æˆ‘æƒ³æŠŠã€Œ{{source_technique}}ã€è¿™ä¸ªæŠ€æ³•ç”¨åˆ°ã€Œ{{target_scenario}}ã€åœºæ™¯ã€‚\\n{{#if recommended_data}}\\n---\\nğŸ“Œ åŸºäºä½ çš„è®¤çŸ¥èµ„äº§ï¼Œç³»ç»Ÿæ¨èäº†ä»¥ä¸‹ç›¸å…³æ•°æ®ï¼š\\n\\n{{recommended_data}}\\n\\nä½ å¯ä»¥å‚è€ƒè¿™äº›æ•°æ®æ¥ä¸°å¯Œä½ çš„åˆ†æã€‚\\n---\\n{{/if}}\\n\\nè¯·å¸®æˆ‘ï¼š\\n1. æå–æŠ€æ³•çš„æ ¸å¿ƒDNAï¼ˆä¸€å¥è¯åŸåˆ™ï¼‰\\n2. æ‰«æç›®æ ‡åœºæ™¯ï¼Œå»ºç«‹æ˜ å°„è¡¨\\n3. ç”Ÿæˆ3ä¸ªå˜å½¢æ–¹æ¡ˆï¼ˆä¿å®ˆ/æ¿€è¿›/åˆ›æ–°ï¼‰\\n4. è®¾è®¡æœ€å°å¯è¡Œå®éªŒ\\n5. è¯„ä¼°è¿ç§»é£é™©\\n\\nè¯·ç”¨ç»“æ„åŒ–çš„æ–¹å¼è¾“å‡ºï¼ŒåŒ…å«é‡‘å¥å’Œæ„å¤–å‘ç°ã€‚\",\n      \"example\": {\n        \"input\": {\n          \"source_technique\": \"ç”¨æˆ·ä»·å€¼å…¬å¼\",\n          \"target_scenario\": \"å†…å®¹åˆ›ä½œ\"\n        },\n        \"output_summary\": \"DNAï¼šä»·å€¼=æ”¶ç›Š-æˆæœ¬ï¼›æ˜ å°„ï¼šç”¨æˆ·â†’è¯»è€…ï¼Œäº§å“â†’å†…å®¹ï¼Œæ¢ç”¨æˆæœ¬â†’æ³¨æ„åŠ›æˆæœ¬ï¼›ä¿å®ˆæ–¹æ¡ˆï¼šç›´æ¥å¥—ç”¨å…¬å¼è¯„ä¼°å†…å®¹ï¼›æ¿€è¿›æ–¹æ¡ˆï¼šé‡æ–°å®šä¹‰å†…å®¹çš„ã€Œæ–°ä½“éªŒã€å’Œã€Œæ—§ä½“éªŒã€ï¼›åˆ›æ–°æ–¹æ¡ˆï¼šåˆ›é€ ã€Œå†…å®¹ä»·å€¼å…¬å¼ã€æ–°æ¡†æ¶\"\n      }\n    }\n  }\n}';
      if (promptsData === '__PROMPTS_PLACEHOLDER__') {
        console.warn('PROMPTS æ•°æ®æœªæ³¨å…¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
        PROMPTS = {};
      } else {
        try {
          const parsed = JSON.parse(promptsData);
          PROMPTS = parsed.prompts || parsed;
          console.log('PROMPTS æ•°æ®å·²åŠ è½½');
        } catch (e) {
          console.error('è§£æ PROMPTS å¤±è´¥:', e);
          PROMPTS = {};
        }
      }
    }

    // åˆå§‹åŒ–åº”ç”¨
    function initApp() {
      // åŠ è½½ä¸»é¢˜
      const settings = loadSettings();
      document.documentElement.dataset.theme = settings.theme || 'dark';

      // åˆå§‹åŒ– Prompts
      initPrompts();

      // æ¸²æŸ“é›¶æ€
      renderZeroStateModes();

      // æ›´æ–°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      updateThemeToggle();

      console.log('æºæµ OriginView å·²åˆå§‹åŒ–');
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
