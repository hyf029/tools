<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube å­—å¹•æå–å·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5; /* é›è“ */
            --primary-hover: #4338ca;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #111827;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --error: #ef4444;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 2.5rem;
            border: 1px solid var(--border);
        }
        
        /* å¤´éƒ¨ */
        header { margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        h1 { margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; color: var(--text-main); }
        .icon { font-size: 1.8rem; }
        .subtitle { margin-top: 0.5rem; color: var(--text-sub); font-size: 0.95rem; }

        /* è¾“å…¥åŒº */
        .input-group { margin-bottom: 1.5rem; position: relative; }
        .input-wrapper { display: flex; gap: 10px; }
        input[type="url"] {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            outline: none;
        }
        input[type="url"]:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-primary:disabled { opacity: 0.7; cursor: wait; }
        
        .btn-ai { background: var(--success); color: white; width: 100%; margin-top: 10px; }
        .btn-ai:hover { opacity: 0.9; }

        /* çº¿è·¯é€‰æ‹©å¾®è°ƒ */
        .settings { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-sub); }
        select { padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); color: var(--text-main); cursor: pointer; }

        /* å†…å®¹åŒº */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem; display: none; }
        .col { display: flex; flex-direction: column; }
        .col-label { font-weight: 600; margin-bottom: 0.8rem; display: flex; justify-content: space-between; align-items: center; }
        
        textarea {
            width: 100%;
            height: 500px;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            font-family: monospace;
            line-height: 1.6;
            background: #fafafa;
            box-sizing: border-box;
        }
        .markdown-body {
            height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            background: white;
            line-height: 1.7;
        }

        /* çŠ¶æ€æç¤º */
        #status { margin-top: 1rem; text-align: center; font-weight: 500; min-height: 24px; }
        .text-error { color: var(--error); }
        .text-success { color: var(--success); }

        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><span class="icon">ğŸ“</span> YouTube å­—å¹•æå–å·¥å…·</h1>
        <div class="subtitle">ä¸€é”®æå–è§†é¢‘å­—å¹•ï¼Œå¹¶ä½¿ç”¨ DeepSeek AI è¿›è¡Œæ™ºèƒ½æ•´ç†ã€‚</div>
    </header>

    <div class="settings">
        <span>ğŸ“¡ æå–çº¿è·¯:</span>
        <select id="provider">
            <option value="plural">çº¿è·¯ 1 (YouTube Transcripts - é«˜é¢åº¦)</option>
            <option value="transcriptor">çº¿è·¯ 2 (å¤‡ç”¨ - ç¨³å®šä½†é¢åº¦å°‘)</option>
        </select>
    </div>

    <div class="input-group">
        <div class="input-wrapper">
            <input type="url" id="videoUrl" placeholder="è¯·ç²˜è´´ YouTube è§†é¢‘é“¾æ¥..." onkeydown="if(event.key==='Enter') extract()">
            <button class="btn-primary" id="btnExt" onclick="extract()">ğŸš€ æå–å­—å¹•</button>
        </div>
        <div id="status"></div>
    </div>

    <div class="grid" id="resultArea">
        <div class="col">
            <div class="col-label">
                <span>ğŸ“„ è‹±æ–‡åŸæ–‡</span>
                <span style="font-size:0.8rem; font-weight:normal; color:var(--text-sub)" id="wordCount"></span>
            </div>
            <textarea id="englishOutput" readonly placeholder="æå–ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>

        <div class="col">
            <div class="col-label">
                <span>ğŸ§  ä¸­æ–‡ç¬”è®°</span>
            </div>
            <div id="chineseOutput" class="markdown-body">
                <div style="color:#9ca3af; text-align:center; margin-top:200px;">ç­‰å¾…åŸæ–‡æå–...</div>
            </div>
            <button class="btn-primary btn-ai" id="btnTrans" onclick="translateText()">âœ¨ DeepSeek ç¿»è¯‘ & æ•´ç†</button>
        </div>
    </div>
</div>

<script>
    // --- é…ç½®ä¸­å¿ƒ ---
    const CONFIG = {
        // Line 1: å¯¹åº”æ‚¨æˆªå›¾ç¬¬ä¸€è¡Œ (å¤æ•°s)
        plural: { host: "youtube-transcripts.p.rapidapi.com", endpoint: "/youtube/transcript", method: "GET" },
        // Line 2: å¯¹åº”æ‚¨æˆªå›¾ç¬¬äºŒè¡Œ (å•æ•°)
        transcriptor: { host: "youtube-transcriptor.p.rapidapi.com", endpoint: "/transcript", method: "GET" }
    };

    const els = {
        url: document.getElementById('videoUrl'),
        provider: document.getElementById('provider'),
        status: document.getElementById('status'),
        grid: document.getElementById('resultArea'),
        enOut: document.getElementById('englishOutput'),
        cnOut: document.getElementById('chineseOutput'),
        btnExt: document.getElementById('btnExt'),
        btnTrans: document.getElementById('btnTrans'),
        count: document.getElementById('wordCount')
    };

    function extractVideoID(url) {
        const match = url.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);
        return (match && match[7].length == 11) ? match[7] : false;
    }

    async function extract() {
        const url = els.url.value.trim();
        const videoId = extractVideoID(url);
        const apiKey = localStorage.getItem('rapidapi_key');
        const pKey = els.provider.value;
        const conf = CONFIG[pKey];

        if (!url) return showStatus("âŒ è¯·è¾“å…¥è§†é¢‘é“¾æ¥", "error");
        if (!videoId) return showStatus("âŒ æ— æ•ˆçš„ YouTube é“¾æ¥", "error");
        if (!apiKey) return showStatus("âŒ æœªæ£€æµ‹åˆ° Keyï¼Œè¯·å…ˆé…ç½® Key ç®¡ç†å™¨", "error");

        setLoading(true, "extract");
        showStatus(`æ­£åœ¨é€šè¿‡ [çº¿è·¯${pKey==='plural'?'1':'2'}] è¿æ¥...`, "normal");
        
        try {
            // æ„é€ è¯·æ±‚
            let targetUrl = `https://${conf.host}${conf.endpoint}`;
            if (pKey === 'plural') targetUrl += `?url=${encodeURIComponent(url)}`;
            else targetUrl += `?video_id=${videoId}&lang=en`;

            const res = await fetch(targetUrl, {
                method: conf.method,
                headers: { "X-RapidAPI-Key": apiKey, "X-RapidAPI-Host": conf.host }
            });

            if (!res.ok) throw new Error(`HTTP ${res.status} - æ¥å£è¯·æ±‚å¤±è´¥`);

            const data = await res.json();
            let text = "";

            // æ™ºèƒ½è§£æé€»è¾‘
            if (data.content && Array.isArray(data.content)) text = data.content.map(x => x.text).join(' ');
            else if (data.transcripts && Array.isArray(data.transcripts)) text = data.transcripts.map(x => x.text).join(' '); // çº¿è·¯1å¸¸è§æ ¼å¼
            else if (data.transcriptionAsText) text = data.transcriptionAsText; // çº¿è·¯2å¸¸è§æ ¼å¼
            else if (Array.isArray(data)) text = data.map(x => x.text || x.subtitle).join(' ');
            else text = JSON.stringify(data); // å…œåº•

            if (text.length < 50 && text.startsWith('{')) throw new Error("æå–å†…å®¹ä¸ºç©ºæˆ–æ ¼å¼æ— æ³•è¯†åˆ«");

            // æˆåŠŸå±•ç¤º
            els.grid.style.display = 'grid';
            els.enOut.value = text;
            els.count.textContent = `å…± ${text.length} å­—ç¬¦`;
            showStatus("âœ… å­—å¹•æå–æˆåŠŸï¼", "success");
            els.cnOut.innerHTML = "<div style='color:#6b7280; text-align:center; margin-top:200px;'>è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç¿»è¯‘</div>";

        } catch (e) {
            showStatus(`âŒ å¤±è´¥: ${e.message} (è¯·å°è¯•åˆ‡æ¢çº¿è·¯)`, "error");
        } finally {
            setLoading(false, "extract");
        }
    }

    async function translateText() {
        const text = els.enOut.value;
        const key = localStorage.getItem('siliconflow_key');
        if (!key) return alert("è¯·åœ¨ Key ç®¡ç†å™¨ä¸­é…ç½® siliconflow_key");
        if (!text) return alert("æ²¡æœ‰å¯ç¿»è¯‘çš„å†…å®¹");

        setLoading(true, "translate");
        els.cnOut.innerHTML = "<div style='padding:20px;'>â³ DeepSeek æ­£åœ¨æ€è€ƒä¸æ•´ç†...</div>";

        try {
            const res = await fetch("https://api.siliconflow.cn/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "deepseek-ai/DeepSeek-V3",
                    messages: [
                        { role: "system", content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç§‘æŠ€å†…å®¹æ•´ç†ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹è‹±æ–‡è§†é¢‘å­—å¹•ç¿»è¯‘å¹¶æ•´ç†ä¸ºä¸­æ–‡ç¬”è®°ã€‚è¦æ±‚ï¼š\n1. ä½¿ç”¨ Markdown æ ¼å¼ã€‚\n2. é€»è¾‘æ¸…æ™°ï¼Œä½¿ç”¨ä¸€çº§ã€äºŒçº§æ ‡é¢˜å’Œåˆ—è¡¨ã€‚\n3. å»é™¤å£è¯­å†—ä½™ï¼Œæç‚¼æ ¸å¿ƒå¹²è´§ã€‚" },
                        { role: "user", content: text }
                    ]
                })
            });
            const data = await res.json();
            if(data.error) throw new Error(data.error.message);
            els.cnOut.innerHTML = marked.parse(data.choices[0].message.content);
        } catch (e) {
            els.cnOut.innerHTML = `<div style='color:red; padding:20px;'>ç¿»è¯‘å‡ºé”™: ${e.message}</div>`;
        } finally {
            setLoading(false, "translate");
        }
    }

    function showStatus(msg, type) {
        els.status.textContent = msg;
        els.status.className = type === 'error' ? 'text-error' : 'text-success';
    }

    function setLoading(isLoading, type) {
        const btn = type === 'extract' ? els.btnExt : els.btnTrans;
        const originalText = type === 'extract' ? "ğŸš€ æå–å­—å¹•" : "âœ¨ DeepSeek ç¿»è¯‘ & æ•´ç†";
        btn.disabled = isLoading;
        btn.textContent = isLoading ? "å¤„ç†ä¸­..." : originalText;
    }
</script>
</body>
</html>